import * as vite from 'vite';
import { Plugin } from 'vite';
import { UserConfig, UnoGenerator, BetterMap, UserConfigDefaults } from '@unocss/core';

declare type FilterPattern = ReadonlyArray<string | RegExp> | string | RegExp | null;
interface PluginConfig<Theme extends {} = {}> extends UserConfig<Theme> {
    /**
     * Patterns that filter the files being extracted.
     */
    include?: FilterPattern;
    /**
     * Patterns that filter the files NOT being extracted.
     */
    exclude?: FilterPattern;
}

interface VitePluginConfig<Theme extends {} = {}> extends PluginConfig<Theme> {
    /**
     * Enable UnoCSS inspector
     *
     * @default true
     */
    inspector?: boolean;
    /**
     * CSS Generation mode
     *
     * - `global` - generate a single CSS sheet for entire App
     * - `dist-chunk` - generate a CSS sheet for each code chunk on build, great for MPA
     * - `per-module` - generate a CSS sheet for each module, can be scoped
     * - `vue-scoped` - inject generated CSS to Vue SFC's `<style scoped>` for isolation
     *
     * @default 'global'
     */
    mode?: 'global' | 'per-module' | 'vue-scoped' | 'dist-chunk';
}

interface UnocssPluginContext<Config extends PluginConfig = PluginConfig> {
    uno: UnoGenerator;
    config: Config;
    tokens: Set<string>;
    modules: BetterMap<string, string>;
    filter: (code: string, id: string) => boolean;
    reloadConfig: () => Promise<void>;
    extract: (code: string, id?: string) => Promise<void>;
    configFilepath?: string;
    invalidate: () => void;
    onInvalidate: (fn: () => void) => void;
}

declare function ChunkModeBuildPlugin({ uno, filter }: UnocssPluginContext): Plugin;

declare function GlobalModeDevPlugin({ uno, tokens, onInvalidate, extract, filter }: UnocssPluginContext): Plugin[];

declare function GlobalModeBuildPlugin({ uno, extract, tokens, modules, filter }: UnocssPluginContext): Plugin[];

declare function GlobalModePlugin(ctx: UnocssPluginContext): vite.Plugin[];

declare function PerModuleModePlugin({ uno, filter }: UnocssPluginContext): Plugin;

declare function VueScopedPlugin({ uno, config }: UnocssPluginContext): Plugin;

declare function defineConfig<Theme extends {}>(config: VitePluginConfig<Theme>): VitePluginConfig<Theme>;
declare function UnocssPlugin(configOrPath?: VitePluginConfig | string, defaults?: UserConfigDefaults): Plugin[];

export { ChunkModeBuildPlugin, GlobalModeBuildPlugin, GlobalModeDevPlugin, GlobalModePlugin, PerModuleModePlugin, UnocssPluginContext, VitePluginConfig, VueScopedPlugin, UnocssPlugin as default, defineConfig };
