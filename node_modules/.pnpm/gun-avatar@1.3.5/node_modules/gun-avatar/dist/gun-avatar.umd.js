(function(g,d){typeof exports=="object"&&typeof module!="undefined"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(g=typeof globalThis!="undefined"?globalThis:g||self,d(g["gun-avatar"]={}))})(this,function(g){"use strict";(()=>{if(!r())return;const a=CanvasRenderingContext2D.prototype,t=a.drawImage;if(!t){console.error("This script requires a basic implementation of drawImage");return}a.drawImage=function(n,u,l){if(!(arguments.length===9))return t.apply(this,[...arguments]);const m=o(...arguments);if(!s(m))return t.apply(this,m)};function r(){const e=document.createElement("canvas").getContext("2d");e.fillRect(0,0,40,40),e.drawImage(e.canvas,-40,-40,80,80,50,50,20,20);const n=e.getImageData(50,50,30,30),u=new Uint32Array(n.data.buffer),l=(f,h)=>u[h*n.width+f],c=[[9,9],[20,9],[9,20],[20,20]],m=[[10,10],[19,10],[10,19],[19,19]];return c.some(([f,h])=>l(f,h)!==0)||m.some(([f,h])=>l(f,h)===0)}function o(e,n,u,l,c,m,f,h,p){const{width:R,height:D}=i(e);l<0&&(n+=l,l=Math.abs(l)),c<0&&(u+=c,c=Math.abs(c)),h<0&&(m+=h,h=Math.abs(h)),p<0&&(f+=p,p=Math.abs(p));const y=Math.max(n,0),A=Math.min(n+l,R),v=Math.max(u,0),M=Math.min(u+c,D),C=h/l,I=p/c;return[e,y,v,A-y,M-v,n<0?m-n*C:m,u<0?f-u*I:f,(A-y)*C,(M-v)*I]}function s(e){return[3,4,7,8].some(n=>!e[n])}function i(e){const n=u=>{const l=globalThis[u];return l&&e instanceof l};if(n("HTMLImageElement"))return{width:e.naturalWidth,height:e.naturalHeight};if(n("HTMLVideoElement"))return{width:e.videoWidth,height:e.videoHeight};if(n("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(n("HTMLCanvasElement")||n("ImageBitmap"))return e}})();const d={};if(document){class a extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.img=document.createElement("img"),this.shadowRoot.append(this.img)}render(){this.pub=this.hasAttribute("pub")?this.getAttribute("pub"):"1234123455Ute2tFhdjDQgzR-1234lfSlZxgEZKuquI.2F-j1234434U1234Asj-5lxnECG5TDyuPD8gEiuI123",this.size=this.hasAttribute("size")?this.getAttribute("size"):400,this.round=!!(this.hasAttribute("round")||this.getAttribute("round")==""),this.round?this.img.style.borderRadius="100%":this.img.style.borderRadius="0%",this.dark=!!(this.hasAttribute("dark")||this.getAttribute("dark")==""),this.img.src=b(this.pub,this.size,this.dark)}connectedCallback(){this.render()}static get observedAttributes(){return["pub","round","size","dark"]}attributeChangedCallback(r,o,s){this.render()}}customElements.define("gun-avatar",a),document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementsByClassName("gun-avatar");for(let r of t)r.src=b(r.dataset.pub,r.dataset.size,r.dataset.dark)})}function b(a,t=800,r=!1){var n;if(!a)return;if((n=d==null?void 0:d[t])==null?void 0:n[a])return d[t][a];const o=document.createElement("canvas");o.width=o.height=t;const s=o.getContext("2d"),e=a.split(".").map(u=>S(u));return w(s,e[0][42],e[1][42],t,r),E(e[0],s,t,.42*t),s.globalCompositeOperation="lighter",E(e[1],s,t,.125*t),s.globalCompositeOperation="source-over",s.scale(-1,1),s.translate(-t/2,0),s.drawImage(o,t/2,0,t,t,0,0,t,t),d[t]=d[t]||{},d[t][a]=o.toDataURL(),d[t][a]}function w(a,t,r,o,s=!1){var i=a.createLinearGradient(0,0,0,o);let e=70;s&&(e=0),i.addColorStop(0,`hsl(0,0%,${e+t*30}%)`),i.addColorStop(1,`hsl(0,0%,${e+r*30}%)`),a.fillStyle=i,a.fillRect(0,0,o,o)}function E(a,t,r,o){T(a,7).forEach(i=>{if(i.length==7){let e=r/2+i[0]*r/2,n=i[1]*r,u=i[2]*o,l=i[3]*360,c=i[4]*100,m=i[5]*100,f=i[6];t.beginPath(),t.arc(e,n,u,0,2*Math.PI,!1),t.fillStyle=`hsla(${l},${c}%,${m}%,${f})`,t.closePath(),t.fill()}})}function S(a){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split("");let o=[],s=0;for(let i of a)o[s++]=r.indexOf(i)/64;return o}function T(a,t=3){return[...Array(Math.ceil(a.length/t))].map(()=>a.splice(0,t))}g.gunAvatar=b,Object.defineProperty(g,"__esModule",{value:!0}),g[Symbol.toStringTag]="Module"});
