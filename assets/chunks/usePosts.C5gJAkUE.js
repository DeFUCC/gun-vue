import{j as v,i as P,aF as $,aP as h}from"./components.C6y7OgGP.js";import{a as y,b as k,u as x}from"./useZip.DDT8OgWW.js";import{p as M}from"./useMd.C2K9fZpO.js";import{ak as w,h as b,p as Z,aW as F}from"./framework.ap9ZVjPY.js";function B(i){if(!i)return;const l=v(),e=w({}),o=w({});l.user(P.pub).get("posts").map().on(function(t,n){let a=n.indexOf(i);if(a==-1)return;let c=n.slice(-87),r=n.slice(0,44),p=n.slice(45,89);a==0?(e[p]=e[p]||{},e[p][c]=t):(o[r]=o[r]||{},o[r][c]=t)});const u=b(()=>{let t=0;for(let n in e)t:for(let a in e[n])if(e[n][a]){t++;break t}return t}),f=b(()=>{let t=0;for(let n in o)t:for(let a in o[n])if(o[n][a]){t++;break t}return t}),s=Z(!1);async function d(){s.value=!0,s.value=!await A(i,e)}function m(t){E(i,t)}return{posts:e,backlinks:o,countPosts:u,countBacklinks:f,downloadPosts:d,downloading:s,uploadPosts:m}}async function A(i,l){if(!l)return;const{zipPost:e,downloadZip:o}=k(),u=F({});for(let f in l){const{post:s}=x({hash:f});u[f]=s,s.title&&await e(s)}return await o({title:`#${i}`}),!0}function E(i,l){Array.from(l).forEach(async e=>{const o=await $.loadAsync(e);o.comment&&console.info("Zip file comment: "+o.comment),o.forEach(async(u,f)=>{var s;if(u.endsWith("index.md")){let d=u.slice(0,-9),m=await f.async("string"),{frontmatter:t,content:n}=M(m);if(t=t||{},t.title=(t==null?void 0:t.title)||d,t.icon){const c=await o.file(`${d}/${t.icon}`).async("base64"),r=h(c);t.icon=`data:${r};base64,${c}`}if(t.cover){const c=await((s=o==null?void 0:o.file(`${d}/${t.cover}`))==null?void 0:s.async("base64")),r=h(c);t.cover=`data:${r};base64,${c}`}let a={...t,content:n};y(i,a)}})})}export{B as u};
