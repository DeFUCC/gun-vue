import{_ as T,p as u,q as U,v as D,c as v,o as m,r as E,j as o,G as N,a as $,n as x,w as L,e as y,aE as g,aF as w,T as I,a0 as c}from"./framework.ap9ZVjPY.js";import{a as K,x as M,Y as B,S as Q,y as R}from"./components.B0l348pj.js";import{Z as b,v as Y,m as z,w as k}from"./english.CNr916y2.js";import{u as H}from"./useQR.CKE3dRKT.js";import"./theme.B5p3DQ49.js";import"./index.PUUcqk1C.js";function C(p,s="#/auth/"){let n=p.indexOf(s),l=p.substring(n+s.length);return decodeURIComponent(l)}const O={key:0,class:"flex flex-col gap-2"},W={key:0,class:"flex"},Z={__name:"AuthForm",setup(p){u("pass");const s=u(),n=u(null),l=u(!1),{auth:h}=K();U(s,async t=>{if(!t)return;if(typeof t=="string"&&t.includes("#/auth/")&&(t=C(t)),t&&typeof t=="string"&&t.substring(0,3)=="SEA"){n.value="";return}if(t&&typeof t=="string"&&Y(t.trim(),k)){const a=z(t.trim(),k);t=await b(btoa(String.fromCharCode(...a)))}let e=R(t);e!=null&&e.pub&&(e!=null&&e.priv)?(h(e),s.value=null):console.log("No valid pair")});async function A(t=s.value){typeof t=="string"&&t.includes("#/auth/")&&(t=C(t)),s.value=await Q.decrypt(t,n.value)}const d=u(!1);u("");async function S(){let t=await navigator.credentials.get({publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32)),userVerification:"preferred",timeout:6e4}}),e=new Uint8Array(await crypto.subtle.digest("SHA-256",t.rawId)).slice(0,20);s.value=await b(btoa(String.fromCharCode(...e)))}async function V(t){var e;s.value=await f((e=t.dataTransfer)==null?void 0:e.files[0]),l.value=!0}async function F(t){var e;s.value=await f((e=t.target)==null?void 0:e.files[0])}D(()=>{"launchQueue"in window&&window.launchQueue.setConsumer(async t=>{var a;const e=(a=t.files)==null?void 0:a[0];if(e){const i=await e.getFile();s.value=await f(i)}})});async function f(t,e){if(!t)return;const a=t.type.toLowerCase();let i;try{if(a==="application/json"||t.name.endsWith(".webkey"))i=await M([t]);else if(a==="image/png"||a==="image/svg+xml"){const r=await B(t);r!=null&&r.content&&(i=r.content)}else if(a.startsWith("image/")){const{processFile:r}=H();i=await r(t)}return i}catch(r){console.error("Failed to extract auth data from file:",r)}}return(t,e)=>(m(),v("div",{class:x(["flex flex-col gap-4 flex-1 items-stretch bg-light-700 dark-bg-dark-50 rounded-3xl p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":d.value}]),id:"dropzone",onDrop:e[6]||(e[6]=c(a=>{V(a),d.value=!1},["prevent"])),onDragover:e[7]||(e[7]=c(a=>d.value=!0,["prevent"])),onDragleave:e[8]||(e[8]=c(a=>d.value=!1,["prevent"]))},[E(t.$slots,"default",{class:"text-md"},()=>[e[9]||(e[9]=$("Login with a saved key"))],!0),o("button",{class:"flex-1 button items-center",onClick:e[0]||(e[0]=a=>S())},e[10]||(e[10]=[o("div",{class:"i-la-fingerprint text-4xl"},null,-1),o("div",{class:"px-2"},"Login",-1)])),o("button",{class:x(["flex-1 button cursor-pointer flex items-center",{active:l.value}]),onClick:e[1]||(e[1]=a=>l.value=!l.value)},e[11]||(e[11]=[o("div",{class:"i-la-key text-4xl"},null,-1),o("div",{class:"p-1 ml-1 font-bold"},"Key ",-1)]),2),N(I,{name:"fade",mode:"out-in"},{default:L(()=>[l.value?(m(),v("div",O,[e[13]||(e[13]=o("div",{class:"text-sm opacity-50 p-2"},"Drag and drop your key file here or choose it",-1)),o("input",{id:"file",type:"file",accept:"image/*,.webkey,application/json,image/svg+xml",onInput:e[2]||(e[2]=a=>F(a))},null,32),g(o("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[3]||(e[3]=a=>s.value=a),rows:"6",cols:"40",placeholder:"Your seed phrase or your keypair"},null,512),[[w,s.value]]),n.value!==null?(m(),v("form",W,[g(o("input",{class:"py-3 px-4 m-4 rounded-xl text-xl text-center","onUpdate:modelValue":e[4]||(e[4]=a=>n.value=a),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[w,n.value]]),o("button",{class:"button text-4xl",type:"submit",onClick:e[5]||(e[5]=a=>A())},e[12]||(e[12]=[o("div",{class:"i-la-sign-in-alt text-4xl"},null,-1)]))])):y("",!0)])):y("",!0)]),_:1})],34))}},_=T(Z,[["__scopeId","data-v-c4c7e8f4"]]);export{_ as default};
