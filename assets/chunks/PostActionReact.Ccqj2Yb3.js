import{p as S,s as L,h as _,c as v,o as p,j as w,G as $,t as k,k as f,w as x,F as B,B as C,a0 as h,e as R,aO as P,aE as D,b as F,aS as G}from"./framework.NFQ89pQN.js";import{u as y,h as E,i as b,aP as N,n as T}from"./components.B_nZlxjj.js";import{g as V}from"./useMates.DImzoikL.js";import{a as A,c as O}from"./useReactions.CWF7huT5.js";import"./theme.DAUgw0Wt.js";const z=["rooms"];function M({tag:t,hash:s,back:d}){const{user:r}=y(),n=S("👍"),o=E().user(b.pub);L(()=>{z.includes(t)?o.get(t).get(`${s}@${r.pub}`).on(e=>{e&&e!==!0&&(n.value=e)}):o.get("posts").get(`${t}:${s}@${r.pub}`).on(e=>{e&&e!==!0&&(n.value=e)})});function a(e){U({tag:t,hash:s,back:d,reaction:V(e||n.value)})}return{reaction:n,react:a}}async function U({tag:t,hash:s,back:d,reaction:r=!0}){var o,a;const{user:n}=y(),m=E();if(t=="rooms"){let e=m.user(b.pub).get(t).get(`${s}@${n.pub}`),c=await e.then();e.put(c?null:r,null,{opt:{cert:(o=b.features)==null?void 0:o[t]}})}else{const e=m.user(b.pub).get("posts");let c=d?`${s}:${t}@${n.pub}`:`${t}:${s}@${n.pub}`;const g=e.get(c);let u=await g.then();g.put(u?null:r,null,{opt:{cert:(a=b.features)==null?void 0:a.posts}})}}const q={class:"p-1 flex flex-wrap gap-2 items-center"},H={class:"p-2 font-bold"},I=["onClick"],J={key:0,class:"pl-2 text-xl"},K=["onClick"],ee={__name:"PostActionReact",props:{authors:{type:Object,default:()=>({})},hash:{type:String,default:""},tag:{type:String,default:""},back:Boolean},emits:["react","user"],setup(t){const s=t,{user:d}=y(),{reaction:r,react:n}=M({...s}),m=_(()=>A(s.authors)),o=_(()=>O(s.authors)),a=S();return(e,c)=>{var g;return p(),v("div",q,[w("div",H,k(o.value>0?"+":"")+k(o.value),1),$(f(N),{"is-my":(g=t.authors)==null?void 0:g[f(d).pub],reaction:f(r),onReact:c[0]||(c[0]=u=>f(n)(u))},null,8,["is-my","reaction"]),$(P,{name:"fade"},{default:x(()=>[(p(!0),v(B,null,C(m.value,(u,l)=>(p(),v("div",{class:"p-2px flex items-center rounded-3xl bg-light-500 dark-bg-dark-600 gap-1",key:l,onClick:h(i=>f(n)(l),["stop","prevent"])},[l!=="true"?(p(),v("div",J,k(l),1)):R("",!0),w("div",{class:"font-bold px-1",onClick:h(i=>a.value=a.value?null:l,["stop","prevent"])},k(u.length),9,K),$(P,{name:"fade"},{default:x(()=>[4>u.length||a.value==l?(p(!0),v(B,{key:0},C(u,i=>D((p(),F(f(T),{class:"rounded-full shadow-md min-w-6",key:i,size:20,selectable:!0,pub:i,"show-name":!1,onClick:h(Q=>e.$emit("user",i),["stop","prevent"])},null,8,["pub","onClick"])),[[G,i]])),128)):R("",!0)]),_:2},1024)],8,I))),128))]),_:1})])}}};export{ee as default};
