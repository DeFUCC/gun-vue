import{Y as v,Z as C}from"./components.BfL1cQFx.js";import{v as I,m as O,w as g}from"./english.MxR0N9Hb.js";import{d as R}from"./decode.BnXHfSSi.js";import{B}from"./index.PUUcqk1C.js";const i="#/auth/";function Q(t=""){let o=encodeURIComponent(t);return window.location.origin+window.location.pathname+i+o}async function S(t){if(!t)return!1;if(typeof t=="string"){if(t.includes(i)&&(t=decodeURIComponent(link.substring(link.indexOf(i)+i.length))),t.substring(0,3)=="SEA")return"";if(I(t.trim(),g)){const o=O(t.trim(),g);t=await C(btoa(String.fromCharCode(...o)))}typeof t=="string"&&(t=JSON.parse(t))}return t!=null&&t.pub&&(t!=null&&t.priv)?t:null}async function W(t,o){if(!t)return!1;const e=t.type.toLowerCase();let n=null;try{if(e==="application/json"||t.name.endsWith(".webkey"))n=await A(t);else if(e==="image/png"||e==="image/svg+xml"){const r=await v(t);r!=null&&r.content&&(n=r.content)}else e.startsWith("image/")&&(n=await F(t))}catch(r){console.error("Failed to extract auth data from file:",r)}return n}async function A(t){if(!t||t.size>2e7){console.error("File is missing or too big");return}return await new Promise((o,e)=>{const n=Object.assign(new FileReader,{onload:()=>o(n.result),onerror:e});n.readAsText(t)})}async function F(t){if(!t||typeof t.type!="string"||!t.type.startsWith("image/"))return console.warn("Invalid file or file type is not an image. Received:",t&&t.type),null;try{const o=await createImageBitmap(t),{width:e,height:n}=o,r=typeof OffscreenCanvas<"u"?new OffscreenCanvas(e,n):document.createElement("canvas");r.width=e,r.height=n;const c=r.getContext("2d");if(!c)return console.error("Failed to get 2D context from canvas."),o.close(),null;c.drawImage(o,0,0),o.close();const m=c.getImageData(0,0,e,n).data,u=new Array(n),y=128;for(let a=0;a<n;a++){const f=new Array(e),w=a*e*4;for(let s=0;s<e;s++){const l=w+s*4,h=m[l],p=m[l+1],b=m[l+2],x=.299*h+.587*p+.114*b;f[s]=x<y?1:0}u[a]=f}const d=new B({width:e,height:n});return d.data=u,R(d.toImage())}catch(o){return console.error("Error processing QR code:",o),null}}export{Q as g,W as h,S as p};
