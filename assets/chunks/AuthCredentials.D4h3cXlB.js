import{x as $,h,c as a,e as p,k as s,o as i,j as t,J as D,aE as I,aQ as P,a1 as j,n as F,w as M,T as W}from"./framework.DMS09ad0.js";import{z as A,B as q,u as V,x as N,G as L,v as O}from"./components.BfuT3X--.js";import{g as z}from"./useAuth.1_7ZSDmU.js";import G from"./QrShow.C3Xasg5t.js";import"./theme.Cz5CPBav.js";import"./english.MxR0N9Hb.js";import"./decode.BnXHfSSi.js";import"./index.PUUcqk1C.js";function J(){const{share:v,isSupported:m}=A();function x(u,r,n){if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&m){v({title:r,text:n.startsWith("text/")?u:"Your key file",files:[new File([u],r,{type:n})]});return}const o=new Blob([u],{type:n}),l=URL.createObjectURL(o),d=document.createElement("a");d.href=l,d.download=r,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l)}function b(u,r){const n=Q(),l=K(u)[n];!(l!=null&&l.content)||!(l!=null&&l.extension)||x(l.content,`${r||"account"}${l.extension}`,l.mime)}function k(u,r,n="png"){fetch(u).then(o=>o.blob()).then(o=>x(o,`${r||"account "+new Date().getDate()}.${n}`,o.type))}function g(u,r,n="webkey"){x(u,`${r||"account "+new Date().getDate()}.${n}`,"application/json")}async function y(u,r,n="png"){if(!m){console.log("Sharing not supported");return}try{const o=await fetch(u).then(d=>d.blob());if(!o){console.error("Failed to create blob from data URL");return}const l=new File([o],`${r||"avatar"}.${n}`,{type:n=="png"?"image/png":"image/svg+xml"});return v({title:r||"Gun-Vue avatar",files:[l]}).catch(d=>console.error("Share failed:",d))}catch(o){console.error("Share preparation failed:",o)}}return{saveLink:b,saveImage:k,saveJson:g,shareImage:y}}function Q(){var x,b;const v=((b=(x=navigator.userAgentData)==null?void 0:x.platform)==null?void 0:b.toLowerCase())??"",m=navigator.userAgent??"";return v.startsWith("mac")?"Mac":v.startsWith("linux")?"Linux":m.includes("Mac")?"Mac":m.includes("Linux")&&!m.includes("Android")?"Linux":"Windows"}function K(v,m="Bookmark"){return{Win:{content:`[InternetShortcut]
URL=${v}`,extension:".url",mime:"application/internet-shortcut"},Mac:{content:`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>URL</key>
  <string>${v}</string>
</dict>
</plist>`,extension:".webloc",mime:"application/x-apple-plist"},Linux:{content:`[Desktop Entry]
Encoding=UTF-8
Type=Link
Name=${m}
URL=${v}`,extension:".desktop",mime:"application/x-desktop"}}}const Y={class:"flex w-full relative"},H=["disabled","type"],X={key:0,class:"i-la-eye"},Z={key:1,class:"i-la-eye-slash"},_={key:0,class:"text-sm p-2 op-60 justify-center"},ee={class:"flex gap-2 w-full"},te=["disabled"],se={key:0,class:"flex flex-col items-start"},ne={class:"flex gap-2 p-2 text-sm flex-wrap items-center"},le={key:0,class:"i-la-copy"},oe={key:1,class:"i-la-check"},ae={class:"flex gap-2 p-2 text-sm flex-wrap items-center"},ie=["href"],re={key:0,class:"i-la-copy"},ue={key:1,class:"i-la-check"},de={class:"flex flex-wrap p-2 gap-2 items-center"},ce={class:"flex gap-2 items-center"},pe=["src"],ve={class:"p-4 flex flex-col gap-2 items-center",key:"qr"},me={key:1,class:"text-sm p-2 op-60 text-center"},he={__name:"AuthCredentials",emits:["close"],setup(v,{emit:m}){const x=m,{text:b,copy:k,copied:g,isSupported:y}=q(),{share:u,isSupported:r}=A(),{user:n}=V(),o=$(""),l=$(!1),d=$(!1),w=$(!1),f=N(async()=>o.value&&o.value.length>=5&&l.value?await O.encrypt(n.pair(),o.value):null),C=h(()=>z(f.value)),S=h(()=>L({pub:n.pub,embed:f.value,svg:!1})),T=h(()=>L({pub:n.pub,embed:f.value,svg:!0,p3:!1})),{saveImage:U,saveJson:B,saveLink:R,shareImage:E}=J();return(xe,e)=>s(n).is?(i(),a("div",{class:"flex flex-col select-none items-stretcvh gap-2 shadow-lg bg-dark-100 backdrop-blur bg-opacity-60 rounded-xl p-4",key:s(n).is},[t("form",{class:"flex flex-col items-center justify-center gap-2 relative flex-1",onSubmit:e[3]||(e[3]=j(c=>l.value=!0,["prevent","stop"]))},[t("div",Y,[I(t("input",{class:"p-4 rounded-xl w-full dark-bg-dark-700 text-center",id:"password","onUpdate:modelValue":e[0]||(e[0]=c=>o.value=c),name:"password",autocomplete:"current-password",disabled:l.value,type:d.value?"text":"password",placeholder:"5+ letters"},null,8,H),[[P,o.value]]),t("button",{class:"text-xl absolute left-4 top-4 op-40 hover-op-90 transition-800",onClick:e[1]||(e[1]=c=>d.value=!d.value),type:"button"},[d.value?(i(),a("div",Z)):(i(),a("div",X))]),t("button",{class:"text-xl absolute right-4 top-4 op-40 hover-op-90 transition-800",onClick:e[2]||(e[2]=c=>{o.value="",l.value=!1,x("close")}),type:"button"},e[14]||(e[14]=[t("div",{class:"i-la-times"},null,-1)]))]),l.value?p("",!0):(i(),a("div",_,"Set a password to encrypt your key backup")),t("div",ee,[l.value?p("",!0):(i(),a("button",{key:0,class:"button items-center flex-1",disabled:o.value.length<5||l.value,type:"submit"},e[15]||(e[15]=[t("div",{class:"i-la-check text-2xl"},null,-1),t("div",{class:"ml-2"},"Generate encrypted backup",-1)]),8,te))])],32),l.value?(i(),a("div",se,[t("div",ne,[e[18]||(e[18]=t("div",{class:"flex gap-2 items-center"},[t("div",{class:"i-la-key text-3xl"}),t("div",{class:"text-lg op-70"},"Key")],-1)),s(y)?(i(),a("button",{key:0,class:"button items-center text-2xl",onClick:e[4]||(e[4]=c=>s(k)(s(f)))},[s(g)?(i(),a("div",oe)):(i(),a("div",le))])):p("",!0),t("button",{class:"button items-center",onClick:e[5]||(e[5]=c=>s(B)(s(f),s(n).name))},e[16]||(e[16]=[t("div",{class:"i-la-download text-2xl"},null,-1)])),s(r)?(i(),a("button",{key:1,class:"button items-center text-2xl",onClick:e[6]||(e[6]=c=>s(u)({title:s(n).name||"User",text:s(f)}))},e[17]||(e[17]=[t("div",{class:"i-la-share-square text-2xl"},null,-1)]))):p("",!0)]),t("div",ae,[t("a",{class:"flex gap-2 items-center",href:C.value,target:"_blank"},e[19]||(e[19]=[t("div",{class:"i-la-link text-3xl"},null,-1),t("div",{class:"text-lg op-70"},"Link",-1)]),8,ie),s(y)?(i(),a("button",{key:0,class:"button items-center text-2xl",onClick:e[7]||(e[7]=c=>s(k)(C.value))},[s(g)?(i(),a("div",ue)):(i(),a("div",re))])):p("",!0),t("button",{class:F(["flex-1 button items-center",{active:w.value}]),onClick:e[8]||(e[8]=c=>w.value=!w.value)},e[20]||(e[20]=[t("div",{class:"i-la-qrcode text-2xl"},null,-1)]),2),t("button",{class:"button items-center",onClick:e[9]||(e[9]=c=>s(R)(C.value,s(n).name))},e[21]||(e[21]=[t("div",{class:"i-la-download text-2xl"},null,-1)])),s(r)?(i(),a("button",{key:1,class:"button items-center",onClick:e[10]||(e[10]=c=>s(u)({title:s(n).name||"User",text:C.value}))},e[22]||(e[22]=[t("div",{class:"i-la-share-square text-2xl"},null,-1)]))):p("",!0)]),t("div",de,[t("div",ce,[t("img",{src:s(L)({pub:s(n).pub,size:35})},null,8,pe),e[23]||(e[23]=t("div",{class:"text-lg op-70"},"Avatar",-1))]),t("button",{class:"button items-center",onClick:e[11]||(e[11]=c=>s(U)(S.value,s(n).name,"png"))},e[24]||(e[24]=[t("div",{class:"i-la-image text-2xl"},null,-1)])),t("button",{class:"button items-center",onClick:e[12]||(e[12]=c=>s(U)(T.value,s(n).name,"svg"))},e[25]||(e[25]=[t("div",{class:"i-la-file-image text-2xl"},null,-1)])),s(r)?(i(),a("button",{key:0,class:"button items-center",onClick:e[13]||(e[13]=c=>s(E)(S.value,s(n).name))},e[26]||(e[26]=[t("div",{class:"i-la-share-square text-2xl"},null,-1)]))):p("",!0)])])):p("",!0),D(W,{name:"fade",mode:"out-in"},{default:M(()=>[w.value?(i(),a("div",ve,[D(G,{data:s(f)},null,8,["data"])])):p("",!0)]),_:1}),l.value?(i(),a("div",me,"Save your encrypted key in a secure place. Write down the password. Keep it safe.")):p("",!0)])):p("",!0)}};export{he as default};
