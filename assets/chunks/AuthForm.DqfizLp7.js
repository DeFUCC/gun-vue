import{_ as T,p as d,q as E,c as p,o as v,j as l,e as b,ag as K,n as x,aE as m,aF as g,G as y,k as L,w as P,T as R,a0 as f}from"./framework.ap9ZVjPY.js";import{a as U,x as w,Q as $,y as k,S as q,z as B,B as G,K as z,C as I}from"./components.ClaRPLQ8.js";import"./theme.F0zT3-QT.js";import{Z as j}from"./derive.sAC03Vlj.js";const H={class:"flex flex-wrap justify-center my-2 gap-2"},J={key:0,class:"flex"},M={class:"hidden"},O={class:"flex flex-wrap"},Z={__name:"AuthForm",setup(h){const{processFile:C}=B(),o=d("pass"),s=d(),i=d(null),{auth:A}=U();function F(t){o.value!=t?o.value=t:o.value=null}E(s,async t=>{if(!t)return;typeof t=="string"&&t.includes("#/auth/")&&(t=k(t)),t&&typeof t=="string"&&t.substring(0,3)=="SEA"&&(i.value="");let e=I(t);e!=null&&e.pub&&(e!=null&&e.priv)?(A(e),s.value=null):console.log("No valid pair")});async function N(t=s.value){typeof t=="string"&&t.includes("#/auth/")&&(t=k(t)),s.value=await q.decrypt(t,i.value)}async function Q(t){var e;s.value=await G((e=t.target)==null?void 0:e.files)}async function c(t){var a,r;const e=(r=(a=t.target)==null?void 0:a.files)==null?void 0:r[0];if(e)try{const n=await z(e);n!=null&&n.content&&(s.value=n.content)}catch(n){console.error("Failed to extract data from avatar:",n)}}async function S(t){s.value=await C(t)}const u=d(!1);d("");async function V(){let t=await navigator.credentials.get({publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32)),userVerification:"preferred",timeout:6e4}}),e=new Uint8Array(await crypto.subtle.digest("SHA-256",t.rawId)).slice(0,20);s.value=await j(btoa(String.fromCharCode(...e)))}async function D(t){var e;s.value=await w((e=t.dataTransfer)==null?void 0:e.files)}return"launchQueue"in window&&window.launchQueue.setConsumer(async t=>{var a;const e=(a=t.files)==null?void 0:a[0];if(e){const r=await e.getFile();console.log("loading",r),s.value=await w([r])}}),(t,e)=>(v(),p("div",{class:x(["flex flex-col my-4 flex-1 items-center bg-light-700 dark-bg-dark-50 rounded-3xl p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":u.value}]),id:"dropzone",onDrop:e[10]||(e[10]=f(a=>{D(a),u.value=!1},["prevent"])),onDragover:e[11]||(e[11]=f(a=>u.value=!0,["prevent"])),onDragleave:e[12]||(e[12]=f(a=>u.value=!1,["prevent"]))},[e[17]||(e[17]=l("div",{class:"font-bold text-xl"},"I already have an account",-1)),e[18]||(e[18]=l("div",{class:"text-md"},"Login with a saved key",-1)),l("div",H,[l("button",{class:"button items-center",onClick:e[0]||(e[0]=a=>V())},e[13]||(e[13]=[l("div",{class:"i-la-fingerprint text-2xl"},null,-1),l("div",{class:"px-2"},"PassKey",-1)])),l("button",{class:x(["button cursor-pointer flex items-center",{active:o.value=="key"}]),onClick:e[1]||(e[1]=a=>F("key"))},e[14]||(e[14]=[l("div",{class:"i-la-key text-2xl"},null,-1),l("div",{class:"p-1 ml-1 font-bold"},"Text",-1)]),2),e[15]||(e[15]=K('<label class="button cursor-pointer flex items-center" for="qr-input" data-v-4be03168><div class="i-la-qrcode text-2xl" data-v-4be03168></div><div class="p-1 ml-1 font-bold" data-v-4be03168>QR</div></label><label class="button cursor-pointer flex items-center" for="json-input" data-v-4be03168><div class="i-la-file-code text-2xl" data-v-4be03168></div><div class="p-1 ml-1 font-bold" data-v-4be03168>File</div></label><label class="button cursor-pointer flex items-center" for="png-input" data-v-4be03168><div class="i-la-user-circle text-2xl" data-v-4be03168></div><div class="p-1 ml-1 font-bold" data-v-4be03168>PNG</div></label><label class="button cursor-pointer flex items-center" for="svg-input" data-v-4be03168><div class="i-la-user text-2xl" data-v-4be03168></div><div class="p-1 ml-1 font-bold" data-v-4be03168>SVG</div></label>',4))]),i.value!==null?(v(),p("form",J,[m(l("input",{class:"py-1 px-4 m-1 rounded-xl","onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[g,i.value]]),l("button",{class:"button text-2xl",type:"submit",onClick:e[3]||(e[3]=a=>N())},e[16]||(e[16]=[l("div",{class:"i-la-sign-in-alt text-2xl"},null,-1)]))])):b("",!0),l("div",M,[y(L($),{onLoaded:e[4]||(e[4]=a=>s.value=a)}),l("input",{id:"qr-input",type:"file",accept:"image/*",onChange:e[5]||(e[5]=a=>S(a.target.files[0]))},null,32),l("input",{id:"json-input",ref:"file",tabindex:"-1",type:"file",accept:".webkey,application/json",onChange:e[6]||(e[6]=a=>Q(a))},null,544),l("input",{id:"png-input",type:"file",accept:"image/png",onChange:e[7]||(e[7]=a=>c(a))},null,32),l("input",{id:"svg-input",type:"file",accept:"image/svg+xml",onChange:e[8]||(e[8]=a=>c(a))},null,32)]),e[19]||(e[19]=l("div",{class:"text-sm opacity-50"},"Drag and drop your file here (PNG, JSON, or QR photo/screenshot)",-1)),l("div",O,[y(R,{name:"fade",mode:"out-in",appear:""},{default:P(()=>[o.value=="key"?m((v(),p("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[9]||(e[9]=a=>s.value=a),rows:"6",cols:"40",placeholder:"Paste your key pair here or drag and drop a file"},null,512)),[[g,s.value]]):b("",!0)]),_:1})])],34))}},ee=T(Z,[["__scopeId","data-v-4be03168"]]);export{ee as default};
