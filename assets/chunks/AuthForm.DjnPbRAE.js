import{_ as E,p,q as T,c as i,o as d,j as s,e as y,ag as q,n as v,aD as b,aE as g,G as k,k as w,w as B,F as R,B as U,t as j,T as z,a0 as c}from"./framework.BoVd_Pm6.js";import{a as J,Q as O,x as N,S as I,y as C,$ as F,z as K}from"./components.DDidTy9E.js";import{u as M}from"./useQR.DtE150Mk.js";import"./theme.BlSwDMow.js";import{u as W}from"./useWebAuthn.33aIaTgM.js";const h={class:"flex flex-wrap justify-center my-2"},H={key:0,class:"flex"},X={class:"hidden"},Y={class:"flex flex-wrap"},Z={key:0,class:"flex flex-col p-2 text-sm flex-1 w-full dark-bg-dark-200"},_=["onClick"],ee={__name:"AuthForm",setup(te){const{processFile:m}=M(),n=p("pass"),o=p(),u=p(null),{auth:P}=J();function x(a){n.value!=a?n.value=a:n.value=null}T(o,async a=>{if(!a)return;typeof a=="string"&&a.includes("#/auth/")&&(a=N(a)),a&&typeof a=="string"&&a.substring(0,3)=="SEA"&&(u.value="");let e=K(a);e!=null&&e.pub&&(e!=null&&e.priv)?(P(e),o.value=null):console.log("No valid pair")});async function S(a=o.value){typeof a=="string"&&a.includes("#/auth/")&&(a=N(a)),o.value=await I.decrypt(a,u.value)}function $(a){var e;C((e=a.target)==null?void 0:e.files,t=>o.value=t)}async function D(a){var t,l;const e=(l=(t=a.target)==null?void 0:t.files)==null?void 0:l[0];if(e)try{const r=await F(e);r!=null&&r.content&&(o.value=r.content)}catch(r){console.error("Failed to extract data from PNG:",r)}}function L(a){m(a,e=>o.value=e)}async function G(a){const e=a[0];if(!e)return;const t=e.type.toLowerCase();if(t==="application/json")C([e],l=>o.value=l);else if(t==="image/png")try{const l=await F(e);l!=null&&l.content&&(o.value=l.content)}catch(l){console.error("Failed to extract data from PNG:",l)}else t.startsWith("image/")&&m(e,l=>o.value=l)}const f=p(!1),{users:Q,getUser:V}=W();p("");async function A(a){try{o.value=await V(a)}catch(e){console.error(e.message)}}return(a,e)=>(d(),i("div",{class:v(["flex flex-col my-4 flex-1 items-center bg-light-700 dark-bg-dark-50 rounded-3xl p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":f.value}]),id:"dropzone",onDrop:e[9]||(e[9]=c(t=>{var l;G((l=t.dataTransfer)==null?void 0:l.files),f.value=!1},["prevent"])),onDragover:e[10]||(e[10]=c(t=>f.value=!0,["prevent"])),onDragleave:e[11]||(e[11]=c(t=>f.value=!1,["prevent"]))},[e[16]||(e[16]=s("div",{class:"font-bold text-xl"},"I already have an account",-1)),e[17]||(e[17]=s("div",{class:"text-md"},"Login with a saved key",-1)),s("div",h,[s("button",{class:v(["button items-center",{active:n.value=="passkey"}]),onClick:e[0]||(e[0]=t=>x("passkey"))},e[12]||(e[12]=[s("div",{class:"i-la-key"},null,-1),s("div",{class:"px-2"},"PassKey",-1)]),2),s("button",{class:v(["button m-2 cursor-pointer flex items-center",{active:n.value=="key"}]),onClick:e[1]||(e[1]=t=>x("key"))},e[13]||(e[13]=[s("div",{class:"i-la-key text-xl"},null,-1),s("div",{class:"p-1 ml-1 font-bold"},"Paste",-1)]),2),e[14]||(e[14]=q('<label class="button m-2 cursor-pointer flex items-center" for="qr-input" data-v-cb9d2a03><div class="i-la-qrcode text-xl" data-v-cb9d2a03></div><div class="p-1 ml-1 font-bold" data-v-cb9d2a03>QR</div></label><label class="button m-2 cursor-pointer flex items-center" for="json-input" data-v-cb9d2a03><div class="i-la-file-code text-xl" data-v-cb9d2a03></div><div class="p-1 ml-1 font-bold" data-v-cb9d2a03>JSON</div></label><label class="button m-2 cursor-pointer flex items-center" for="png-input" data-v-cb9d2a03><div class="i-la-user-circle text-xl" data-v-cb9d2a03></div><div class="p-1 ml-1 font-bold" data-v-cb9d2a03>PNG</div></label>',3))]),u.value!==null?(d(),i("form",H,[b(s("input",{class:"py-1 px-4 m-1 rounded-xl","onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[g,u.value]]),s("button",{class:"button text-2xl",type:"submit",onClick:e[3]||(e[3]=t=>S())},e[15]||(e[15]=[s("div",{class:"i-la-sign-in-alt"},null,-1)]))])):y("",!0),s("div",X,[k(w(O),{onLoaded:e[4]||(e[4]=t=>o.value=t)}),s("input",{id:"qr-input",type:"file",accept:"image/*",onChange:e[5]||(e[5]=t=>L(t.target.files[0]))},null,32),s("input",{id:"json-input",ref:"file",tabindex:"-1",type:"file",accept:"application/json",onChange:e[6]||(e[6]=t=>$(t))},null,544),s("input",{id:"png-input",type:"file",accept:"image/png",onChange:e[7]||(e[7]=t=>D(t))},null,32)]),e[18]||(e[18]=s("div",{class:"text-sm opacity-50"},"Drag and drop your key file here (PNG, JSON, or QR image)",-1)),s("div",Y,[k(z,{name:"fade",mode:"out-in",appear:""},{default:B(()=>[n.value=="passkey"?(d(),i("div",Z,[(d(!0),i(R,null,U(w(Q),t=>(d(),i("div",{class:"p-2",key:t,onClick:l=>A(t)},j(t),9,_))),128))])):n.value=="key"?b((d(),i("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[8]||(e[8]=t=>o.value=t),rows:"6",cols:"40",placeholder:"Paste your key pair here or drag and drop a file"},null,512)),[[g,o.value]]):y("",!0)]),_:1})])],34))}},re=E(ee,[["__scopeId","data-v-cb9d2a03"]]);export{re as default};
