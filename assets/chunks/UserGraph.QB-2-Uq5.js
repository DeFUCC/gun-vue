import{p as h,j as m,i as f,R as d,bo as b}from"./components.B1jSCJNL.js";import{a as g}from"./useMates.Xgn35zMG.js";import{f as v}from"./force-graph.DFXwfBP0.js";import{d as k,p as w,ai as _,h as x,v as j,s as C,c as y,o as R,j as D}from"./framework.BoVd_Pm6.js";import"./theme.CpRZ4BpD.js";const E={class:"bg-light-700 dark-bg-dark-500 overflow-none max-w-100vw max-h-100svh w-full h-full"},L=k({__name:"UserGraph",emits:["user"],setup(G,{emit:i}){const a=w(null),u=i,n=h("deep"),c=m(),s=_({});c.user(f.pub).get("space").map().once(async(e,r)=>{s[r]={pub:r,name:await c.user(r).get("profile").get("name").then(),color:n.hex(r),links:g(r)}});const l=x(()=>{let e=[];return Object.values(s).forEach(r=>{Object.entries(r.links).forEach(t=>{!s[t[0]]||!t[1].text||e.push({source:r.pub,target:t[0],emoji:t[1].emoji,back:t[1].back})})}),e}),o=v().width(600).nodeId("pub").nodeColor("color").nodeVal(e=>e.pub==d.pub?10:1).nodeRelSize(4).linkDirectionalArrowLength(4).linkDirectionalArrowRelPos(1).linkLabel("emoji").linkCurvature(.2).linkColor(e=>{var r;return n.hex(((r=e.source)==null?void 0:r.pub)||0)}).linkWidth(e=>e.back?3:1).onNodeDragEnd(e=>{e.fx=e.x,e.fy=e.y}).onNodeClick(e=>{o.centerAt(e.x,e.y,1e3),o.zoom(4,2e3)}).onNodeClick(e=>{u("user",e.pub)});return j(()=>{o(a.value)}),C(()=>o.graphData({nodes:Object.values(s),links:l.value})),b(a,e=>{const r=e[0],{width:t,height:p}=r.contentRect;o.width(t),o.height(p)}),(e,r)=>(R(),y("div",E,[D("div",{id:"graph",ref_key:"graph",ref:a},null,512)]))}});export{L as default};
