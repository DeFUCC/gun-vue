import{_ as T,p as d,q as N,v as V,c,o as f,r as O,j as n,G as $,a as E,n as v,w as K,e as g,aE as y,aF as w,T as U,a0 as m}from"./framework.ap9ZVjPY.js";import{Y as B,S as I,j as J,x as L}from"./components.C6y7OgGP.js";import{Z as x,v as M,m as P,w as b}from"./english.CNr916y2.js";import{u as R}from"./useQR.D2HH2LlQ.js";import"./theme.Di6tJv9d.js";import"./index.PUUcqk1C.js";const z={key:0,class:"flex flex-col gap-2"},Q={key:0,class:"flex"},W={__name:"AuthForm",setup(Y){const o=d(),i=d(null),l=d(!1),u=d(!1);N(o,async t=>{const e=J(),a=await A(t);a===""&&(i.value=""),a&&a.pub&&e.user().auth(a)}),V(()=>{"launchQueue"in window&&window.launchQueue.setConsumer(async t=>{var a;const e=(a=t.files)==null?void 0:a[0];if(e){const r=await e.getFile();o.value=await p(r),l.value=!0}})});async function k(){const t=await F();t&&(o.value=await x(t))}async function h(t){var e;o.value=await p((e=t.dataTransfer)==null?void 0:e.files[0]),l.value=!0}async function C(t){var e;o.value=await p((e=t.target)==null?void 0:e.files[0]),l.value=!0}async function S(t){o.value=await I.decrypt(t,i.value)}async function A(t){if(!t)return!1;let e="#/auth/";if(typeof t=="string"&&t.includes(e)&&(t=decodeURIComponent(link.substring(link.indexOf(e)+e.length))),typeof t=="string"&&t.substring(0,3)=="SEA")return"";if(typeof t=="string"&&M(t.trim(),b)){const r=P(t.trim(),b);t=await x(btoa(String.fromCharCode(...r)))}let a=L(t);return a!=null&&a.pub&&(a!=null&&a.priv)?a:null}async function p(t,e){if(!t)return!1;const a=t.type.toLowerCase();let r=null;try{if(a==="application/json"||t.name.endsWith(".webkey"))r=await D(t);else if(a==="image/png"||a==="image/svg+xml"){const s=await B(t);s!=null&&s.content&&(r=s.content)}else if(a.startsWith("image/")){const{processFile:s}=R();r=await s(t)}}catch(s){console.error("Failed to extract auth data from file:",s)}return r}async function D(t){if(!t||t.size>2e7){console.error("File is missing or too big");return}return await new Promise((e,a)=>{const r=Object.assign(new FileReader,{onload:()=>e(r.result),onerror:a});r.readAsText(t)})}async function F(){const t=crypto.getRandomValues(new Uint8Array(32)),e=await navigator.credentials.get({publicKey:{challenge:t,userVerification:"preferred",timeout:6e4}}),a=btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),r=JSON.parse(new TextDecoder().decode(e.response.clientDataJSON));if(r.challenge!==a)return console.error("Wrong challenge received! Check your authentication provider security.",r.challenge,a),!1;const s=new Uint8Array(await crypto.subtle.digest("SHA-256",e.rawId)).slice(0,20);return btoa(String.fromCharCode(...s))}return(t,e)=>(f(),c("div",{class:v(["flex flex-col gap-4 flex-1 items-stretch bg-light-700 dark-bg-dark-50 rounded-3xl p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":u.value}]),id:"dropzone",onDrop:e[6]||(e[6]=m(a=>{h(a),u.value=!1},["prevent"])),onDragover:e[7]||(e[7]=m(a=>u.value=!0,["prevent"])),onDragleave:e[8]||(e[8]=m(a=>u.value=!1,["prevent"]))},[O(t.$slots,"default",{class:"text-md"},()=>[e[9]||(e[9]=E("Login with a saved key"))],!0),n("button",{class:"flex-1 button items-center",onClick:e[0]||(e[0]=a=>k())},e[10]||(e[10]=[n("div",{class:"i-la-fingerprint text-4xl"},null,-1),n("div",{class:"px-2"},"Login",-1)])),n("button",{class:v(["flex-1 button cursor-pointer flex items-center",{active:l.value}]),onClick:e[1]||(e[1]=a=>l.value=!l.value)},e[11]||(e[11]=[n("div",{class:"i-la-key text-4xl"},null,-1),n("div",{class:"p-1 ml-1 font-bold"},"Key ",-1)]),2),$(U,{name:"fade",mode:"out-in"},{default:K(()=>[l.value?(f(),c("div",z,[e[13]||(e[13]=n("div",{class:"text-sm opacity-50 p-2"},"Drag and drop your key file here or choose it",-1)),n("input",{id:"file",type:"file",accept:"image/*,.webkey,application/json,image/svg+xml",onInput:e[2]||(e[2]=a=>C(a))},null,32),y(n("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[3]||(e[3]=a=>o.value=a),rows:"6",cols:"40",placeholder:"Your seed phrase or your keypair"},null,512),[[w,o.value]]),i.value!==null?(f(),c("form",Q,[y(n("input",{class:"py-3 px-4 m-4 rounded-xl text-xl text-center","onUpdate:modelValue":e[4]||(e[4]=a=>i.value=a),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[w,i.value]]),n("button",{class:"button text-4xl",type:"submit",onClick:e[5]||(e[5]=a=>S(o.value))},e[12]||(e[12]=[n("div",{class:"i-la-sign-in-alt text-4xl"},null,-1)]))])):g("",!0)])):g("",!0)]),_:1})],34))}},_=T(W,[["__scopeId","data-v-99cdb821"]]);export{_ as default};
