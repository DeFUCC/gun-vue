import{x as U,b6 as Rt,aj as K,p as ct,b7 as zt,z as kt,a0 as Ot,b8 as Ut,h as L,b9 as Q,au as j,ba as Vt,bb as Ft,bc as F,y as Wt,bd as Yt,s as Xt,k as o,R as Ht,d as qt,ar as Jt,be as Zt,I as Qt,c as N,o as O,e as te,J as ee,P as se,j as D,t as ne,G as tt,H as et,n as re,b as gt,M as ie,aq as oe}from"./framework.DOfjDz1B.js";import{h as ae,u as Ct,i as W,aU as ce,s as le,aV as ue,aW as fe}from"./components.BfL1cQFx.js";import{g as de}from"./useMates.DCRW0Ss7.js";import"./theme.2Mja-hgs.js";function he(t=U(null)){const{pressed:e}=Rt(),s=K({x:0,y:0,normX:0,normY:0,pressed:e,inside:!1});ct(()=>{document.addEventListener("mousemove",n);const{isOutside:r}=zt(t);kt(r,i=>{s.inside=!i})}),Ot(()=>{document.removeEventListener("mousemove",n)});function n(r,i=t.value,a=!1){const c=i.closest("svg");if(!c)return;var p=c.createSVGPoint();p.x=r.clientX,p.y=r.clientY;let l=p.matrixTransform(c.getScreenCTM().inverse());if(a){let u=i.getBBox();s.x=l.x<u.width?l.x<0?0:l.x:u.width,s.y=l.y<u.height?l.y<0?0:l.y:u.height,s.normY=s.y/u.height,s.normX=s.x/u.width}else s.x=l.x,s.y=l.y}return{area:t,mouse:s}}function nt(){return nt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},nt.apply(this,arguments)}function pe(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function vt(t,e){return{x:t.x-e,y:t.y-e,w:t.w+2*e,h:t.h+2*e}}function yt(t,e){return t.x>e.x&&t.x<e.x+e.w&&t.y>e.y&&t.y<e.y+e.h}function wt(t,e,s,n){switch(n===void 0&&(n=50),s){case"top":return{x:t.x,y:Math.min((t.y+e.y)/2,t.y-n)};case"bottom":return{x:t.x,y:Math.max((t.y+e.y)/2,t.y+n)};case"left":return{x:Math.min((t.x+e.x)/2,t.x-n),y:t.y};case"right":return{x:Math.max((t.x+e.x)/2,t.x+n),y:t.y}}}function bt(t){switch(t){case"left":return 0;case"top":return 90;case"right":return 180;case"bottom":return 270}}function me(t,e,s,n,r,i,a,c,p){for(var l=nt({padStart:0,padEnd:0,controlPointStretch:50,allowedStartSides:["top","right","bottom","left"],allowedEndSides:["top","right","bottom","left"]},p),u={x:t,y:e,w:s,h:n},m={x:t+s/2,y:e-2*l.padStart},I={x:t+s/2,y:e+n+2*l.padStart},S={x:t-2*l.padStart,y:e+n/2},P={x:t+s+2*l.padStart,y:e+n/2},w={x:r,y:i,w:a,h:c},A={x:r+a/2,y:i-2*l.padEnd},g={x:r+a/2,y:i+c+2*l.padEnd},_={x:r-2*l.padEnd,y:i+c/2},k={x:r+a+2*l.padEnd,y:i+c/2},M=["top","right","bottom","left"],G=l.allowedStartSides.length>0?l.allowedStartSides:M,b=l.allowedEndSides.length>0?l.allowedEndSides:M,d={top:m,right:P,bottom:I,left:S},f={top:A,right:k,bottom:g,left:_},h=1/0,v=m,y=A,E="top",R="top",ut=15,H=0;H<G.length;H++){var ft=G[H],q=d[ft];if(!yt(q,vt(w,ut)))for(var J=0;J<b.length;J++){var dt=b[J],Z=f[dt];if(!yt(Z,vt(u,ut))){var ht=pe(q,Z);ht<h&&(h=ht,v=q,y=Z,E=ft,R=dt)}}}var pt=wt(v,y,E,l.controlPointStretch),mt=wt(y,v,R,l.controlPointStretch);return[v.x,v.y,pt.x,pt.y,mt.x,mt.y,y.x,y.y,bt(R),bt(E)]}function ge(t,e,s,n,r){return me(t,e,0,0,s,n,0,0,r)}function ve(t,e,s){if(Ut(t))return L(()=>Q(j(t),j(e),j(s)));const n=U(t);return L({get(){return n.value=Q(n.value,j(e),j(s))},set(r){n.value=Q(r,j(e),j(s))}})}function ye({TIMEOUT:t=1e4,randomness:e=.1}={}){const s=U(),{area:n,mouse:r}=he(s),{width:i,height:a}=Vt(s),c=K([0,0]),p=ve(1,.5,2),l=ae(),{user:u}=Ct(),m=K({title:"space",joined:!1,db:L(()=>l.user(W.pub).get("space")),cert:L(()=>{var d;return(d=W.features)==null?void 0:d.space}),my:{mouse:L(()=>({x:r.x,y:r.y})),pos:null}});async function I(){m.joined=!0}function S({x:d=r.x,y:f=r.y}={}){var h;u.pub&&(m.joined||I(),c[0]=d,c[1]=f,m.db.get(u.pub).get("pos").put(JSON.stringify({x:d,y:f}),null,{opt:{cert:(h=W.features)==null?void 0:h.space}}))}const P=Ft("Shift"),w=L(()=>P.value?100:10);F("ArrowUp",()=>{S({x:c[0],y:c[1]-w.value})}),F("ArrowDown",()=>{S({x:c[0],y:c[1]+w.value})}),F("ArrowLeft",()=>{S({x:c[0]-w.value,y:c[1]})}),F("ArrowRight",()=>{S({x:c[0]+w.value,y:c[1]})});function A(d=""){var f;u.pub&&(m.joined||I(),m.db.get(u.pub).get("status").put(d,null,{opt:{cert:(f=W.features)==null?void 0:f.space}}))}const g=K({}),_=K({}),k=K({}),M=L(()=>{var f;const d={};for(let h in g)Date.now()-((f=g[h])==null?void 0:f.pulse)<t&&(d[h]=g[h]);return d}),G=L(()=>Object.keys(M.value).length);m.db.map().once(async(d,f)=>{f==u.pub&&(m.joined=!0);const h={pub:f,draw:"",status:"",blink:!1,pulse:0,hasPos:!1,pos:{x:0,y:0}};g[f]=h,m.db.get(f).get("pos").on(v=>{g[f].hasPos=!0,g[f].pos=typeof v=="string"?JSON.parse(v):v}),m.db.get(f).get("draw").on(v=>{g[f].draw=v}),m.db.get(f).get("status").on(v=>{g[f].status=v}),l.user(f).get("pulse").on(v=>{g[f].pulse=Number(v),g[f].blink=!g[f].blink}).back().get("mates").map().on((v,y)=>{_[f]=_[f]||{},_[f][y]=v})});const b={};return Wt(()=>{for(let d in _){b[d]=b[d]||{};for(let f in _[d]){let h=b[d][f]=b[d][f]||Math.random()*e;if(_[d][f]){const v=_[d][f];let y=g[d],E=g[f],R=Date.now()*2-(y==null?void 0:y.pulse)-(E==null?void 0:E.pulse);y&&E&&(y!=null&&y.hasPos)&&(E!=null&&E.hasPos)&&R<t&&(k[d+f]={user:d,mate:f,emoji:de(v),from:y.pos,to:E.pos,arrow:we(y.pos,E.pos,h)})}else delete k[d+f]}}}),{space:m,allGuests:g,guests:M,guestCount:G,links:k,plane:s,width:i,height:a,pos:c,zoom:p,area:n,join:I,place:S,setStatus:A}}function we(t,e,s=0){let n=ge(t.x,t.y,e.x,e.y,{padEnd:20,padStart:10});const[r,i,a,c,p,l,u,m,I,S]=n;return{sx:r,sy:i,c1x:a*(1-s+2*s),c1y:c*(1-s+2*s),c2x:p*(1-s+2*s),c2y:l*(1-s+2*s),ex:u,ey:m,ae:I,as:S}}function be(){try{return"constructor"in GestureEvent}catch{return!1}}function Mt(){return typeof window<"u"&&"ontouchstart"in window}function At(t){return"pointerId"in t?null:t.type==="touchend"?t.changedTouches:t.targetTouches}function Nt(t){return Array.from(At(t)).map(e=>e.identifier)}function xt(t){const e="buttons"in t?t.buttons:0,{shiftKey:s,altKey:n,metaKey:r,ctrlKey:i}=t;return{buttons:e,shiftKey:s,altKey:n,metaKey:r,ctrlKey:i}}const xe=t=>t;function St(t,e=xe){const s=At(t),{clientX:n,clientY:r}=s?s[0]:t;return e([n,r])}function Lt(){}function Bt(...t){return t.length===0?Lt:t.length===1?t[0]:function(){var e;for(let s of t)e=s.apply(this,arguments)||e;return e}}function B(t,e){if(t===void 0){if(e===void 0)throw new Error("Must define fallback value if undefined is expected");t=e}return Array.isArray(t)?t:[t,t]}function _t(t,...e){return typeof t=="function"?t(...e):t}function z(t){return{_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:Lt,canceled:!1,memo:void 0,args:void 0,...t}}function rt(){const t={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},e=z({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),s=z({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),n=z({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),r=z({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),i=z({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:t,drag:e,pinch:s,wheel:n,move:r,scroll:i}}var Se=Object.defineProperty,_e=(t,e,s)=>e in t?Se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,T=(t,e,s)=>(_e(t,typeof e!="symbol"?e+"":e,s),s);class Ee{constructor(e){this.classes=e,T(this,"nativeRefs"),T(this,"config"),T(this,"handlers"),T(this,"state"),T(this,"timeouts"),T(this,"domListeners"),T(this,"windowListeners"),T(this,"pointerIds",new Set),T(this,"touchIds",new Set),T(this,"supportsTouchEvents",Mt()),T(this,"supportsGestureEvents",be()),T(this,"bind",(...s)=>{const n={};for(let r of this.classes)new r(this,s).addBindings(n);for(let r in this.nativeRefs)C(n,r,i=>this.nativeRefs[r]({...this.state.shared,event:i,args:s}));return this.config.domTarget?Oe(this,n):Ce(this,n)}),T(this,"clean",()=>{const{eventOptions:s,domTarget:n}=this.config,r=o(n);r&&V(r,jt(this.domListeners),s),Object.values(this.timeouts).forEach(clearTimeout),Te(this)}),T(this,"reset",()=>{this.state=rt()}),this.classes=e,this.state=rt(),this.timeouts={},this.domListeners=[],this.windowListeners={}}}function Pe(t,e){"pointerId"in e?t.pointerIds.add(e.pointerId):t.touchIds=new Set(Nt(e))}function De(t,e){"pointerId"in e?t.pointerIds.delete(e.pointerId):Nt(e).forEach(s=>t.touchIds.delete(s))}function Te(t){const{config:{window:e,eventOptions:s},windowListeners:n}=t,r=o(e);if(r){for(let i in n){const a=n[i];V(r,a,s)}t.windowListeners={}}}function Ie({config:t,windowListeners:e},s,n=t.eventOptions){const r=o(t.window);r&&(V(r,e[s],n),delete e[s])}function ke({config:t,windowListeners:e},s,n=[],r=t.eventOptions){const i=o(t.window);i&&(V(i,e[s],r),$t(i,e[s]=n,r))}function Oe({config:t,domListeners:e},s){const{eventOptions:n,domTarget:r}=t,i=o(r);if(!i)throw new Error("domTarget must be defined");V(i,jt(e),n);for(let[a,c]of Object.entries(s)){const p=a.slice(2).toLowerCase();e.push([p,Bt(...c)])}$t(i,e,n)}function Ce({config:t},e){const s={},n=t.eventOptions.capture?"Capture":"";for(let[r,i]of Object.entries(e)){const a=Array.isArray(i)?i:[i],c=r+n;s[c]=Bt(...a)}return s}function jt(t=[]){return t.splice(0,t.length)}function C(t,e,s){t[e]||(t[e]=[]),t[e].push(s)}function $t(t,e=[],s={}){if(t)for(let[n,r]of e)t.addEventListener(n,r,s)}function V(t,e=[],s={}){if(t)for(let[n,r]of e)t.removeEventListener(n,r,s)}function it(t,e){return t.map((s,n)=>s+e[n])}function Gt(t,e){return t.map((s,n)=>s-e[n])}function ot(t){return Math.hypot(...t)}function Me(t,e,s){const n=ot(e),r=n===0?0:1/n,i=s===0?0:1/s,a=i*n,c=e.map(u=>i*u),p=e.map(u=>r*u),l=ot(t);return{velocities:c,velocity:a,distance:l,direction:p}}function at(t){return Math.sign?Math.sign(t):+(t>0)-+(t<0)||+t}function Ae(t,e,s){return Math.max(e,Math.min(t,s))}function Ne(t,e){return Math.pow(t,e*5)}function Et(t,e,s){return e===0||Math.abs(e)===1/0?Ne(t,s):t*e*s/(e+s*t)}function Pt(t,e,s,n=.15){return n===0?Ae(t,e,s):t<e?-Et(e-t,s-e,n)+e:t>s?+Et(t-s,s-e,n)+s:t}var Le=Object.defineProperty,Be=(t,e,s)=>e in t?Le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Y=(t,e,s)=>(Be(t,typeof e!="symbol"?e+"":e,s),s);const $=new Map,je=t=>t;class $e{constructor(e,s=[]){this.controller=e,this.args=s,Y(this,"debounced",!0),Y(this,"setTimeout",(n,r=140,...i)=>{clearTimeout(this.controller.timeouts[this.stateKey]),this.controller.timeouts[this.stateKey]=window.setTimeout(n,r,...i)}),Y(this,"clearTimeout",()=>{clearTimeout(this.controller.timeouts[this.stateKey])}),Y(this,"fireGestureHandler",(n=!1)=>{if(this.state._blocked)return this.debounced||(this.state._active=!1,this.clean()),null;if(!n&&!this.state.intentional&&!this.config.triggerAllEvents)return null;if(this.state.intentional){const p=this.state.active,l=this.state._active;this.state.active=l,this.state.first=l&&!p,this.state.last=p&&!l,this.controller.state.shared[this.ingKey]=l}const r=this.controller.pointerIds.size||this.controller.touchIds.size,i=this.controller.state.shared.buttons>0||r>0,a={...this.controller.state.shared,...this.state,...this.mapStateValues(this.state),locked:!!document.pointerLockElement,touches:r,down:i},c=this.handler(a);return this.state.memo=c!==void 0?c:this.state.memo,a}),this.controller=e,this.args=s}get config(){return this.controller.config[this.stateKey]}get enabled(){return this.controller.config.enabled&&this.config.enabled}get state(){return this.controller.state[this.stateKey]}get handler(){return this.controller.handlers[this.stateKey]}get transform(){return this.config.transform||this.controller.config.transform||je}updateSharedState(e){Object.assign(this.controller.state.shared,e)}updateGestureState(e){Object.assign(this.state,e)}checkIntentionality(e,s){return{_intentional:e,_blocked:!1}}getMovement(e){const{rubberband:s,threshold:n}=this.config,{_bounds:r,_initial:i,_active:a,_intentional:c,lastOffset:p,movement:l}=this.state,u=this.getInternalMovement(e,this.state),m=this.transform(n).map(Math.abs),I=c[0]===!1?Dt(u[0],m[0]):c[0],S=c[1]===!1?Dt(u[1],m[1]):c[1],P=this.checkIntentionality([I,S],u);if(P._blocked)return{...P,_movement:u,delta:[0,0]};const w=P._intentional,A=u;let g=[w[0]!==!1?u[0]-w[0]:0,w[1]!==!1?u[1]-w[1]:0];const _=it(g,p),k=a?s:[0,0];return g=Tt(r,it(g,i),k),{...P,intentional:w[0]!==!1||w[1]!==!1,_initial:i,_movement:A,movement:g,values:e,offset:Tt(r,_,k),delta:Gt(g,l)}}clean(){this.clearTimeout()}}function Dt(t,e){return Math.abs(t)>=e?at(t)*e:!1}function Tt(t,[e,s],[n,r]){const[[i,a],[c,p]]=t;return[Pt(e,i,a,n),Pt(s,c,p,r)]}function st({state:t},e,s){const{timeStamp:n,type:r}=e,i=t.values,a=s?0:n-t.startTime;return{_lastEventType:r,event:e,timeStamp:n,elapsedTime:a,previous:i}}function Ge({state:t,config:e,stateKey:s,args:n},r,i){const a=t.offset,c=i.timeStamp,{initial:p,bounds:l}=e,u={...rt()[s],_active:!0,args:n,values:r,initial:r,offset:a,lastOffset:a,startTime:c};return{...u,_initial:_t(p,u),_bounds:_t(l,u)}}class Ke extends $e{getInternalMovement(e,s){return Gt(e,s.initial)}checkIntentionality(e,s){if(e[0]===!1&&e[1]===!1)return{_intentional:e,axis:this.state.axis};const[n,r]=s.map(Math.abs),i=this.state.axis||(n>r?"x":n<r?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:e,_blocked:!1,axis:i}:i?this.config.axis&&i!==this.config.axis?{_intentional:e,_blocked:!0,axis:i}:(e[i==="x"?1:0]=!1,{_intentional:e,_blocked:!1,axis:i}):{_intentional:[!1,!1],_blocked:!1,axis:i}}getKinematics(e,s){const n=this.getMovement(e);if(!n._blocked){const r=s.timeStamp-this.state.timeStamp;Object.assign(n,Me(n.movement,n.delta,r))}return n}mapStateValues(e){return{xy:e.values,vxvy:e.velocities}}}var Re=Object.defineProperty,ze=(t,e,s)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,x=(t,e,s)=>(ze(t,typeof e!="symbol"?e+"":e,s),s);const Ue=3;function It(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}class Ve extends Ke{constructor(){super(...arguments),x(this,"ingKey","dragging"),x(this,"stateKey","drag"),x(this,"setPointerCapture",e=>{if(this.config.useTouch||document.pointerLockElement)return;const{target:s,pointerId:n}=e;s&&"setPointerCapture"in s&&s.setPointerCapture(n),this.updateGestureState({_dragTarget:s,_dragPointerId:n})}),x(this,"releasePointerCapture",()=>{if(this.config.useTouch||document.pointerLockElement)return;const{_dragTarget:e,_dragPointerId:s}=this.state;if(s&&e&&"releasePointerCapture"in e&&(!("hasPointerCapture"in e)||e.hasPointerCapture(s)))try{e.releasePointerCapture(s)}catch{}}),x(this,"preventScroll",e=>{this.state._dragPreventScroll&&e.cancelable&&e.preventDefault()}),x(this,"getEventId",e=>this.config.useTouch?e.changedTouches[0].identifier:e.pointerId),x(this,"isValidEvent",e=>this.state._pointerId===this.getEventId(e)),x(this,"shouldPreventWindowScrollY",this.config.preventWindowScrollY&&this.controller.supportsTouchEvents),x(this,"setUpWindowScrollDetection",e=>{It(e),ke(this.controller,this.stateKey,[["touchmove",this.preventScroll],["touchend",this.clean.bind(this)],["touchcancel",this.clean.bind(this)]],{passive:!1}),this.setTimeout(this.startDrag.bind(this),250,e)}),x(this,"setUpDelayedDragTrigger",e=>{this.state._dragDelayed=!0,It(e),this.setTimeout(this.startDrag.bind(this),this.config.delay,e)}),x(this,"setStartState",e=>{const s=St(e,this.transform);this.updateSharedState(xt(e)),this.updateGestureState({...Ge(this,s,e),...st(this,e,!0),_pointerId:this.getEventId(e)}),this.updateGestureState(this.getMovement(s))}),x(this,"onDragStart",e=>{Pe(this.controller,e),!(!this.enabled||this.state._active)&&(this.setStartState(e),this.setPointerCapture(e),this.shouldPreventWindowScrollY?this.setUpWindowScrollDetection(e):this.config.delay>0?this.setUpDelayedDragTrigger(e):this.startDrag(e,!0))}),x(this,"onDragChange",e=>{if(this.state.canceled||!this.state._active||!this.isValidEvent(e)||this.state._lastEventType===e.type&&e.timeStamp===this.state.timeStamp)return;let s;if(document.pointerLockElement){const{movementX:p,movementY:l}=e;s=it(this.transform([p,l]),this.state.values)}else s=St(e,this.transform);const n=this.getKinematics(s,e);if(!this.state._dragStarted){if(this.state._dragDelayed){this.startDrag(e);return}if(this.shouldPreventWindowScrollY)if(!this.state._dragPreventScroll&&n.axis)if(n.axis==="x")this.startDrag(e);else{this.state._active=!1;return}else return;else return}const r=xt(e);this.updateSharedState(r);const i=st(this,e),a=ot(n._movement);let{_dragIsTap:c}=this.state;c&&a>=Ue&&(c=!1),this.updateGestureState({...i,...n,_dragIsTap:c}),this.fireGestureHandler()}),x(this,"onDragEnd",e=>{if(De(this.controller,e),!this.isValidEvent(e)||(this.clean(),!this.state._active))return;this.state._active=!1;const s=this.state._dragIsTap,[n,r]=this.state.velocities,[i,a]=this.state.movement,[c,p]=this.state._intentional,[l,u]=this.config.swipeVelocity,[m,I]=this.config.swipeDistance,S=this.config.swipeDuration,P={...st(this,e),...this.getMovement(this.state.values)},w=[0,0];P.elapsedTime<S&&(c!==!1&&Math.abs(n)>l&&Math.abs(i)>m&&(w[0]=at(n)),p!==!1&&Math.abs(r)>u&&Math.abs(a)>I&&(w[1]=at(r))),this.updateSharedState({buttons:0}),this.updateGestureState({...P,tap:s,swipe:w}),this.fireGestureHandler(this.config.filterTaps&&s===!0)}),x(this,"clean",()=>{super.clean(),this.state._dragStarted=!1,this.releasePointerCapture(),Ie(this.controller,this.stateKey)}),x(this,"onCancel",()=>{this.state.canceled||(this.updateGestureState({canceled:!0,_active:!1}),this.updateSharedState({buttons:0}),Ht(this.fireGestureHandler))}),x(this,"onClick",e=>{this.state._dragIsTap||e.stopPropagation()})}startDrag(e,s=!1){!this.state._active||this.state._dragStarted||(s||this.setStartState(e),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())}addBindings(e){if(this.config.useTouch?(C(e,"onTouchStart",this.onDragStart),C(e,"onTouchMove",this.onDragChange),C(e,"onTouchEnd",this.onDragEnd),C(e,"onTouchCancel",this.onDragEnd)):(C(e,"onPointerDown",this.onDragStart),C(e,"onPointerMove",this.onDragChange),C(e,"onPointerUp",this.onDragEnd),C(e,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){const s=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";C(e,s,this.onClick)}}}function Fe(t,e){let s,n=[],r,i=!1;function a(...c){return i&&s===this&&e(c,n)||(r=t.apply(this,c),i=!0,s=this,n=c),r}return a}function X(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;let s,n,r;if(Array.isArray(t)){if(s=t.length,s!==e.length)return!1;for(n=s;n--!==0;)if(!X(t[n],e[n]))return!1;return!0}let i;if(typeof Map=="function"&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i=t.entries();!(n=i.next()).done;)if(!e.has(n.value[0]))return!1;for(i=t.entries();!(n=i.next()).done;)if(!X(n.value[1],e.get(n.value[0])))return!1;return!0}if(typeof Set=="function"&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i=t.entries();!(n=i.next()).done;)if(!e.has(n.value[0]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(r=Object.keys(t),s=r.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,r[n]))return!1;if(typeof Element<"u"&&t instanceof Element)return!1;for(n=s;n--!==0;)if(!(r[n]==="_owner"&&t.$$typeof)&&!X(t[r[n]],e[r[n]]))return!1;return!0}return t!==t&&e!==e}function We(t,e){try{return X(t,e)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}}function lt(t={},e){const s={};for(const[n,r]of Object.entries(e))switch(typeof r){case"function":s[n]=r.call(s,t[n],n,t);break;case"object":s[n]=lt(t[n],r);break;case"boolean":r&&(s[n]=t[n]);break}return s}const Ye=180,Xe=.15,He=.5,qe=50,Je=250,Ze={threshold(t=0){return B(t)},rubberband(t=0){switch(t){case!0:return B(Xe);case!1:return B(0);default:return B(t)}},enabled(t=!0){return t},triggerAllEvents(t=!1){return t},initial(t=0){return typeof t=="function"?t:B(t)},transform:!0},Kt={...Ze,axis:!0,lockDirection(t=!1){return t},bounds(t={}){if(typeof t=="function")return i=>Kt.bounds(t(i));const{left:e=-1/0,right:s=1/0,top:n=-1/0,bottom:r=1/0}=t;return[[e,s],[n,r]]}},Qe=typeof window<"u"&&window.document&&window.document.createElement,ts={enabled(t=!0){return t},domTarget:!0,window(t=Qe?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform:!0},es={...Kt,useTouch(t=!0){return t&&Mt()},preventWindowScrollY(t=!1){return t},threshold(t,e,{filterTaps:s=!1,lockDirection:n=!1,axis:r=void 0}){const i=B(t,s?3:n||r?1:0);return this.filterTaps=s,i},swipeVelocity(t=He){return B(t)},swipeDistance(t=qe){return B(t)},swipeDuration(t=Je){return t},delay(t=0){switch(t){case!0:return Ye;case!1:return 0;default:return t}}};function ss(t){return lt(t,ts)}function ns(t={}){return lt(t,es)}function rs({domTarget:t,eventOptions:e,window:s,enabled:n,...r}){const i=ss({domTarget:t,eventOptions:e,window:s,enabled:n});return i.drag=ns(r),i}function is(t,e,s={}){const n=os(t),r=new Ee(n);return r.config=e,r.handlers=t,r.nativeRefs=s,Yt()&&!e.manual&&(ct(r.bind),Xt(r.clean)),r}function os(t){const e=new Set;return t.drag&&e.add($.get("drag")),t.wheel&&e.add($.get("wheel")),t.scroll&&e.add($.get("scroll")),t.move&&e.add($.get("move")),t.pinch&&e.add($.get("pinch")),t.hover&&e.add($.get("hover")),e}function as(t,e={}){$.set("drag",Ve);const s=U();return s.value||(s.value=Fe(rs,We)),is({drag:t},s.value(e))}const cs={class:"flex flex-col items-center"},ls=["viewBox"],us=["transform"],fs=["innerHTML"],ds=["x","y","viewBox"],hs=["x","y","width","height"],ps={class:"link"},ms=["x1","x2","y1","y2","stroke"],gs=["transform"],vs={class:"mouse"},ys=["fill"],ws={class:"arrows"},bs={class:"guests"},Ps=qt({__name:"SpacePlane",props:{pad:{type:Number,default:50},coord:{type:String,default:""}},emits:["user","enter","leave","chat","post","update:coord"],setup(t,{emit:e}){const s=e,{user:n}=Ct(),{space:r,plane:i,pos:a,zoom:c,links:p,width:l,height:u,guests:m,guestCount:I,area:S,join:P,place:w,setStatus:A}=ye({TIMEOUT:1e4});kt(I,(b,d)=>{b>d?s("enter"):s("leave")});const g=oe(b=>{w({x:b[0],y:b[1]}),s("update:coord",`${b[0]},${b[1]}`)},200);as(b=>{if(!(b.delta[0]&&b.delta[1])||M.ing)return;const[d,f]=b.delta;a[0]-=d,a[1]-=f,g(a)},{domTarget:i});const _=U(),{drauu:k,draw:M,loadCanvas:G}=ce();return ct(()=>{k.mount(_.value,_.value.parentElement),G()}),Jt(()=>{console.log("activated")}),Zt(()=>{console.log("deactivated")}),Ot(()=>{k.unmount()}),(b,d)=>{const f=Qt("space-draw");return O(),N("div",cs,[!o(r).joined&&o(n).is?(O(),N("div",{key:0,class:"text-2xl p-8 top-15vh cursor-pointer absolute rounded-3xl shadow-xl border-4",style:se({borderColor:o(n).color}),onClick:d[0]||(d[0]=h=>{o(P)()})},"Click anywhere to join the space",4)):te("",!0),ee(f,{class:"z-500"}),(O(),N("svg",{class:"h-full w-full z-200 bg-dark-100 bg-opacity-5 touch-none cursor-grab active-cursor-grabbing",ref_key:"plane",ref:i,xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full","font-family":"Commissioner , sans-serif","text-anchor":"middle","dominant-baseline":"middle",viewBox:`${-t.pad+o(a)[0]-Number(o(l))/2} ${-t.pad+o(a)[1]-Number(o(u))/2} ${Number(o(l))*Number(o(c))+2*t.pad} ${Number(o(u))*Number(o(c))+2*t.pad}`,onClick:d[3]||(d[3]=h=>{o(n).is||(o(n).auth=!0)})},[d[4]||(d[4]=D("defs",null,[D("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[D("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})]),D("clipPath",{id:"mask",clipPathUnits:"objectBoundingBox"},[D("circle",{r:".5",cx:".5",cy:".5"})])],-1)),D("text",{class:"text-xs","text-anchor":"end",fill:"currentColor",transform:`translate(${o(a)[0]+Number(o(l))/2-10} ${o(a)[1]-Number(o(u))/2+20})`},ne(o(a)),9,us),(O(!0),N(tt,null,et(o(m),h=>(O(),N("g",{class:"opacity-90",key:h.draw,innerHTML:h.draw},null,8,fs))),128)),(O(),N("svg",{class:re(["opacity-70",{"pointer-events-none":!o(M).enabled,"touch-none":o(M).enabled}]),ref_key:"paper",ref:_,x:o(a)[0]-Number(o(l))/2-t.pad,y:o(a)[1]-Number(o(u))/2-t.pad,viewBox:`${-t.pad+o(a)[0]-Number(o(l))/2} ${-t.pad+o(a)[1]-Number(o(u))/2} ${Number(o(l))+2*t.pad} ${Number(o(u))+2*t.pad}`},null,10,ds)),D("rect",{ref_key:"area",ref:S,x:o(a)[0]-Number(o(l))/2,y:o(a)[1]-Number(o(u))/2,rx:"12",width:Number(o(l)),height:Number(o(u)),fill:"none",stroke:"#3333","stroke-width":"1"},null,8,hs),D("g",ps,[D("line",{x1:o(a)[0],x2:o(r).my.mouse.x,y1:o(a)[1],y2:o(r).my.mouse.y,stroke:o(n).color,"stroke-dasharray":"6"},null,8,ms)]),D("g",{class:"pointer",transform:`translate(${o(a)[0]} ${o(a)[1]})`},[D("g",vs,[D("circle",{style:{filter:"url(#shadowButton)"},fill:o(n).color,r:"8"},null,8,ys)])],8,gs),D("g",ws,[(O(!0),N(tt,null,et(o(p),(h,v)=>(O(),gt(o(ue),{key:v,link:h,onUser:d[1]||(d[1]=y=>o(le).pub=y)},null,8,["link"]))),128))]),D("g",bs,[(O(!0),N(tt,null,et(o(m),h=>{var v,y;return O(),gt(o(fe),ie({class:"cursor-pointer transition-all ease-out duration-600",key:h==null?void 0:h.pub},{ref_for:!0},h,{style:{transform:`translate(${(v=h==null?void 0:h.pos)==null?void 0:v.x}px, ${(y=h==null?void 0:h.pos)==null?void 0:y.y}px)`},onUpdateStatus:d[2]||(d[2]=E=>o(A)(E))}),null,16,["style"])}),128))])],8,ls))])}}});export{Ps as default};
