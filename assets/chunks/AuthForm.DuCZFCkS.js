import{_ as Q,p as u,q as V,c as p,o as f,j as s,e as m,ag as $,aD as x,aE as y,G as g,k as E,w as L,T,a0 as v,n as q}from"./framework.BoVd_Pm6.js";import{a as A,Q as R,x as b,S as j,y as k,$ as w,z}from"./components.BLyRHMpj.js";import{u as B}from"./useQR.CXltOZwU.js";import"./theme.C0V-IKld.js";const J={class:"flex flex-wrap justify-center my-2"},O={key:0,class:"flex"},U={class:"hidden"},I={class:"flex flex-wrap"},M={__name:"AuthForm",setup(W){const{processFile:c}=B(),i=u("pass"),o=u(),r=u(null),{auth:N}=A();function C(t){i.value!=t?i.value=t:i.value=null}V(o,async t=>{if(!t)return;typeof t=="string"&&t.includes("#/auth/")&&(t=b(t)),t&&typeof t=="string"&&t.substring(0,3)=="SEA"&&(r.value="");let e=z(t);e!=null&&e.pub&&(e!=null&&e.priv)?(N(e),o.value=null):console.log("No valid pair")});async function P(t=o.value){typeof t=="string"&&t.includes("#/auth/")&&(t=b(t)),o.value=await j.decrypt(t,r.value)}function F(t){var e;k((e=t.target)==null?void 0:e.files,a=>o.value=a)}async function S(t){var a,l;const e=(l=(a=t.target)==null?void 0:a.files)==null?void 0:l[0];if(e)try{const n=await w(e);n!=null&&n.content&&(o.value=n.content)}catch(n){console.error("Failed to extract data from PNG:",n)}}function D(t){c(t,e=>o.value=e)}async function G(t){const e=t[0];if(!e)return;const a=e.type.toLowerCase();if(a==="application/json")k([e],l=>o.value=l);else if(a==="image/png")try{const l=await w(e);l!=null&&l.content&&(o.value=l.content)}catch(l){console.error("Failed to extract data from PNG:",l)}else a.startsWith("image/")&&c(e,l=>o.value=l)}const d=u(!1);return(t,e)=>(f(),p("div",{class:q(["flex flex-col my-4 flex-1 items-center bg-light-700 dark-bg-dark-50 rounded-3xl p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":d.value}]),id:"dropzone",onDrop:e[8]||(e[8]=v(a=>{var l;G((l=a.dataTransfer)==null?void 0:l.files),d.value=!1},["prevent"])),onDragover:e[9]||(e[9]=v(a=>d.value=!0,["prevent"])),onDragleave:e[10]||(e[10]=v(a=>d.value=!1,["prevent"]))},[e[14]||(e[14]=s("div",{class:"font-bold text-xl"},"I already have an account",-1)),e[15]||(e[15]=s("div",{class:"text-md"},"Login with a saved key",-1)),s("div",J,[s("button",{class:"button m-2 cursor-pointer flex items-center",onClick:e[0]||(e[0]=a=>C("key"))},e[11]||(e[11]=[s("div",{class:"i-la-key text-xl"},null,-1),s("div",{class:"p-1 ml-1 font-bold"},"Paste",-1)])),e[12]||(e[12]=$('<label class="button m-2 cursor-pointer flex items-center" for="qr-input" data-v-09602c24><div class="i-la-qrcode text-xl" data-v-09602c24></div><div class="p-1 ml-1 font-bold" data-v-09602c24>QR</div></label><label class="button m-2 cursor-pointer flex items-center" for="json-input" data-v-09602c24><div class="i-la-file-code text-xl" data-v-09602c24></div><div class="p-1 ml-1 font-bold" data-v-09602c24>JSON</div></label><label class="button m-2 cursor-pointer flex items-center" for="png-input" data-v-09602c24><div class="i-la-user-circle text-xl" data-v-09602c24></div><div class="p-1 ml-1 font-bold" data-v-09602c24>PNG</div></label>',3))]),r.value!==null?(f(),p("form",O,[x(s("input",{class:"py-1 px-4 m-1 rounded-xl","onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[y,r.value]]),s("button",{class:"button text-2xl",type:"submit",onClick:e[2]||(e[2]=a=>P())},e[13]||(e[13]=[s("div",{class:"i-la-sign-in-alt"},null,-1)]))])):m("",!0),s("div",U,[g(E(R),{onLoaded:e[3]||(e[3]=a=>o.value=a)}),s("input",{id:"qr-input",type:"file",accept:"image/*",onChange:e[4]||(e[4]=a=>D(a.target.files[0]))},null,32),s("input",{id:"json-input",ref:"file",tabindex:"-1",type:"file",accept:"application/json",onChange:e[5]||(e[5]=a=>F(a))},null,544),s("input",{id:"png-input",type:"file",accept:"image/png",onChange:e[6]||(e[6]=a=>S(a))},null,32)]),e[16]||(e[16]=s("div",{class:"text-sm opacity-50"},"Drag and drop your key file here (PNG, JSON, or QR image)",-1)),s("div",I,[g(T,{name:"fade",mode:"out-in",appear:""},{default:L(()=>[i.value=="key"?x((f(),p("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[7]||(e[7]=a=>o.value=a),rows:"6",cols:"40",placeholder:"Paste your key pair here or drag and drop a file"},null,512)),[[y,o.value]]):m("",!0)]),_:1})])],34))}},Y=Q(M,[["__scopeId","data-v-09602c24"]]);export{Y as default};
