import{ah as m,p as O,V as P}from"./framework.BfubPTv1.js";function j(){const i=m(new Map),l=O(!1),u=m({done:!1,progress:0,downloadSpeed:0,downloaded:0});let n=null,o=null;const w=["udp://tracker.leechers-paradise.org:6969","udp://tracker.coppersurfer.tk:6969","udp://tracker.opentrackr.org:1337","udp://explodie.org:6969","udp://tracker.empire-js.us:1337","wss://tracker.btorrent.xyz","wss://tracker.openwebtorrent.com"];function g(e,t=w){const r=t.map(a=>`&tr=${encodeURIComponent(a)}`).join("");return`magnet:?xt=urn:btih:${e}${r}`}function p(e){return e.replace(/[^a-zA-Z0-9.-]/g,"_")}async function y(e){try{const a=await(await(await n.getFileHandle(`${e}.meta.json`)).getFile()).text();return JSON.parse(a)}catch{return null}}async function F(e,t){const a=await(await n.getFileHandle(`${e}.meta.json`,{create:!0})).createWritable();await a.write(JSON.stringify(t)),await a.close()}async function d(){try{n=await navigator.storage.getDirectory();const e=(await P(async()=>{const{default:t}=await import("./webtorrent.min.D4AedfBj.js");return{default:t}},[])).default;o=new e,l.value=!0,await h()}catch(e){return console.error("Torrent system initialization failed:",e),!1}}async function h(){if(n)for await(const[e]of n.entries()){if(e.endsWith(".meta.json"))continue;const t=await y(e);if(!t)continue;const r=await b(e);if(r){const a=new File([r],t.originalName,{type:t.type});await f(a,e)}}}async function f(e,t){return new Promise(r=>{o.seed([e],a=>{i.set(t,{file:e,torrent:a,info:{infoHash:a.infoHash,magnetURI:a.magnetURI,name:a.name,length:a.length}}),r(i.get(t))})})}async function v(e){l.value||await d();const t=[];for(const r of e){const a=await _(r);if(a){const s=await f(r,a);t.push(s)}}return t}async function H(e){const t=i.get(e);t!=null&&t.torrent&&t.torrent.destroy(),await(n==null?void 0:n.removeEntry(e)),await(n==null?void 0:n.removeEntry(`${e}.meta.json`).catch(()=>{})),i.delete(e)}async function _(e){if(!n)return null;try{const t=p(e.name),a=await(await n.getFileHandle(t,{create:!0})).createWritable();return await a.write(e),await a.close(),await F(t,{originalName:e.name,type:e.type,lastModified:e.lastModified}),t}catch(t){return console.error("Error saving to OPFS:",t),null}}async function b(e){if(!n)return null;try{return await(await n.getFileHandle(e)).getFile()}catch(t){return console.error("Error loading from OPFS:",t),null}}async function S(e){return l.value||await d(),new Promise(async t=>{function r(s){const k=s.files;o.on("download",c=>{Object.assign(u,{done:c.done,progress:c.progress,downloaded:c.downloaded,downloadSpeed:c.downloadSpeed})}),t(k)}let a=await o.get(e);if(a)r(a);else{const s=g(e);o.add(s,r)}})}return{files:i,initialized:l,downloadStatus:u,init:d,upload:v,download:S,deleteFile:H,defaultTrackers:w}}export{j as u};
