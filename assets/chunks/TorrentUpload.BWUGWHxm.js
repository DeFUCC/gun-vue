import{p as d,V as N,d as Q,h as q,aR as G,aS as I,c as g,o as r,G as H,a0 as C,n as O,j as l,r as P,t as c,k as i,w as B,e as h,T as j,b as L,F as z,B as A,q as M}from"./framework.BfubPTv1.js";import"./theme.Bx92stOk.js";import{H as _,a9 as J,U as K,i as W,a as X}from"./components.Cuv16BkZ.js";import{p as Y}from"./index.BuUnCgYx.js";function Z(S){const w=d(),b=d();return N(()=>import("./webtorrent.min.D4AedfBj.js"),[]).then(a=>{const u=new a.default;u.on("upload",o=>{b.value=o}),u.seed(S,function(o){console.log("Client is seeding "+o.magnetURI),w.value=o})}),{torrent:w,progress:b}}const ee={class:"flex"},le={class:"text-md max-w-55ch"},se={class:"p-0"},ae={class:"flex flex-wrap gap-2 p-4 items-start"},te={key:0,class:"flex flex-col gap-2"},ne={class:"font-mono text-sm"},oe=["href"],re={class:"p-0"},ie={class:"p-0"},ue={class:"p-0"},ge=Q({__name:"TorrentUpload",emits:["uploaded","url"],setup(S,{emit:w}){const b=w,a=d();d();const u=d(!1),o=d(!1),x=d(!1),y=d(!1);function $(s){var t,k;const e=((t=s.target)==null?void 0:t.files)||((k=s==null?void 0:s.dataTransfer)==null?void 0:k.files);if(!e||e.length===0)return;const{torrent:p}=Z(e);W();const{user:v}=X();M(p,async f=>{a.value=f,u.value=!0;const n={infoHash:f.infoHash,length:f.length,name:f.name,author:v.pub};b("uploaded",n),b("url",m.value)})}function R(s){s.preventDefault(),y.value=!0}function T(s){s.preventDefault(),y.value=!1}function F(s){s.preventDefault(),y.value=!1,$(s)}const m=q(()=>{var e,p,v;if(!((e=a.value)!=null&&e.infoHash))return"";let s=new URL((p=window==null?void 0:window.location)==null?void 0:p.href);return s.hash="",`${s.href}#/files/${(v=a.value)==null?void 0:v.infoHash}`}),D=G({source:m}),{share:V,isSupported:E}=I();return(s,e)=>{var p,v;return r(),g("div",ee,[a.value?(r(),g("div",{key:1,class:"animate-pulse p-2 flex flex-wrap gap-2 bg-light-100 dark-bg-dark-400 rounded cursor-pointer items-center break-all border-2 rounded-lg shadow-lg",onClick:e[2]||(e[2]=t=>u.value=!u.value)},[e[10]||(e[10]=l("div",{class:"font-bold"},"Sharing a file:",-1)),l("div",le,c((p=a.value)==null?void 0:p.name),1),e[11]||(e[11]=l("div",{class:"flex-1"},null,-1)),l("div",se,c(i(Y)((v=a.value)==null?void 0:v.length)),1),l("div",{class:"i-la-times",onClick:e[1]||(e[1]=C(t=>a.value=null,["prevent","stop"]))})])):(r(),g("label",{key:0,class:O(["border-2 shadow-lg p-4 flex flex-wrap gap-2 bg-light-100 dark-bg-dark-400 rounded-lg cursor-pointer items-center",{"bg-light-800":y.value}]),for:"file",onDragover:C(R,["prevent"]),onDragleave:C(T,["prevent"]),onDrop:C(F,["prevent"])},[e[9]||(e[9]=l("div",{class:"i-la-paperclip text-xl"},null,-1)),P(s.$slots,"default",{},()=>[e[8]||(e[8]=l("div",{class:"font-bold"},"Drop your files here",-1))]),l("input",{id:"file",type:"file",accept:"*",onChange:e[0]||(e[0]=t=>$(t)),style:{display:"none"}},null,32)],34)),H(i(K),{open:u.value,onClose:e[7]||(e[7]=t=>u.value=!1)},{default:B(()=>{var t,k,f;return[l("div",ae,[a.value?(r(),g("div",te,[e[17]||(e[17]=l("div",{class:"text-xl"},"Sharing the torrent",-1)),l("div",ne,c((t=a.value)==null?void 0:t.infoHash),1),l("a",{class:"gap-2 button underline font-bold -all",href:m.value,target:"_blank"},e[12]||(e[12]=[l("div",{class:"i-la-link"},null,-1),l("div",{class:"p-0"},"Download URL",-1)]),8,oe),i(D).isSupported.value?(r(),g("button",{key:0,class:"p-2 button gap-2",onClick:e[3]||(e[3]=n=>i(D).copy())},[e[13]||(e[13]=l("div",{class:"i-la-copy"},null,-1)),l("div",re,c((k=i(D))!=null&&k.copied.value?"Copied!":"Copy"),1)])):h("",!0),i(E)?(r(),g("button",{key:1,class:"p-2 button gap-2",onClick:e[4]||(e[4]=n=>{var U;return i(V)({title:(U=a.value)==null?void 0:U.name,url:m.value})})},e[14]||(e[14]=[l("div",{class:"i-la-share"},null,-1),l("div",{class:"p-0"}," Share",-1)]))):h("",!0),l("button",{class:"button p-2 gap-2",onClick:e[5]||(e[5]=n=>o.value=!o.value)},[e[15]||(e[15]=l("div",{class:"i-la-qrcode"},null,-1)),l("div",ie,c(o.value?"Hide":"Show")+" QR ",1)]),l("button",{class:"button p-2 gap-2",onClick:e[6]||(e[6]=n=>x.value=!x.value)},[e[16]||(e[16]=l("div",{class:"i-la-file"},null,-1)),l("div",ue,c(x.value?"Hide":"Show")+" file ",1)])])):h("",!0),H(j,{name:"fade"},{default:B(()=>[m.value&&o.value?(r(),L(i(_),{key:0,data:m.value},null,8,["data"])):h("",!0)]),_:1}),x.value?(r(!0),g(z,{key:1},A((f=a.value)==null?void 0:f.files,n=>(r(),L(i(J),{class:"flex-auto",key:n==null?void 0:n.name,file:n},null,8,["file"]))),128)):h("",!0)])]}),_:1},8,["open"])])}}});export{ge as default};
