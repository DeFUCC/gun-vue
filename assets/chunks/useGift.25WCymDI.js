import{g as a}from"./composables.BdOMFBpf.js";import{h as b,u as j,i as p,a8 as d}from"./components.BfL1cQFx.js";import{aj as m,h as u,b2 as v,z as G,az as N,x as $}from"./framework.DOfjDz1B.js";function S(n){const s=b(),o=m({}),e=m({from:!1,to:!1,complete:u(()=>e.from&&e.to),status:u(()=>e.from?e.to?"complete":"proposed":"canceled")});return s.get("#"+a).get(n).once((r,c)=>{try{Object.assign(o,JSON.parse(r)),s.user(o.from).get(a).get(c).on(i=>{e.from=i}),s.user(o.to).get(a).get(c).on(i=>{e.to=i})}catch{}}),{gift:o,state:e}}async function A(n,s=!0){const{user:o}=j();o.db.get(a).get(n).put(s)}function E(n){const{user:s}=j(),{now:o,pause:e}=v({interval:1e3,controls:!0}),r=m({from:u(()=>s==null?void 0:s.pub),to:"",qn:null,ql:null,wish:"",project:"",date:u(()=>o.value.getTime()),room:u(()=>p.pub)}),c=u(()=>{let t=q(r);return t.qn=Number(t.qn),t}),i=["from","to","qn","ql"],w=u(()=>i.reduce((f,l)=>f&&r[l],!0));G(r,t=>{t.project&&(r.to=t.project.slice(-87))});const y=N(async()=>{const{hash:t}=await d(c.value);return t}),h=$(!1);Object.assign(r,n);const g=b();async function O(){var l;const{hash:t,hashed:f}=await d(c.value);console.log(t,f),g.get("#"+a).get(t).put(f),g.user().get(a).get(t).put("proposed",()=>{e(),h.value=!0}),(l=p.features)!=null&&l.gifts&&g.user(p.pub).get(a).get(`${t}@${s.pub}`).put(!0,()=>{console.log(`gift ${t} published`)},{opt:{cert:p.features.gifts}})}return{gift:r,cleanGift:c,valid:w,propose:O,proposed:h,hash:y}}function q(n){return Object.entries(n).filter(([s,o])=>!!o).reduce((s,[o,e])=>({...s,[o]:e===Object(e)?q(e):e}),{})}export{E as a,A as g,q as r,S as u};
