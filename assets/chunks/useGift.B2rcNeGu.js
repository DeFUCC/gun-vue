import{g as u}from"./composables.CrYqeRZ_.js";import{i as b,a as j,h as p,ad as d}from"./components.w4on3SLO.js";import{ah as m,h as a,a$ as v,q as G,ay as N,p as $}from"./framework.BfubPTv1.js";function A(n){const s=b(),o=m({}),e=m({from:!1,to:!1,complete:a(()=>e.from&&e.to),status:a(()=>e.from?e.to?"complete":"proposed":"canceled")});return s.get("#"+u).get(n).once((r,c)=>{try{Object.assign(o,JSON.parse(r)),s.user(o.from).get(u).get(c).on(i=>{e.from=i}),s.user(o.to).get(u).get(c).on(i=>{e.to=i})}catch{}}),{gift:o,state:e}}async function E(n,s=!0){const{user:o}=j();o.db.get(u).get(n).put(s)}function J(n){const{user:s}=j(),{now:o,pause:e}=v({interval:1e3,controls:!0}),r=m({from:a(()=>s==null?void 0:s.pub),to:"",qn:null,ql:null,wish:"",project:"",date:a(()=>o.value.getTime()),room:a(()=>p.pub)}),c=a(()=>{let t=q(r);return t.qn=Number(t.qn),t}),i=["from","to","qn","ql"],y=a(()=>i.reduce((f,l)=>f&&r[l],!0));G(r,t=>{t.project&&(r.to=t.project.slice(-87))});const w=N(async()=>{const{hash:t}=await d(c.value);return t}),h=$(!1);Object.assign(r,n);const g=b();async function O(){var l;const{hash:t,hashed:f}=await d(c.value);console.log(t,f),g.get("#"+u).get(t).put(f),g.user().get(u).get(t).put("proposed",()=>{e(),h.value=!0}),(l=p.features)!=null&&l.gifts&&g.user(p.pub).get(u).get(`${t}@${s.pub}`).put(!0,()=>{console.log(`gift ${t} published`)},{opt:{cert:p.features.gifts}})}return{gift:r,cleanGift:c,valid:y,propose:O,proposed:h,hash:w}}function q(n){return Object.entries(n).filter(([s,o])=>!!o).reduce((s,[o,e])=>({...s,[o]:e===Object(e)?q(e):e}),{})}export{J as a,E as g,q as r,A as u};
