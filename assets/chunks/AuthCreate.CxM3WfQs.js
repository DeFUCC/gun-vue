import{d as j,p as y,ak as P,h as f,v as $,c as i,e as p,k as a,o as l,j as t,aE as N,aF as _,a0 as d,n as b,t as E,P as T}from"./framework.ap9ZVjPY.js";import{a as B,D,E as I,G as M,H as G,N as H,j as q,I as z}from"./components.Cf6-ENKK.js";import{e as F,Z as Y,w as Z}from"./english.CNr916y2.js";import"./theme.Db1AxbS0.js";const J={class:"h-240px w-240px border-8 rounded-full shadow-xl flex items-center justify-center"},L=["data"],O={class:"flex flex-col gap-4 p-4 max-w-70vw"},Q={class:"flex flex-wrap justify-center gap-2"},W=["disabled"],X=["disabled"],ee={class:"blur-lg hover-blur-0 transition-500 select-all"},te={key:0,class:"max-w-100 text-12px font-mono text-green-700"},se={key:1,class:"max-w-100 text-12px font-mono text-red"},ae=["disabled"],de=j({__name:"AuthCreate",emits:["back"],setup(ne,{emit:oe}){const{user:x,auth:g}=B(),n=y(""),r=y(crypto.getRandomValues(new Uint8Array(20))),v=P(new Set),{undo:w,canUndo:k,canRedo:h,redo:C}=D(r),A=f(()=>F(r.value,Z)),m=f(()=>v.has(r.value)),u=I(async()=>await Y(btoa(String.fromCharCode(...r.value))),{},{immediate:!0});async function U(){r.value=crypto.getRandomValues(new Uint8Array(20))}function V(){g(u.value,()=>T(async()=>{await q().user(u.value.pub).get("profile").get("name").once().then()||z("name",n.value||"Noname")}))}async function K(){let s=await S(n.value);v.add(s),r.value=s}const c=y(null),{focused:R}=M(c);G(()=>{c.value.active||c.value.focus()}),$(()=>{R.value=!0});async function S(s){if(!s)return;const e=await navigator.credentials.create({publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32)),rp:{name:"Gun-Vue"},user:{id:crypto.getRandomValues(new Uint8Array(16)),name:s,displayName:s},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],authenticatorSelection:{residentKey:"required",userVerification:"preferred"},attestation:"none",timeout:6e4}});return new Uint8Array(await crypto.subtle.digest("SHA-256",e.rawId)).slice(0,20)}return(s,e)=>a(x).is?p("",!0):(l(),i("form",{key:0,class:"flex flex-col items-center flex-1 bg-light-700 dark-bg-dark-200 rounded-3xl shadow-lg text-center py-4 transition duration-300ms ease-in relative",onSubmit:e[6]||(e[6]=d(o=>n.value&&V(),["prevent"]))},[t("button",{class:"button absolute top-0 left-0",onClick:e[0]||(e[0]=o=>s.$emit("back"))},e[7]||(e[7]=[t("div",{class:"i-la-angle-left"},null,-1)])),t("div",J,[a(u)?(l(),i("object",{key:0,data:a(H)({pub:a(u).pub,size:220,svg:"interactive"})},null,8,L)):p("",!0)]),t("div",O,[N(t("input",{class:"p-4 rounded-2xl text-center text-xl font-bol max-w-full","onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),ref_key:"input",ref:c,autofocus:"",placeholder:"Your Name",autocomplete:"username"},null,512),[[_,n.value]]),t("div",Q,[a(k)?(l(),i("button",{key:0,class:"gap-2 button items-center",type:"button",onClick:e[2]||(e[2]=d(o=>a(w)(),["stop"]))},e[8]||(e[8]=[t("div",{class:"i-la-undo text-2xl"},null,-1)]))):p("",!0),t("button",{class:"gap-2 button items-center",type:"button",onClick:e[3]||(e[3]=d(o=>U(),["stop"]))},e[9]||(e[9]=[t("div",{class:"i-la-redo-alt text-2xl"},null,-1)])),t("button",{class:b(["gap-2 button items-center",{[m.value?"bg-green! dark-bg-green-800!":""]:!0}]),title:"Requires name to create a new credential",type:"button",disabled:!n.value,onClick:e[4]||(e[4]=d(o=>K(),["stop"]))},e[10]||(e[10]=[t("div",{class:"i-la-fingerprint text-2xl"},null,-1)]),10,W),t("button",{class:"gap-2 button items-center",type:"button",disabled:!a(h),onClick:e[5]||(e[5]=d(o=>a(C)(),["stop"]))},e[11]||(e[11]=[t("div",{class:"i-la-redo text-2xl"},null,-1)]),8,X)]),t("div",{class:b(["p-4 rounded-xl max-w-100 font-mono bg-light-900 dark-bg-dark-700 border-2",{[m.value?"border-green!":"border-red"]:!0}])},[t("p",ee,E(A.value),1)],2),m.value?(l(),i("div",te,"This passphrase comes from your PassKey and can be accessed from another device with the same credentials provider. You can recover this seed phrase from your credentials ID later. But best practice is to write it down somewhere just in case of possible provider failures. Even if the seed phrase gets destroyed a derived key pair may be securely stored and used as well.")):(l(),i("div",se,"Random seed phrases are not stored after use for key derivation. Store it privately to derive this key pair on other devices. If you ever lose your seed phrase you can still store your derived key pair and use it as purely random one.")),a(u)?(l(),i("button",{key:2,class:"button w-full flex justify-center items-center",disabled:!n.value,type:"submit"},"Authenticate",8,ae)):p("",!0)])],32))}});export{de as default};
