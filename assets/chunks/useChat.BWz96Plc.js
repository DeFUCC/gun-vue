import{j as D,a as j,i as n,O as w}from"./components.o3Gv9VgH.js";import{p as O,h as a,ah as g,aW as x}from"./framework.BN2VI_cg.js";function L(l="general"){const c=D(),{user:p}=j(),i=O(l),h=a(()=>{const t=g({general:{}});return c.user(n.pub).get("chat").map().on((e,u)=>{var r;const[s,o]=u.split("@");t[s]=t[s]||{},e?t[s][o]=e:(r=t==null?void 0:t[s])==null||delete r[o]}),t});function b(t){c.user(n.pub).get("chat").get(`${w(t)||t}@${p.pub}`).put(!0,void 0,{opt:{cert:n.features.chat}})}const m=a(()=>c.user(n.pub).get("chat/"+i.value)),f=a(()=>{const t=g({});return m.value.map().on((e,u)=>{const s=u.substring(0,13),o=u.substring(14),r={timestamp:s,author:o,text:e};t[u]=r}),t}),d=a(()=>Object.values(f.value||{})),v=x(d),$=a(()=>v.value.sort((t,e)=>t.timestamp>e.timestamp?1:-1));function C(t){if(!t)return;let e=Date.now();m.value.get(`${e}@${p.pub}`).put(t,void 0,{opt:{cert:n.features.chat}})}return{send:C,addChat:b,currentChat:i,chats:h,messages:f,sorted:$}}export{L as u};
