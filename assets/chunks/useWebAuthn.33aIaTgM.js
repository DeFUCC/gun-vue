import{B as A,S as u}from"./components.DDidTy9E.js";import{p as E,s as U}from"./framework.BoVd_Pm6.js";function I(){const t=A("webauthn-min",{}),r=E(Object.values(t.value).map(e=>e.username));U(()=>{r.value=Object.values(t.value).map(e=>e.username)});async function d(e,n){if(!e||!n)throw new Error("Username & keypair required");const a=f(32),l=new TextEncoder().encode(e).slice(0,64),h={challenge:a,rp:{id:location.hostname,name:document.title||"PWA"},user:{id:l,name:e,displayName:e},pubKeyCredParams:[{type:"public-key",alg:-7}],authenticatorSelection:{residentKey:"required",userVerification:"required"},attestation:"none"},c=await navigator.credentials.create({publicKey:h});if(!c)throw new Error("Credential creation cancelled");const o=new Uint8Array(c.rawId),i=p(o),y=await m(o),w=await u.work(i,location.hostname),s=await u.encrypt(n,w);t.value[y]={username:e,encKeypair:s}}async function g(e){const n=Object.entries(t.value).find(([,v])=>v.username===e);if(!n)throw new Error("No stored credential");const[a,{encKeypair:l}]=n,c={challenge:f(32),rpId:location.hostname,userVerification:"required"},o=await navigator.credentials.get({publicKey:c});if(!o)throw new Error("Authentication cancelled");const i=new Uint8Array(o.rawId);if(await m(i)!==a)throw new Error("Credential does not match selected user");const w=await u.work(p(i),location.hostname),s=await u.decrypt(l,w);if(!s)throw new Error("Unable to decrypt – wrong authenticator");return s}function b(e){for(const[n,a]of Object.entries(t.value))a.username===e&&delete t.value[n]}return{users:r,storeUser:d,getUser:g,deleteUser:b}}function f(t){const r=new Uint8Array(t);return crypto.getRandomValues(r),r}function p(t){return btoa(String.fromCharCode(...t))}async function m(t){const r=new Uint8Array(await crypto.subtle.digest("SHA-256",t));return Array.from(r,d=>d.toString(16).padStart(2,"0")).join("")}export{I as u};
