import{_ as Q,p as d,q as V,c as f,o as p,j as l,e as m,ag as E,n as x,aD as y,aE as g,G as b,k as T,w as q,T as A,a0 as v}from"./framework.BoVd_Pm6.js";import{a as J,Q as O,x as k,S as R,y as w,$ as N,z as j}from"./components.CAswpCM7.js";import{g as z}from"./usePassKeys.vbZW3sWo.js";import{d as B}from"./usePair.C9HcjAT2.js";import{u as K}from"./useQR.KIvXCFyB.js";import"./theme.CQ_cKKXK.js";const U={class:"flex flex-wrap justify-center my-2"},I={key:0,class:"flex"},M={class:"hidden"},W={class:"flex flex-wrap"},H={__name:"AuthForm",setup(X){const{processFile:c}=K(),r=d("pass"),o=d(),i=d(null),{auth:P}=J();function C(t){r.value!=t?r.value=t:r.value=null}V(o,async t=>{if(!t)return;typeof t=="string"&&t.includes("#/auth/")&&(t=k(t)),t&&typeof t=="string"&&t.substring(0,3)=="SEA"&&(i.value="");let e=j(t);e!=null&&e.pub&&(e!=null&&e.priv)?(P(e),o.value=null):console.log("No valid pair")});async function S(t=o.value){typeof t=="string"&&t.includes("#/auth/")&&(t=k(t)),o.value=await R.decrypt(t,i.value)}function F(t){var e;w((e=t.target)==null?void 0:e.files,a=>o.value=a)}async function $(t){var a,s;const e=(s=(a=t.target)==null?void 0:a.files)==null?void 0:s[0];if(e)try{const n=await N(e);n!=null&&n.content&&(o.value=n.content)}catch(n){console.error("Failed to extract data from PNG:",n)}}function D(t){c(t,e=>o.value=e)}async function G(t){const e=t[0];if(!e)return;const a=e.type.toLowerCase();if(a==="application/json")w([e],s=>o.value=s);else if(a==="image/png")try{const s=await N(e);s!=null&&s.content&&(o.value=s.content)}catch(s){console.error("Failed to extract data from PNG:",s)}else a.startsWith("image/")&&c(e,s=>o.value=s)}const u=d(!1);d("");async function L(){let t=await z();console.log(t),o.value=await B(JSON.stringify(t))}return(t,e)=>(p(),f("div",{class:x(["flex flex-col my-4 flex-1 items-center bg-light-700 dark-bg-dark-50 rounded-3xl p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":u.value}]),id:"dropzone",onDrop:e[9]||(e[9]=v(a=>{var s;G((s=a.dataTransfer)==null?void 0:s.files),u.value=!1},["prevent"])),onDragover:e[10]||(e[10]=v(a=>u.value=!0,["prevent"])),onDragleave:e[11]||(e[11]=v(a=>u.value=!1,["prevent"]))},[e[16]||(e[16]=l("div",{class:"font-bold text-xl"},"I already have an account",-1)),e[17]||(e[17]=l("div",{class:"text-md"},"Login with a saved key",-1)),l("div",U,[l("button",{class:"button items-center",onClick:e[0]||(e[0]=a=>L())},e[12]||(e[12]=[l("div",{class:"i-la-key"},null,-1),l("div",{class:"px-2"},"PassKey",-1)])),l("button",{class:x(["button m-2 cursor-pointer flex items-center",{active:r.value=="key"}]),onClick:e[1]||(e[1]=a=>C("key"))},e[13]||(e[13]=[l("div",{class:"i-la-key text-xl"},null,-1),l("div",{class:"p-1 ml-1 font-bold"},"Paste",-1)]),2),e[14]||(e[14]=E('<label class="button m-2 cursor-pointer flex items-center" for="qr-input" data-v-1d60f01c><div class="i-la-qrcode text-xl" data-v-1d60f01c></div><div class="p-1 ml-1 font-bold" data-v-1d60f01c>QR</div></label><label class="button m-2 cursor-pointer flex items-center" for="json-input" data-v-1d60f01c><div class="i-la-file-code text-xl" data-v-1d60f01c></div><div class="p-1 ml-1 font-bold" data-v-1d60f01c>JSON</div></label><label class="button m-2 cursor-pointer flex items-center" for="png-input" data-v-1d60f01c><div class="i-la-user-circle text-xl" data-v-1d60f01c></div><div class="p-1 ml-1 font-bold" data-v-1d60f01c>PNG</div></label>',3))]),i.value!==null?(p(),f("form",I,[y(l("input",{class:"py-1 px-4 m-1 rounded-xl","onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[g,i.value]]),l("button",{class:"button text-2xl",type:"submit",onClick:e[3]||(e[3]=a=>S())},e[15]||(e[15]=[l("div",{class:"i-la-sign-in-alt"},null,-1)]))])):m("",!0),l("div",M,[b(T(O),{onLoaded:e[4]||(e[4]=a=>o.value=a)}),l("input",{id:"qr-input",type:"file",accept:"image/*",onChange:e[5]||(e[5]=a=>D(a.target.files[0]))},null,32),l("input",{id:"json-input",ref:"file",tabindex:"-1",type:"file",accept:"application/json",onChange:e[6]||(e[6]=a=>F(a))},null,544),l("input",{id:"png-input",type:"file",accept:"image/png",onChange:e[7]||(e[7]=a=>$(a))},null,32)]),e[18]||(e[18]=l("div",{class:"text-sm opacity-50"},"Drag and drop your key file here (PNG, JSON, or QR image)",-1)),l("div",W,[b(A,{name:"fade",mode:"out-in",appear:""},{default:q(()=>[r.value=="key"?y((p(),f("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[8]||(e[8]=a=>o.value=a),rows:"6",cols:"40",placeholder:"Paste your key pair here or drag and drop a file"},null,512)),[[g,o.value]]):m("",!0)]),_:1})])],34))}},ae=Q(H,[["__scopeId","data-v-1d60f01c"]]);export{ae as default};
