import{j as a,i as c,k as f,at as j,a as g,au as l,r as b}from"./components.DuMoxvdb.js";import{ak as d,h as i}from"./framework.ap9ZVjPY.js";function y(u){const{user:o}=g(),e=d({id:l(6),title:u,type:"project",status:"new",public:!0,funding:!1,room:i(()=>c.pub),author:i(()=>o.pub)});async function r(n){const t=a(),s=t.user().get("projects").get(e.id).put(e,()=>{var p;e.public&&(t.user(c.pub).get("projects").get(e.id+"@"+o.pub).put(s,()=>{console.log("added project"),n&&n()},{opt:{cert:(p=c.features)==null?void 0:p.projects}}),e.title="",e.id="")})}return{newProject:e,addProject:r}}function h(u,o,e){const n=a().user().get("projects").get(u);n.get(o).put(e,()=>{n.get("updated").put(Date.now())})}function w(u){const o=a(),e=d({id:"0",type:"event"});o.user(c.pub).get("projects").get(u).map().on(async(t,s)=>{s=="cover"&&f(t)?e[s]=await o.get("#cover").get(t).then():e[s]=t});function r(t,s){h(u.slice(0,-88),t,s)}async function n(t){const s=await b(t);s&&(o.get("#cover").get(s).put(t),r("cover",s))}return{project:e,updateField:r,updateCover:n}}async function P(u){var n;const o=a(),e=j(),{user:r}=g();if(u.includes(r.pub))o.user(c.pub).get("projects").get(u).put(null,void 0,{opt:{cert:(n=c.features)==null?void 0:n.projects}});else if(c.hosts[r.pub]){const t=await r.decrypt(c.hosts[r.pub].enc);e.user().auth(t,()=>{e.user().get("projects").get(u).put(null)})}console.error("Can't delete the project")}export{y as a,P as r,w as u};
