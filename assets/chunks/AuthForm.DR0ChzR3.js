import{_ as J,p as v,h as _,q as w,v as j,c as r,o as i,j as t,G as V,aE as g,e as y,aF as h,n as A,w as U,t as z,aP as H,T as N,a0 as C,P as Q}from"./framework.NFQ89pQN.js";import{q as Y,r as Z,Z as D,C as L}from"./components.Bh0JkzMg.js";import{e as W,w as X}from"./english.MxR0N9Hb.js";import{h as K,p as ee}from"./useAuth.QmeKFiEq.js";import"./theme.B2AGLJY6.js";import"./useQR.D2HH2LlQ.js";import"./index.PUUcqk1C.js";async function te(n){if(!n)return;const u=P(),o=S(u);try{const s=await navigator.credentials.create({publicKey:{challenge:u,rp:{name:"Gun-Vue"},user:{id:crypto.getRandomValues(new Uint8Array(16)),name:n,displayName:n},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],authenticatorSelection:{residentKey:"required",userVerification:"preferred"},attestation:"none",timeout:6e4}});return $(s,o)?T(s.rawId):!1}catch(s){return console.error("Error creating passkey:",s),!1}}async function ae(){const n=P(),u=S(n);try{const o=await navigator.credentials.get({publicKey:{challenge:n,userVerification:"preferred",timeout:6e4}});return $(o,u)?T(o.rawId):!1}catch(o){return console.error("Error during passkey login:",o),!1}}function P(){return crypto.getRandomValues(new Uint8Array(32))}function S(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function $(n,u){const o=JSON.parse(new TextDecoder().decode(n.response.clientDataJSON));return o.challenge!==u?(console.error("Wrong challenge received! Check your authentication provider security.",o.challenge,u),!1):!0}async function T(n){const u=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(u).slice(0,20);return btoa(String.fromCharCode(...o))}const le={key:1,class:"flex relative"},se=["disabled"],ne={key:0,class:"px-2"},oe={key:1,class:"px-2"},re=["disabled"],ie={key:0,class:"p-1 ml-1 font-bold"},ue={key:1,class:"p-1 ml-1 font-bold"},de={key:0,class:"flex flex-col gap-2"},ce={class:"shadow bg-light-100 dark-bg-dark-800 p-4 rounded-xl border hyphens-none font-mono text-center"},pe={class:"blur-lg hover-blur-0 transition duration-800 select-all"},ve={class:"bg-light-100 dark-bg-dark-800 select-none border-1 shadow rounded-lg p-4 flex items-center gap-4",for:"secure"},fe=["disabled"],ye={key:0,class:"text-red text-xs"},me={key:0,class:"flex flex-col gap-2"},ge={key:0,class:"flex flex-col gap-2"},xe={__name:"AuthForm",emits:["auth"],setup(n,{emit:u}){const o=u,s=v(),f=v(null),p=v(!1),m=v(!1),d=v(!1),c=v(""),x=v(!1),b=v(crypto.getRandomValues(new Uint8Array(20))),I=_(()=>W(b.value,X)),k=v(null),{focused:B}=Y(k);Z(()=>{k.value.focus()}),w(c,l=>{l.length==0&&(d.value=!1)}),w(p,l=>{l&&(b.value=crypto.getRandomValues(new Uint8Array(20)))}),w(s,async l=>{const e=await ee(l);e===""&&(f.value=""),e&&e.pub&&e.priv&&o("auth",e)}),j(()=>{"launchQueue"in window&&window.launchQueue.setConsumer(async l=>{var a;const e=(a=l.files)==null?void 0:a[0];if(e){const G=await e.getFile();s.value=await K(G),p.value=!0}})});async function F(){s.value=await D(btoa(String.fromCharCode(...b.value)))}async function E(){const l=d.value?await te(c.value):await ae();l&&(s.value=await D(l))}async function M(l){var e;s.value=await K((e=l.dataTransfer)==null?void 0:e.files[0]),p.value=!0}async function O(l){var e;s.value=await K((e=l.target)==null?void 0:e.files[0]),p.value=!0}async function R(l){s.value=await L.decrypt(l,f.value)}function q(){d.value=!0,Q(()=>{B.value=!0})}return(l,e)=>(i(),r("div",{class:A(["max-w-80 flex flex-col gap-4 flex-1 items-stretch bg-light-700 dark-bg-dark-50 p-4 shadow-lg border-4 border-dark-100 dark-border-light-100 border-op-0 dark-border-op-0",{"border-op-100 dark-border-op-100":m.value}]),id:"dropzone",onDrop:e[11]||(e[11]=C(a=>{M(a),m.value=!1},["prevent"])),onDragover:e[12]||(e[12]=C(a=>m.value=!0,["prevent"])),onDragleave:e[13]||(e[13]=C(a=>m.value=!1,["prevent"]))},[d.value?(i(),r("div",le,[g(t("input",{class:"p-4 rounded-2xl text-xl w-full dark-bg-dark-700 outline","onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),ref_key:"input",ref:k,autofocus:"",placeholder:"Your Name",autocomplete:"username"},null,512),[[h,c.value]]),c.value?(i(),r("button",{key:0,class:"absolute top-4 right-4 op-60 hover-op-100 transition",onClick:e[2]||(e[2]=a=>c.value="")},e[15]||(e[15]=[t("div",{class:"i-la-times text-2xl"},null,-1)]))):y("",!0)])):(i(),r("button",{key:0,class:"select-none flex-1 button items-center",onClick:e[0]||(e[0]=a=>q())},e[14]||(e[14]=[t("div",{class:"i-la-plus text-4xl"},null,-1),t("div",{class:"px-2"},"New account",-1)]))),t("button",{class:"select-none flex-1 button items-center",onClick:e[3]||(e[3]=a=>E()),disabled:d.value&&!c.value},[e[16]||(e[16]=t("div",{class:"i-la-fingerprint text-4xl"},null,-1)),d.value?(i(),r("div",oe,"New PassKey")):(i(),r("div",ne,"Use PassKey"))],8,se),t("button",{class:A(["select-none flex-1 button cursor-pointer flex items-center",{active:p.value}]),onClick:e[4]||(e[4]=a=>p.value=!p.value),disabled:d.value&&!c.value},[e[17]||(e[17]=t("div",{class:"i-la-key text-4xl"},null,-1)),d.value?(i(),r("div",ue,"Generate Key ")):(i(),r("div",ie,"Use Key "))],10,re),V(N,{name:"fade",mode:"out-in"},{default:U(()=>[p.value&&d.value?(i(),r("div",de,[t("div",ce,[t("div",pe,z(I.value),1)]),t("label",ve,[g(t("input",{class:"scale-150",id:"secure",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>x.value=a)},null,512),[[H,x.value]]),e[18]||(e[18]=t("div",{class:"text-sm op-80"},"I've securely stored my seed phrase.",-1))]),t("button",{class:"button",onClick:e[6]||(e[6]=a=>F()),disabled:!c.value||!x.value},e[19]||(e[19]=[t("div",{class:"i-la-check text-4xl"},null,-1),t("div",{class:"text-lg px-2"},"Authenticate",-1)]),8,fe),c.value?y("",!0):(i(),r("div",ye,"Name must not be left empty"))])):y("",!0)]),_:1}),V(N,{name:"fade",mode:"out-in"},{default:U(()=>[p.value&&!d.value?(i(),r("div",me,[t("input",{class:"bg-light-100 dark-bg-dark-800 border-1 p-4 shadow rounded-xl",id:"file",type:"file",accept:"image/*,.webkey,application/json,image/svg+xml",onInput:e[7]||(e[7]=a=>O(a))},null,32),g(t("textarea",{class:"p-2 text-sm flex-1 w-full dark-bg-dark-200",key:"text","onUpdate:modelValue":e[8]||(e[8]=a=>s.value=a),rows:"6",cols:"40",placeholder:"Your seed phrase or your keypair"},null,512),[[h,s.value]]),e[21]||(e[21]=t("div",{class:"text-sm opacity-50 p-2"},"Drag and drop your key file in this area",-1)),f.value!==null?(i(),r("form",ge,[g(t("input",{class:"p-4 rounded-xl text-xl text-center","onUpdate:modelValue":e[9]||(e[9]=a=>f.value=a),autofocus:"",type:"password",autocomplete:"current-password",placeholder:"Enter the password"},null,512),[[h,f.value]]),t("button",{class:"button",type:"submit",onClick:e[10]||(e[10]=a=>R(s.value))},e[20]||(e[20]=[t("div",{class:"i-la-check text-4xl"},null,-1),t("div",{class:"px-2"},"Authenticate",-1)]))])):y("",!0)])):y("",!0)]),_:1})],34))}},Ae=J(xe,[["__scopeId","data-v-222e0971"]]);export{Ae as default};
