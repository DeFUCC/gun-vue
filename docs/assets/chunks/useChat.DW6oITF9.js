import{h as D,a as j,j as u,L as w}from"./components.BVdgfkYk.js";import{s as L,h as o,ai as l,aU as U}from"./framework.HF1qYBJ2.js";function G(f="general"){const c=D(),{user:i}=j(),p=L(f),h=o(()=>{const t=l({general:{}});return c.user(u.pub).get("chat").map().on((e,a)=>{var r;const[s,n]=a.split("@");t[s]=t[s]||{},e?t[s][n]=e:(r=t==null?void 0:t[s])==null||delete r[n]}),t});function b(t){c.user(u.pub).get("chat").get(`${w(t)||t}@${i.pub}`).put(!0,void 0,{opt:{cert:u.features.chat}})}const m=o(()=>c.user(u.pub).get("chat/"+p.value)),g=o(()=>{const t=l({});return m.value.map().on((e,a)=>{const s=a.substring(0,13),n=a.substring(14),r={timestamp:s,author:n,text:e};t[a]=r}),t}),d=o(()=>Object.values(g.value||{})),v=U(d),$=o(()=>v.value.sort((t,e)=>t.timestamp>e.timestamp?1:-1));function C(t){if(!t)return;let e=Date.now();m.value.get(`${e}@${i.pub}`).put(t,void 0,{opt:{cert:u.features.chat}})}return{send:C,addChat:b,currentChat:p,chats:h,messages:g,sorted:$}}export{G as u};
