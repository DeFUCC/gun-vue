import{p as c,V as T,d as V,h as E,aR as F,aS as D,o as n,c as f,j as s,t as m,k as i,a0 as G,G as _,w as H,e as k,T as N,b as U,F as Q,C as q,q as I}from"./framework.BtfQKcS5.js";import"./theme.CLU2AM17.js";import{G as P,a6 as j,U as A,h as M,a as O}from"./components.PU-Z0Qqv.js";import{p as z}from"./index.BuUnCgYx.js";function J(y){const b=c(),x=c();return T(()=>import("./webtorrent.min.HcgxlztZ.js"),[]).then(t=>{const r=new t.default;r.on("upload",a=>{x.value=a}),r.seed(y,function(a){console.log("Client is seeding "+a.magnetURI),b.value=a})}),{torrent:b,progress:x}}const K={class:"flex flex-col gap-4 break-all"},W={key:0,class:"p-2 flex flex-wrap gap-2 bg-light-100 dark-bg-dark-400 rounded cursor-pointer items-center"},X={class:"text-md max-w-55ch"},Y={class:"flex-1 font-mono text-xs min-w-10"},Z={class:"p-0"},ee={class:"flex flex-wrap gap-2 p-4 items-start"},se={key:0,class:"flex flex-col gap-2"},te={class:"font-mono text-sm"},ae=["href"],le={class:"p-0"},oe={class:"p-0"},ne={class:"p-0"},pe=V({__name:"TorrentUpload",emits:["uploaded"],setup(y,{emit:b}){const x=b,t=c();c();const r=c(!1),a=c(!1),w=c(!1);function R(l){var u;const{torrent:e}=J((u=l==null?void 0:l.target)==null?void 0:u.files);M();const{user:p}=O();I(e,async v=>{t.value=v,r.value=!0;const o={infoHash:v.infoHash,length:v.length,name:v.name,author:p.pub};x("uploaded",o)})}const g=E(()=>{var e,p,u;if(!((e=t.value)!=null&&e.infoHash))return"";let l=new URL((p=window==null?void 0:window.location)==null?void 0:p.href);return`${l.protocol}//${l.hostname}${l.port?`:${l.port}`:""}/#/files/${(u=t.value)==null?void 0:u.infoHash}`}),h=F({source:g}),{share:B,isSupported:L}=D();return(l,e)=>{var p,u,v;return n(),f("div",K,[t.value?(n(),f("div",{key:1,class:"p-2 flex flex-wrap gap-2 bg-light-100 dark-bg-dark-400 rounded cursor-pointer items-center break-all",onClick:e[2]||(e[2]=o=>r.value=!r.value)},[e[9]||(e[9]=s("div",{class:"font-bold"},"Sharing a file:",-1)),s("div",X,m((p=t.value)==null?void 0:p.name),1),s("div",Y,m((u=t.value)==null?void 0:u.infoHash),1),s("div",Z,m(i(z)((v=t.value)==null?void 0:v.length)),1),s("div",{class:"i-la-times",onClick:e[1]||(e[1]=G(o=>t.value=null,["prevent","stop"]))})])):(n(),f("label",W,[e[8]||(e[8]=s("div",{class:"font-bold"},"Share a file",-1)),s("input",{class:"max-w-30",type:"file",accept:"*",onChange:e[0]||(e[0]=o=>R(o))},null,32)])),_(i(A),{open:r.value,onClose:e[7]||(e[7]=o=>r.value=!1)},{default:H(()=>{var o,C,S;return[s("div",ee,[t.value?(n(),f("div",se,[e[15]||(e[15]=s("div",{class:"text-xl"},"Sharing the torrent",-1)),s("div",te,m((o=t.value)==null?void 0:o.infoHash),1),s("a",{class:"gap-2 button underline font-bold break-all",href:g.value,target:"_blank"},e[10]||(e[10]=[s("div",{class:"i-la-link"},null,-1),s("div",{class:"p-0"},"Download URL",-1)]),8,ae),i(h).isSupported.value?(n(),f("button",{key:0,class:"p-2 button gap-2",onClick:e[3]||(e[3]=d=>i(h).copy())},[e[11]||(e[11]=s("div",{class:"i-la-copy"},null,-1)),s("div",le,m((C=i(h))!=null&&C.copied.value?"Copied!":"Copy"),1)])):k("",!0),i(L)?(n(),f("button",{key:1,class:"p-2 button gap-2",onClick:e[4]||(e[4]=d=>{var $;return i(B)({title:($=t.value)==null?void 0:$.name,url:g.value})})},e[12]||(e[12]=[s("div",{class:"i-la-share"},null,-1),s("div",{class:"p-0"}," Share",-1)]))):k("",!0),s("button",{class:"button p-2 gap-2",onClick:e[5]||(e[5]=d=>a.value=!a.value)},[e[13]||(e[13]=s("div",{class:"i-la-qrcode"},null,-1)),s("div",oe,m(a.value?"Hide":"Show")+" QR ",1)]),s("button",{class:"button p-2 gap-2",onClick:e[6]||(e[6]=d=>w.value=!w.value)},[e[14]||(e[14]=s("div",{class:"i-la-file"},null,-1)),s("div",ne,m(w.value?"Hide":"Show")+" file ",1)])])):k("",!0),_(N,{name:"fade"},{default:H(()=>[g.value&&a.value?(n(),U(i(P),{key:0,data:g.value},null,8,["data"])):k("",!0)]),_:1}),w.value?(n(!0),f(Q,{key:1},q((S=t.value)==null?void 0:S.files,d=>(n(),U(i(j),{class:"flex-auto",key:d==null?void 0:d.name,file:d},null,8,["file"]))),128)):k("",!0)])]}),_:1},8,["open"])])}}});export{pe as default};
