import{aj as K,y as ut,v as Ot,az as Mt,s as V,aS as Ut,h as $,aT as tt,aU as B,x as Vt,am as Ft,z as Yt,R as Wt,k as i,d as Xt,aq as Ht,aV as qt,D as Jt,o as k,c as N,P as Zt,e as Qt,I as yt,j as T,t as te,F as et,E as st,n as ee,b as nt,M as se,w as ne}from"./framework.2DHwbLKR.js";import{bc as re,bd as oe,be as ie,h as ae,a as At,j as Y,bf as le,bg as W,o as ce,bh as ue,p as j,bi as fe,bj as de,X as he,aB as pe,Y as me,aV as ge}from"./components.vhzIzXJf.js";import{g as ve}from"./useMates.gbZwSM0z.js";import"./theme.CJUnx4L9.js";function ye(t=V(null)){const{pressed:e}=re(),s=K({x:0,y:0,normX:0,normY:0,pressed:e,inside:!1});ut(()=>{document.addEventListener("mousemove",n);const{isOutside:r}=oe(t);Ot(r,o=>{s.inside=!o})}),Mt(()=>{document.removeEventListener("mousemove",n)});function n(r,o=t.value,a=!1){const l=o.closest("svg");if(!l)return;var p=l.createSVGPoint();p.x=r.clientX,p.y=r.clientY;let c=p.matrixTransform(l.getScreenCTM().inverse());if(a){let f=o.getBBox();s.x=c.x<f.width?c.x<0?0:c.x:f.width,s.y=c.y<f.height?c.y<0?0:c.y:f.height,s.normY=s.y/f.height,s.normX=s.x/f.width}else s.x=c.x,s.y=c.y}return{area:t,mouse:s}}function ot(){return ot=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},ot.apply(this,arguments)}function we(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function wt(t,e){return{x:t.x-e,y:t.y-e,w:t.w+2*e,h:t.h+2*e}}function bt(t,e){return t.x>e.x&&t.x<e.x+e.w&&t.y>e.y&&t.y<e.y+e.h}function xt(t,e,s,n){switch(n===void 0&&(n=50),s){case"top":return{x:t.x,y:Math.min((t.y+e.y)/2,t.y-n)};case"bottom":return{x:t.x,y:Math.max((t.y+e.y)/2,t.y+n)};case"left":return{x:Math.min((t.x+e.x)/2,t.x-n),y:t.y};case"right":return{x:Math.max((t.x+e.x)/2,t.x+n),y:t.y}}}function St(t){switch(t){case"left":return 0;case"top":return 90;case"right":return 180;case"bottom":return 270}}function be(t,e,s,n,r,o,a,l,p){for(var c=ot({padStart:0,padEnd:0,controlPointStretch:50,allowedStartSides:["top","right","bottom","left"],allowedEndSides:["top","right","bottom","left"]},p),f={x:t,y:e,w:s,h:n},m={x:t+s/2,y:e-2*c.padStart},I={x:t+s/2,y:e+n+2*c.padStart},S={x:t-2*c.padStart,y:e+n/2},P={x:t+s+2*c.padStart,y:e+n/2},b={x:r,y:o,w:a,h:l},A={x:r+a/2,y:o-2*c.padEnd},g={x:r+a/2,y:o+l+2*c.padEnd},_={x:r-2*c.padEnd,y:o+l/2},C={x:r+a+2*c.padEnd,y:o+l/2},M=["top","right","bottom","left"],z=c.allowedStartSides.length>0?c.allowedStartSides:M,y=c.allowedEndSides.length>0?c.allowedEndSides:M,u={top:m,right:P,bottom:I,left:S},d={top:A,right:C,bottom:g,left:_},h=1/0,v=m,w=A,E="top",R="top",dt=15,q=0;q<z.length;q++){var ht=z[q],J=u[ht];if(!bt(J,wt(b,dt)))for(var Z=0;Z<y.length;Z++){var pt=y[Z],Q=d[pt];if(!bt(Q,wt(f,dt))){var mt=we(J,Q);mt<h&&(h=mt,v=J,w=Q,E=ht,R=pt)}}}var gt=xt(v,w,E,c.controlPointStretch),vt=xt(w,v,R,c.controlPointStretch);return[v.x,v.y,gt.x,gt.y,vt.x,vt.y,w.x,w.y,St(R),St(E)]}function xe(t,e,s,n,r){return be(t,e,0,0,s,n,0,0,r)}function Se(t,e,s){if(typeof t=="function"||Ut(t))return $(()=>tt(B(t),B(e),B(s)));const n=V(t);return $({get(){return n.value=tt(n.value,B(e),B(s))},set(r){n.value=tt(r,B(e),B(s))}})}function _e({TIMEOUT:t=1e4,randomness:e=.1}={}){const s=V(),{area:n,mouse:r}=ye(s),{width:o,height:a}=ie(s),l=K([0,0]),p=Se(1,.5,2),c=ae(),{user:f}=At(),m=K({title:"space",joined:!1,db:$(()=>c.user(Y.pub).get("space")),cert:$(()=>{var u;return(u=Y.features)==null?void 0:u.space}),my:{mouse:$(()=>({x:r.x,y:r.y})),pos:null}});async function I(){m.joined=!0}function S({x:u=r.x,y:d=r.y}={}){var h;f.pub&&(m.joined||I(),l[0]=u,l[1]=d,m.db.get(f.pub).get("pos").put(JSON.stringify({x:u,y:d}),null,{opt:{cert:(h=Y.features)==null?void 0:h.space}}))}const P=le("Shift"),b=$(()=>P.value?100:10);W("ArrowUp",()=>{S({x:l[0],y:l[1]-b.value})}),W("ArrowDown",()=>{S({x:l[0],y:l[1]+b.value})}),W("ArrowLeft",()=>{S({x:l[0]-b.value,y:l[1]})}),W("ArrowRight",()=>{S({x:l[0]+b.value,y:l[1]})});function A(u=""){var d;f.pub&&(m.joined||I(),m.db.get(f.pub).get("status").put(u,null,{opt:{cert:(d=Y.features)==null?void 0:d.space}}))}const g=K({}),_=K({}),C=K({}),M=$(()=>{var d;const u={};for(let h in g)Date.now()-((d=g[h])==null?void 0:d.pulse)<t&&(u[h]=g[h]);return u}),z=$(()=>Object.keys(M.value).length);m.db.map().once(async(u,d)=>{d==f.pub&&(m.joined=!0);const h={pub:d,draw:"",status:"",blink:!1,pulse:0,hasPos:!1,pos:{x:0,y:0}};g[d]=h,m.db.get(d).get("pos").on(v=>{g[d].hasPos=!0,g[d].pos=typeof v=="string"?JSON.parse(v):v}),m.db.get(d).get("draw").on(v=>{g[d].draw=v}),m.db.get(d).get("status").on(v=>{g[d].status=v}),c.user(d).get("pulse").on(v=>{g[d].pulse=Number(v),g[d].blink=!g[d].blink}).back().get("mates").map().on((v,w)=>{_[d]=_[d]||{},_[d][w]=v})});const y={};return Vt(()=>{for(let u in _){y[u]=y[u]||{};for(let d in _[u]){let h=y[u][d]=y[u][d]||Math.random()*e;if(_[u][d]){const v=_[u][d];let w=g[u],E=g[d],R=Date.now()*2-(w==null?void 0:w.pulse)-(E==null?void 0:E.pulse);w&&E&&(w!=null&&w.hasPos)&&(E!=null&&E.hasPos)&&R<t&&(C[u+d]={user:u,mate:d,emoji:ve(v),from:w.pos,to:E.pos,arrow:Ee(w.pos,E.pos,h)})}else delete C[u+d]}}}),{space:m,allGuests:g,guests:M,guestCount:z,links:C,plane:s,width:o,height:a,pos:l,zoom:p,area:n,join:I,place:S,setStatus:A}}function Ee(t,e,s=0){let n=xe(t.x,t.y,e.x,e.y,{padEnd:20,padStart:10});const[r,o,a,l,p,c,f,m,I,S]=n;return{sx:r,sy:o,c1x:a*(1-s+2*s),c1y:l*(1-s+2*s),c2x:p*(1-s+2*s),c2y:c*(1-s+2*s),ex:f,ey:m,ae:I,as:S}}function Pe(){try{return"constructor"in GestureEvent}catch{return!1}}function Nt(){return typeof window<"u"&&"ontouchstart"in window}function $t(t){return"pointerId"in t?null:t.type==="touchend"?t.changedTouches:t.targetTouches}function Lt(t){return Array.from($t(t)).map(e=>e.identifier)}function _t(t){const e="buttons"in t?t.buttons:0,{shiftKey:s,altKey:n,metaKey:r,ctrlKey:o}=t;return{buttons:e,shiftKey:s,altKey:n,metaKey:r,ctrlKey:o}}const De=t=>t;function Et(t,e=De){const s=$t(t),{clientX:n,clientY:r}=s?s[0]:t;return e([n,r])}function Bt(){}function jt(...t){return t.length===0?Bt:t.length===1?t[0]:function(){var e;for(let s of t)e=s.apply(this,arguments)||e;return e}}function L(t,e){if(t===void 0){if(e===void 0)throw new Error("Must define fallback value if undefined is expected");t=e}return Array.isArray(t)?t:[t,t]}function Pt(t,...e){return typeof t=="function"?t(...e):t}function U(t){return{_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:Bt,canceled:!1,memo:void 0,args:void 0,...t}}function it(){const t={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},e=U({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),s=U({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),n=U({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),r=U({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),o=U({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:t,drag:e,pinch:s,wheel:n,move:r,scroll:o}}var Te=Object.defineProperty,Ie=(t,e,s)=>e in t?Te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,D=(t,e,s)=>(Ie(t,typeof e!="symbol"?e+"":e,s),s);class Ce{constructor(e){this.classes=e,D(this,"nativeRefs"),D(this,"config"),D(this,"handlers"),D(this,"state"),D(this,"timeouts"),D(this,"domListeners"),D(this,"windowListeners"),D(this,"pointerIds",new Set),D(this,"touchIds",new Set),D(this,"supportsTouchEvents",Nt()),D(this,"supportsGestureEvents",Pe()),D(this,"bind",(...s)=>{const n={};for(let r of this.classes)new r(this,s).addBindings(n);for(let r in this.nativeRefs)O(n,r,o=>this.nativeRefs[r]({...this.state.shared,event:o,args:s}));return this.config.domTarget?$e(this,n):Le(this,n)}),D(this,"clean",()=>{const{eventOptions:s,domTarget:n}=this.config,r=i(n);r&&F(r,Gt(this.domListeners),s),Object.values(this.timeouts).forEach(clearTimeout),Me(this)}),D(this,"reset",()=>{this.state=it()}),this.classes=e,this.state=it(),this.timeouts={},this.domListeners=[],this.windowListeners={}}}function ke(t,e){"pointerId"in e?t.pointerIds.add(e.pointerId):t.touchIds=new Set(Lt(e))}function Oe(t,e){"pointerId"in e?t.pointerIds.delete(e.pointerId):Lt(e).forEach(s=>t.touchIds.delete(s))}function Me(t){const{config:{window:e,eventOptions:s},windowListeners:n}=t,r=i(e);if(r){for(let o in n){const a=n[o];F(r,a,s)}t.windowListeners={}}}function Ae({config:t,windowListeners:e},s,n=t.eventOptions){const r=i(t.window);r&&(F(r,e[s],n),delete e[s])}function Ne({config:t,windowListeners:e},s,n=[],r=t.eventOptions){const o=i(t.window);o&&(F(o,e[s],r),zt(o,e[s]=n,r))}function $e({config:t,domListeners:e},s){const{eventOptions:n,domTarget:r}=t,o=i(r);if(!o)throw new Error("domTarget must be defined");F(o,Gt(e),n);for(let[a,l]of Object.entries(s)){const p=a.slice(2).toLowerCase();e.push([p,jt(...l)])}zt(o,e,n)}function Le({config:t},e){const s={},n=t.eventOptions.capture?"Capture":"";for(let[r,o]of Object.entries(e)){const a=Array.isArray(o)?o:[o],l=r+n;s[l]=jt(...a)}return s}function Gt(t=[]){return t.splice(0,t.length)}function O(t,e,s){t[e]||(t[e]=[]),t[e].push(s)}function zt(t,e=[],s={}){if(t)for(let[n,r]of e)t.addEventListener(n,r,s)}function F(t,e=[],s={}){if(t)for(let[n,r]of e)t.removeEventListener(n,r,s)}function at(t,e){return t.map((s,n)=>s+e[n])}function Kt(t,e){return t.map((s,n)=>s-e[n])}function lt(t){return Math.hypot(...t)}function Be(t,e,s){const n=lt(e),r=n===0?0:1/n,o=s===0?0:1/s,a=o*n,l=e.map(f=>o*f),p=e.map(f=>r*f),c=lt(t);return{velocities:l,velocity:a,distance:c,direction:p}}function ct(t){return Math.sign?Math.sign(t):+(t>0)-+(t<0)||+t}function je(t,e,s){return Math.max(e,Math.min(t,s))}function Ge(t,e){return Math.pow(t,e*5)}function Dt(t,e,s){return e===0||Math.abs(e)===1/0?Ge(t,s):t*e*s/(e+s*t)}function Tt(t,e,s,n=.15){return n===0?je(t,e,s):t<e?-Dt(e-t,s-e,n)+e:t>s?+Dt(t-s,s-e,n)+s:t}var ze=Object.defineProperty,Ke=(t,e,s)=>e in t?ze(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,X=(t,e,s)=>(Ke(t,typeof e!="symbol"?e+"":e,s),s);const G=new Map,Re=t=>t;class Ue{constructor(e,s=[]){this.controller=e,this.args=s,X(this,"debounced",!0),X(this,"setTimeout",(n,r=140,...o)=>{clearTimeout(this.controller.timeouts[this.stateKey]),this.controller.timeouts[this.stateKey]=window.setTimeout(n,r,...o)}),X(this,"clearTimeout",()=>{clearTimeout(this.controller.timeouts[this.stateKey])}),X(this,"fireGestureHandler",(n=!1)=>{if(this.state._blocked)return this.debounced||(this.state._active=!1,this.clean()),null;if(!n&&!this.state.intentional&&!this.config.triggerAllEvents)return null;if(this.state.intentional){const p=this.state.active,c=this.state._active;this.state.active=c,this.state.first=c&&!p,this.state.last=p&&!c,this.controller.state.shared[this.ingKey]=c}const r=this.controller.pointerIds.size||this.controller.touchIds.size,o=this.controller.state.shared.buttons>0||r>0,a={...this.controller.state.shared,...this.state,...this.mapStateValues(this.state),locked:!!document.pointerLockElement,touches:r,down:o},l=this.handler(a);return this.state.memo=l!==void 0?l:this.state.memo,a}),this.controller=e,this.args=s}get config(){return this.controller.config[this.stateKey]}get enabled(){return this.controller.config.enabled&&this.config.enabled}get state(){return this.controller.state[this.stateKey]}get handler(){return this.controller.handlers[this.stateKey]}get transform(){return this.config.transform||this.controller.config.transform||Re}updateSharedState(e){Object.assign(this.controller.state.shared,e)}updateGestureState(e){Object.assign(this.state,e)}checkIntentionality(e,s){return{_intentional:e,_blocked:!1}}getMovement(e){const{rubberband:s,threshold:n}=this.config,{_bounds:r,_initial:o,_active:a,_intentional:l,lastOffset:p,movement:c}=this.state,f=this.getInternalMovement(e,this.state),m=this.transform(n).map(Math.abs),I=l[0]===!1?It(f[0],m[0]):l[0],S=l[1]===!1?It(f[1],m[1]):l[1],P=this.checkIntentionality([I,S],f);if(P._blocked)return{...P,_movement:f,delta:[0,0]};const b=P._intentional,A=f;let g=[b[0]!==!1?f[0]-b[0]:0,b[1]!==!1?f[1]-b[1]:0];const _=at(g,p),C=a?s:[0,0];return g=Ct(r,at(g,o),C),{...P,intentional:b[0]!==!1||b[1]!==!1,_initial:o,_movement:A,movement:g,values:e,offset:Ct(r,_,C),delta:Kt(g,c)}}clean(){this.clearTimeout()}}function It(t,e){return Math.abs(t)>=e?ct(t)*e:!1}function Ct(t,[e,s],[n,r]){const[[o,a],[l,p]]=t;return[Tt(e,o,a,n),Tt(s,l,p,r)]}function rt({state:t},e,s){const{timeStamp:n,type:r}=e,o=t.values,a=s?0:n-t.startTime;return{_lastEventType:r,event:e,timeStamp:n,elapsedTime:a,previous:o}}function Ve({state:t,config:e,stateKey:s,args:n},r,o){const a=t.offset,l=o.timeStamp,{initial:p,bounds:c}=e,f={...it()[s],_active:!0,args:n,values:r,initial:r,offset:a,lastOffset:a,startTime:l};return{...f,_initial:Pt(p,f),_bounds:Pt(c,f)}}class Fe extends Ue{getInternalMovement(e,s){return Kt(e,s.initial)}checkIntentionality(e,s){if(e[0]===!1&&e[1]===!1)return{_intentional:e,axis:this.state.axis};const[n,r]=s.map(Math.abs),o=this.state.axis||(n>r?"x":n<r?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:e,_blocked:!1,axis:o}:o?this.config.axis&&o!==this.config.axis?{_intentional:e,_blocked:!0,axis:o}:(e[o==="x"?1:0]=!1,{_intentional:e,_blocked:!1,axis:o}):{_intentional:[!1,!1],_blocked:!1,axis:o}}getKinematics(e,s){const n=this.getMovement(e);if(!n._blocked){const r=s.timeStamp-this.state.timeStamp;Object.assign(n,Be(n.movement,n.delta,r))}return n}mapStateValues(e){return{xy:e.values,vxvy:e.velocities}}}var Ye=Object.defineProperty,We=(t,e,s)=>e in t?Ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,x=(t,e,s)=>(We(t,typeof e!="symbol"?e+"":e,s),s);const Xe=3;function kt(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}class He extends Fe{constructor(){super(...arguments),x(this,"ingKey","dragging"),x(this,"stateKey","drag"),x(this,"setPointerCapture",e=>{if(this.config.useTouch||document.pointerLockElement)return;const{target:s,pointerId:n}=e;s&&"setPointerCapture"in s&&s.setPointerCapture(n),this.updateGestureState({_dragTarget:s,_dragPointerId:n})}),x(this,"releasePointerCapture",()=>{if(this.config.useTouch||document.pointerLockElement)return;const{_dragTarget:e,_dragPointerId:s}=this.state;if(s&&e&&"releasePointerCapture"in e&&(!("hasPointerCapture"in e)||e.hasPointerCapture(s)))try{e.releasePointerCapture(s)}catch{}}),x(this,"preventScroll",e=>{this.state._dragPreventScroll&&e.cancelable&&e.preventDefault()}),x(this,"getEventId",e=>this.config.useTouch?e.changedTouches[0].identifier:e.pointerId),x(this,"isValidEvent",e=>this.state._pointerId===this.getEventId(e)),x(this,"shouldPreventWindowScrollY",this.config.preventWindowScrollY&&this.controller.supportsTouchEvents),x(this,"setUpWindowScrollDetection",e=>{kt(e),Ne(this.controller,this.stateKey,[["touchmove",this.preventScroll],["touchend",this.clean.bind(this)],["touchcancel",this.clean.bind(this)]],{passive:!1}),this.setTimeout(this.startDrag.bind(this),250,e)}),x(this,"setUpDelayedDragTrigger",e=>{this.state._dragDelayed=!0,kt(e),this.setTimeout(this.startDrag.bind(this),this.config.delay,e)}),x(this,"setStartState",e=>{const s=Et(e,this.transform);this.updateSharedState(_t(e)),this.updateGestureState({...Ve(this,s,e),...rt(this,e,!0),_pointerId:this.getEventId(e)}),this.updateGestureState(this.getMovement(s))}),x(this,"onDragStart",e=>{ke(this.controller,e),!(!this.enabled||this.state._active)&&(this.setStartState(e),this.setPointerCapture(e),this.shouldPreventWindowScrollY?this.setUpWindowScrollDetection(e):this.config.delay>0?this.setUpDelayedDragTrigger(e):this.startDrag(e,!0))}),x(this,"onDragChange",e=>{if(this.state.canceled||!this.state._active||!this.isValidEvent(e)||this.state._lastEventType===e.type&&e.timeStamp===this.state.timeStamp)return;let s;if(document.pointerLockElement){const{movementX:p,movementY:c}=e;s=at(this.transform([p,c]),this.state.values)}else s=Et(e,this.transform);const n=this.getKinematics(s,e);if(!this.state._dragStarted){if(this.state._dragDelayed){this.startDrag(e);return}if(this.shouldPreventWindowScrollY)if(!this.state._dragPreventScroll&&n.axis)if(n.axis==="x")this.startDrag(e);else{this.state._active=!1;return}else return;else return}const r=_t(e);this.updateSharedState(r);const o=rt(this,e),a=lt(n._movement);let{_dragIsTap:l}=this.state;l&&a>=Xe&&(l=!1),this.updateGestureState({...o,...n,_dragIsTap:l}),this.fireGestureHandler()}),x(this,"onDragEnd",e=>{if(Oe(this.controller,e),!this.isValidEvent(e)||(this.clean(),!this.state._active))return;this.state._active=!1;const s=this.state._dragIsTap,[n,r]=this.state.velocities,[o,a]=this.state.movement,[l,p]=this.state._intentional,[c,f]=this.config.swipeVelocity,[m,I]=this.config.swipeDistance,S=this.config.swipeDuration,P={...rt(this,e),...this.getMovement(this.state.values)},b=[0,0];P.elapsedTime<S&&(l!==!1&&Math.abs(n)>c&&Math.abs(o)>m&&(b[0]=ct(n)),p!==!1&&Math.abs(r)>f&&Math.abs(a)>I&&(b[1]=ct(r))),this.updateSharedState({buttons:0}),this.updateGestureState({...P,tap:s,swipe:b}),this.fireGestureHandler(this.config.filterTaps&&s===!0)}),x(this,"clean",()=>{super.clean(),this.state._dragStarted=!1,this.releasePointerCapture(),Ae(this.controller,this.stateKey)}),x(this,"onCancel",()=>{this.state.canceled||(this.updateGestureState({canceled:!0,_active:!1}),this.updateSharedState({buttons:0}),Wt(this.fireGestureHandler))}),x(this,"onClick",e=>{this.state._dragIsTap||e.stopPropagation()})}startDrag(e,s=!1){!this.state._active||this.state._dragStarted||(s||this.setStartState(e),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())}addBindings(e){if(this.config.useTouch?(O(e,"onTouchStart",this.onDragStart),O(e,"onTouchMove",this.onDragChange),O(e,"onTouchEnd",this.onDragEnd),O(e,"onTouchCancel",this.onDragEnd)):(O(e,"onPointerDown",this.onDragStart),O(e,"onPointerMove",this.onDragChange),O(e,"onPointerUp",this.onDragEnd),O(e,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){const s=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";O(e,s,this.onClick)}}}function qe(t,e){let s,n=[],r,o=!1;function a(...l){return o&&s===this&&e(l,n)||(r=t.apply(this,l),o=!0,s=this,n=l),r}return a}function H(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;let s,n,r;if(Array.isArray(t)){if(s=t.length,s!==e.length)return!1;for(n=s;n--!==0;)if(!H(t[n],e[n]))return!1;return!0}let o;if(typeof Map=="function"&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(o=t.entries();!(n=o.next()).done;)if(!e.has(n.value[0]))return!1;for(o=t.entries();!(n=o.next()).done;)if(!H(n.value[1],e.get(n.value[0])))return!1;return!0}if(typeof Set=="function"&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(o=t.entries();!(n=o.next()).done;)if(!e.has(n.value[0]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(r=Object.keys(t),s=r.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,r[n]))return!1;if(typeof Element<"u"&&t instanceof Element)return!1;for(n=s;n--!==0;)if(!(r[n]==="_owner"&&t.$$typeof)&&!H(t[r[n]],e[r[n]]))return!1;return!0}return t!==t&&e!==e}function Je(t,e){try{return H(t,e)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}}function ft(t={},e){const s={};for(const[n,r]of Object.entries(e))switch(typeof r){case"function":s[n]=r.call(s,t[n],n,t);break;case"object":s[n]=ft(t[n],r);break;case"boolean":r&&(s[n]=t[n]);break}return s}const Ze=180,Qe=.15,ts=.5,es=50,ss=250,ns={threshold(t=0){return L(t)},rubberband(t=0){switch(t){case!0:return L(Qe);case!1:return L(0);default:return L(t)}},enabled(t=!0){return t},triggerAllEvents(t=!1){return t},initial(t=0){return typeof t=="function"?t:L(t)},transform:!0},Rt={...ns,axis:!0,lockDirection(t=!1){return t},bounds(t={}){if(typeof t=="function")return o=>Rt.bounds(t(o));const{left:e=-1/0,right:s=1/0,top:n=-1/0,bottom:r=1/0}=t;return[[e,s],[n,r]]}},rs=typeof window<"u"&&window.document&&window.document.createElement,os={enabled(t=!0){return t},domTarget:!0,window(t=rs?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform:!0},is={...Rt,useTouch(t=!0){return t&&Nt()},preventWindowScrollY(t=!1){return t},threshold(t,e,{filterTaps:s=!1,lockDirection:n=!1,axis:r=void 0}){const o=L(t,s?3:n||r?1:0);return this.filterTaps=s,o},swipeVelocity(t=ts){return L(t)},swipeDistance(t=es){return L(t)},swipeDuration(t=ss){return t},delay(t=0){switch(t){case!0:return Ze;case!1:return 0;default:return t}}};function as(t){return ft(t,os)}function ls(t={}){return ft(t,is)}function cs({domTarget:t,eventOptions:e,window:s,enabled:n,...r}){const o=as({domTarget:t,eventOptions:e,window:s,enabled:n});return o.drag=ls(r),o}function us(t,e,s={}){const n=fs(t),r=new Ce(n);return r.config=e,r.handlers=t,r.nativeRefs=s,Ft()&&!e.manual&&(ut(r.bind),Yt(r.clean)),r}function fs(t){const e=new Set;return t.drag&&e.add(G.get("drag")),t.wheel&&e.add(G.get("wheel")),t.scroll&&e.add(G.get("scroll")),t.move&&e.add(G.get("move")),t.pinch&&e.add(G.get("pinch")),t.hover&&e.add(G.get("hover")),e}function ds(t,e={}){G.set("drag",He);const s=V();return s.value||(s.value=qe(cs,Je)),us({drag:t},s.value(e))}const hs={class:"flex flex-col items-center"},ps=["viewBox"],ms=T("defs",null,[T("filter",{id:"shadowButton",x:"-50%",height:"200%",width:"300%"},[T("feDropShadow",{dx:"0",dy:"3",stdDeviation:"3","flood-color":"#2225"})]),T("clipPath",{id:"mask",clipPathUnits:"objectBoundingBox"},[T("circle",{r:".5",cx:".5",cy:".5"})])],-1),gs=["transform"],vs=["innerHTML"],ys=["x","y","viewBox"],ws=["x","y","width","height"],bs={class:"link"},xs=["x1","x2","y1","y2","stroke"],Ss=["transform"],_s={class:"mouse"},Es=["fill"],Ps={class:"arrows"},Ds={class:"guests"},Os=Xt({__name:"SpacePlane",props:{pad:{type:Number,default:50},coord:{type:String,default:""}},emits:["user","enter","leave","chat","post","update:coord"],setup(t,{emit:e}){const s=e,{user:n}=At();ce("deep");const{space:r,plane:o,pos:a,zoom:l,links:p,width:c,height:f,guests:m,guestCount:I,area:S,join:P,place:b,setStatus:A}=_e({TIMEOUT:1e4});Ot(I,(y,u)=>{y>u?s("enter"):s("leave")});const g=ge(y=>{b({x:y[0],y:y[1]}),s("update:coord",`${y[0]},${y[1]}`)},200);ds(y=>{if(!(y.delta[0]&&y.delta[1])||M.ing)return;const[u,d]=y.delta;a[0]-=u,a[1]-=d,g(a)},{domTarget:o});const _=V(),{drauu:C,draw:M,loadCanvas:z}=ue();return ut(()=>{C.mount(_.value,_.value.parentElement),z()}),Ht(()=>{console.log("activated")}),qt(()=>{console.log("deactivated")}),Mt(()=>{C.unmount()}),(y,u)=>{const d=Jt("space-draw");return k(),N("div",hs,[!i(r).joined&&i(n).is?(k(),N("div",{key:0,class:"text-2xl p-8 top-15vh cursor-pointer absolute rounded-3xl shadow-xl border-4",style:Zt({borderColor:i(n).color}),onClick:u[0]||(u[0]=h=>{i(P)()})},"Click anywhere to join the space",4)):Qt("",!0),yt(d,{class:"z-500"}),(k(),N("svg",{class:"h-full w-full z-200 bg-dark-100 bg-opacity-5 touch-none cursor-grab active-cursor-grabbing",ref_key:"plane",ref:o,xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full","font-family":"Commissioner , sans-serif","text-anchor":"middle","dominant-baseline":"middle",viewBox:`${-t.pad+i(a)[0]-Number(i(c))/2} ${-t.pad+i(a)[1]-Number(i(f))/2} ${Number(i(c))*Number(i(l))+2*t.pad} ${Number(i(f))*Number(i(l))+2*t.pad}`,onClick:u[3]||(u[3]=h=>{i(n).is||(i(n).auth=!0)})},[ms,T("text",{class:"text-xs","text-anchor":"end",fill:"currentColor",transform:`translate(${i(a)[0]+Number(i(c))/2-10} ${i(a)[1]-Number(i(f))/2+20})`},te(i(a)),9,gs),(k(!0),N(et,null,st(i(m),h=>(k(),N("g",{class:"opacity-90",key:h.draw,innerHTML:h.draw},null,8,vs))),128)),(k(),N("svg",{class:ee(["opacity-70",{"pointer-events-none":!i(M).enabled,"touch-none":i(M).enabled}]),ref_key:"paper",ref:_,x:i(a)[0]-Number(i(c))/2-t.pad,y:i(a)[1]-Number(i(f))/2-t.pad,viewBox:`${-t.pad+i(a)[0]-Number(i(c))/2} ${-t.pad+i(a)[1]-Number(i(f))/2} ${Number(i(c))+2*t.pad} ${Number(i(f))+2*t.pad}`},null,10,ys)),T("rect",{ref_key:"area",ref:S,x:i(a)[0]-Number(i(c))/2,y:i(a)[1]-Number(i(f))/2,rx:"12",width:Number(i(c)),height:Number(i(f)),fill:"none",stroke:"#3333","stroke-width":"1"},null,8,ws),T("g",bs,[T("line",{x1:i(a)[0],x2:i(r).my.mouse.x,y1:i(a)[1],y2:i(r).my.mouse.y,stroke:i(n).color,"stroke-dasharray":"6"},null,8,xs)]),T("g",{class:"pointer",transform:`translate(${i(a)[0]} ${i(a)[1]})`},[T("g",_s,[T("circle",{style:{filter:"url(#shadowButton)"},fill:i(n).color,r:"8"},null,8,Es)])],8,Ss),T("g",Ps,[(k(!0),N(et,null,st(i(p),(h,v)=>(k(),nt(i(fe),{key:v,link:h,onUser:u[1]||(u[1]=w=>i(j).pub=w)},null,8,["link"]))),128))]),T("g",Ds,[(k(!0),N(et,null,st(i(m),h=>{var v,w;return k(),nt(i(de),se({class:"cursor-pointer transition-all ease-out duration-600",key:h==null?void 0:h.pub,ref_for:!0},h,{style:{transform:`translate(${(v=h==null?void 0:h.pos)==null?void 0:v.x}px, ${(w=h==null?void 0:h.pos)==null?void 0:w.y}px)`},onUpdateStatus:u[2]||(u[2]=E=>i(A)(E))}),null,16,["style"])}),128))])],8,ps)),yt(i(me),{class:"z-4000",open:!!i(j).pub,onClose:u[8]||(u[8]=h=>i(j).pub=null)},{default:ne(()=>[(k(),nt(i(he),{class:"max-w-600px",key:i(j).pub,pub:i(j).pub,onUser:u[4]||(u[4]=h=>y.$emit("user",h)),onPost:u[5]||(u[5]=h=>y.$emit("post",String(i(pe)(h)))),onChat:u[6]||(u[6]=h=>y.$emit("chat",i(j).pub)),onClose:u[7]||(u[7]=h=>i(j).pub=null)},null,8,["pub"]))]),_:1},8,["open"])])}}});export{Os as default};
