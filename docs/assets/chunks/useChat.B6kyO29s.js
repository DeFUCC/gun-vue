import{h as C,a as D,j as a,V as w,W as x}from"./components.DFZHOas0.js";import{s as y,h as o,aj as l}from"./framework.2DHwbLKR.js";function O(f="general"){const c=C(),{user:p}=D(),i=y(f),h=o(()=>{const t=l({general:{}});return c.user(a.pub).get("chat").map().on((e,u)=>{var r;const[s,n]=u.split("@");t[s]=t[s]||{},e?t[s][n]=e:(r=t==null?void 0:t[s])==null||delete r[n]}),t});function b(t){c.user(a.pub).get("chat").get(`${x(t)||t}@${p.pub}`).put(!0,void 0,{opt:{cert:a.features.chat}})}const m=o(()=>c.user(a.pub).get("chat/"+i.value)),g=o(()=>{const t=l({});return m.value.map().on((e,u)=>{const s=u.substring(0,13),n=u.substring(14),r={timestamp:s,author:n,text:e};t[u]=r}),t}),d=o(()=>Object.values(g.value||{})),v=w(d),$=o(()=>v.value.sort((t,e)=>t.timestamp>e.timestamp?1:-1));function j(t){if(!t)return;let e=Date.now();m.value.get(`${e}@${p.pub}`).put(t,void 0,{opt:{cert:a.features.chat}})}return{send:j,addChat:b,currentChat:i,chats:h,messages:g,sorted:$}}export{O as u};
