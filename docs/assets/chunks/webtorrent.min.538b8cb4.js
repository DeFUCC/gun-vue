var Ce,te,cr={9742:(N,R)=>{R.byteLength=function(g){var b=r(g),h=b[0],w=b[1];return 3*(h+w)/4-w},R.toByteArray=function(g){var b,h,w=r(g),s=w[0],a=w[1],u=new f(function(C,H,U){return 3*(H+U)/4-U}(0,s,a)),x=0,S=a>0?s-4:s;for(h=0;h<S;h+=4)b=k[g.charCodeAt(h)]<<18|k[g.charCodeAt(h+1)]<<12|k[g.charCodeAt(h+2)]<<6|k[g.charCodeAt(h+3)],u[x++]=b>>16&255,u[x++]=b>>8&255,u[x++]=255&b;return a===2&&(b=k[g.charCodeAt(h)]<<2|k[g.charCodeAt(h+1)]>>4,u[x++]=255&b),a===1&&(b=k[g.charCodeAt(h)]<<10|k[g.charCodeAt(h+1)]<<4|k[g.charCodeAt(h+2)]>>2,u[x++]=b>>8&255,u[x++]=255&b),u},R.fromByteArray=function(g){for(var b,h=g.length,w=h%3,s=[],a=16383,u=0,x=h-w;u<x;u+=a)s.push(d(g,u,u+a>x?x:u+a));return w===1?(b=g[h-1],s.push(y[b>>2]+y[b<<4&63]+"==")):w===2&&(b=(g[h-2]<<8)+g[h-1],s.push(y[b>>10]+y[b>>4&63]+y[b<<2&63]+"=")),s.join("")};for(var y=[],k=[],f=typeof Uint8Array<"u"?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,i=m.length;c<i;++c)y[c]=m[c],k[m.charCodeAt(c)]=c;function r(g){var b=g.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=g.indexOf("=");return h===-1&&(h=b),[h,h===b?0:4-h%4]}function d(g,b,h){for(var w,s,a=[],u=b;u<h;u+=3)w=(g[u]<<16&16711680)+(g[u+1]<<8&65280)+(255&g[u+2]),a.push(y[(s=w)>>18&63]+y[s>>12&63]+y[s>>6&63]+y[63&s]);return a.join("")}k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63},2090:N=>{function R(y,k){if(typeof y[0]=="string")return y.join("");if(typeof y[0]=="number")return new Uint8Array(y);const f=new Uint8Array(k);let m=0;for(let c=0,i=y.length;c<i;c++){const r=y[c];f.set(r,m),m+=r.byteLength||r.length}return f}N.exports=async function*(y,k=512,f={}){typeof k=="object"&&(k=(f=k).size);let{nopad:m,zeroPadding:c=!0}=f;m&&(c=!1);let i=[],r=0;for await(const d of y)if(r+=d.byteLength||d.length||1,i.push(d),r>=k){const g=R(i,r);let b=0;for(;r>=k;)yield g.slice(b,b+k),r-=k,b+=k;i=[g.slice(b,g.length)]}r&&(yield R(i,c?k:r))}},8764:(N,R,y)=>{const k=y(9742),f=y(645),m=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;R.Buffer=r,R.SlowBuffer=function(n){return+n!=n&&(n=0),r.alloc(+n)},R.INSPECT_MAX_BYTES=50;const c=2147483647;function i(n){if(n>c)throw new RangeError('The value "'+n+'" is invalid for option "size"');const l=new Uint8Array(n);return Object.setPrototypeOf(l,r.prototype),l}function r(n,l,p){if(typeof n=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(n)}return d(n,l,p)}function d(n,l,p){if(typeof n=="string")return function(z,X){if(typeof X=="string"&&X!==""||(X="utf8"),!r.isEncoding(X))throw new TypeError("Unknown encoding: "+X);const pt=0|a(z,X);let wt=i(pt);const kt=wt.write(z,X);return kt!==pt&&(wt=wt.slice(0,kt)),wt}(n,l);if(ArrayBuffer.isView(n))return function(z){if(At(z,Uint8Array)){const X=new Uint8Array(z);return w(X.buffer,X.byteOffset,X.byteLength)}return h(z)}(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(At(n,ArrayBuffer)||n&&At(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(At(n,SharedArrayBuffer)||n&&At(n.buffer,SharedArrayBuffer)))return w(n,l,p);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const L=n.valueOf&&n.valueOf();if(L!=null&&L!==n)return r.from(L,l,p);const F=function(z){if(r.isBuffer(z)){const X=0|s(z.length),pt=i(X);return pt.length===0||z.copy(pt,0,0,X),pt}if(z.length!==void 0)return typeof z.length!="number"||Et(z.length)?i(0):h(z);if(z.type==="Buffer"&&Array.isArray(z.data))return h(z.data)}(n);if(F)return F;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return r.from(n[Symbol.toPrimitive]("string"),l,p);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}function g(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function b(n){return g(n),i(n<0?0:0|s(n))}function h(n){const l=n.length<0?0:0|s(n.length),p=i(l);for(let L=0;L<l;L+=1)p[L]=255&n[L];return p}function w(n,l,p){if(l<0||n.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<l+(p||0))throw new RangeError('"length" is outside of buffer bounds');let L;return L=l===void 0&&p===void 0?new Uint8Array(n):p===void 0?new Uint8Array(n,l):new Uint8Array(n,l,p),Object.setPrototypeOf(L,r.prototype),L}function s(n){if(n>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return 0|n}function a(n,l){if(r.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||At(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);const p=n.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&p===0)return 0;let F=!1;for(;;)switch(l){case"ascii":case"latin1":case"binary":return p;case"utf8":case"utf-8":return vt(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*p;case"hex":return p>>>1;case"base64":return Ct(n).length;default:if(F)return L?-1:vt(n).length;l=(""+l).toLowerCase(),F=!0}}function u(n,l,p){let L=!1;if((l===void 0||l<0)&&(l=0),l>this.length||((p===void 0||p>this.length)&&(p=this.length),p<=0)||(p>>>=0)<=(l>>>=0))return"";for(n||(n="utf8");;)switch(n){case"hex":return gt(this,l,p);case"utf8":case"utf-8":return tt(this,l,p);case"ascii":return lt(this,l,p);case"latin1":case"binary":return ct(this,l,p);case"base64":return G(this,l,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return mt(this,l,p);default:if(L)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),L=!0}}function x(n,l,p){const L=n[l];n[l]=n[p],n[p]=L}function S(n,l,p,L,F){if(n.length===0)return-1;if(typeof p=="string"?(L=p,p=0):p>2147483647?p=2147483647:p<-2147483648&&(p=-2147483648),Et(p=+p)&&(p=F?0:n.length-1),p<0&&(p=n.length+p),p>=n.length){if(F)return-1;p=n.length-1}else if(p<0){if(!F)return-1;p=0}if(typeof l=="string"&&(l=r.from(l,L)),r.isBuffer(l))return l.length===0?-1:C(n,l,p,L,F);if(typeof l=="number")return l&=255,typeof Uint8Array.prototype.indexOf=="function"?F?Uint8Array.prototype.indexOf.call(n,l,p):Uint8Array.prototype.lastIndexOf.call(n,l,p):C(n,[l],p,L,F);throw new TypeError("val must be string, number or Buffer")}function C(n,l,p,L,F){let z,X=1,pt=n.length,wt=l.length;if(L!==void 0&&((L=String(L).toLowerCase())==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(n.length<2||l.length<2)return-1;X=2,pt/=2,wt/=2,p/=2}function kt(yt,Rt){return X===1?yt[Rt]:yt.readUInt16BE(Rt*X)}if(F){let yt=-1;for(z=p;z<pt;z++)if(kt(n,z)===kt(l,yt===-1?0:z-yt)){if(yt===-1&&(yt=z),z-yt+1===wt)return yt*X}else yt!==-1&&(z-=z-yt),yt=-1}else for(p+wt>pt&&(p=pt-wt),z=p;z>=0;z--){let yt=!0;for(let Rt=0;Rt<wt;Rt++)if(kt(n,z+Rt)!==kt(l,Rt)){yt=!1;break}if(yt)return z}return-1}function H(n,l,p,L){p=Number(p)||0;const F=n.length-p;L?(L=Number(L))>F&&(L=F):L=F;const z=l.length;let X;for(L>z/2&&(L=z/2),X=0;X<L;++X){const pt=parseInt(l.substr(2*X,2),16);if(Et(pt))return X;n[p+X]=pt}return X}function U(n,l,p,L){return dt(vt(l,n.length-p),n,p,L)}function D(n,l,p,L){return dt(function(F){const z=[];for(let X=0;X<F.length;++X)z.push(255&F.charCodeAt(X));return z}(l),n,p,L)}function W(n,l,p,L){return dt(Ct(l),n,p,L)}function $(n,l,p,L){return dt(function(F,z){let X,pt,wt;const kt=[];for(let yt=0;yt<F.length&&!((z-=2)<0);++yt)X=F.charCodeAt(yt),pt=X>>8,wt=X%256,kt.push(wt),kt.push(pt);return kt}(l,n.length-p),n,p,L)}function G(n,l,p){return l===0&&p===n.length?k.fromByteArray(n):k.fromByteArray(n.slice(l,p))}function tt(n,l,p){p=Math.min(n.length,p);const L=[];let F=l;for(;F<p;){const z=n[F];let X=null,pt=z>239?4:z>223?3:z>191?2:1;if(F+pt<=p){let wt,kt,yt,Rt;switch(pt){case 1:z<128&&(X=z);break;case 2:wt=n[F+1],(192&wt)==128&&(Rt=(31&z)<<6|63&wt,Rt>127&&(X=Rt));break;case 3:wt=n[F+1],kt=n[F+2],(192&wt)==128&&(192&kt)==128&&(Rt=(15&z)<<12|(63&wt)<<6|63&kt,Rt>2047&&(Rt<55296||Rt>57343)&&(X=Rt));break;case 4:wt=n[F+1],kt=n[F+2],yt=n[F+3],(192&wt)==128&&(192&kt)==128&&(192&yt)==128&&(Rt=(15&z)<<18|(63&wt)<<12|(63&kt)<<6|63&yt,Rt>65535&&Rt<1114112&&(X=Rt))}}X===null?(X=65533,pt=1):X>65535&&(X-=65536,L.push(X>>>10&1023|55296),X=56320|1023&X),L.push(X),F+=pt}return function(z){const X=z.length;if(X<=nt)return String.fromCharCode.apply(String,z);let pt="",wt=0;for(;wt<X;)pt+=String.fromCharCode.apply(String,z.slice(wt,wt+=nt));return pt}(L)}R.kMaxLength=c,r.TYPED_ARRAY_SUPPORT=function(){try{const n=new Uint8Array(1),l={foo:function(){return 42}};return Object.setPrototypeOf(l,Uint8Array.prototype),Object.setPrototypeOf(n,l),n.foo()===42}catch{return!1}}(),r.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.buffer}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.byteOffset}}),r.poolSize=8192,r.from=function(n,l,p){return d(n,l,p)},Object.setPrototypeOf(r.prototype,Uint8Array.prototype),Object.setPrototypeOf(r,Uint8Array),r.alloc=function(n,l,p){return function(L,F,z){return g(L),L<=0?i(L):F!==void 0?typeof z=="string"?i(L).fill(F,z):i(L).fill(F):i(L)}(n,l,p)},r.allocUnsafe=function(n){return b(n)},r.allocUnsafeSlow=function(n){return b(n)},r.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==r.prototype},r.compare=function(n,l){if(At(n,Uint8Array)&&(n=r.from(n,n.offset,n.byteLength)),At(l,Uint8Array)&&(l=r.from(l,l.offset,l.byteLength)),!r.isBuffer(n)||!r.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===l)return 0;let p=n.length,L=l.length;for(let F=0,z=Math.min(p,L);F<z;++F)if(n[F]!==l[F]){p=n[F],L=l[F];break}return p<L?-1:L<p?1:0},r.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(n,l){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return r.alloc(0);let p;if(l===void 0)for(l=0,p=0;p<n.length;++p)l+=n[p].length;const L=r.allocUnsafe(l);let F=0;for(p=0;p<n.length;++p){let z=n[p];if(At(z,Uint8Array))F+z.length>L.length?(r.isBuffer(z)||(z=r.from(z)),z.copy(L,F)):Uint8Array.prototype.set.call(L,z,F);else{if(!r.isBuffer(z))throw new TypeError('"list" argument must be an Array of Buffers');z.copy(L,F)}F+=z.length}return L},r.byteLength=a,r.prototype._isBuffer=!0,r.prototype.swap16=function(){const n=this.length;if(n%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let l=0;l<n;l+=2)x(this,l,l+1);return this},r.prototype.swap32=function(){const n=this.length;if(n%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let l=0;l<n;l+=4)x(this,l,l+3),x(this,l+1,l+2);return this},r.prototype.swap64=function(){const n=this.length;if(n%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let l=0;l<n;l+=8)x(this,l,l+7),x(this,l+1,l+6),x(this,l+2,l+5),x(this,l+3,l+4);return this},r.prototype.toString=function(){const n=this.length;return n===0?"":arguments.length===0?tt(this,0,n):u.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(n){if(!r.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n||r.compare(this,n)===0},r.prototype.inspect=function(){let n="";const l=R.INSPECT_MAX_BYTES;return n=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(n+=" ... "),"<Buffer "+n+">"},m&&(r.prototype[m]=r.prototype.inspect),r.prototype.compare=function(n,l,p,L,F){if(At(n,Uint8Array)&&(n=r.from(n,n.offset,n.byteLength)),!r.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(l===void 0&&(l=0),p===void 0&&(p=n?n.length:0),L===void 0&&(L=0),F===void 0&&(F=this.length),l<0||p>n.length||L<0||F>this.length)throw new RangeError("out of range index");if(L>=F&&l>=p)return 0;if(L>=F)return-1;if(l>=p)return 1;if(this===n)return 0;let z=(F>>>=0)-(L>>>=0),X=(p>>>=0)-(l>>>=0);const pt=Math.min(z,X),wt=this.slice(L,F),kt=n.slice(l,p);for(let yt=0;yt<pt;++yt)if(wt[yt]!==kt[yt]){z=wt[yt],X=kt[yt];break}return z<X?-1:X<z?1:0},r.prototype.includes=function(n,l,p){return this.indexOf(n,l,p)!==-1},r.prototype.indexOf=function(n,l,p){return S(this,n,l,p,!0)},r.prototype.lastIndexOf=function(n,l,p){return S(this,n,l,p,!1)},r.prototype.write=function(n,l,p,L){if(l===void 0)L="utf8",p=this.length,l=0;else if(p===void 0&&typeof l=="string")L=l,p=this.length,l=0;else{if(!isFinite(l))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");l>>>=0,isFinite(p)?(p>>>=0,L===void 0&&(L="utf8")):(L=p,p=void 0)}const F=this.length-l;if((p===void 0||p>F)&&(p=F),n.length>0&&(p<0||l<0)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");L||(L="utf8");let z=!1;for(;;)switch(L){case"hex":return H(this,n,l,p);case"utf8":case"utf-8":return U(this,n,l,p);case"ascii":case"latin1":case"binary":return D(this,n,l,p);case"base64":return W(this,n,l,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,n,l,p);default:if(z)throw new TypeError("Unknown encoding: "+L);L=(""+L).toLowerCase(),z=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const nt=4096;function lt(n,l,p){let L="";p=Math.min(n.length,p);for(let F=l;F<p;++F)L+=String.fromCharCode(127&n[F]);return L}function ct(n,l,p){let L="";p=Math.min(n.length,p);for(let F=l;F<p;++F)L+=String.fromCharCode(n[F]);return L}function gt(n,l,p){const L=n.length;(!l||l<0)&&(l=0),(!p||p<0||p>L)&&(p=L);let F="";for(let z=l;z<p;++z)F+=Mt[n[z]];return F}function mt(n,l,p){const L=n.slice(l,p);let F="";for(let z=0;z<L.length-1;z+=2)F+=String.fromCharCode(L[z]+256*L[z+1]);return F}function V(n,l,p){if(n%1!=0||n<0)throw new RangeError("offset is not uint");if(n+l>p)throw new RangeError("Trying to access beyond buffer length")}function v(n,l,p,L,F,z){if(!r.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>F||l<z)throw new RangeError('"value" argument is out of bounds');if(p+L>n.length)throw new RangeError("Index out of range")}function A(n,l,p,L,F){B(l,L,F,n,p,7);let z=Number(l&BigInt(4294967295));n[p++]=z,z>>=8,n[p++]=z,z>>=8,n[p++]=z,z>>=8,n[p++]=z;let X=Number(l>>BigInt(32)&BigInt(4294967295));return n[p++]=X,X>>=8,n[p++]=X,X>>=8,n[p++]=X,X>>=8,n[p++]=X,p}function q(n,l,p,L,F){B(l,L,F,n,p,7);let z=Number(l&BigInt(4294967295));n[p+7]=z,z>>=8,n[p+6]=z,z>>=8,n[p+5]=z,z>>=8,n[p+4]=z;let X=Number(l>>BigInt(32)&BigInt(4294967295));return n[p+3]=X,X>>=8,n[p+2]=X,X>>=8,n[p+1]=X,X>>=8,n[p]=X,p+8}function Y(n,l,p,L,F,z){if(p+L>n.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("Index out of range")}function Q(n,l,p,L,F){return l=+l,p>>>=0,F||Y(n,0,p,4),f.write(n,l,p,L,23,4),p+4}function st(n,l,p,L,F){return l=+l,p>>>=0,F||Y(n,0,p,8),f.write(n,l,p,L,52,8),p+8}r.prototype.slice=function(n,l){const p=this.length;(n=~~n)<0?(n+=p)<0&&(n=0):n>p&&(n=p),(l=l===void 0?p:~~l)<0?(l+=p)<0&&(l=0):l>p&&(l=p),l<n&&(l=n);const L=this.subarray(n,l);return Object.setPrototypeOf(L,r.prototype),L},r.prototype.readUintLE=r.prototype.readUIntLE=function(n,l,p){n>>>=0,l>>>=0,p||V(n,l,this.length);let L=this[n],F=1,z=0;for(;++z<l&&(F*=256);)L+=this[n+z]*F;return L},r.prototype.readUintBE=r.prototype.readUIntBE=function(n,l,p){n>>>=0,l>>>=0,p||V(n,l,this.length);let L=this[n+--l],F=1;for(;l>0&&(F*=256);)L+=this[n+--l]*F;return L},r.prototype.readUint8=r.prototype.readUInt8=function(n,l){return n>>>=0,l||V(n,1,this.length),this[n]},r.prototype.readUint16LE=r.prototype.readUInt16LE=function(n,l){return n>>>=0,l||V(n,2,this.length),this[n]|this[n+1]<<8},r.prototype.readUint16BE=r.prototype.readUInt16BE=function(n,l){return n>>>=0,l||V(n,2,this.length),this[n]<<8|this[n+1]},r.prototype.readUint32LE=r.prototype.readUInt32LE=function(n,l){return n>>>=0,l||V(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+16777216*this[n+3]},r.prototype.readUint32BE=r.prototype.readUInt32BE=function(n,l){return n>>>=0,l||V(n,4,this.length),16777216*this[n]+(this[n+1]<<16|this[n+2]<<8|this[n+3])},r.prototype.readBigUInt64LE=Bt(function(n){T(n>>>=0,"offset");const l=this[n],p=this[n+7];l!==void 0&&p!==void 0||J(n,this.length-8);const L=l+256*this[++n]+65536*this[++n]+this[++n]*2**24,F=this[++n]+256*this[++n]+65536*this[++n]+p*2**24;return BigInt(L)+(BigInt(F)<<BigInt(32))}),r.prototype.readBigUInt64BE=Bt(function(n){T(n>>>=0,"offset");const l=this[n],p=this[n+7];l!==void 0&&p!==void 0||J(n,this.length-8);const L=l*2**24+65536*this[++n]+256*this[++n]+this[++n],F=this[++n]*2**24+65536*this[++n]+256*this[++n]+p;return(BigInt(L)<<BigInt(32))+BigInt(F)}),r.prototype.readIntLE=function(n,l,p){n>>>=0,l>>>=0,p||V(n,l,this.length);let L=this[n],F=1,z=0;for(;++z<l&&(F*=256);)L+=this[n+z]*F;return F*=128,L>=F&&(L-=Math.pow(2,8*l)),L},r.prototype.readIntBE=function(n,l,p){n>>>=0,l>>>=0,p||V(n,l,this.length);let L=l,F=1,z=this[n+--L];for(;L>0&&(F*=256);)z+=this[n+--L]*F;return F*=128,z>=F&&(z-=Math.pow(2,8*l)),z},r.prototype.readInt8=function(n,l){return n>>>=0,l||V(n,1,this.length),128&this[n]?-1*(255-this[n]+1):this[n]},r.prototype.readInt16LE=function(n,l){n>>>=0,l||V(n,2,this.length);const p=this[n]|this[n+1]<<8;return 32768&p?4294901760|p:p},r.prototype.readInt16BE=function(n,l){n>>>=0,l||V(n,2,this.length);const p=this[n+1]|this[n]<<8;return 32768&p?4294901760|p:p},r.prototype.readInt32LE=function(n,l){return n>>>=0,l||V(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},r.prototype.readInt32BE=function(n,l){return n>>>=0,l||V(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},r.prototype.readBigInt64LE=Bt(function(n){T(n>>>=0,"offset");const l=this[n],p=this[n+7];l!==void 0&&p!==void 0||J(n,this.length-8);const L=this[n+4]+256*this[n+5]+65536*this[n+6]+(p<<24);return(BigInt(L)<<BigInt(32))+BigInt(l+256*this[++n]+65536*this[++n]+this[++n]*16777216)}),r.prototype.readBigInt64BE=Bt(function(n){T(n>>>=0,"offset");const l=this[n],p=this[n+7];l!==void 0&&p!==void 0||J(n,this.length-8);const L=(l<<24)+65536*this[++n]+256*this[++n]+this[++n];return(BigInt(L)<<BigInt(32))+BigInt(this[++n]*16777216+65536*this[++n]+256*this[++n]+p)}),r.prototype.readFloatLE=function(n,l){return n>>>=0,l||V(n,4,this.length),f.read(this,n,!0,23,4)},r.prototype.readFloatBE=function(n,l){return n>>>=0,l||V(n,4,this.length),f.read(this,n,!1,23,4)},r.prototype.readDoubleLE=function(n,l){return n>>>=0,l||V(n,8,this.length),f.read(this,n,!0,52,8)},r.prototype.readDoubleBE=function(n,l){return n>>>=0,l||V(n,8,this.length),f.read(this,n,!1,52,8)},r.prototype.writeUintLE=r.prototype.writeUIntLE=function(n,l,p,L){n=+n,l>>>=0,p>>>=0,!L&&v(this,n,l,p,Math.pow(2,8*p)-1,0);let F=1,z=0;for(this[l]=255&n;++z<p&&(F*=256);)this[l+z]=n/F&255;return l+p},r.prototype.writeUintBE=r.prototype.writeUIntBE=function(n,l,p,L){n=+n,l>>>=0,p>>>=0,!L&&v(this,n,l,p,Math.pow(2,8*p)-1,0);let F=p-1,z=1;for(this[l+F]=255&n;--F>=0&&(z*=256);)this[l+F]=n/z&255;return l+p},r.prototype.writeUint8=r.prototype.writeUInt8=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,1,255,0),this[l]=255&n,l+1},r.prototype.writeUint16LE=r.prototype.writeUInt16LE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,2,65535,0),this[l]=255&n,this[l+1]=n>>>8,l+2},r.prototype.writeUint16BE=r.prototype.writeUInt16BE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,2,65535,0),this[l]=n>>>8,this[l+1]=255&n,l+2},r.prototype.writeUint32LE=r.prototype.writeUInt32LE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,4,4294967295,0),this[l+3]=n>>>24,this[l+2]=n>>>16,this[l+1]=n>>>8,this[l]=255&n,l+4},r.prototype.writeUint32BE=r.prototype.writeUInt32BE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,4,4294967295,0),this[l]=n>>>24,this[l+1]=n>>>16,this[l+2]=n>>>8,this[l+3]=255&n,l+4},r.prototype.writeBigUInt64LE=Bt(function(n,l=0){return A(this,n,l,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeBigUInt64BE=Bt(function(n,l=0){return q(this,n,l,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeIntLE=function(n,l,p,L){if(n=+n,l>>>=0,!L){const pt=Math.pow(2,8*p-1);v(this,n,l,p,pt-1,-pt)}let F=0,z=1,X=0;for(this[l]=255&n;++F<p&&(z*=256);)n<0&&X===0&&this[l+F-1]!==0&&(X=1),this[l+F]=(n/z>>0)-X&255;return l+p},r.prototype.writeIntBE=function(n,l,p,L){if(n=+n,l>>>=0,!L){const pt=Math.pow(2,8*p-1);v(this,n,l,p,pt-1,-pt)}let F=p-1,z=1,X=0;for(this[l+F]=255&n;--F>=0&&(z*=256);)n<0&&X===0&&this[l+F+1]!==0&&(X=1),this[l+F]=(n/z>>0)-X&255;return l+p},r.prototype.writeInt8=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,1,127,-128),n<0&&(n=255+n+1),this[l]=255&n,l+1},r.prototype.writeInt16LE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,2,32767,-32768),this[l]=255&n,this[l+1]=n>>>8,l+2},r.prototype.writeInt16BE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,2,32767,-32768),this[l]=n>>>8,this[l+1]=255&n,l+2},r.prototype.writeInt32LE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,4,2147483647,-2147483648),this[l]=255&n,this[l+1]=n>>>8,this[l+2]=n>>>16,this[l+3]=n>>>24,l+4},r.prototype.writeInt32BE=function(n,l,p){return n=+n,l>>>=0,p||v(this,n,l,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[l]=n>>>24,this[l+1]=n>>>16,this[l+2]=n>>>8,this[l+3]=255&n,l+4},r.prototype.writeBigInt64LE=Bt(function(n,l=0){return A(this,n,l,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),r.prototype.writeBigInt64BE=Bt(function(n,l=0){return q(this,n,l,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),r.prototype.writeFloatLE=function(n,l,p){return Q(this,n,l,!0,p)},r.prototype.writeFloatBE=function(n,l,p){return Q(this,n,l,!1,p)},r.prototype.writeDoubleLE=function(n,l,p){return st(this,n,l,!0,p)},r.prototype.writeDoubleBE=function(n,l,p){return st(this,n,l,!1,p)},r.prototype.copy=function(n,l,p,L){if(!r.isBuffer(n))throw new TypeError("argument should be a Buffer");if(p||(p=0),L||L===0||(L=this.length),l>=n.length&&(l=n.length),l||(l=0),L>0&&L<p&&(L=p),L===p||n.length===0||this.length===0)return 0;if(l<0)throw new RangeError("targetStart out of bounds");if(p<0||p>=this.length)throw new RangeError("Index out of range");if(L<0)throw new RangeError("sourceEnd out of bounds");L>this.length&&(L=this.length),n.length-l<L-p&&(L=n.length-l+p);const F=L-p;return this===n&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(l,p,L):Uint8Array.prototype.set.call(n,this.subarray(p,L),l),F},r.prototype.fill=function(n,l,p,L){if(typeof n=="string"){if(typeof l=="string"?(L=l,l=0,p=this.length):typeof p=="string"&&(L=p,p=this.length),L!==void 0&&typeof L!="string")throw new TypeError("encoding must be a string");if(typeof L=="string"&&!r.isEncoding(L))throw new TypeError("Unknown encoding: "+L);if(n.length===1){const z=n.charCodeAt(0);(L==="utf8"&&z<128||L==="latin1")&&(n=z)}}else typeof n=="number"?n&=255:typeof n=="boolean"&&(n=Number(n));if(l<0||this.length<l||this.length<p)throw new RangeError("Out of range index");if(p<=l)return this;let F;if(l>>>=0,p=p===void 0?this.length:p>>>0,n||(n=0),typeof n=="number")for(F=l;F<p;++F)this[F]=n;else{const z=r.isBuffer(n)?n:r.from(n,L),X=z.length;if(X===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(F=0;F<p-l;++F)this[F+l]=z[F%X]}return this};const ut={};function _t(n,l,p){ut[n]=class extends p{constructor(){super(),Object.defineProperty(this,"message",{value:l.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${n}]`,this.stack,delete this.name}get code(){return n}set code(L){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:L,writable:!0})}toString(){return`${this.name} [${n}]: ${this.message}`}}}function Tt(n){let l="",p=n.length;const L=n[0]==="-"?1:0;for(;p>=L+4;p-=3)l=`_${n.slice(p-3,p)}${l}`;return`${n.slice(0,p)}${l}`}function B(n,l,p,L,F,z){if(n>p||n<l){const X=typeof l=="bigint"?"n":"";let pt;throw pt=z>3?l===0||l===BigInt(0)?`>= 0${X} and < 2${X} ** ${8*(z+1)}${X}`:`>= -(2${X} ** ${8*(z+1)-1}${X}) and < 2 ** ${8*(z+1)-1}${X}`:`>= ${l}${X} and <= ${p}${X}`,new ut.ERR_OUT_OF_RANGE("value",pt,n)}(function(X,pt,wt){T(pt,"offset"),X[pt]!==void 0&&X[pt+wt]!==void 0||J(pt,X.length-(wt+1))})(L,F,z)}function T(n,l){if(typeof n!="number")throw new ut.ERR_INVALID_ARG_TYPE(l,"number",n)}function J(n,l,p){throw Math.floor(n)!==n?(T(n,p),new ut.ERR_OUT_OF_RANGE(p||"offset","an integer",n)):l<0?new ut.ERR_BUFFER_OUT_OF_BOUNDS:new ut.ERR_OUT_OF_RANGE(p||"offset",`>= ${p?1:0} and <= ${l}`,n)}_t("ERR_BUFFER_OUT_OF_BOUNDS",function(n){return n?`${n} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),_t("ERR_INVALID_ARG_TYPE",function(n,l){return`The "${n}" argument must be of type number. Received type ${typeof l}`},TypeError),_t("ERR_OUT_OF_RANGE",function(n,l,p){let L=`The value of "${n}" is out of range.`,F=p;return Number.isInteger(p)&&Math.abs(p)>4294967296?F=Tt(String(p)):typeof p=="bigint"&&(F=String(p),(p>BigInt(2)**BigInt(32)||p<-(BigInt(2)**BigInt(32)))&&(F=Tt(F)),F+="n"),L+=` It must be ${l}. Received ${F}`,L},RangeError);const ht=/[^+/0-9A-Za-z-_]/g;function vt(n,l){let p;l=l||1/0;const L=n.length;let F=null;const z=[];for(let X=0;X<L;++X){if(p=n.charCodeAt(X),p>55295&&p<57344){if(!F){if(p>56319){(l-=3)>-1&&z.push(239,191,189);continue}if(X+1===L){(l-=3)>-1&&z.push(239,191,189);continue}F=p;continue}if(p<56320){(l-=3)>-1&&z.push(239,191,189),F=p;continue}p=65536+(F-55296<<10|p-56320)}else F&&(l-=3)>-1&&z.push(239,191,189);if(F=null,p<128){if((l-=1)<0)break;z.push(p)}else if(p<2048){if((l-=2)<0)break;z.push(p>>6|192,63&p|128)}else if(p<65536){if((l-=3)<0)break;z.push(p>>12|224,p>>6&63|128,63&p|128)}else{if(!(p<1114112))throw new Error("Invalid code point");if((l-=4)<0)break;z.push(p>>18|240,p>>12&63|128,p>>6&63|128,63&p|128)}}return z}function Ct(n){return k.toByteArray(function(l){if((l=(l=l.split("=")[0]).trim().replace(ht,"")).length<2)return"";for(;l.length%4!=0;)l+="=";return l}(n))}function dt(n,l,p,L){let F;for(F=0;F<L&&!(F+p>=l.length||F>=n.length);++F)l[F+p]=n[F];return F}function At(n,l){return n instanceof l||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===l.name}function Et(n){return n!=n}const Mt=function(){const n="0123456789abcdef",l=new Array(256);for(let p=0;p<16;++p){const L=16*p;for(let F=0;F<16;++F)l[L+F]=n[p]+n[F]}return l}();function Bt(n){return typeof BigInt>"u"?zt:n}function zt(){throw new Error("BigInt not supported")}},9421:(N,R,y)=>{const k=y(7117),f=y(4375);N.exports=class{constructor(m,c){if(this.store=m,this.chunkLength=m.chunkLength,this.inProgressGets=new Map,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.cache=new k(c)}put(m,c,i=()=>{}){if(!this.cache)return f(()=>i(new Error("CacheStore closed")));this.cache.remove(m),this.store.put(m,c,i)}get(m,c,i=()=>{}){if(typeof c=="function")return this.get(m,null,c);if(!this.cache)return f(()=>i(new Error("CacheStore closed")));c||(c={});let r=this.cache.get(m);if(r){const b=c.offset||0,h=c.length||r.length-b;return b===0&&h===r.length||(r=r.slice(b,h+b)),f(()=>i(null,r))}let d=this.inProgressGets.get(m);const g=!!d;d||(d=[],this.inProgressGets.set(m,d)),d.push({opts:c,cb:i}),g||this.store.get(m,(b,h)=>{b||this.cache==null||this.cache.set(m,h);const w=this.inProgressGets.get(m);this.inProgressGets.delete(m);for(const{opts:s,cb:a}of w)if(b)a(b);else{const u=s.offset||0,x=s.length||h.length-u;let S=h;u===0&&x===h.length||(S=h.slice(u,x+u)),a(null,S)}})}close(m=()=>{}){if(!this.cache)return f(()=>m(new Error("CacheStore closed")));this.cache=null,this.store.close(m)}destroy(m=()=>{}){if(!this.cache)return f(()=>m(new Error("CacheStore closed")));this.cache=null,this.store.destroy(m)}}},6313:(N,R,y)=>{var k=y(8764).Buffer,f=function(){function m(h,w){return w!=null&&h instanceof w}var c,i,r;try{c=Map}catch{c=function(){}}try{i=Set}catch{i=function(){}}try{r=Promise}catch{r=function(){}}function d(h,w,s,a,u){typeof w=="object"&&(s=w.depth,a=w.prototype,u=w.includeNonEnumerable,w=w.circular);var x=[],S=[],C=k!==void 0;return w===void 0&&(w=!0),s===void 0&&(s=1/0),function H(U,D){if(U===null)return null;if(D===0)return U;var W,$;if(typeof U!="object")return U;if(m(U,c))W=new c;else if(m(U,i))W=new i;else if(m(U,r))W=new r(function(v,A){U.then(function(q){v(H(q,D-1))},function(q){A(H(q,D-1))})});else if(d.__isArray(U))W=[];else if(d.__isRegExp(U))W=new RegExp(U.source,b(U)),U.lastIndex&&(W.lastIndex=U.lastIndex);else if(d.__isDate(U))W=new Date(U.getTime());else{if(C&&k.isBuffer(U))return W=k.allocUnsafe?k.allocUnsafe(U.length):new k(U.length),U.copy(W),W;m(U,Error)?W=Object.create(U):a===void 0?($=Object.getPrototypeOf(U),W=Object.create($)):(W=Object.create(a),$=a)}if(w){var G=x.indexOf(U);if(G!=-1)return S[G];x.push(U),S.push(W)}for(var tt in m(U,c)&&U.forEach(function(v,A){var q=H(A,D-1),Y=H(v,D-1);W.set(q,Y)}),m(U,i)&&U.forEach(function(v){var A=H(v,D-1);W.add(A)}),U){var nt;$&&(nt=Object.getOwnPropertyDescriptor($,tt)),nt&&nt.set==null||(W[tt]=H(U[tt],D-1))}if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(U);for(tt=0;tt<lt.length;tt++){var ct=lt[tt];(!(mt=Object.getOwnPropertyDescriptor(U,ct))||mt.enumerable||u)&&(W[ct]=H(U[ct],D-1),mt.enumerable||Object.defineProperty(W,ct,{enumerable:!1}))}}if(u){var gt=Object.getOwnPropertyNames(U);for(tt=0;tt<gt.length;tt++){var mt,V=gt[tt];(mt=Object.getOwnPropertyDescriptor(U,V))&&mt.enumerable||(W[V]=H(U[V],D-1),Object.defineProperty(W,V,{enumerable:!1}))}}return W}(h,s)}function g(h){return Object.prototype.toString.call(h)}function b(h){var w="";return h.global&&(w+="g"),h.ignoreCase&&(w+="i"),h.multiline&&(w+="m"),w}return d.clonePrototype=function(h){if(h===null)return null;var w=function(){};return w.prototype=h,new w},d.__objToStr=g,d.__isDate=function(h){return typeof h=="object"&&g(h)==="[object Date]"},d.__isArray=function(h){return typeof h=="object"&&g(h)==="[object Array]"},d.__isRegExp=function(h){return typeof h=="object"&&g(h)==="[object RegExp]"},d.__getRegExpFlags=b,d}();N.exports&&(N.exports=f)},9648:N=>{N.exports=function(){for(var R=navigator.hardwareConcurrency||1,y=[],k=0;k<R;k++)y.push({model:"",speed:0,times:{user:0,nice:0,sys:0,idle:0,irq:0}});return y}},1227:(N,R,y)=>{var k=y(8768);R.formatArgs=function(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+N.exports.humanize(this.diff),!this.useColors)return;const c="color: "+this.color;m.splice(1,0,c,"color: inherit");let i=0,r=0;m[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(i++,d==="%c"&&(r=i))}),m.splice(r,0,c)},R.save=function(m){try{m?R.storage.setItem("debug",m):R.storage.removeItem("debug")}catch{}},R.load=function(){let m;try{m=R.storage.getItem("debug")}catch{}return!m&&k!==void 0&&"env"in k&&(m=k.env.DEBUG),m},R.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},R.storage=function(){try{return localStorage}catch{}}(),R.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),R.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],R.log=console.debug||console.log||(()=>{}),N.exports=y(2447)(R);const{formatters:f}=N.exports;f.j=function(m){try{return JSON.stringify(m)}catch(c){return"[UnexpectedJSONParseError]: "+c.message}}},2447:(N,R,y)=>{N.exports=function(k){function f(i){let r,d,g,b=null;function h(...w){if(!h.enabled)return;const s=h,a=Number(new Date),u=a-(r||a);s.diff=u,s.prev=r,s.curr=a,r=a,w[0]=f.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let x=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(S,C)=>{if(S==="%%")return"%";x++;const H=f.formatters[C];if(typeof H=="function"){const U=w[x];S=H.call(s,U),w.splice(x,1),x--}return S}),f.formatArgs.call(s,w),(s.log||f.log).apply(s,w)}return h.namespace=i,h.useColors=f.useColors(),h.color=f.selectColor(i),h.extend=m,h.destroy=f.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(d!==f.namespaces&&(d=f.namespaces,g=f.enabled(i)),g),set:w=>{b=w}}),typeof f.init=="function"&&f.init(h),h}function m(i,r){const d=f(this.namespace+(r===void 0?":":r)+i);return d.log=this.log,d}function c(i){return i.toString().substring(2,i.toString().length-2).replace(/\.\*\?$/,"*")}return f.debug=f,f.default=f,f.coerce=function(i){return i instanceof Error?i.stack||i.message:i},f.disable=function(){const i=[...f.names.map(c),...f.skips.map(c).map(r=>"-"+r)].join(",");return f.enable(""),i},f.enable=function(i){let r;f.save(i),f.namespaces=i,f.names=[],f.skips=[];const d=(typeof i=="string"?i:"").split(/[\s,]+/),g=d.length;for(r=0;r<g;r++)d[r]&&((i=d[r].replace(/\*/g,".*?"))[0]==="-"?f.skips.push(new RegExp("^"+i.slice(1)+"$")):f.names.push(new RegExp("^"+i+"$")))},f.enabled=function(i){if(i[i.length-1]==="*")return!0;let r,d;for(r=0,d=f.skips.length;r<d;r++)if(f.skips[r].test(i))return!1;for(r=0,d=f.names.length;r<d;r++)if(f.names[r].test(i))return!0;return!1},f.humanize=y(7824),f.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(k).forEach(i=>{f[i]=k[i]}),f.names=[],f.skips=[],f.formatters={},f.selectColor=function(i){let r=0;for(let d=0;d<i.length;d++)r=(r<<5)-r+i.charCodeAt(d),r|=0;return f.colors[Math.abs(r)%f.colors.length]},f.enable(f.load()),f}},2840:(N,R,y)=>{var k=y(8768),f=y(778),m=function(){},c=function(i,r,d){if(typeof r=="function")return c(i,null,r);r||(r={}),d=f(d||m);var g=i._writableState,b=i._readableState,h=r.readable||r.readable!==!1&&i.readable,w=r.writable||r.writable!==!1&&i.writable,s=!1,a=function(){i.writable||u()},u=function(){w=!1,h||d.call(i)},x=function(){h=!1,w||d.call(i)},S=function(W){d.call(i,W?new Error("exited with error code: "+W):null)},C=function(W){d.call(i,W)},H=function(){k.nextTick(U)},U=function(){if(!s)return(!h||b&&b.ended&&!b.destroyed)&&(!w||g&&g.ended&&!g.destroyed)?void 0:d.call(i,new Error("premature close"))},D=function(){i.req.on("finish",u)};return function(W){return W.setHeader&&typeof W.abort=="function"}(i)?(i.on("complete",u),i.on("abort",H),i.req?D():i.on("request",D)):w&&!g&&(i.on("end",a),i.on("close",a)),function(W){return W.stdio&&Array.isArray(W.stdio)&&W.stdio.length===3}(i)&&i.on("exit",S),i.on("end",x),i.on("finish",u),r.error!==!1&&i.on("error",C),i.on("close",H),function(){s=!0,i.removeListener("complete",u),i.removeListener("abort",H),i.removeListener("request",D),i.req&&i.req.removeListener("finish",u),i.removeListener("end",a),i.removeListener("close",a),i.removeListener("finish",u),i.removeListener("exit",S),i.removeListener("end",x),i.removeListener("error",C),i.removeListener("close",H)}};N.exports=c},2114:N=>{function R(y,k){for(const f in k)Object.defineProperty(y,f,{value:k[f],enumerable:!0,configurable:!0});return y}N.exports=function(y,k,f){if(!y||typeof y=="string")throw new TypeError("Please pass an Error to err-code");f||(f={}),typeof k=="object"&&(f=k,k=""),k&&(f.code=k);try{return R(y,f)}catch{f.message=y.message,f.stack=y.stack;const c=function(){};return c.prototype=Object.create(Object.getPrototypeOf(y)),R(new c,f)}}},5573:N=>{var R=/["'&<>]/;N.exports=function(y){var k,f=""+y,m=R.exec(f);if(!m)return f;var c="",i=0,r=0;for(i=m.index;i<f.length;i++){switch(f.charCodeAt(i)){case 34:k="&quot;";break;case 38:k="&amp;";break;case 39:k="&#39;";break;case 60:k="&lt;";break;case 62:k="&gt;";break;default:continue}r!==i&&(c+=f.substring(r,i)),r=i+1,c+=k}return r!==i?c+f.substring(r,i):c}},7187:N=>{var R=Object.create||function(a){var u=function(){};return u.prototype=a,new u},y=Object.keys||function(a){var u=[];for(var x in a)Object.prototype.hasOwnProperty.call(a,x)&&u.push(x);return x},k=Function.prototype.bind||function(a){var u=this;return function(){return u.apply(a,arguments)}};function f(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=R(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}N.exports=f,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._maxListeners=void 0;var m,c=10;try{var i={};Object.defineProperty&&Object.defineProperty(i,"x",{value:0}),m=i.x===0}catch{m=!1}function r(a){return a._maxListeners===void 0?f.defaultMaxListeners:a._maxListeners}function d(a,u,x,S){var C,H,U;if(typeof x!="function")throw new TypeError('"listener" argument must be a function');if((H=a._events)?(H.newListener&&(a.emit("newListener",u,x.listener?x.listener:x),H=a._events),U=H[u]):(H=a._events=R(null),a._eventsCount=0),U){if(typeof U=="function"?U=H[u]=S?[x,U]:[U,x]:S?U.unshift(x):U.push(x),!U.warned&&(C=r(a))&&C>0&&U.length>C){U.warned=!0;var D=new Error("Possible EventEmitter memory leak detected. "+U.length+' "'+String(u)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');D.name="MaxListenersExceededWarning",D.emitter=a,D.type=u,D.count=U.length,typeof console=="object"&&console.warn&&console.warn("%s: %s",D.name,D.message)}}else U=H[u]=x,++a._eventsCount;return a}function g(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var a=new Array(arguments.length),u=0;u<a.length;++u)a[u]=arguments[u];this.listener.apply(this.target,a)}}function b(a,u,x){var S={fired:!1,wrapFn:void 0,target:a,type:u,listener:x},C=k.call(g,S);return C.listener=x,S.wrapFn=C,C}function h(a,u,x){var S=a._events;if(!S)return[];var C=S[u];return C?typeof C=="function"?x?[C.listener||C]:[C]:x?function(H){for(var U=new Array(H.length),D=0;D<U.length;++D)U[D]=H[D].listener||H[D];return U}(C):s(C,C.length):[]}function w(a){var u=this._events;if(u){var x=u[a];if(typeof x=="function")return 1;if(x)return x.length}return 0}function s(a,u){for(var x=new Array(u),S=0;S<u;++S)x[S]=a[S];return x}m?Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(a){if(typeof a!="number"||a<0||a!=a)throw new TypeError('"defaultMaxListeners" must be a positive number');c=a}}):f.defaultMaxListeners=c,f.prototype.setMaxListeners=function(a){if(typeof a!="number"||a<0||isNaN(a))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=a,this},f.prototype.getMaxListeners=function(){return r(this)},f.prototype.emit=function(a){var u,x,S,C,H,U,D=a==="error";if(U=this._events)D=D&&U.error==null;else if(!D)return!1;if(D){if(arguments.length>1&&(u=arguments[1]),u instanceof Error)throw u;var W=new Error('Unhandled "error" event. ('+u+")");throw W.context=u,W}if(!(x=U[a]))return!1;var $=typeof x=="function";switch(S=arguments.length){case 1:(function(G,tt,nt){if(tt)G.call(nt);else for(var lt=G.length,ct=s(G,lt),gt=0;gt<lt;++gt)ct[gt].call(nt)})(x,$,this);break;case 2:(function(G,tt,nt,lt){if(tt)G.call(nt,lt);else for(var ct=G.length,gt=s(G,ct),mt=0;mt<ct;++mt)gt[mt].call(nt,lt)})(x,$,this,arguments[1]);break;case 3:(function(G,tt,nt,lt,ct){if(tt)G.call(nt,lt,ct);else for(var gt=G.length,mt=s(G,gt),V=0;V<gt;++V)mt[V].call(nt,lt,ct)})(x,$,this,arguments[1],arguments[2]);break;case 4:(function(G,tt,nt,lt,ct,gt){if(tt)G.call(nt,lt,ct,gt);else for(var mt=G.length,V=s(G,mt),v=0;v<mt;++v)V[v].call(nt,lt,ct,gt)})(x,$,this,arguments[1],arguments[2],arguments[3]);break;default:for(C=new Array(S-1),H=1;H<S;H++)C[H-1]=arguments[H];(function(G,tt,nt,lt){if(tt)G.apply(nt,lt);else for(var ct=G.length,gt=s(G,ct),mt=0;mt<ct;++mt)gt[mt].apply(nt,lt)})(x,$,this,C)}return!0},f.prototype.addListener=function(a,u){return d(this,a,u,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(a,u){return d(this,a,u,!0)},f.prototype.once=function(a,u){if(typeof u!="function")throw new TypeError('"listener" argument must be a function');return this.on(a,b(this,a,u)),this},f.prototype.prependOnceListener=function(a,u){if(typeof u!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(a,b(this,a,u)),this},f.prototype.removeListener=function(a,u){var x,S,C,H,U;if(typeof u!="function")throw new TypeError('"listener" argument must be a function');if(!(S=this._events))return this;if(!(x=S[a]))return this;if(x===u||x.listener===u)--this._eventsCount==0?this._events=R(null):(delete S[a],S.removeListener&&this.emit("removeListener",a,x.listener||u));else if(typeof x!="function"){for(C=-1,H=x.length-1;H>=0;H--)if(x[H]===u||x[H].listener===u){U=x[H].listener,C=H;break}if(C<0)return this;C===0?x.shift():function(D,W){for(var $=W,G=$+1,tt=D.length;G<tt;$+=1,G+=1)D[$]=D[G];D.pop()}(x,C),x.length===1&&(S[a]=x[0]),S.removeListener&&this.emit("removeListener",a,U||u)}return this},f.prototype.removeAllListeners=function(a){var u,x,S;if(!(x=this._events))return this;if(!x.removeListener)return arguments.length===0?(this._events=R(null),this._eventsCount=0):x[a]&&(--this._eventsCount==0?this._events=R(null):delete x[a]),this;if(arguments.length===0){var C,H=y(x);for(S=0;S<H.length;++S)(C=H[S])!=="removeListener"&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=R(null),this._eventsCount=0,this}if(typeof(u=x[a])=="function")this.removeListener(a,u);else if(u)for(S=u.length-1;S>=0;S--)this.removeListener(a,u[S]);return this},f.prototype.listeners=function(a){return h(this,a,!0)},f.prototype.rawListeners=function(a){return h(this,a,!1)},f.listenerCount=function(a,u){return typeof a.listenerCount=="function"?a.listenerCount(u):w.call(a,u)},f.prototype.listenerCount=w,f.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},3975:N=>{N.exports=class{constructor(R){if(!(R>0)||R-1&R)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(R),this.mask=R-1,this.top=0,this.btm=0,this.next=null}push(R){return this.buffer[this.top]===void 0&&(this.buffer[this.top]=R,this.top=this.top+1&this.mask,!0)}shift(){const R=this.buffer[this.btm];if(R!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,R}peek(){return this.buffer[this.btm]}isEmpty(){return this.buffer[this.btm]===void 0}}},1607:(N,R,y)=>{const k=y(3975);N.exports=class{constructor(f){this.hwm=f||16,this.head=new k(this.hwm),this.tail=this.head}push(f){if(!this.head.push(f)){const m=this.head;this.head=m.next=new k(2*this.head.buffer.length),this.head.push(f)}}shift(){const f=this.tail.shift();if(f===void 0&&this.tail.next){const m=this.tail.next;return this.tail.next=null,this.tail=m,this.tail.shift()}return f}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},3811:()=>{typeof ReadableStream>"u"||ReadableStream.prototype[Symbol.asyncIterator]||(ReadableStream.prototype[Symbol.asyncIterator]=function(){const N=this.getReader();let R=N.read();return{next(){const y=R;return R=N.read(),y},return(){R.then(()=>N.releaseLock())},throw(y){throw this.return(),y},[Symbol.asyncIterator](){return this}}})},5177:N=>{N.exports=function(){if(typeof globalThis>"u")return null;var R={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return R.RTCPeerConnection?R:null}},4137:(N,R,y)=>{var k=y(8764).Buffer;const f=y(3029),m=y(7187).EventEmitter,c=y(4375);N.exports=class extends m{constructor(i,r){if(r||(r={}),super(),this.chunkLength=Number(i),!this.chunkLength)throw new Error("First argument must be a chunk length");this.closed=!1,this.destroyed=!1,this.length=Number(r.length)||1/0,this.name=r.name||"idb-chunk-store",this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1),this.dbPromise=f.openDB(this.name,void 0,{upgrade:d=>{d.createObjectStore("chunks")},blocking:()=>{this.close()},terminated:()=>{this.closed=!0,this.emit("error",new Error("Database unexpectedly closed"))}})}put(i,r,d=()=>{}){if(this.closed)return c(()=>d(new Error("Storage is closed")));const g=i===this.lastChunkIndex;return g&&r.length!==this.lastChunkLength?c(()=>d(new Error("Last chunk length must be "+this.lastChunkLength))):g||r.length===this.chunkLength?((r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).byteOffset===0&&r.byteLength===r.buffer.byteLength||(r=r.slice()),void(async()=>{try{await(await this.dbPromise).put("chunks",r,i)}catch(b){return void d(b)}d(null)})()):c(()=>d(new Error("Chunk length must be "+this.chunkLength)))}get(i,r,d=()=>{}){return typeof r=="function"?this.get(i,{},r):(r||(r={}),this.closed?c(()=>d(new Error("Storage is closed"))):void(async()=>{let g;try{g=await(await this.dbPromise).get("chunks",i)}catch(s){return void d(s)}if(g==null){const s=new Error("Chunk not found");return s.notFound=!0,void d(s)}let b=k.from(g.buffer,g.byteOffset,g.byteLength);const h=r.offset||0,w=r.length||b.length-h;h===0&&w===b.length||(b=b.slice(h,w+h)),d(null,b)})())}close(i=()=>{}){if(this.closed)return c(()=>i(new Error("Storage is closed")));this.closed=!0,(async()=>{try{(await this.dbPromise).close()}catch(r){return void i(r)}i(null)})()}destroy(i=()=>{}){return this.closed?c(()=>i(new Error("Storage is closed"))):this.destroyed?c(()=>i(new Error("Storage is destroyed"))):(this.destroyed=!0,void this.close(async r=>{if(r)i(r);else{try{await f.deleteDB(this.name)}catch(d){return void i(d)}i(null)}}))}}},3029:(N,R,y)=>{y.r(R),y.d(R,{deleteDB:()=>x,openDB:()=>u,unwrap:()=>a,wrap:()=>s});const k=(D,W)=>W.some($=>D instanceof $);let f,m;const c=new WeakMap,i=new WeakMap,r=new WeakMap,d=new WeakMap,g=new WeakMap;let b={get(D,W,$){if(D instanceof IDBTransaction){if(W==="done")return i.get(D);if(W==="objectStoreNames")return D.objectStoreNames||r.get(D);if(W==="store")return $.objectStoreNames[1]?void 0:$.objectStore($.objectStoreNames[0])}return s(D[W])},set:(D,W,$)=>(D[W]=$,!0),has:(D,W)=>D instanceof IDBTransaction&&(W==="done"||W==="store")||W in D};function h(D){return D!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(m||(m=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(D)?function(...W){return D.apply(a(this),W),s(c.get(this))}:function(...W){return s(D.apply(a(this),W))}:function(W,...$){const G=D.call(a(this),W,...$);return r.set(G,W.sort?W.sort():[W]),s(G)}}function w(D){return typeof D=="function"?h(D):(D instanceof IDBTransaction&&function(W){if(i.has(W))return;const $=new Promise((G,tt)=>{const nt=()=>{W.removeEventListener("complete",lt),W.removeEventListener("error",ct),W.removeEventListener("abort",ct)},lt=()=>{G(),nt()},ct=()=>{tt(W.error||new DOMException("AbortError","AbortError")),nt()};W.addEventListener("complete",lt),W.addEventListener("error",ct),W.addEventListener("abort",ct)});i.set(W,$)}(D),k(D,f||(f=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(D,b):D)}function s(D){if(D instanceof IDBRequest)return function($){const G=new Promise((tt,nt)=>{const lt=()=>{$.removeEventListener("success",ct),$.removeEventListener("error",gt)},ct=()=>{tt(s($.result)),lt()},gt=()=>{nt($.error),lt()};$.addEventListener("success",ct),$.addEventListener("error",gt)});return G.then(tt=>{tt instanceof IDBCursor&&c.set(tt,$)}).catch(()=>{}),g.set(G,$),G}(D);if(d.has(D))return d.get(D);const W=w(D);return W!==D&&(d.set(D,W),g.set(W,D)),W}const a=D=>g.get(D);function u(D,W,{blocked:$,upgrade:G,blocking:tt,terminated:nt}={}){const lt=indexedDB.open(D,W),ct=s(lt);return G&&lt.addEventListener("upgradeneeded",gt=>{G(s(lt.result),gt.oldVersion,gt.newVersion,s(lt.transaction))}),$&&lt.addEventListener("blocked",()=>$()),ct.then(gt=>{nt&&gt.addEventListener("close",()=>nt()),tt&&gt.addEventListener("versionchange",()=>tt())}).catch(()=>{}),ct}function x(D,{blocked:W}={}){const $=indexedDB.deleteDatabase(D);return W&&$.addEventListener("blocked",()=>W()),s($).then(()=>{})}const S=["get","getKey","getAll","getAllKeys","count"],C=["put","add","delete","clear"],H=new Map;function U(D,W){if(!(D instanceof IDBDatabase)||W in D||typeof W!="string")return;if(H.get(W))return H.get(W);const $=W.replace(/FromIndex$/,""),G=W!==$,tt=C.includes($);if(!($ in(G?IDBIndex:IDBObjectStore).prototype)||!tt&&!S.includes($))return;const nt=async function(lt,...ct){const gt=this.transaction(lt,tt?"readwrite":"readonly");let mt=gt.store;return G&&(mt=mt.index(ct.shift())),(await Promise.all([mt[$](...ct),tt&&gt.done]))[0]};return H.set(W,nt),nt}b=(D=>({...D,get:(W,$,G)=>U(W,$)||D.get(W,$,G),has:(W,$)=>!!U(W,$)||D.has(W,$)}))(b)},645:(N,R)=>{R.read=function(y,k,f,m,c){var i,r,d=8*c-m-1,g=(1<<d)-1,b=g>>1,h=-7,w=f?c-1:0,s=f?-1:1,a=y[k+w];for(w+=s,i=a&(1<<-h)-1,a>>=-h,h+=d;h>0;i=256*i+y[k+w],w+=s,h-=8);for(r=i&(1<<-h)-1,i>>=-h,h+=m;h>0;r=256*r+y[k+w],w+=s,h-=8);if(i===0)i=1-b;else{if(i===g)return r?NaN:1/0*(a?-1:1);r+=Math.pow(2,m),i-=b}return(a?-1:1)*r*Math.pow(2,i-m)},R.write=function(y,k,f,m,c,i){var r,d,g,b=8*i-c-1,h=(1<<b)-1,w=h>>1,s=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,a=m?0:i-1,u=m?1:-1,x=k<0||k===0&&1/k<0?1:0;for(k=Math.abs(k),isNaN(k)||k===1/0?(d=isNaN(k)?1:0,r=h):(r=Math.floor(Math.log(k)/Math.LN2),k*(g=Math.pow(2,-r))<1&&(r--,g*=2),(k+=r+w>=1?s/g:s*Math.pow(2,1-w))*g>=2&&(r++,g/=2),r+w>=h?(d=0,r=h):r+w>=1?(d=(k*g-1)*Math.pow(2,c),r+=w):(d=k*Math.pow(2,w-1)*Math.pow(2,c),r=0));c>=8;y[f+a]=255&d,a+=u,d/=256,c-=8);for(r=r<<c|d,b+=c;b>0;y[f+a]=255&r,a+=u,r/=256,b-=8);y[f+a-u]|=128*x}},3700:(N,R,y)=>{const k=y(4375);N.exports=class{constructor(f){if(this.store=f,this.chunkLength=f.chunkLength,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.mem=[]}put(f,m,c=()=>{}){this.mem[f]=m,this.store.put(f,m,i=>{this.mem[f]=null,c(i)})}get(f,m,c=()=>{}){if(typeof m=="function")return this.get(f,null,m);let i=this.mem[f];if(!i)return this.store.get(f,m,c);m||(m={});const r=m.offset||0,d=m.length||i.length-r;r===0&&d===i.length||(i=i.slice(r,d+r)),k(()=>c(null,i))}close(f=()=>{}){this.store.close(f)}destroy(f=()=>{}){this.store.destroy(f)}}},5717:N=>{typeof Object.create=="function"?N.exports=function(R,y){y&&(R.super_=y,R.prototype=Object.create(y.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}))}:N.exports=function(R,y){if(y){R.super_=y;var k=function(){};k.prototype=y.prototype,R.prototype=new k,R.prototype.constructor=R}}},8225:N=>{N.exports=async function*(R){for(let y of R)typeof y=="function"&&(y=y()),yield*y}},1351:(N,R)=>{R.re=()=>{throw new Error("`junk.re` was renamed to `junk.regex`")},R.regex=new RegExp(["^npm-debug\\.log$","^\\..*\\.swp$","^\\.DS_Store$","^\\.AppleDouble$","^\\.LSOverride$","^Icon\\r$","^\\._.*","^\\.Spotlight-V100(?:$|\\/)","\\.Trashes","^__MACOSX$","~$","^Thumbs\\.db$","^ehthumbs\\.db$","^Desktop\\.ini$","@eaDir$"].join("|")),R.is=y=>R.regex.test(y),R.not=y=>!R.is(y),R.default=N.exports},5516:(N,R,y)=>{R.RateLimiter=y(1114),R.TokenBucket=y(4976)},6188:(N,R,y)=>{var k=y(8768);N.exports=function(){if(k!==void 0&&k.hrtime){var f=k.hrtime(),m=f[0],c=f[1];return 1e3*m+Math.floor(c/1e6)}return new Date().getTime()}},1114:(N,R,y)=>{var k=y(8768),f=y(4976),m=y(6188),c=function(i,r,d){this.tokenBucket=new f(i,i,r,null),this.tokenBucket.content=i,this.curIntervalStart=m(),this.tokensThisInterval=0,this.fireImmediately=d};c.prototype={tokenBucket:null,curIntervalStart:0,tokensThisInterval:0,fireImmediately:!1,removeTokens:function(i,r){if(i>this.tokenBucket.bucketSize)return k.nextTick(r.bind(null,"Requested tokens "+i+" exceeds maximum tokens per interval "+this.tokenBucket.bucketSize,null)),!1;var d=this,g=m();if((g<this.curIntervalStart||g-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=g,this.tokensThisInterval=0),i>this.tokenBucket.tokensPerInterval-this.tokensThisInterval){if(this.fireImmediately)k.nextTick(r.bind(null,null,-1));else{var b=Math.ceil(this.curIntervalStart+this.tokenBucket.interval-g);setTimeout(function(){d.tokenBucket.removeTokens(i,h)},b)}return!1}return this.tokenBucket.removeTokens(i,h);function h(w,s){if(w)return r(w,null);d.tokensThisInterval+=i,r(null,s)}},tryRemoveTokens:function(i){if(i>this.tokenBucket.bucketSize)return!1;var r=m();if((r<this.curIntervalStart||r-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=r,this.tokensThisInterval=0),i>this.tokenBucket.tokensPerInterval-this.tokensThisInterval)return!1;var d=this.tokenBucket.tryRemoveTokens(i);return d&&(this.tokensThisInterval+=i),d},getTokensRemaining:function(){return this.tokenBucket.drip(),this.tokenBucket.content}},N.exports=c},4976:(N,R,y)=>{var k=y(8768),f=function(m,c,i,r){if(this.bucketSize=m,this.tokensPerInterval=c,typeof i=="string")switch(i){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+i)}else this.interval=i;this.parentBucket=r,this.content=0,this.lastDrip=+new Date};f.prototype={bucketSize:1,tokensPerInterval:1,interval:1e3,parentBucket:null,content:0,lastDrip:0,removeTokens:function(m,c){var i=this;return this.bucketSize?m>this.bucketSize?(k.nextTick(c.bind(null,"Requested tokens "+m+" exceeds bucket size "+this.bucketSize,null)),!1):(this.drip(),m>this.content?r():this.parentBucket?this.parentBucket.removeTokens(m,function(d,g){return d?c(d,null):m>i.content?r():(i.content-=m,void c(null,Math.min(g,i.content)))}):(this.content-=m,k.nextTick(c.bind(null,null,this.content)),!0)):(k.nextTick(c.bind(null,null,m,Number.POSITIVE_INFINITY)),!0);function r(){var d=Math.ceil((m-i.content)*(i.interval/i.tokensPerInterval));return setTimeout(function(){i.removeTokens(m,c)},d),!1}},tryRemoveTokens:function(m){return!this.bucketSize||!(m>this.bucketSize)&&(this.drip(),!(m>this.content)&&!(this.parentBucket&&!this.parentBucket.tryRemoveTokens(m))&&(this.content-=m,!0))},drip:function(){if(this.tokensPerInterval){var m=+new Date,c=Math.max(m-this.lastDrip,0);this.lastDrip=m;var i=c*(this.tokensPerInterval/this.interval);this.content=Math.min(this.content+i,this.bucketSize)}else this.content=this.bucketSize}},N.exports=f},7117:(N,R,y)=>{var k=y(7187),f=y(5717);function m(c){if(!(this instanceof m))return new m(c);typeof c=="number"&&(c={max:c}),c||(c={}),k.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=c.max||1e3,this.maxAge=c.maxAge||0}N.exports=m,f(m,k.EventEmitter),Object.defineProperty(m.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),m.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},m.prototype.remove=function(c){if(typeof c!="string"&&(c=""+c),this.cache.hasOwnProperty(c)){var i=this.cache[c];return delete this.cache[c],this._unlink(c,i.prev,i.next),i.value}},m.prototype._unlink=function(c,i,r){this.length--,this.length===0?this.head=this.tail=null:this.head===c?(this.head=i,this.cache[this.head].next=null):this.tail===c?(this.tail=r,this.cache[this.tail].prev=null):(this.cache[i].next=r,this.cache[r].prev=i)},m.prototype.peek=function(c){if(this.cache.hasOwnProperty(c)){var i=this.cache[c];if(this._checkAge(c,i))return i.value}},m.prototype.set=function(c,i){var r;if(typeof c!="string"&&(c=""+c),this.cache.hasOwnProperty(c)){if((r=this.cache[c]).value=i,this.maxAge&&(r.modified=Date.now()),c===this.head)return i;this._unlink(c,r.prev,r.next)}else r={value:i,modified:0,next:null,prev:null},this.maxAge&&(r.modified=Date.now()),this.cache[c]=r,this.length===this.max&&this.evict();return this.length++,r.next=null,r.prev=this.head,this.head&&(this.cache[this.head].next=c),this.head=c,this.tail||(this.tail=c),i},m.prototype._checkAge=function(c,i){return!(this.maxAge&&Date.now()-i.modified>this.maxAge)||(this.remove(c),this.emit("evict",{key:c,value:i.value}),!1)},m.prototype.get=function(c){if(typeof c!="string"&&(c=""+c),this.cache.hasOwnProperty(c)){var i=this.cache[c];if(this._checkAge(c,i))return this.head!==c&&(c===this.tail?(this.tail=i.next,this.cache[this.tail].prev=null):this.cache[i.prev].next=i.next,this.cache[i.next].prev=i.prev,this.cache[this.head].next=c,i.prev=this.head,i.next=null,this.head=c),i.value}},m.prototype.evict=function(){if(this.tail){var c=this.tail,i=this.remove(this.tail);this.emit("evict",{key:c,value:i})}}},9417:(N,R,y)=>{var k=y(8764).Buffer;const f=y(6581),{EventEmitter:m}=y(7187),c=y(1227)("lt_donthave");N.exports=()=>{class i extends m{constructor(d){super(),this._peerSupports=!1,this._wire=d}onExtendedHandshake(){this._peerSupports=!0}onMessage(d){let g;try{g=d.readUInt32BE()}catch{return}this._wire.peerPieces.get(g)&&(c("got donthave %d",g),this._wire.peerPieces.set(g,!1),this.emit("donthave",g),this._failRequests(g))}donthave(d){if(!this._peerSupports)return;c("donthave %d",d);const g=k.alloc(4);g.writeUInt32BE(d),this._wire.extended("lt_donthave",g)}_failRequests(d){const g=this._wire.requests;for(let b=0;b<g.length;b++){const h=g[b];h.piece===d&&(f(g,b),b-=1,this._wire._callback(h,new Error("peer sent donthave"),null))}}}return i.prototype.name="lt_donthave",i}},1191:(N,R,y)=>{N.exports=f;const k=y(4375);function f(m,c){if(!(this instanceof f))return new f(m,c);if(c||(c={}),this.chunkLength=Number(m),!this.chunkLength)throw new Error("First argument must be a chunk length");this.chunks=[],this.closed=!1,this.length=Number(c.length)||1/0,this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}f.prototype.put=function(m,c,i=()=>{}){if(this.closed)return k(()=>i(new Error("Storage is closed")));const r=m===this.lastChunkIndex;return r&&c.length!==this.lastChunkLength?k(()=>i(new Error("Last chunk length must be "+this.lastChunkLength))):r||c.length===this.chunkLength?(this.chunks[m]=c,void k(()=>i(null))):k(()=>i(new Error("Chunk length must be "+this.chunkLength)))},f.prototype.get=function(m,c,i=()=>{}){if(typeof c=="function")return this.get(m,null,c);if(this.closed)return k(()=>i(new Error("Storage is closed")));let r=this.chunks[m];if(!r){const b=new Error("Chunk not found");return b.notFound=!0,k(()=>i(b))}c||(c={});const d=c.offset||0,g=c.length||r.length-d;d===0&&g===r.length||(r=r.slice(d,g+d)),k(()=>i(null,r))},f.prototype.close=f.prototype.destroy=function(m=()=>{}){if(this.closed)return k(()=>m(new Error("Storage is closed")));this.closed=!0,this.chunks=null,k(()=>m(null))}},9146:N=>{function R(){this._types=Object.create(null),this._extensions=Object.create(null);for(let y=0;y<arguments.length;y++)this.define(arguments[y]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}R.prototype.define=function(y,k){for(let f in y){let m=y[f].map(function(c){return c.toLowerCase()});f=f.toLowerCase();for(let c=0;c<m.length;c++){const i=m[c];if(i[0]!=="*"){if(!k&&i in this._types)throw new Error('Attempt to change mapping for "'+i+'" extension from "'+this._types[i]+'" to "'+f+'". Pass `force=true` to allow this, otherwise remove "'+i+'" from the list of extensions for "'+f+'".');this._types[i]=f}}if(k||!this._extensions[f]){const c=m[0];this._extensions[f]=c[0]!=="*"?c:c.substr(1)}}},R.prototype.getType=function(y){let k=(y=String(y)).replace(/^.*[/\\]/,"").toLowerCase(),f=k.replace(/^.*\./,"").toLowerCase(),m=k.length<y.length;return(f.length<k.length-1||!m)&&this._types[f]||null},R.prototype.getExtension=function(y){return(y=/^\s*([^;\s]*)/.test(y)&&RegExp.$1)&&this._extensions[y.toLowerCase()]||null},N.exports=R},2109:(N,R,y)=>{let k=y(9146);N.exports=new k(y(4415))},4415:N=>{N.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},7824:N=>{var R=1e3,y=60*R,k=60*y,f=24*k,m=7*f,c=365.25*f;function i(r,d,g,b){var h=d>=1.5*g;return Math.round(r/g)+" "+b+(h?"s":"")}N.exports=function(r,d){d=d||{};var g=typeof r;if(g==="string"&&r.length>0)return function(b){if(!((b=String(b)).length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(b);if(h){var w=parseFloat(h[1]);switch((h[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return w*c;case"weeks":case"week":case"w":return w*m;case"days":case"day":case"d":return w*f;case"hours":case"hour":case"hrs":case"hr":case"h":return w*k;case"minutes":case"minute":case"mins":case"min":case"m":return w*y;case"seconds":case"second":case"secs":case"sec":case"s":return w*R;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return w;default:return}}}}(r);if(g==="number"&&isFinite(r))return d.long?function(b){var h=Math.abs(b);return h>=f?i(b,h,f,"day"):h>=k?i(b,h,k,"hour"):h>=y?i(b,h,y,"minute"):h>=R?i(b,h,R,"second"):b+" ms"}(r):function(b){var h=Math.abs(b);return h>=f?Math.round(b/f)+"d":h>=k?Math.round(b/k)+"h":h>=y?Math.round(b/y)+"m":h>=R?Math.round(b/R)+"s":b+"ms"}(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))}},778:(N,R,y)=>{var k=y(2479);function f(c){var i=function(){return i.called?i.value:(i.called=!0,i.value=c.apply(this,arguments))};return i.called=!1,i}function m(c){var i=function(){if(i.called)throw new Error(i.onceError);return i.called=!0,i.value=c.apply(this,arguments)},r=c.name||"Function wrapped with `once`";return i.onceError=r+" shouldn't be called more than once",i.called=!1,i}N.exports=k(f),N.exports.strict=k(m),f.proto=f(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return f(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return m(this)},configurable:!0})})},6470:(N,R,y)=>{var k=y(8768);function f(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function m(i,r){for(var d,g="",b=0,h=-1,w=0,s=0;s<=i.length;++s){if(s<i.length)d=i.charCodeAt(s);else{if(d===47)break;d=47}if(d===47){if(!(h===s-1||w===1))if(h!==s-1&&w===2){if(g.length<2||b!==2||g.charCodeAt(g.length-1)!==46||g.charCodeAt(g.length-2)!==46){if(g.length>2){var a=g.lastIndexOf("/");if(a!==g.length-1){a===-1?(g="",b=0):b=(g=g.slice(0,a)).length-1-g.lastIndexOf("/"),h=s,w=0;continue}}else if(g.length===2||g.length===1){g="",b=0,h=s,w=0;continue}}r&&(g.length>0?g+="/..":g="..",b=2)}else g.length>0?g+="/"+i.slice(h+1,s):g=i.slice(h+1,s),b=s-h-1;h=s,w=0}else d===46&&w!==-1?++w:w=-1}return g}var c={resolve:function(){for(var i,r="",d=!1,g=arguments.length-1;g>=-1&&!d;g--){var b;g>=0?b=arguments[g]:(i===void 0&&(i=k.cwd()),b=i),f(b),b.length!==0&&(r=b+"/"+r,d=b.charCodeAt(0)===47)}return r=m(r,!d),d?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(i){if(f(i),i.length===0)return".";var r=i.charCodeAt(0)===47,d=i.charCodeAt(i.length-1)===47;return(i=m(i,!r)).length!==0||r||(i="."),i.length>0&&d&&(i+="/"),r?"/"+i:i},isAbsolute:function(i){return f(i),i.length>0&&i.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var i,r=0;r<arguments.length;++r){var d=arguments[r];f(d),d.length>0&&(i===void 0?i=d:i+="/"+d)}return i===void 0?".":c.normalize(i)},relative:function(i,r){if(f(i),f(r),i===r||(i=c.resolve(i))===(r=c.resolve(r)))return"";for(var d=1;d<i.length&&i.charCodeAt(d)===47;++d);for(var g=i.length,b=g-d,h=1;h<r.length&&r.charCodeAt(h)===47;++h);for(var w=r.length-h,s=b<w?b:w,a=-1,u=0;u<=s;++u){if(u===s){if(w>s){if(r.charCodeAt(h+u)===47)return r.slice(h+u+1);if(u===0)return r.slice(h+u)}else b>s&&(i.charCodeAt(d+u)===47?a=u:u===0&&(a=0));break}var x=i.charCodeAt(d+u);if(x!==r.charCodeAt(h+u))break;x===47&&(a=u)}var S="";for(u=d+a+1;u<=g;++u)u!==g&&i.charCodeAt(u)!==47||(S.length===0?S+="..":S+="/..");return S.length>0?S+r.slice(h+a):(h+=a,r.charCodeAt(h)===47&&++h,r.slice(h))},_makeLong:function(i){return i},dirname:function(i){if(f(i),i.length===0)return".";for(var r=i.charCodeAt(0),d=r===47,g=-1,b=!0,h=i.length-1;h>=1;--h)if((r=i.charCodeAt(h))===47){if(!b){g=h;break}}else b=!1;return g===-1?d?"/":".":d&&g===1?"//":i.slice(0,g)},basename:function(i,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');f(i);var d,g=0,b=-1,h=!0;if(r!==void 0&&r.length>0&&r.length<=i.length){if(r.length===i.length&&r===i)return"";var w=r.length-1,s=-1;for(d=i.length-1;d>=0;--d){var a=i.charCodeAt(d);if(a===47){if(!h){g=d+1;break}}else s===-1&&(h=!1,s=d+1),w>=0&&(a===r.charCodeAt(w)?--w==-1&&(b=d):(w=-1,b=s))}return g===b?b=s:b===-1&&(b=i.length),i.slice(g,b)}for(d=i.length-1;d>=0;--d)if(i.charCodeAt(d)===47){if(!h){g=d+1;break}}else b===-1&&(h=!1,b=d+1);return b===-1?"":i.slice(g,b)},extname:function(i){f(i);for(var r=-1,d=0,g=-1,b=!0,h=0,w=i.length-1;w>=0;--w){var s=i.charCodeAt(w);if(s!==47)g===-1&&(b=!1,g=w+1),s===46?r===-1?r=w:h!==1&&(h=1):r!==-1&&(h=-1);else if(!b){d=w+1;break}}return r===-1||g===-1||h===0||h===1&&r===g-1&&r===d+1?"":i.slice(r,g)},format:function(i){if(i===null||typeof i!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof i);return function(r,d){var g=d.dir||d.root,b=d.base||(d.name||"")+(d.ext||"");return g?g===d.root?g+b:g+r+b:b}("/",i)},parse:function(i){f(i);var r={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return r;var d,g=i.charCodeAt(0),b=g===47;b?(r.root="/",d=1):d=0;for(var h=-1,w=0,s=-1,a=!0,u=i.length-1,x=0;u>=d;--u)if((g=i.charCodeAt(u))!==47)s===-1&&(a=!1,s=u+1),g===46?h===-1?h=u:x!==1&&(x=1):h!==-1&&(x=-1);else if(!a){w=u+1;break}return h===-1||s===-1||x===0||x===1&&h===s-1&&h===w+1?s!==-1&&(r.base=r.name=w===0&&b?i.slice(1,s):i.slice(w,s)):(w===0&&b?(r.name=i.slice(1,h),r.base=i.slice(1,s)):(r.name=i.slice(w,h),r.base=i.slice(w,s)),r.ext=i.slice(h,s)),w>0?r.dir=i.slice(0,w-1):b&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};c.posix=c,N.exports=c},3786:N=>{N.exports=function(R){return Math.max(16384,1<<Math.log2(R<1024?1:R/1024)+.5|0)}},4286:(N,R,y)=>{var k=y(8768),f=y(778),m=y(2840),c=y(1156),i=function(){},r=/^v?\.0/.test(k.version),d=function(w){return typeof w=="function"},g=function(w,s,a,u){u=f(u);var x=!1;w.on("close",function(){x=!0}),m(w,{readable:s,writable:a},function(C){if(C)return u(C);x=!0,u()});var S=!1;return function(C){if(!x&&!S)return S=!0,function(H){return!!r&&!!c&&(H instanceof(c.ReadStream||i)||H instanceof(c.WriteStream||i))&&d(H.close)}(w)?w.close(i):function(H){return H.setHeader&&d(H.abort)}(w)?w.abort():d(w.destroy)?w.destroy():void u(C||new Error("stream was destroyed"))}},b=function(w){w()},h=function(w,s){return w.pipe(s)};N.exports=function(){var w,s=Array.prototype.slice.call(arguments),a=d(s[s.length-1]||i)&&s.pop()||i;if(Array.isArray(s[0])&&(s=s[0]),s.length<2)throw new Error("pump requires two streams per minimum");var u=s.map(function(x,S){var C=S<s.length-1;return g(x,C,S>0,function(H){w||(w=H),H&&u.forEach(b),C||(u.forEach(b),a(w))})});return s.reduce(h)}},4375:N=>{let R;N.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):y=>(R||(R=Promise.resolve())).then(y).catch(k=>setTimeout(()=>{throw k},0))},3527:N=>{N.exports=typeof queueMicrotask=="function"?queueMicrotask:R=>Promise.resolve().then(R)},5960:N=>{N.exports=function(R){var y=0;return function(){if(y===R.length)return null;var k=R.length-y,f=Math.random()*k|0,m=R[y+f],c=R[y];return R[y]=m,R[y+f]=c,y++,m}}},1798:(N,R,y)=>{var k=y(8768),f=65536,m=4294967295,c=y(9509).Buffer,i=globalThis.crypto||globalThis.msCrypto;i&&i.getRandomValues?N.exports=function(r,d){if(r>m)throw new RangeError("requested too many random bytes");var g=c.allocUnsafe(r);if(r>0)if(r>f)for(var b=0;b<r;b+=f)i.getRandomValues(g.slice(b,b+f));else i.getRandomValues(g);return typeof d=="function"?k.nextTick(function(){d(null,g)}):g}:N.exports=function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}},4622:N=>{function R(m,c){return{start:m.start,end:m.end,index:c}}function y(m){return{start:m.start,end:m.end}}function k(m,c){return m.index-c.index}function f(m,c){return m.start-c.start}N.exports=function(m,c,i){if(typeof c!="string")throw new TypeError("argument str must be a string");var r=c.indexOf("=");if(r===-1)return-2;var d=c.slice(r+1).split(","),g=[];g.type=c.slice(0,r);for(var b=0;b<d.length;b++){var h=d[b].split("-"),w=parseInt(h[0],10),s=parseInt(h[1],10);isNaN(w)?(w=m-s,s=m-1):isNaN(s)&&(s=m-1),s>m-1&&(s=m-1),isNaN(w)||isNaN(s)||w>s||w<0||g.push({start:w,end:s})}return g.length<1?-1:i&&i.combine?function(a){for(var u=a.map(R).sort(f),x=0,S=1;S<u.length;S++){var C=u[S],H=u[x];C.start>H.end+1?u[++x]=C:C.end>H.end&&(H.end=C.end,H.index=Math.min(H.index,C.index))}u.length=x+1;var U=u.sort(k).map(y);return U.type=a.type,U}(g):g}},7830:N=>{function R(d){return parseInt(d,10)===d}function y(d){function g(h){if(h===void 0){h=new Array(d);for(var w=0;w<d;w++)h[w]=Math.floor(Math.random()*d)}else if(typeof h=="string")h=(h=""+h).split("").map(function(C){return C.charCodeAt(0)%d});else{if(!Array.isArray(h))throw new TypeError("invalid seed key specified");if(!h.every(function(C){return typeof C=="number"&&C===(0|C)}))throw new TypeError("invalid seed key specified: not array of integers")}for(var s=h.length,a=function(){for(var C=new Array(d),H=0;H<d;H++)C[H]=H;return C}(),u=0,x=0;x<d;x++){u=(u+a[x]+h[x%s])%d;var S=a[x];a[x]=a[u],a[u]=S}return a}function b(h){this.s=g(h),this.i=0,this.j=0}return b.prototype.randomNative=function(){this.i=(this.i+1)%d,this.j=(this.j+this.s[this.i])%d;var h=this.s[this.i];return this.s[this.i]=this.s[this.j],this.s[this.j]=h,this.s[(this.s[this.i]+this.s[this.j])%d]},b.prototype.randomUInt32=function(){return 256*(256*(256*this.randomByte()+this.randomByte())+this.randomByte())+this.randomByte()},b.prototype.randomFloat=function(){return this.randomUInt32()/4294967296},b.prototype.random=function(){var h,w;if(arguments.length===1)h=0,w=arguments[0];else{if(arguments.length!==2)throw new TypeError("random takes one or two integer arguments");h=arguments[0],w=arguments[1]}if(!R(h)||!R(w))throw new TypeError("random takes one or two integer arguments");return h+this.randomUInt32()%(w-h+1)},b.prototype.currentState=function(){return{i:this.i,j:this.j,s:this.s.slice()}},b.prototype.setState=function(h){var w=h.s,s=h.i,a=h.j;if(!(s===(0|s)&&0<=s&&s<d))throw new Error("state.i should be integer [0, "+(d-1)+"]");if(!(a===(0|a)&&0<=a&&a<d))throw new Error("state.j should be integer [0, "+(d-1)+"]");if(!Array.isArray(w)||w.length!==d)throw new Error("state should be array of length "+d);for(var u=0;u<d;u++)if(w.indexOf(u)===-1)throw new Error("state should be permutation of 0.."+(d-1)+": "+u+" is missing");this.i=s,this.j=a,this.s=w.slice()},b}var k=y(256);k.prototype.randomByte=k.prototype.randomNative;var f=y(16);f.prototype.randomByte=function(){return 16*this.randomNative()+this.randomNative()};var m="a".charCodeAt(0),c="0".charCodeAt(0);function i(d){return d<10?String.fromCharCode(c+d):String.fromCharCode(m+d-10)}function r(d){return parseInt(d,16)}f.prototype.currentStateString=function(){var d=this.currentState();return i(d.i)+i(d.j)+d.s.map(i).join("")},f.prototype.setStateString=function(d){if(!d.match(/^[0-9a-f]{18}$/))throw new TypeError("RC4small stateString should be 18 hex character string");var g=r(d[0]),b=r(d[1]),h=d.split("").slice(2).map(r);this.setState({i:g,j:b,s:h})},k.RC4small=f,N.exports=k},4281:N=>{var R={};function y(f,m,c){c||(c=Error);var i=function(r){var d,g;function b(h,w,s){return r.call(this,function(a,u,x){return typeof m=="string"?m:m(a,u,x)}(h,w,s))||this}return g=r,(d=b).prototype=Object.create(g.prototype),d.prototype.constructor=d,d.__proto__=g,b}(c);i.prototype.name=c.name,i.prototype.code=f,R[f]=i}function k(f,m){if(Array.isArray(f)){var c=f.length;return f=f.map(function(i){return String(i)}),c>2?"one of ".concat(m," ").concat(f.slice(0,c-1).join(", "),", or ")+f[c-1]:c===2?"one of ".concat(m," ").concat(f[0]," or ").concat(f[1]):"of ".concat(m," ").concat(f[0])}return"of ".concat(m," ").concat(String(f))}y("ERR_INVALID_OPT_VALUE",function(f,m){return'The value "'+m+'" is invalid for option "'+f+'"'},TypeError),y("ERR_INVALID_ARG_TYPE",function(f,m,c){var i,r,d;if(typeof m=="string"&&(r="not ",m.substr(0,r.length)===r)?(i="must not be",m=m.replace(/^not /,"")):i="must be",function(b,h,w){return(w===void 0||w>b.length)&&(w=b.length),b.substring(w-h.length,w)===h}(f," argument"))d="The ".concat(f," ").concat(i," ").concat(k(m,"type"));else{var g=function(b,h,w){return typeof w!="number"&&(w=0),!(w+h.length>b.length)&&b.indexOf(h,w)!==-1}(f,".")?"property":"argument";d='The "'.concat(f,'" ').concat(g," ").concat(i," ").concat(k(m,"type"))}return d+=". Received type ".concat(typeof c)},TypeError),y("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),y("ERR_METHOD_NOT_IMPLEMENTED",function(f){return"The "+f+" method is not implemented"}),y("ERR_STREAM_PREMATURE_CLOSE","Premature close"),y("ERR_STREAM_DESTROYED",function(f){return"Cannot call "+f+" after a stream was destroyed"}),y("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),y("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),y("ERR_STREAM_WRITE_AFTER_END","write after end"),y("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),y("ERR_UNKNOWN_ENCODING",function(f){return"Unknown encoding: "+f},TypeError),y("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),N.exports.q=R},6753:(N,R,y)=>{var k=y(8768),f=Object.keys||function(w){var s=[];for(var a in w)s.push(a);return s};N.exports=g;var m=y(9481),c=y(4229);y(5717)(g,m);for(var i=f(c.prototype),r=0;r<i.length;r++){var d=i[r];g.prototype[d]||(g.prototype[d]=c.prototype[d])}function g(w){if(!(this instanceof g))return new g(w);m.call(this,w),c.call(this,w),this.allowHalfOpen=!0,w&&(w.readable===!1&&(this.readable=!1),w.writable===!1&&(this.writable=!1),w.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",b)))}function b(){this._writableState.ended||k.nextTick(h,this)}function h(w){w.end()}Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(w){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=w,this._writableState.destroyed=w)}})},2725:(N,R,y)=>{N.exports=f;var k=y(4605);function f(m){if(!(this instanceof f))return new f(m);k.call(this,m)}y(5717)(f,k),f.prototype._transform=function(m,c,i){i(null,m)}},9481:(N,R,y)=>{var k,f=y(8768);N.exports=G,G.ReadableState=$,y(7187).EventEmitter;var m=function(B,T){return B.listeners(T).length},c=y(2503),i=y(8764).Buffer,r=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){},d,g=y(4616);d=g&&g.debuglog?g.debuglog("stream"):function(){};var b,h,w,s=y(7327),a=y(1195),u=y(2457).getHighWaterMark,x=y(4281).q,S=x.ERR_INVALID_ARG_TYPE,C=x.ERR_STREAM_PUSH_AFTER_EOF,H=x.ERR_METHOD_NOT_IMPLEMENTED,U=x.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;y(5717)(G,c);var D=a.errorOrDestroy,W=["error","close","destroy","pause","resume"];function $(B,T,J){k=k||y(6753),B=B||{},typeof J!="boolean"&&(J=T instanceof k),this.objectMode=!!B.objectMode,J&&(this.objectMode=this.objectMode||!!B.readableObjectMode),this.highWaterMark=u(this,B,"readableHighWaterMark",J),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=B.emitClose!==!1,this.autoDestroy=!!B.autoDestroy,this.destroyed=!1,this.defaultEncoding=B.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,B.encoding&&(b||(b=y(2553).s),this.decoder=new b(B.encoding),this.encoding=B.encoding)}function G(B){if(k=k||y(6753),!(this instanceof G))return new G(B);var T=this instanceof k;this._readableState=new $(B,this,T),this.readable=!0,B&&(typeof B.read=="function"&&(this._read=B.read),typeof B.destroy=="function"&&(this._destroy=B.destroy)),c.call(this)}function tt(B,T,J,ht,vt){d("readableAddChunk",T);var Ct,dt=B._readableState;if(T===null)dt.reading=!1,function(At,Et){if(d("onEofChunk"),!Et.ended){if(Et.decoder){var Mt=Et.decoder.end();Mt&&Mt.length&&(Et.buffer.push(Mt),Et.length+=Et.objectMode?1:Mt.length)}Et.ended=!0,Et.sync?gt(At):(Et.needReadable=!1,Et.emittedReadable||(Et.emittedReadable=!0,mt(At)))}}(B,dt);else if(vt||(Ct=function(At,Et){var Mt;Bt=Et,i.isBuffer(Bt)||Bt instanceof r||typeof Et=="string"||Et===void 0||At.objectMode||(Mt=new S("chunk",["string","Buffer","Uint8Array"],Et));var Bt;return Mt}(dt,T)),Ct)D(B,Ct);else if(dt.objectMode||T&&T.length>0)if(typeof T=="string"||dt.objectMode||Object.getPrototypeOf(T)===i.prototype||(T=function(At){return i.from(At)}(T)),ht)dt.endEmitted?D(B,new U):nt(B,dt,T,!0);else if(dt.ended)D(B,new C);else{if(dt.destroyed)return!1;dt.reading=!1,dt.decoder&&!J?(T=dt.decoder.write(T),dt.objectMode||T.length!==0?nt(B,dt,T,!1):V(B,dt)):nt(B,dt,T,!1)}else ht||(dt.reading=!1,V(B,dt));return!dt.ended&&(dt.length<dt.highWaterMark||dt.length===0)}function nt(B,T,J,ht){T.flowing&&T.length===0&&!T.sync?(T.awaitDrain=0,B.emit("data",J)):(T.length+=T.objectMode?1:J.length,ht?T.buffer.unshift(J):T.buffer.push(J),T.needReadable&&gt(B)),V(B,T)}Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(B){this._readableState&&(this._readableState.destroyed=B)}}),G.prototype.destroy=a.destroy,G.prototype._undestroy=a.undestroy,G.prototype._destroy=function(B,T){T(B)},G.prototype.push=function(B,T){var J,ht=this._readableState;return ht.objectMode?J=!0:typeof B=="string"&&((T=T||ht.defaultEncoding)!==ht.encoding&&(B=i.from(B,T),T=""),J=!0),tt(this,B,T,!1,J)},G.prototype.unshift=function(B){return tt(this,B,null,!0,!1)},G.prototype.isPaused=function(){return this._readableState.flowing===!1},G.prototype.setEncoding=function(B){b||(b=y(2553).s);var T=new b(B);this._readableState.decoder=T,this._readableState.encoding=this._readableState.decoder.encoding;for(var J=this._readableState.buffer.head,ht="";J!==null;)ht+=T.write(J.data),J=J.next;return this._readableState.buffer.clear(),ht!==""&&this._readableState.buffer.push(ht),this._readableState.length=ht.length,this};var lt=1073741824;function ct(B,T){return B<=0||T.length===0&&T.ended?0:T.objectMode?1:B!=B?T.flowing&&T.length?T.buffer.head.data.length:T.length:(B>T.highWaterMark&&(T.highWaterMark=function(J){return J>=lt?J=lt:(J--,J|=J>>>1,J|=J>>>2,J|=J>>>4,J|=J>>>8,J|=J>>>16,J++),J}(B)),B<=T.length?B:T.ended?T.length:(T.needReadable=!0,0))}function gt(B){var T=B._readableState;d("emitReadable",T.needReadable,T.emittedReadable),T.needReadable=!1,T.emittedReadable||(d("emitReadable",T.flowing),T.emittedReadable=!0,f.nextTick(mt,B))}function mt(B){var T=B._readableState;d("emitReadable_",T.destroyed,T.length,T.ended),T.destroyed||!T.length&&!T.ended||(B.emit("readable"),T.emittedReadable=!1),T.needReadable=!T.flowing&&!T.ended&&T.length<=T.highWaterMark,Q(B)}function V(B,T){T.readingMore||(T.readingMore=!0,f.nextTick(v,B,T))}function v(B,T){for(;!T.reading&&!T.ended&&(T.length<T.highWaterMark||T.flowing&&T.length===0);){var J=T.length;if(d("maybeReadMore read 0"),B.read(0),J===T.length)break}T.readingMore=!1}function A(B){var T=B._readableState;T.readableListening=B.listenerCount("readable")>0,T.resumeScheduled&&!T.paused?T.flowing=!0:B.listenerCount("data")>0&&B.resume()}function q(B){d("readable nexttick read 0"),B.read(0)}function Y(B,T){d("resume",T.reading),T.reading||B.read(0),T.resumeScheduled=!1,B.emit("resume"),Q(B),T.flowing&&!T.reading&&B.read(0)}function Q(B){var T=B._readableState;for(d("flow",T.flowing);T.flowing&&B.read()!==null;);}function st(B,T){return T.length===0?null:(T.objectMode?J=T.buffer.shift():!B||B>=T.length?(J=T.decoder?T.buffer.join(""):T.buffer.length===1?T.buffer.first():T.buffer.concat(T.length),T.buffer.clear()):J=T.buffer.consume(B,T.decoder),J);var J}function ut(B){var T=B._readableState;d("endReadable",T.endEmitted),T.endEmitted||(T.ended=!0,f.nextTick(_t,T,B))}function _t(B,T){if(d("endReadableNT",B.endEmitted,B.length),!B.endEmitted&&B.length===0&&(B.endEmitted=!0,T.readable=!1,T.emit("end"),B.autoDestroy)){var J=T._writableState;(!J||J.autoDestroy&&J.finished)&&T.destroy()}}function Tt(B,T){for(var J=0,ht=B.length;J<ht;J++)if(B[J]===T)return J;return-1}G.prototype.read=function(B){d("read",B),B=parseInt(B,10);var T=this._readableState,J=B;if(B!==0&&(T.emittedReadable=!1),B===0&&T.needReadable&&((T.highWaterMark!==0?T.length>=T.highWaterMark:T.length>0)||T.ended))return d("read: emitReadable",T.length,T.ended),T.length===0&&T.ended?ut(this):gt(this),null;if((B=ct(B,T))===0&&T.ended)return T.length===0&&ut(this),null;var ht,vt=T.needReadable;return d("need readable",vt),(T.length===0||T.length-B<T.highWaterMark)&&d("length less than watermark",vt=!0),T.ended||T.reading?d("reading or ended",vt=!1):vt&&(d("do read"),T.reading=!0,T.sync=!0,T.length===0&&(T.needReadable=!0),this._read(T.highWaterMark),T.sync=!1,T.reading||(B=ct(J,T))),(ht=B>0?st(B,T):null)===null?(T.needReadable=T.length<=T.highWaterMark,B=0):(T.length-=B,T.awaitDrain=0),T.length===0&&(T.ended||(T.needReadable=!0),J!==B&&T.ended&&ut(this)),ht!==null&&this.emit("data",ht),ht},G.prototype._read=function(B){D(this,new H("_read()"))},G.prototype.pipe=function(B,T){var J=this,ht=this._readableState;switch(ht.pipesCount){case 0:ht.pipes=B;break;case 1:ht.pipes=[ht.pipes,B];break;default:ht.pipes.push(B)}ht.pipesCount+=1,d("pipe count=%d opts=%j",ht.pipesCount,T);var vt=(!T||T.end!==!1)&&B!==f.stdout&&B!==f.stderr?dt:l;function Ct(p,L){d("onunpipe"),p===J&&L&&L.hasUnpiped===!1&&(L.hasUnpiped=!0,d("cleanup"),B.removeListener("close",zt),B.removeListener("finish",n),B.removeListener("drain",At),B.removeListener("error",Bt),B.removeListener("unpipe",Ct),J.removeListener("end",dt),J.removeListener("end",l),J.removeListener("data",Mt),Et=!0,!ht.awaitDrain||B._writableState&&!B._writableState.needDrain||At())}function dt(){d("onend"),B.end()}ht.endEmitted?f.nextTick(vt):J.once("end",vt),B.on("unpipe",Ct);var At=function(p){return function(){var L=p._readableState;d("pipeOnDrain",L.awaitDrain),L.awaitDrain&&L.awaitDrain--,L.awaitDrain===0&&m(p,"data")&&(L.flowing=!0,Q(p))}}(J);B.on("drain",At);var Et=!1;function Mt(p){d("ondata");var L=B.write(p);d("dest.write",L),L===!1&&((ht.pipesCount===1&&ht.pipes===B||ht.pipesCount>1&&Tt(ht.pipes,B)!==-1)&&!Et&&(d("false write response, pause",ht.awaitDrain),ht.awaitDrain++),J.pause())}function Bt(p){d("onerror",p),l(),B.removeListener("error",Bt),m(B,"error")===0&&D(B,p)}function zt(){B.removeListener("finish",n),l()}function n(){d("onfinish"),B.removeListener("close",zt),l()}function l(){d("unpipe"),J.unpipe(B)}return J.on("data",Mt),function(p,L,F){if(typeof p.prependListener=="function")return p.prependListener(L,F);p._events&&p._events[L]?Array.isArray(p._events[L])?p._events[L].unshift(F):p._events[L]=[F,p._events[L]]:p.on(L,F)}(B,"error",Bt),B.once("close",zt),B.once("finish",n),B.emit("pipe",J),ht.flowing||(d("pipe resume"),J.resume()),B},G.prototype.unpipe=function(B){var T=this._readableState,J={hasUnpiped:!1};if(T.pipesCount===0)return this;if(T.pipesCount===1)return B&&B!==T.pipes||(B||(B=T.pipes),T.pipes=null,T.pipesCount=0,T.flowing=!1,B&&B.emit("unpipe",this,J)),this;if(!B){var ht=T.pipes,vt=T.pipesCount;T.pipes=null,T.pipesCount=0,T.flowing=!1;for(var Ct=0;Ct<vt;Ct++)ht[Ct].emit("unpipe",this,{hasUnpiped:!1});return this}var dt=Tt(T.pipes,B);return dt===-1||(T.pipes.splice(dt,1),T.pipesCount-=1,T.pipesCount===1&&(T.pipes=T.pipes[0]),B.emit("unpipe",this,J)),this},G.prototype.on=function(B,T){var J=c.prototype.on.call(this,B,T),ht=this._readableState;return B==="data"?(ht.readableListening=this.listenerCount("readable")>0,ht.flowing!==!1&&this.resume()):B==="readable"&&(ht.endEmitted||ht.readableListening||(ht.readableListening=ht.needReadable=!0,ht.flowing=!1,ht.emittedReadable=!1,d("on readable",ht.length,ht.reading),ht.length?gt(this):ht.reading||f.nextTick(q,this))),J},G.prototype.addListener=G.prototype.on,G.prototype.removeListener=function(B,T){var J=c.prototype.removeListener.call(this,B,T);return B==="readable"&&f.nextTick(A,this),J},G.prototype.removeAllListeners=function(B){var T=c.prototype.removeAllListeners.apply(this,arguments);return B!=="readable"&&B!==void 0||f.nextTick(A,this),T},G.prototype.resume=function(){var B=this._readableState;return B.flowing||(d("resume"),B.flowing=!B.readableListening,function(T,J){J.resumeScheduled||(J.resumeScheduled=!0,f.nextTick(Y,T,J))}(this,B)),B.paused=!1,this},G.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},G.prototype.wrap=function(B){var T=this,J=this._readableState,ht=!1;for(var vt in B.on("end",function(){if(d("wrapped end"),J.decoder&&!J.ended){var dt=J.decoder.end();dt&&dt.length&&T.push(dt)}T.push(null)}),B.on("data",function(dt){d("wrapped data"),J.decoder&&(dt=J.decoder.write(dt)),J.objectMode&&dt==null||(J.objectMode||dt&&dt.length)&&(T.push(dt)||(ht=!0,B.pause()))}),B)this[vt]===void 0&&typeof B[vt]=="function"&&(this[vt]=function(dt){return function(){return B[dt].apply(B,arguments)}}(vt));for(var Ct=0;Ct<W.length;Ct++)B.on(W[Ct],this.emit.bind(this,W[Ct]));return this._read=function(dt){d("wrapped _read",dt),ht&&(ht=!1,B.resume())},this},typeof Symbol=="function"&&(G.prototype[Symbol.asyncIterator]=function(){return h===void 0&&(h=y(5850)),h(this)}),Object.defineProperty(G.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(G.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(G.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(B){this._readableState&&(this._readableState.flowing=B)}}),G._fromList=st,Object.defineProperty(G.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(G.from=function(B,T){return w===void 0&&(w=y(5167)),w(G,B,T)})},4605:(N,R,y)=>{N.exports=g;var k=y(4281).q,f=k.ERR_METHOD_NOT_IMPLEMENTED,m=k.ERR_MULTIPLE_CALLBACK,c=k.ERR_TRANSFORM_ALREADY_TRANSFORMING,i=k.ERR_TRANSFORM_WITH_LENGTH_0,r=y(6753);function d(w,s){var a=this._transformState;a.transforming=!1;var u=a.writecb;if(u===null)return this.emit("error",new m);a.writechunk=null,a.writecb=null,s!=null&&this.push(s),u(w);var x=this._readableState;x.reading=!1,(x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}function g(w){if(!(this instanceof g))return new g(w);r.call(this,w),this._transformState={afterTransform:d.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,w&&(typeof w.transform=="function"&&(this._transform=w.transform),typeof w.flush=="function"&&(this._flush=w.flush)),this.on("prefinish",b)}function b(){var w=this;typeof this._flush!="function"||this._readableState.destroyed?h(this,null,null):this._flush(function(s,a){h(w,s,a)})}function h(w,s,a){if(s)return w.emit("error",s);if(a!=null&&w.push(a),w._writableState.length)throw new i;if(w._transformState.transforming)throw new c;return w.push(null)}y(5717)(g,r),g.prototype.push=function(w,s){return this._transformState.needTransform=!1,r.prototype.push.call(this,w,s)},g.prototype._transform=function(w,s,a){a(new f("_transform()"))},g.prototype._write=function(w,s,a){var u=this._transformState;if(u.writecb=a,u.writechunk=w,u.writeencoding=s,!u.transforming){var x=this._readableState;(u.needTransform||x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}},g.prototype._read=function(w){var s=this._transformState;s.writechunk===null||s.transforming?s.needTransform=!0:(s.transforming=!0,this._transform(s.writechunk,s.writeencoding,s.afterTransform))},g.prototype._destroy=function(w,s){r.prototype._destroy.call(this,w,function(a){s(a)})}},4229:(N,R,y)=>{var k,f=y(8768);function m(V){var v=this;this.next=null,this.entry=null,this.finish=function(){(function(A,q,Y){var Q=A.entry;for(A.entry=null;Q;){var st=Q.callback;q.pendingcb--,st(Y),Q=Q.next}q.corkedRequestsFree.next=A})(v,V)}}N.exports=G,G.WritableState=$;var c={deprecate:y(4927)},i=y(2503),r=y(8764).Buffer,d=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){},g,b=y(1195),h=y(2457).getHighWaterMark,w=y(4281).q,s=w.ERR_INVALID_ARG_TYPE,a=w.ERR_METHOD_NOT_IMPLEMENTED,u=w.ERR_MULTIPLE_CALLBACK,x=w.ERR_STREAM_CANNOT_PIPE,S=w.ERR_STREAM_DESTROYED,C=w.ERR_STREAM_NULL_VALUES,H=w.ERR_STREAM_WRITE_AFTER_END,U=w.ERR_UNKNOWN_ENCODING,D=b.errorOrDestroy;function W(){}function $(V,v,A){k=k||y(6753),V=V||{},typeof A!="boolean"&&(A=v instanceof k),this.objectMode=!!V.objectMode,A&&(this.objectMode=this.objectMode||!!V.writableObjectMode),this.highWaterMark=h(this,V,"writableHighWaterMark",A),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var q=V.decodeStrings===!1;this.decodeStrings=!q,this.defaultEncoding=V.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Y){(function(Q,st){var ut=Q._writableState,_t=ut.sync,Tt=ut.writecb;if(typeof Tt!="function")throw new u;if(function(T){T.writing=!1,T.writecb=null,T.length-=T.writelen,T.writelen=0}(ut),st)(function(T,J,ht,vt,Ct){--J.pendingcb,ht?(f.nextTick(Ct,vt),f.nextTick(mt,T,J),T._writableState.errorEmitted=!0,D(T,vt)):(Ct(vt),T._writableState.errorEmitted=!0,D(T,vt),mt(T,J))})(Q,ut,_t,st,Tt);else{var B=ct(ut)||Q.destroyed;B||ut.corked||ut.bufferProcessing||!ut.bufferedRequest||lt(Q,ut),_t?f.nextTick(nt,Q,ut,B,Tt):nt(Q,ut,B,Tt)}})(v,Y)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=V.emitClose!==!1,this.autoDestroy=!!V.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new m(this)}function G(V){var v=this instanceof(k=k||y(6753));if(!v&&!g.call(G,this))return new G(V);this._writableState=new $(V,this,v),this.writable=!0,V&&(typeof V.write=="function"&&(this._write=V.write),typeof V.writev=="function"&&(this._writev=V.writev),typeof V.destroy=="function"&&(this._destroy=V.destroy),typeof V.final=="function"&&(this._final=V.final)),i.call(this)}function tt(V,v,A,q,Y,Q,st){v.writelen=q,v.writecb=st,v.writing=!0,v.sync=!0,v.destroyed?v.onwrite(new S("write")):A?V._writev(Y,v.onwrite):V._write(Y,Q,v.onwrite),v.sync=!1}function nt(V,v,A,q){A||function(Y,Q){Q.length===0&&Q.needDrain&&(Q.needDrain=!1,Y.emit("drain"))}(V,v),v.pendingcb--,q(),mt(V,v)}function lt(V,v){v.bufferProcessing=!0;var A=v.bufferedRequest;if(V._writev&&A&&A.next){var q=v.bufferedRequestCount,Y=new Array(q),Q=v.corkedRequestsFree;Q.entry=A;for(var st=0,ut=!0;A;)Y[st]=A,A.isBuf||(ut=!1),A=A.next,st+=1;Y.allBuffers=ut,tt(V,v,!0,v.length,Y,"",Q.finish),v.pendingcb++,v.lastBufferedRequest=null,Q.next?(v.corkedRequestsFree=Q.next,Q.next=null):v.corkedRequestsFree=new m(v),v.bufferedRequestCount=0}else{for(;A;){var _t=A.chunk,Tt=A.encoding,B=A.callback;if(tt(V,v,!1,v.objectMode?1:_t.length,_t,Tt,B),A=A.next,v.bufferedRequestCount--,v.writing)break}A===null&&(v.lastBufferedRequest=null)}v.bufferedRequest=A,v.bufferProcessing=!1}function ct(V){return V.ending&&V.length===0&&V.bufferedRequest===null&&!V.finished&&!V.writing}function gt(V,v){V._final(function(A){v.pendingcb--,A&&D(V,A),v.prefinished=!0,V.emit("prefinish"),mt(V,v)})}function mt(V,v){var A=ct(v);if(A&&(function(Y,Q){Q.prefinished||Q.finalCalled||(typeof Y._final!="function"||Q.destroyed?(Q.prefinished=!0,Y.emit("prefinish")):(Q.pendingcb++,Q.finalCalled=!0,f.nextTick(gt,Y,Q)))}(V,v),v.pendingcb===0&&(v.finished=!0,V.emit("finish"),v.autoDestroy))){var q=V._readableState;(!q||q.autoDestroy&&q.endEmitted)&&V.destroy()}return A}y(5717)(G,i),$.prototype.getBuffer=function(){for(var V=this.bufferedRequest,v=[];V;)v.push(V),V=V.next;return v},function(){try{Object.defineProperty($.prototype,"buffer",{get:c.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(g=Function.prototype[Symbol.hasInstance],Object.defineProperty(G,Symbol.hasInstance,{value:function(V){return!!g.call(this,V)||this===G&&V&&V._writableState instanceof $}})):g=function(V){return V instanceof this},G.prototype.pipe=function(){D(this,new x)},G.prototype.write=function(V,v,A){var q,Y=this._writableState,Q=!1,st=!Y.objectMode&&(q=V,r.isBuffer(q)||q instanceof d);return st&&!r.isBuffer(V)&&(V=function(ut){return r.from(ut)}(V)),typeof v=="function"&&(A=v,v=null),st?v="buffer":v||(v=Y.defaultEncoding),typeof A!="function"&&(A=W),Y.ending?function(ut,_t){var Tt=new H;D(ut,Tt),f.nextTick(_t,Tt)}(this,A):(st||function(ut,_t,Tt,B){var T;return Tt===null?T=new C:typeof Tt=="string"||_t.objectMode||(T=new s("chunk",["string","Buffer"],Tt)),!T||(D(ut,T),f.nextTick(B,T),!1)}(this,Y,V,A))&&(Y.pendingcb++,Q=function(ut,_t,Tt,B,T,J){if(!Tt){var ht=function(At,Et,Mt){return At.objectMode||At.decodeStrings===!1||typeof Et!="string"||(Et=r.from(Et,Mt)),Et}(_t,B,T);B!==ht&&(Tt=!0,T="buffer",B=ht)}var vt=_t.objectMode?1:B.length;_t.length+=vt;var Ct=_t.length<_t.highWaterMark;if(Ct||(_t.needDrain=!0),_t.writing||_t.corked){var dt=_t.lastBufferedRequest;_t.lastBufferedRequest={chunk:B,encoding:T,isBuf:Tt,callback:J,next:null},dt?dt.next=_t.lastBufferedRequest:_t.bufferedRequest=_t.lastBufferedRequest,_t.bufferedRequestCount+=1}else tt(ut,_t,!1,vt,B,T,J);return Ct}(this,Y,st,V,v,A)),Q},G.prototype.cork=function(){this._writableState.corked++},G.prototype.uncork=function(){var V=this._writableState;V.corked&&(V.corked--,V.writing||V.corked||V.bufferProcessing||!V.bufferedRequest||lt(this,V))},G.prototype.setDefaultEncoding=function(V){if(typeof V=="string"&&(V=V.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((V+"").toLowerCase())>-1))throw new U(V);return this._writableState.defaultEncoding=V,this},Object.defineProperty(G.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(G.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),G.prototype._write=function(V,v,A){A(new a("_write()"))},G.prototype._writev=null,G.prototype.end=function(V,v,A){var q=this._writableState;return typeof V=="function"?(A=V,V=null,v=null):typeof v=="function"&&(A=v,v=null),V!=null&&this.write(V,v),q.corked&&(q.corked=1,this.uncork()),q.ending||function(Y,Q,st){Q.ending=!0,mt(Y,Q),st&&(Q.finished?f.nextTick(st):Y.once("finish",st)),Q.ended=!0,Y.writable=!1}(this,q,A),this},Object.defineProperty(G.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(V){this._writableState&&(this._writableState.destroyed=V)}}),G.prototype.destroy=b.destroy,G.prototype._undestroy=b.undestroy,G.prototype._destroy=function(V,v){v(V)}},5850:(N,R,y)=>{var k,f=y(8768);function m(C,H,U){return(H=function(D){var W=function($,G){if(typeof $!="object"||$===null)return $;var tt=$[Symbol.toPrimitive];if(tt!==void 0){var nt=tt.call($,G||"default");if(typeof nt!="object")return nt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(G==="string"?String:Number)($)}(D,"string");return typeof W=="symbol"?W:String(W)}(H))in C?Object.defineProperty(C,H,{value:U,enumerable:!0,configurable:!0,writable:!0}):C[H]=U,C}var c=y(8610),i=Symbol("lastResolve"),r=Symbol("lastReject"),d=Symbol("error"),g=Symbol("ended"),b=Symbol("lastPromise"),h=Symbol("handlePromise"),w=Symbol("stream");function s(C,H){return{value:C,done:H}}function a(C){var H=C[i];if(H!==null){var U=C[w].read();U!==null&&(C[b]=null,C[i]=null,C[r]=null,H(s(U,!1)))}}function u(C){f.nextTick(a,C)}var x=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((m(k={get stream(){return this[w]},next:function(){var C=this,H=this[d];if(H!==null)return Promise.reject(H);if(this[g])return Promise.resolve(s(void 0,!0));if(this[w].destroyed)return new Promise(function($,G){f.nextTick(function(){C[d]?G(C[d]):$(s(void 0,!0))})});var U,D=this[b];if(D)U=new Promise(function($,G){return function(tt,nt){$.then(function(){G[g]?tt(s(void 0,!0)):G[h](tt,nt)},nt)}}(D,this));else{var W=this[w].read();if(W!==null)return Promise.resolve(s(W,!1));U=new Promise(this[h])}return this[b]=U,U}},Symbol.asyncIterator,function(){return this}),m(k,"return",function(){var C=this;return new Promise(function(H,U){C[w].destroy(null,function(D){D?U(D):H(s(void 0,!0))})})}),k),x);N.exports=function(C){var H,U=Object.create(S,(m(H={},w,{value:C,writable:!0}),m(H,i,{value:null,writable:!0}),m(H,r,{value:null,writable:!0}),m(H,d,{value:null,writable:!0}),m(H,g,{value:C._readableState.endEmitted,writable:!0}),m(H,h,{value:function(D,W){var $=U[w].read();$?(U[b]=null,U[i]=null,U[r]=null,D(s($,!1))):(U[i]=D,U[r]=W)},writable:!0}),H));return U[b]=null,c(C,function(D){if(D&&D.code!=="ERR_STREAM_PREMATURE_CLOSE"){var W=U[r];return W!==null&&(U[b]=null,U[i]=null,U[r]=null,W(D)),void(U[d]=D)}var $=U[i];$!==null&&(U[b]=null,U[i]=null,U[r]=null,$(s(void 0,!0))),U[g]=!0}),C.on("readable",u.bind(null,U)),U}},7327:(N,R,y)=>{function k(b,h){var w=Object.keys(b);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(b);h&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(b,a).enumerable})),w.push.apply(w,s)}return w}function f(b){for(var h=1;h<arguments.length;h++){var w=arguments[h]!=null?arguments[h]:{};h%2?k(Object(w),!0).forEach(function(s){m(b,s,w[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(w)):k(Object(w)).forEach(function(s){Object.defineProperty(b,s,Object.getOwnPropertyDescriptor(w,s))})}return b}function m(b,h,w){return(h=i(h))in b?Object.defineProperty(b,h,{value:w,enumerable:!0,configurable:!0,writable:!0}):b[h]=w,b}function c(b,h){for(var w=0;w<h.length;w++){var s=h[w];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(b,i(s.key),s)}}function i(b){var h=function(w,s){if(typeof w!="object"||w===null)return w;var a=w[Symbol.toPrimitive];if(a!==void 0){var u=a.call(w,s||"default");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(w)}(b,"string");return typeof h=="symbol"?h:String(h)}var r=y(8764).Buffer,d=y(2361).inspect,g=d&&d.custom||"inspect";N.exports=function(){function b(){(function(s,a){if(!(s instanceof a))throw new TypeError("Cannot call a class as a function")})(this,b),this.head=null,this.tail=null,this.length=0}var h,w;return h=b,(w=[{key:"push",value:function(s){var a={data:s,next:null};this.length>0?this.tail.next=a:this.head=a,this.tail=a,++this.length}},{key:"unshift",value:function(s){var a={data:s,next:this.head};this.length===0&&(this.tail=a),this.head=a,++this.length}},{key:"shift",value:function(){if(this.length!==0){var s=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,s}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(s){if(this.length===0)return"";for(var a=this.head,u=""+a.data;a=a.next;)u+=s+a.data;return u}},{key:"concat",value:function(s){if(this.length===0)return r.alloc(0);for(var a,u,x,S=r.allocUnsafe(s>>>0),C=this.head,H=0;C;)a=C.data,u=S,x=H,r.prototype.copy.call(a,u,x),H+=C.data.length,C=C.next;return S}},{key:"consume",value:function(s,a){var u;return s<this.head.data.length?(u=this.head.data.slice(0,s),this.head.data=this.head.data.slice(s)):u=s===this.head.data.length?this.shift():a?this._getString(s):this._getBuffer(s),u}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(s){var a=this.head,u=1,x=a.data;for(s-=x.length;a=a.next;){var S=a.data,C=s>S.length?S.length:s;if(C===S.length?x+=S:x+=S.slice(0,s),(s-=C)==0){C===S.length?(++u,a.next?this.head=a.next:this.head=this.tail=null):(this.head=a,a.data=S.slice(C));break}++u}return this.length-=u,x}},{key:"_getBuffer",value:function(s){var a=r.allocUnsafe(s),u=this.head,x=1;for(u.data.copy(a),s-=u.data.length;u=u.next;){var S=u.data,C=s>S.length?S.length:s;if(S.copy(a,a.length-s,0,C),(s-=C)==0){C===S.length?(++x,u.next?this.head=u.next:this.head=this.tail=null):(this.head=u,u.data=S.slice(C));break}++x}return this.length-=x,a}},{key:g,value:function(s,a){return d(this,f(f({},a),{},{depth:0,customInspect:!1}))}}])&&c(h.prototype,w),Object.defineProperty(h,"prototype",{writable:!1}),b}()},1195:(N,R,y)=>{var k=y(8768);function f(i,r){c(i,r),m(i)}function m(i){i._writableState&&!i._writableState.emitClose||i._readableState&&!i._readableState.emitClose||i.emit("close")}function c(i,r){i.emit("error",r)}N.exports={destroy:function(i,r){var d=this,g=this._readableState&&this._readableState.destroyed,b=this._writableState&&this._writableState.destroyed;return g||b?(r?r(i):i&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,k.nextTick(c,this,i)):k.nextTick(c,this,i)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(i||null,function(h){!r&&h?d._writableState?d._writableState.errorEmitted?k.nextTick(m,d):(d._writableState.errorEmitted=!0,k.nextTick(f,d,h)):k.nextTick(f,d,h):r?(k.nextTick(m,d),r(h)):k.nextTick(m,d)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(i,r){var d=i._readableState,g=i._writableState;d&&d.autoDestroy||g&&g.autoDestroy?i.destroy(r):i.emit("error",r)}}},8610:(N,R,y)=>{var k=y(4281).q.ERR_STREAM_PREMATURE_CLOSE;function f(){}N.exports=function m(c,i,r){if(typeof i=="function")return m(c,null,i);i||(i={}),r=function(C){var H=!1;return function(){if(!H){H=!0;for(var U=arguments.length,D=new Array(U),W=0;W<U;W++)D[W]=arguments[W];C.apply(this,D)}}}(r||f);var d=i.readable||i.readable!==!1&&c.readable,g=i.writable||i.writable!==!1&&c.writable,b=function(){c.writable||w()},h=c._writableState&&c._writableState.finished,w=function(){g=!1,h=!0,d||r.call(c)},s=c._readableState&&c._readableState.endEmitted,a=function(){d=!1,s=!0,g||r.call(c)},u=function(C){r.call(c,C)},x=function(){var C;return d&&!s?(c._readableState&&c._readableState.ended||(C=new k),r.call(c,C)):g&&!h?(c._writableState&&c._writableState.ended||(C=new k),r.call(c,C)):void 0},S=function(){c.req.on("finish",w)};return function(C){return C.setHeader&&typeof C.abort=="function"}(c)?(c.on("complete",w),c.on("abort",x),c.req?S():c.on("request",S)):g&&!c._writableState&&(c.on("end",b),c.on("close",b)),c.on("end",a),c.on("finish",w),i.error!==!1&&c.on("error",u),c.on("close",x),function(){c.removeListener("complete",w),c.removeListener("abort",x),c.removeListener("request",S),c.req&&c.req.removeListener("finish",w),c.removeListener("end",b),c.removeListener("close",b),c.removeListener("finish",w),c.removeListener("end",a),c.removeListener("error",u),c.removeListener("close",x)}}},5167:N=>{N.exports=function(){throw new Error("Readable.from is not available in the browser")}},9946:(N,R,y)=>{var k,f=y(4281).q,m=f.ERR_MISSING_ARGS,c=f.ERR_STREAM_DESTROYED;function i(g){if(g)throw g}function r(g){g()}function d(g,b){return g.pipe(b)}N.exports=function(){for(var g=arguments.length,b=new Array(g),h=0;h<g;h++)b[h]=arguments[h];var w,s=function(u){return u.length?typeof u[u.length-1]!="function"?i:u.pop():i}(b);if(Array.isArray(b[0])&&(b=b[0]),b.length<2)throw new m("streams");var a=b.map(function(u,x){var S=x<b.length-1;return function(C,H,U,D){D=function(G){var tt=!1;return function(){tt||(tt=!0,G.apply(void 0,arguments))}}(D);var W=!1;C.on("close",function(){W=!0}),k===void 0&&(k=y(8610)),k(C,{readable:H,writable:U},function(G){if(G)return D(G);W=!0,D()});var $=!1;return function(G){if(!W&&!$)return $=!0,function(tt){return tt.setHeader&&typeof tt.abort=="function"}(C)?C.abort():typeof C.destroy=="function"?C.destroy():void D(G||new c("pipe"))}}(u,S,x>0,function(C){w||(w=C),C&&a.forEach(r),S||(a.forEach(r),s(w))})});return b.reduce(d)}},2457:(N,R,y)=>{var k=y(4281).q.ERR_INVALID_OPT_VALUE;N.exports={getHighWaterMark:function(f,m,c,i){var r=function(d,g,b){return d.highWaterMark!=null?d.highWaterMark:g?d[b]:null}(m,i,c);if(r!=null){if(!isFinite(r)||Math.floor(r)!==r||r<0)throw new k(i?c:"highWaterMark",r);return Math.floor(r)}return f.objectMode?16:16384}}},2503:(N,R,y)=>{N.exports=y(7187).EventEmitter},8473:(N,R,y)=>{(R=N.exports=y(9481)).Stream=R,R.Readable=R,R.Writable=y(4229),R.Duplex=y(6753),R.Transform=y(4605),R.PassThrough=y(2725),R.finished=y(8610),R.pipeline=y(9946)},9967:(N,R,y)=>{N.exports=function(f,m,c){if(typeof m!="number")throw new Error("second argument must be a Number");let i,r,d,g,b,h,w=!0;Array.isArray(f)?(i=[],d=r=f.length):(g=Object.keys(f),i={},d=r=g.length);function s(u){function x(){c&&c(u,i),c=null}w?k(x):x()}function a(u,x,S){if(i[u]=S,x&&(b=!0),--d==0||x)s(x);else if(!b&&h<r){let C;g?(C=g[h],h+=1,f[C](function(H,U){a(C,H,U)})):(C=h,h+=1,f[C](function(H,U){a(C,H,U)}))}}h=m,d?g?g.some(function(u,x){return f[u](function(S,C){a(u,S,C)}),x===m-1}):f.some(function(u,x){return u(function(S,C){a(x,S,C)}),x===m-1}):s(null),w=!1};const k=y(4375)},4595:(N,R,y)=>{N.exports=function(f,m){let c,i,r,d=!0;Array.isArray(f)?(c=[],i=f.length):(r=Object.keys(f),c={},i=r.length);function g(h){function w(){m&&m(h,c),m=null}d?k(w):w()}function b(h,w,s){c[h]=s,(--i==0||w)&&g(w)}i?r?r.forEach(function(h){f[h](function(w,s){b(h,w,s)})}):f.forEach(function(h,w){h(function(s,a){b(w,s,a)})}):g(null),d=!1};const k=y(4375)},9509:(N,R,y)=>{var k=y(8764),f=k.Buffer;function m(i,r){for(var d in i)r[d]=i[d]}function c(i,r,d){return f(i,r,d)}f.from&&f.alloc&&f.allocUnsafe&&f.allocUnsafeSlow?N.exports=k:(m(k,R),R.Buffer=c),c.prototype=Object.create(f.prototype),m(f,c),c.from=function(i,r,d){if(typeof i=="number")throw new TypeError("Argument must not be a number");return f(i,r,d)},c.alloc=function(i,r,d){if(typeof i!="number")throw new TypeError("Argument must be a number");var g=f(i);return r!==void 0?typeof d=="string"?g.fill(r,d):g.fill(r):g.fill(0),g},c.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return f(i)},c.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return k.SlowBuffer(i)}},7485:(N,R,y)=>{var k=y(8764).Buffer;N.exports=function(f,m){var c=[];f.on("data",function(i){c.push(i)}),f.once("end",function(){m&&m(null,k.concat(c)),m=null}),f.once("error",function(i){m&&m(i),m=null})}},8853:(N,R,y)=>{const k=y(1227)("simple-peer"),f=y(5177),m=y(1798),c=y(8473),i=y(4375),r=y(2114),{Buffer:d}=y(8764),g=65536;function b(w){return w.replace(/a=ice-options:trickle\s\n/g,"")}class h extends c.Duplex{constructor(s){if(super(s=Object.assign({allowHalfOpen:!1},s)),this._id=m(4).toString("hex").slice(0,7),this._debug("new peer %o",s),this.channelName=s.initiator?s.channelName||m(20).toString("hex"):null,this.initiator=s.initiator||!1,this.channelConfig=s.channelConfig||h.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},h.config,s.config),this.offerOptions=s.offerOptions||{},this.answerOptions=s.answerOptions||{},this.sdpTransform=s.sdpTransform||(a=>a),this.streams=s.streams||(s.stream?[s.stream]:[]),this.trickle=s.trickle===void 0||s.trickle,this.allowHalfTrickle=s.allowHalfTrickle!==void 0&&s.allowHalfTrickle,this.iceCompleteTimeout=s.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=s.wrtc&&typeof s.wrtc=="object"?s.wrtc:f(),!this._wrtc)throw r(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(a){return void this.destroy(r(a,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=a=>{this._onIceCandidate(a)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(a=>{this.destroy(r(a,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=a=>{this._setupData(a)},this.streams&&this.streams.forEach(a=>{this.addStream(a)}),this._pc.ontrack=a=>{this._onTrack(a)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(s){if(!this.destroying){if(this.destroyed)throw r(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof s=="string")try{s=JSON.parse(s)}catch{s={}}this._debug("signal()"),s.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),s.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(s.transceiverRequest.kind,s.transceiverRequest.init)),s.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(s.candidate):this._pendingCandidates.push(s.candidate)),s.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(s)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(a=>{this._addIceCandidate(a)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(a=>{this.destroy(r(a,"ERR_SET_REMOTE_DESCRIPTION"))}),s.sdp||s.candidate||s.renegotiate||s.transceiverRequest||this.destroy(r(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(s){const a=new this._wrtc.RTCIceCandidate(s);this._pc.addIceCandidate(a).catch(u=>{var x;!a.address||a.address.endsWith(".local")?(x="Ignoring unsupported ICE candidate.",console.warn(x)):this.destroy(r(u,"ERR_ADD_ICE_CANDIDATE"))})}send(s){if(!this.destroying){if(this.destroyed)throw r(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(s)}}addTransceiver(s,a){if(!this.destroying){if(this.destroyed)throw r(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(s,a),this._needsNegotiation()}catch(u){this.destroy(r(u,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:s,init:a}})}}addStream(s){if(!this.destroying){if(this.destroyed)throw r(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),s.getTracks().forEach(a=>{this.addTrack(a,s)})}}addTrack(s,a){if(this.destroying)return;if(this.destroyed)throw r(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const u=this._senderMap.get(s)||new Map;let x=u.get(a);if(x)throw x.removed?r(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):r(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");x=this._pc.addTrack(s,a),u.set(a,x),this._senderMap.set(s,u),this._needsNegotiation()}replaceTrack(s,a,u){if(this.destroying)return;if(this.destroyed)throw r(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const x=this._senderMap.get(s),S=x?x.get(u):null;if(!S)throw r(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");a&&this._senderMap.set(a,x),S.replaceTrack!=null?S.replaceTrack(a):this.destroy(r(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(s,a){if(this.destroying)return;if(this.destroyed)throw r(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const u=this._senderMap.get(s),x=u?u.get(a):null;if(!x)throw r(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{x.removed=!0,this._pc.removeTrack(x)}catch(S){S.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(x):this.destroy(r(S,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(s){if(!this.destroying){if(this.destroyed)throw r(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),s.getTracks().forEach(a=>{this.removeTrack(a,s)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,i(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw r(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(s){this._destroy(s,()=>{})}_destroy(s,a){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",s&&(s.message||s)),i(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",s&&(s.message||s)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,s&&this.emit("error",s),this.emit("close"),a()}))}_setupData(s){if(!s.channel)return this.destroy(r(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=s.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=g),this.channelName=this._channel.label,this._channel.onmessage=u=>{this._onChannelMessage(u)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=u=>{const x=u.error instanceof Error?u.error:new Error(`Datachannel error: ${u.message} ${u.filename}:${u.lineno}:${u.colno}`);this.destroy(r(x,"ERR_DATA_CHANNEL"))};let a=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(a&&this._onChannelClose(),a=!0):a=!1},5e3)}_read(){}_write(s,a,u){if(this.destroyed)return u(r(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(s)}catch(x){return this.destroy(r(x,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>g?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=u):u(null)}else this._debug("write before connect"),this._chunk=s,this._cb=u}_onFinish(){if(this.destroyed)return;const s=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?s():this.once("connect",s)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(s=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(s.sdp=b(s.sdp)),s.sdp=this.sdpTransform(s.sdp);const a=()=>{if(this.destroyed)return;const u=this._pc.localDescription||s;this._debug("signal"),this.emit("signal",{type:u.type,sdp:u.sdp})};this._pc.setLocalDescription(s).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?a():this.once("_iceComplete",a))}).catch(u=>{this.destroy(r(u,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(s=>{this.destroy(r(s,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(s=>{s.mid||!s.sender.track||s.requested||(s.requested=!0,this.addTransceiver(s.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(s=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(s.sdp=b(s.sdp)),s.sdp=this.sdpTransform(s.sdp);const a=()=>{if(this.destroyed)return;const u=this._pc.localDescription||s;this._debug("signal"),this.emit("signal",{type:u.type,sdp:u.sdp}),this.initiator||this._requestMissingTransceivers()};this._pc.setLocalDescription(s).then(()=>{this.destroyed||(this.trickle||this._iceComplete?a():this.once("_iceComplete",a))}).catch(u=>{this.destroy(r(u,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(s=>{this.destroy(r(s,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(r(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const s=this._pc.iceConnectionState,a=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",s,a),this.emit("iceStateChange",s,a),s!=="connected"&&s!=="completed"||(this._pcReady=!0,this._maybeReady()),s==="failed"&&this.destroy(r(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),s==="closed"&&this.destroy(r(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(s){const a=u=>(Object.prototype.toString.call(u.values)==="[object Array]"&&u.values.forEach(x=>{Object.assign(u,x)}),u);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(u=>{const x=[];u.forEach(S=>{x.push(a(S))}),s(null,x)},u=>s(u)):this._pc.getStats.length>0?this._pc.getStats(u=>{if(this.destroyed)return;const x=[];u.result().forEach(S=>{const C={};S.names().forEach(H=>{C[H]=S.stat(H)}),C.id=S.id,C.type=S.type,C.timestamp=S.timestamp,x.push(a(C))}),s(null,x)},u=>s(u)):s(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const s=()=>{this.destroyed||this.getStats((a,u)=>{if(this.destroyed)return;a&&(u=[]);const x={},S={},C={};let H=!1;u.forEach(D=>{D.type!=="remotecandidate"&&D.type!=="remote-candidate"||(x[D.id]=D),D.type!=="localcandidate"&&D.type!=="local-candidate"||(S[D.id]=D),D.type!=="candidatepair"&&D.type!=="candidate-pair"||(C[D.id]=D)});const U=D=>{H=!0;let W=S[D.localCandidateId];W&&(W.ip||W.address)?(this.localAddress=W.ip||W.address,this.localPort=Number(W.port)):W&&W.ipAddress?(this.localAddress=W.ipAddress,this.localPort=Number(W.portNumber)):typeof D.googLocalAddress=="string"&&(W=D.googLocalAddress.split(":"),this.localAddress=W[0],this.localPort=Number(W[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let $=x[D.remoteCandidateId];$&&($.ip||$.address)?(this.remoteAddress=$.ip||$.address,this.remotePort=Number($.port)):$&&$.ipAddress?(this.remoteAddress=$.ipAddress,this.remotePort=Number($.portNumber)):typeof D.googRemoteAddress=="string"&&($=D.googRemoteAddress.split(":"),this.remoteAddress=$[0],this.remotePort=Number($[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(u.forEach(D=>{D.type==="transport"&&D.selectedCandidatePairId&&U(C[D.selectedCandidatePairId]),(D.type==="googCandidatePair"&&D.googActiveConnection==="true"||(D.type==="candidatepair"||D.type==="candidate-pair")&&D.selected)&&U(D)}),H||Object.keys(C).length&&!Object.keys(S).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(W){return this.destroy(r(W,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const D=this._cb;this._cb=null,D(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(s,100)})};s()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>g||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(s=>{this._pc.removeTrack(s),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(s){this.destroyed||(s.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:s.candidate.candidate,sdpMLineIndex:s.candidate.sdpMLineIndex,sdpMid:s.candidate.sdpMid}}):s.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),s.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(s){if(this.destroyed)return;let a=s.data;a instanceof ArrayBuffer&&(a=d.from(a)),this.push(a)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const s=this._cb;this._cb=null,s(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(s){this.destroyed||s.streams.forEach(a=>{this._debug("on track"),this.emit("track",s.track,a),this._remoteTracks.push({track:s.track,stream:a}),this._remoteStreams.some(u=>u.id===a.id)||(this._remoteStreams.push(a),i(()=>{this._debug("on stream"),this.emit("stream",a)}))})}_debug(){const s=[].slice.call(arguments);s[0]="["+this._id+"] "+s[0],k.apply(null,s)}}h.WEBRTC_SUPPORT=!!f(),h.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},h.channelConfig={},N.exports=h},522:(N,R,y)=>{var k=y(8764).Buffer;const f=y(1227)("simple-websocket"),m=y(1798),c=y(8473),i=y(4375),r=y(3719),d=typeof r!="function"?WebSocket:r;class g extends c.Duplex{constructor(h={}){if(typeof h=="string"&&(h={url:h}),super(h=Object.assign({allowHalfOpen:!1},h)),h.url==null&&h.socket==null)throw new Error("Missing required `url` or `socket` option");if(h.url!=null&&h.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=m(4).toString("hex").slice(0,7),this._debug("new websocket: %o",h),this.connected=!1,this.destroyed=!1,this._chunk=null,this._cb=null,this._interval=null,h.socket)this.url=h.socket.url,this._ws=h.socket,this.connected=h.socket.readyState===d.OPEN;else{this.url=h.url;try{this._ws=typeof r=="function"?new d(h.url,null,{...h,encoding:void 0}):new d(h.url)}catch(w){return void i(()=>this.destroy(w))}}this._ws.binaryType="arraybuffer",h.socket&&this.connected?i(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=w=>this._handleMessage(w),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=w=>this._handleError(w),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(h){this._ws.send(h)}destroy(h){this._destroy(h,()=>{})}_destroy(h,w){if(!this.destroyed){if(this._debug("destroy (error: %s)",h&&(h.message||h)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){const s=this._ws,a=()=>{s.onclose=null};if(s.readyState===d.CLOSED)a();else try{s.onclose=a,s.close()}catch{a()}s.onopen=null,s.onmessage=null,s.onerror=()=>{}}this._ws=null,h&&this.emit("error",h),this.emit("close"),w()}}_read(){}_write(h,w,s){if(this.destroyed)return s(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(h)}catch(a){return this.destroy(a)}typeof r!="function"&&this._ws.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=h,this._cb=s}_handleOpen(){if(!this.connected&&!this.destroyed){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(w){return this.destroy(w)}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof r!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(h){if(this.destroyed)return;let w=h.data;w instanceof ArrayBuffer&&(w=k.from(w)),this.push(w)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(h){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;const h=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?h():this.once("connect",h)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>65536)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);const h=this._cb;this._cb=null,h(null)}_debug(){const h=[].slice.call(arguments);h[0]="["+this._id+"] "+h[0],f.apply(null,h)}}g.WEBSOCKET_SUPPORT=!!d,N.exports=g},558:(N,R,y)=>{const k=y(7768),f=y(9929);N.exports={Throttle:k,ThrottleGroup:f}},9929:(N,R,y)=>{const{TokenBucket:k}=y(5516),f=y(7768);N.exports=class{constructor(m={}){if(typeof m!="object")throw new Error("Options must be an object");this.throttles=[],this.setEnabled(m.enabled),this.setRate(m.rate,m.chunksize)}getEnabled(){return this._enabled}getRate(){return this.bucket.tokensPerInterval}getChunksize(){return this.chunksize}setEnabled(m=!0){if(typeof m!="boolean")throw new Error("Enabled must be a boolean");this._enabled=m;for(const c of this.throttles)c.setEnabled(m)}setRate(m,c=null){if(!Number.isInteger(m)||m<0)throw new Error("Rate must be an integer bigger than zero");if(m=parseInt(m),c&&(typeof c!="number"||c<=0))throw new Error("Chunksize must be bigger than zero");if(c=c||Math.max(parseInt(m/10),1),c=parseInt(c),m>0&&c>m)throw new Error("Chunk size must be smaller than rate");this.bucket||(this.bucket=new k(m,m,"second",null)),this.bucket.bucketSize=m,this.bucket.tokensPerInterval=m,this.chunksize=c}setChunksize(m){if(!Number.isInteger(m)||m<=0)throw new Error("Chunk size must be an integer bigger than zero");const c=this.getRate();if(m=parseInt(m),c>0&&m>c)throw new Error("Chunk size must be smaller than rate");this.chunksize=m}throttle(m={}){if(typeof m!="object")throw new Error("Options must be an object");return new f({...m,group:this})}destroy(){for(const m of this.throttles)m.destroy();this.throttles=[]}_addThrottle(m){if(!(m instanceof f))throw new Error("Throttle must be an instance of Throttle");this.throttles.push(m)}_removeThrottle(m){const c=this.throttles.indexOf(m);c>-1&&this.throttles.splice(c,1)}}},7768:(N,R,y)=>{const{EventEmitter:k}=y(7187),{Transform:f}=y(1237),{wait:m}=y(5324);N.exports=class extends f{constructor(i={}){if(super(),typeof i!="object")throw new Error("Options must be an object");const r=Object.assign({},i);if(r.group&&!(r.group instanceof c))throw new Error("Group must be an instanece of ThrottleGroup");r.group||(r.group=new c(r)),this._setEnabled(r.enabled||r.group.enabled),this._group=r.group,this._emitter=new k,this._destroyed=!1,this._group._addThrottle(this)}getEnabled(){return this._enabled}getGroup(){return this._group}_setEnabled(i=!0){if(typeof i!="boolean")throw new Error("Enabled must be a boolean");this._enabled=i}setEnabled(i){this._setEnabled(i),this._enabled?this._emitter.emit("enabled"):this._emitter.emit("disabled")}_transform(i,r){this._processChunk(i,r)}async _waitForTokens(i){return new Promise((r,d)=>{let g=!1;const b=this;function h(w){if(b._emitter.removeListener("disabled",h),b._emitter.removeListener("destroyed",h),!g){if(g=!0,w)return d(w);r()}}this._emitter.once("disabled",h),this._emitter.once("destroyed",h),this._group.bucket.removeTokens(i,h)})}_areBothEnabled(){return this._enabled&&this._group.getEnabled()}async _processChunk(i,r){if(!this._areBothEnabled())return r(null,i);let d=0,g=this._group.getChunksize(),b=i.slice(d,d+g);for(;b.length>0;){if(this._areBothEnabled())try{for(;this._group.getRate()===0&&!this._destroyed&&this._areBothEnabled();)if(await m(1e3),this._destroyed)return;if(this._areBothEnabled()&&!this._group.bucket.tryRemoveTokens(b.length)&&(await this._waitForTokens(b.length),this._destroyed))return}catch(h){return r(h)}this.push(b),d+=g,g=this._areBothEnabled()?this._group.getChunksize():i.length-d,b=i.slice(d,d+g)}return r()}destroy(...i){this._group._removeThrottle(this),this._destroyed=!0,this._emitter.emit("destroyed"),super.destroy(...i)}};const c=y(9929)},5324:N=>{N.exports={wait:function(R){return new Promise(y=>setTimeout(y,R))}}},1237:(N,R,y)=>{const{EventEmitter:k}=y(7187),f=new Error("Stream was destroyed"),m=new Error("Premature close"),c=y(3527),i=y(1607),r=67108863,d=4,g=8,b=1^r,h=16,w=128,s=256,a=1024,u=2048,x=4096,S=8192,C=16384,H=32784,U=65536,D=768^r,W=1<<17,$=2<<17,G=4<<17,tt=8<<17,nt=16<<17,lt=32<<17,ct=64<<17,gt=129<<17,mt=256<<17,V=66977791,v=66846719,A=131088,q=66977775,Y=C|lt,Q=d|g|2,st=1|Q,ut=Q|Y,_t=16941072,Tt=16809984|st,B=st|a|C,T=st|C|w,J=st|a|w,ht=st|x|w|S,vt=st|h|a|C|U,Ct=Q|a|C,dt=st|mt|lt,At=1179648,Et=3145728|st|W,Mt=st|W|tt,Bt=st|mt|At|lt,zt=nt|Q|mt|lt,n=Symbol.asyncIterator||Symbol("asyncIterator");class l{constructor(E,{highWaterMark:rt=16384,map:bt=null,mapWritable:xt,byteLength:Lt,byteLengthWritable:Pt}={}){this.stream=E,this.queue=new i,this.highWaterMark=rt,this.buffered=0,this.error=null,this.pipeline=null,this.byteLength=Pt||Lt||le,this.map=xt||bt,this.afterWrite=wt.bind(this),this.afterUpdateNextTick=Rt.bind(this)}get ended(){return(this.stream._duplexState&lt)!=0}push(E){return this.map!==null&&(E=this.map(E)),this.buffered+=this.byteLength(E),this.queue.push(E),this.buffered<this.highWaterMark?(this.stream._duplexState|=tt,!0):(this.stream._duplexState|=3145728,!1)}shift(){const E=this.queue.shift(),rt=this.stream;return this.buffered-=this.byteLength(E),this.buffered===0&&(rt._duplexState&=66060287),E}end(E){typeof E=="function"?this.stream.once("finish",E):E!=null&&this.push(E),this.stream._duplexState=(this.stream._duplexState|mt)&v}autoBatch(E,rt){const bt=[],xt=this.stream;for(bt.push(E);(xt._duplexState&Mt)===At;)bt.push(xt._writableState.shift());if(xt._duplexState&st)return rt(null);xt._writev(bt,rt)}update(){const E=this.stream;for(;(E._duplexState&Mt)===tt;){const rt=this.shift();E._duplexState|=655360,E._write(rt,this.afterWrite),E._duplexState&=66584575}!(393216&E._duplexState)&&this.updateNonPrimary()}updateNonPrimary(){const E=this.stream;if((E._duplexState&Bt)===mt)return E._duplexState=33554431&(E._duplexState|W),void E._final(X.bind(this));(E._duplexState&Q)!==d?(E._duplexState&Tt)==1&&(E._duplexState=(E._duplexState|A)&b,E._open(ee.bind(this))):!(E._duplexState&_t)&&(E._duplexState|=A,E._destroy(pt.bind(this)))}updateNextTick(){!(this.stream._duplexState&gt)&&(this.stream._duplexState|=gt,c(this.afterUpdateNextTick))}}class p{constructor(E,{highWaterMark:rt=16384,map:bt=null,mapReadable:xt,byteLength:Lt,byteLengthReadable:Pt}={}){this.stream=E,this.queue=new i,this.highWaterMark=rt,this.buffered=0,this.error=null,this.pipeline=null,this.byteLength=Pt||Lt||le,this.map=xt||bt,this.pipeTo=null,this.afterRead=kt.bind(this),this.afterUpdateNextTick=yt.bind(this)}get ended(){return(this.stream._duplexState&C)!=0}pipe(E,rt){if(this.pipeTo!==null)throw new Error("Can only pipe to one destination");if(typeof rt!="function"&&(rt=null),this.stream._duplexState|=512,this.pipeTo=E,this.pipeline=new F(this.stream,E,rt),rt&&this.stream.on("error",ce),Yt(E))E._writableState.pipeline=this.pipeline,rt&&E.on("error",ce),E.on("finish",this.pipeline.finished.bind(this.pipeline));else{const bt=this.pipeline.done.bind(this.pipeline,E),xt=this.pipeline.done.bind(this.pipeline,E,null);E.on("error",bt),E.on("close",xt),E.on("finish",this.pipeline.finished.bind(this.pipeline))}E.on("drain",z.bind(this)),this.stream.emit("piping",E),E.emit("pipe",this.stream)}push(E){const rt=this.stream;return E===null?(this.highWaterMark=0,rt._duplexState=67043295&(rt._duplexState|a),!1):(this.map!==null&&(E=this.map(E)),this.buffered+=this.byteLength(E),this.queue.push(E),rt._duplexState=67043327&(rt._duplexState|w),this.buffered<this.highWaterMark)}shift(){const E=this.queue.shift();return this.buffered-=this.byteLength(E),this.buffered===0&&(this.stream._duplexState&=67100543),E}unshift(E){let rt;const bt=[];for(;(rt=this.queue.shift())!==void 0;)bt.push(rt);this.push(E);for(let xt=0;xt<bt.length;xt++)this.queue.push(bt[xt])}read(){const E=this.stream;if((E._duplexState&T)===w){const rt=this.shift();return this.pipeTo!==null&&this.pipeTo.write(rt)===!1&&(E._duplexState&=D),E._duplexState&u&&E.emit("data",rt),rt}return null}drain(){const E=this.stream;for(;(E._duplexState&T)===w&&768&E._duplexState;){const rt=this.shift();this.pipeTo!==null&&this.pipeTo.write(rt)===!1&&(E._duplexState&=D),E._duplexState&u&&E.emit("data",rt)}}update(){const E=this.stream;for(this.drain();this.buffered<this.highWaterMark&&!(E._duplexState&vt);)E._duplexState|=65616,E._read(this.afterRead),E._duplexState&=67108799,!(E._duplexState&h)&&this.drain();(E._duplexState&ht)==4224&&(E._duplexState|=S,E.emit("readable")),!(48&E._duplexState)&&this.updateNonPrimary()}updateNonPrimary(){const E=this.stream;(E._duplexState&J)===a&&(E._duplexState=67107839&(E._duplexState|C),E.emit("end"),(E._duplexState&ut)===Y&&(E._duplexState|=d),this.pipeTo!==null&&this.pipeTo.end()),(E._duplexState&Q)!==d?(E._duplexState&Tt)==1&&(E._duplexState=(E._duplexState|A)&b,E._open(ee.bind(this))):!(E._duplexState&_t)&&(E._duplexState|=A,E._destroy(pt.bind(this)))}updateNextTick(){!(this.stream._duplexState&H)&&(this.stream._duplexState|=H,c(this.afterUpdateNextTick))}}class L{constructor(E){this.data=null,this.afterTransform=pe.bind(E),this.afterFinal=null}}class F{constructor(E,rt,bt){this.from=E,this.to=rt,this.afterPipe=bt,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(E,rt){rt&&(this.error=rt),E!==this.to||(this.to=null,this.from===null)?E!==this.from||(this.from=null,this.to===null)?(this.afterPipe!==null&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):!(E._duplexState&C)&&this.to.destroy(this.error||new Error("Readable stream closed before ending")):this.from._duplexState&C&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}function z(){this.stream._duplexState|=512,80&this.stream._duplexState?this.drain():this.updateNextTick()}function X(at){const E=this.stream;at&&E.destroy(at),!(E._duplexState&Q)&&(E._duplexState|=lt,E.emit("finish")),(E._duplexState&ut)===Y&&(E._duplexState|=d),E._duplexState&=V,this.update()}function pt(at){const E=this.stream;at||this.error===f||(at=this.error),at&&E.emit("error",at),E._duplexState|=g,E.emit("close");const rt=E._readableState,bt=E._writableState;rt!==null&&rt.pipeline!==null&&rt.pipeline.done(E,at),bt!==null&&bt.pipeline!==null&&bt.pipeline.done(E,at)}function wt(at){const E=this.stream;at&&E.destroy(at),E._duplexState&=V,(E._duplexState&Et)===nt&&(E._duplexState&=65011711,(E._duplexState&ct)===ct&&E.emit("drain")),!(E._duplexState&G)&&this.update()}function kt(at){at&&this.stream.destroy(at),this.stream._duplexState&=67108847,!(64&this.stream._duplexState)&&this.update()}function yt(){this.stream._duplexState&=67076079,this.update()}function Rt(){this.stream._duplexState&=50200575,this.update()}function ee(at){const E=this.stream;at&&E.destroy(at),!(E._duplexState&d)&&(!(E._duplexState&B)&&(E._duplexState|=32),!(E._duplexState&dt)&&(E._duplexState|=$),E.emit("open")),E._duplexState&=q,E._writableState!==null&&E._writableState.update(),E._readableState!==null&&E._readableState.update()}function pe(at,E){E!=null&&this.push(E),this._writableState.afterWrite(at)}class re extends k{constructor(E){super(),this._duplexState=0,this._readableState=null,this._writableState=null,E&&(E.open&&(this._open=E.open),E.destroy&&(this._destroy=E.destroy),E.predestroy&&(this._predestroy=E.predestroy),E.signal&&E.signal.addEventListener("abort",Zt.bind(this)))}_open(E){E(null)}_destroy(E){E(null)}_predestroy(){}get readable(){return this._readableState!==null||void 0}get writable(){return this._writableState!==null||void 0}get destroyed(){return(this._duplexState&g)!=0}get destroying(){return(this._duplexState&Q)!=0}destroy(E){!(this._duplexState&Q)&&(E||(E=f),this._duplexState=66846687&(this._duplexState|d),this._readableState!==null&&(this._readableState.error=E),this._writableState!==null&&(this._writableState.error=E),this._duplexState|=2,this._predestroy(),this._duplexState&=67108861,this._readableState!==null&&this._readableState.updateNextTick(),this._writableState!==null&&this._writableState.updateNextTick())}on(E,rt){return this._readableState!==null&&(E==="data"&&(this._duplexState|=2304,this._readableState.updateNextTick()),E==="readable"&&(this._duplexState|=x,this._readableState.updateNextTick())),this._writableState!==null&&E==="drain"&&(this._duplexState|=ct,this._writableState.updateNextTick()),super.on(E,rt)}}class Ft extends re{constructor(E){super(E),this._duplexState|=1|lt,this._readableState=new p(this,E),E&&(E.read&&(this._read=E.read),E.eagerOpen&&this.resume().pause())}_read(E){E(null)}pipe(E,rt){return this._readableState.pipe(E,rt),this._readableState.updateNextTick(),E}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(E){return this._readableState.updateNextTick(),this._readableState.push(E)}unshift(E){return this._readableState.updateNextTick(),this._readableState.unshift(E)}resume(){return this._duplexState|=s,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=67108607,this}static _fromAsyncIterator(E,rt){let bt;const xt=new Ft({...rt,read(Pt){E.next().then(Lt).then(Pt.bind(null,null)).catch(Pt)},predestroy(){bt=E.return()},destroy(Pt){if(!bt)return Pt(null);bt.then(Pt.bind(null,null)).catch(Pt)}});return xt;function Lt(Pt){Pt.done?xt.push(null):xt.push(Pt.value)}}static from(E,rt){if(Yt(bt=E)&&bt.readable)return E;var bt;if(E[n])return this._fromAsyncIterator(E[n](),rt);Array.isArray(E)||(E=E===void 0?[]:[E]);let xt=0;return new Ft({...rt,read(Lt){this.push(xt===E.length?null:E[xt++]),Lt(null)}})}static isBackpressured(E){return(E._duplexState&Ct)!=0||E._readableState.buffered>=E._readableState.highWaterMark}static isPaused(E){return(E._duplexState&s)==0}[n](){const E=this;let rt=null,bt=null,xt=null;return this.on("error",Nt=>{rt=Nt}),this.on("readable",function(){bt!==null&&Lt(E.read())}),this.on("close",function(){bt!==null&&Lt(null)}),{[n](){return this},next:()=>new Promise(function(Nt,$t){bt=Nt,xt=$t;const It=E.read();It!==null?Lt(It):E._duplexState&g&&Lt(null)}),return:()=>Pt(null),throw:Nt=>Pt(Nt)};function Lt(Nt){xt!==null&&(rt?xt(rt):Nt===null&&!(E._duplexState&C)?xt(f):bt({value:Nt,done:Nt===null}),xt=bt=null)}function Pt(Nt){return E.destroy(Nt),new Promise(($t,It)=>{if(E._duplexState&g)return $t({value:void 0,done:!0});E.once("close",function(){Nt?It(Nt):$t({value:void 0,done:!0})})})}}}class qt extends Ft{constructor(E){super(E),this._duplexState=1,this._writableState=new l(this,E),E&&(E.writev&&(this._writev=E.writev),E.write&&(this._write=E.write),E.final&&(this._final=E.final))}_writev(E,rt){rt(null)}_write(E,rt){this._writableState.autoBatch(E,rt)}_final(E){E(null)}write(E){return this._writableState.updateNextTick(),this._writableState.push(E)}end(E){return this._writableState.updateNextTick(),this._writableState.end(E),this}}class Xt extends qt{constructor(E){super(E),this._transformState=new L(this),E&&(E.transform&&(this._transform=E.transform),E.flush&&(this._flush=E.flush))}_write(E,rt){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=E:this._transform(E,this._transformState.afterTransform)}_read(E){if(this._transformState.data!==null){const rt=this._transformState.data;this._transformState.data=null,E(null),this._transform(rt,this._transformState.afterTransform)}else E(null)}_transform(E,rt){rt(null,E)}_flush(E){E(null)}_final(E){this._transformState.afterFinal=E,this._flush(ge.bind(this))}}function ge(at,E){const rt=this._transformState.afterFinal;if(at)return rt(at);E!=null&&this.push(E),this.push(null),rt(null)}function ne(at,...E){const rt=Array.isArray(at)?[...at,...E]:[at,...E],bt=rt.length&&typeof rt[rt.length-1]=="function"?rt.pop():null;if(rt.length<2)throw new Error("Pipeline requires at least 2 streams");let xt=rt[0],Lt=null,Pt=null;for(let It=1;It<rt.length;It++)Lt=rt[It],Yt(xt)?xt.pipe(Lt,$t):(Nt(xt,!0,It>1,$t),xt.pipe(Lt)),xt=Lt;if(bt){let It=!1;Lt.on("finish",()=>{It=!0}),Lt.on("error",Dt=>{Pt=Pt||Dt}),Lt.on("close",()=>bt(Pt||(It?null:m)))}return Lt;function Nt(It,Dt,me,ie){It.on("error",ie),It.on("close",function(){if(Dt&&It._readableState&&!It._readableState.ended||me&&It._writableState&&!It._writableState.ended)return ie(m)})}function $t(It){if(It&&!Pt){Pt=It;for(const Dt of rt)Dt.destroy(It)}}}function he(at){return!!at._readableState||!!at._writableState}function Yt(at){return typeof at._duplexState=="number"&&he(at)}function le(at){return function(E){return typeof E=="object"&&E!==null&&typeof E.byteLength=="number"}(at)?at.byteLength:1024}function ce(){}function Zt(){this.destroy(new Error("Stream aborted."))}N.exports={pipeline:ne,pipelinePromise:function(...at){return new Promise((E,rt)=>ne(...at,bt=>{if(bt)return rt(bt);E()}))},isStream:he,isStreamx:Yt,getStreamError:function(at){return at._readableState&&at._readableState.error||at._writableState&&at._writableState.error},Stream:re,Writable:class extends re{constructor(at){super(at),this._duplexState|=16385,this._writableState=new l(this,at),at&&(at.writev&&(this._writev=at.writev),at.write&&(this._write=at.write),at.final&&(this._final=at.final))}_writev(at,E){E(null)}_write(at,E){this._writableState.autoBatch(at,E)}_final(at){at(null)}static isBackpressured(at){return(at._duplexState&zt)!=0}write(at){return this._writableState.updateNextTick(),this._writableState.push(at)}end(at){return this._writableState.updateNextTick(),this._writableState.end(at),this}},Readable:Ft,Duplex:qt,Transform:Xt,PassThrough:class extends Xt{}}},2553:(N,R,y)=>{var k=y(9509).Buffer,f=k.isEncoding||function(s){switch((s=""+s)&&s.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function m(s){var a;switch(this.encoding=function(u){var x=function(S){if(!S)return"utf8";for(var C;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(C)return;S=(""+S).toLowerCase(),C=!0}}(u);if(typeof x!="string"&&(k.isEncoding===f||!f(u)))throw new Error("Unknown encoding: "+u);return x||u}(s),this.encoding){case"utf16le":this.text=r,this.end=d,a=4;break;case"utf8":this.fillLast=i,a=4;break;case"base64":this.text=g,this.end=b,a=3;break;default:return this.write=h,void(this.end=w)}this.lastNeed=0,this.lastTotal=0,this.lastChar=k.allocUnsafe(a)}function c(s){return s<=127?0:s>>5==6?2:s>>4==14?3:s>>3==30?4:s>>6==2?-1:-2}function i(s){var a=this.lastTotal-this.lastNeed,u=function(x,S,C){if((192&S[0])!=128)return x.lastNeed=0,"�";if(x.lastNeed>1&&S.length>1){if((192&S[1])!=128)return x.lastNeed=1,"�";if(x.lastNeed>2&&S.length>2&&(192&S[2])!=128)return x.lastNeed=2,"�"}}(this,s);return u!==void 0?u:this.lastNeed<=s.length?(s.copy(this.lastChar,a,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(s.copy(this.lastChar,a,0,s.length),void(this.lastNeed-=s.length))}function r(s,a){if((s.length-a)%2==0){var u=s.toString("utf16le",a);if(u){var x=u.charCodeAt(u.length-1);if(x>=55296&&x<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=s[s.length-2],this.lastChar[1]=s[s.length-1],u.slice(0,-1)}return u}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=s[s.length-1],s.toString("utf16le",a,s.length-1)}function d(s){var a=s&&s.length?this.write(s):"";if(this.lastNeed){var u=this.lastTotal-this.lastNeed;return a+this.lastChar.toString("utf16le",0,u)}return a}function g(s,a){var u=(s.length-a)%3;return u===0?s.toString("base64",a):(this.lastNeed=3-u,this.lastTotal=3,u===1?this.lastChar[0]=s[s.length-1]:(this.lastChar[0]=s[s.length-2],this.lastChar[1]=s[s.length-1]),s.toString("base64",a,s.length-u))}function b(s){var a=s&&s.length?this.write(s):"";return this.lastNeed?a+this.lastChar.toString("base64",0,3-this.lastNeed):a}function h(s){return s.toString(this.encoding)}function w(s){return s&&s.length?this.write(s):""}R.s=m,m.prototype.write=function(s){if(s.length===0)return"";var a,u;if(this.lastNeed){if((a=this.fillLast(s))===void 0)return"";u=this.lastNeed,this.lastNeed=0}else u=0;return u<s.length?a?a+this.text(s,u):this.text(s,u):a||""},m.prototype.end=function(s){var a=s&&s.length?this.write(s):"";return this.lastNeed?a+"�":a},m.prototype.text=function(s,a){var u=function(S,C,H){var U=C.length-1;if(U<H)return 0;var D=c(C[U]);return D>=0?(D>0&&(S.lastNeed=D-1),D):--U<H||D===-2?0:(D=c(C[U]),D>=0?(D>0&&(S.lastNeed=D-2),D):--U<H||D===-2?0:(D=c(C[U]),D>=0?(D>0&&(D===2?D=0:S.lastNeed=D-3),D):0))}(this,s,a);if(!this.lastNeed)return s.toString("utf8",a);this.lastTotal=u;var x=s.length-(u-this.lastNeed);return s.copy(this.lastChar,0,x),s.toString("utf8",a,x)},m.prototype.fillLast=function(s){if(this.lastNeed<=s.length)return s.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);s.copy(this.lastChar,this.lastTotal-this.lastNeed,0,s.length),this.lastNeed-=s.length}},5017:(N,R,y)=>{var k=y(883);R.encode=k.encode,R.decode=k.decode},883:(N,R,y)=>{var k=y(8764).Buffer,f=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];R.encode=function(m){k.isBuffer(m)||(m=new k(m));for(var c,i,r=0,d=0,g=0,b=0,h=new k(8*(c=m,i=Math.floor(c.length/5),c.length%5==0?i:i+1));r<m.length;){var w=m[r];g>3?(b=(b=w&255>>g)<<(g=(g+5)%8)|(r+1<m.length?m[r+1]:0)>>8-g,r++):(b=w>>8-(g+5)&31,(g=(g+5)%8)===0&&r++),h[d]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(b),d++}for(r=d;r<h.length;r++)h[r]=61;return h},R.decode=function(m){var c,i=0,r=0,d=0;k.isBuffer(m)||(m=new k(m));for(var g=new k(Math.ceil(5*m.length/8)),b=0;b<m.length&&m[b]!==61;b++){var h=m[b]-48;if(!(h<f.length))throw new Error("Invalid input - it is not base32 encoded string");r=f[h],i<=3?(i=(i+5)%8)===0?(c|=r,g[d]=c,d++,c=0):c|=255&r<<8-i:(c|=255&r>>>(i=(i+5)%8),g[d]=c,d++,c=255&r<<8-i)}return g.slice(0,d)}},1463:N=>{function R(y){return(+Date.now()-y)/100&65535}N.exports=function(y){const k=+Date.now(),f=10*(y||5),m=[0];let c=1,i=R(k)-1&65535;return function(r){const d=R(k);let g=d-i&65535;for(g>f&&(g=f),i=d;g--;)c===f&&(c=0),m[c]=m[c===0?f-1:c-1],c++;r&&(m[c-1]+=r);const b=m[c-1],h=m.length<f?0:m[c===f?0:c];return m.length<10?b:10*(b-h)/m.length}}},8687:(N,R,y)=>{var k=y(8764).Buffer;const f=16384;class m{constructor(i){this.length=i,this.missing=i,this.sources=null,this._chunks=Math.ceil(i/f),this._remainder=i%f||f,this._buffered=0,this._buffer=null,this._cancellations=null,this._reservations=0,this._flushed=!1}chunkLength(i){return i===this._chunks-1?this._remainder:f}chunkLengthRemaining(i){return this.length-i*f}chunkOffset(i){return i*f}reserve(){return this.init()?this._cancellations.length?this._cancellations.pop():this._reservations<this._chunks?this._reservations++:-1:-1}reserveRemaining(){if(!this.init())return-1;if(this._cancellations.length||this._reservations<this._chunks){let i=this._reservations;for(;this._cancellations.length;)i=Math.min(i,this._cancellations.pop());return this._reservations=this._chunks,i}return-1}cancel(i){this.init()&&this._cancellations.push(i)}cancelRemaining(i){this.init()&&(this._reservations=i)}get(i){return this.init()?this._buffer[i]:null}set(i,r,d){if(!this.init())return!1;const g=r.length,b=Math.ceil(g/f);for(let h=0;h<b;h++)if(!this._buffer[i+h]){const w=h*f,s=r.slice(w,w+f);this._buffered++,this._buffer[i+h]=s,this.missing-=s.length,this.sources.includes(d)||this.sources.push(d)}return this._buffered===this._chunks}flush(){if(!this._buffer||this._chunks!==this._buffered)return null;const i=k.concat(this._buffer,this.length);return this._buffer=null,this._cancellations=null,this.sources=null,this._flushed=!0,i}init(){return!this._flushed&&(this._buffer||(this._buffer=new Array(this._chunks),this._cancellations=[],this.sources=[]),!0)}}Object.defineProperty(m,"BLOCK_LENGTH",{value:f}),N.exports=m},6581:N=>{N.exports=function(R,y){if(!(y>=R.length||y<0)){var k=R.pop();if(y<R.length){var f=R[y];return R[y]=k,f}return k}}},4927:N=>{function R(y){try{if(!globalThis.localStorage)return!1}catch{return!1}var k=globalThis.localStorage[y];return k!=null&&String(k).toLowerCase()==="true"}N.exports=function(y,k){if(R("noDeprecation"))return y;var f=!1;return function(){if(!f){if(R("throwDeprecation"))throw new Error(k);R("traceDeprecation")?console.trace(k):console.warn(k),f=!0}return y.apply(this,arguments)}}},2479:N=>{N.exports=function R(y,k){if(y&&k)return R(y)(k);if(typeof y!="function")throw new TypeError("need wrapper function");return Object.keys(y).forEach(function(m){f[m]=y[m]}),f;function f(){for(var m=new Array(arguments.length),c=0;c<m.length;c++)m[c]=arguments[c];var i=y.apply(this,m),r=m[m.length-1];return typeof i=="function"&&i!==r&&Object.keys(r).forEach(function(d){i[d]=r[d]}),i}}},6475:()=>{},2203:()=>{},3423:()=>{},1494:()=>{},5381:()=>{},8838:()=>{},5517:()=>{},9354:()=>{},8411:()=>{},1857:()=>{},159:()=>{},859:()=>{},2911:()=>{},970:()=>{},1982:()=>{},1156:()=>{},2361:()=>{},4616:()=>{},3719:()=>{},1018:()=>{},2067:()=>{},8302:()=>{},3552:()=>{},5843:()=>{},3287:(N,R,y)=>{y.r(R),y.d(R,{default:()=>u,enableSecure:()=>a});var k=y(7187),f=y(1237),m=y(6581),c=y(1227),i=y(814);const r="tcpIncoming",d="tcpOutgoing",g="utpIncoming",b="utpOutgoing",h="webSeed",w=c("webtorrent:peer");let s=!1;const a=()=>{s=!0};class u extends k{constructor(S,C){super(),this.id=S,this.type=C,w("new %s Peer %s",C,S),this.addr=null,this.conn=null,this.swarm=null,this.wire=null,this.source=null,this.connected=!1,this.destroyed=!1,this.timeout=null,this.retries=0,this.sentPe1=!1,this.sentPe2=!1,this.sentPe3=!1,this.sentPe4=!1,this.sentHandshake=!1}onConnect(){if(this.destroyed)return;this.connected=!0,w("Peer %s connected",this.id),clearTimeout(this.connectTimeout);const S=this.conn;S.once("end",()=>{this.destroy()}),S.once("close",()=>{this.destroy()}),S.once("finish",()=>{this.destroy()}),S.once("error",H=>{this.destroy(H)});const C=this.wire=new i.Z(this.type,this.retries,s);C.once("end",()=>{this.destroy()}),C.once("close",()=>{this.destroy()}),C.once("finish",()=>{this.destroy()}),C.once("error",H=>{this.destroy(H)}),C.once("pe1",()=>{this.onPe1()}),C.once("pe2",()=>{this.onPe2()}),C.once("pe3",()=>{this.onPe3()}),C.once("pe4",()=>{this.onPe4()}),C.once("handshake",(H,U)=>{this.onHandshake(H,U)}),this.startHandshakeTimeout(),this.setThrottlePipes(),this.swarm&&(this.type==="tcpOutgoing"?s&&this.retries===0&&!this.sentPe1?this.sendPe1():this.sentHandshake||this.handshake():this.type==="tcpIncoming"||this.sentHandshake||this.handshake())}sendPe1(){this.wire.sendPe1(),this.sentPe1=!0}onPe1(){this.sendPe2()}sendPe2(){this.wire.sendPe2(),this.sentPe2=!0}onPe2(){this.sendPe3()}sendPe3(){this.wire.sendPe3(this.swarm.infoHash),this.sentPe3=!0}onPe3(S){this.swarm&&(this.swarm.infoHashHash!==S&&this.destroy(new Error("unexpected crypto handshake info hash for this swarm")),this.sendPe4())}sendPe4(){this.wire.sendPe4(this.swarm.infoHash),this.sentPe4=!0}onPe4(){this.sentHandshake||this.handshake()}clearPipes(){this.conn.unpipe(),this.wire.unpipe()}setThrottlePipes(){const S=this;(0,f.pipeline)(this.conn,this.throttleGroups.down.throttle(),new f.Transform({transform(C,H){S.emit("download",C.length),S.destroyed||H(null,C)}}),this.wire,this.throttleGroups.up.throttle(),new f.Transform({transform(C,H){S.emit("upload",C.length),S.destroyed||H(null,C)}}),this.conn)}onHandshake(S,C){if(!this.swarm||this.destroyed)return;if(this.swarm.destroyed)return this.destroy(new Error("swarm already destroyed"));if(S!==this.swarm.infoHash)return this.destroy(new Error("unexpected handshake info hash for this swarm"));if(C===this.swarm.peerId)return this.destroy(new Error("refusing to connect to ourselves"));w("Peer %s got handshake %s",this.id,S),clearTimeout(this.handshakeTimeout),this.retries=0;let H=this.addr;!H&&this.conn.remoteAddress&&this.conn.remotePort&&(H=`${this.conn.remoteAddress}:${this.conn.remotePort}`),this.swarm._onWire(this.wire,H),this.swarm&&!this.swarm.destroyed&&(this.sentHandshake||this.handshake())}handshake(){const S={dht:!this.swarm.private&&!!this.swarm.client.dht,fast:!0};this.wire.handshake(this.swarm.infoHash,this.swarm.client.peerId,S),this.sentHandshake=!0}startConnectTimeout(){clearTimeout(this.connectTimeout);const S={webrtc:25e3,tcpOutgoing:5e3,utpOutgoing:5e3};this.connectTimeout=setTimeout(()=>{this.destroy(new Error("connect timeout"))},S[this.type]),this.connectTimeout.unref&&this.connectTimeout.unref()}startHandshakeTimeout(){clearTimeout(this.handshakeTimeout),this.handshakeTimeout=setTimeout(()=>{this.destroy(new Error("handshake timeout"))},25e3),this.handshakeTimeout.unref&&this.handshakeTimeout.unref()}destroy(S){if(this.destroyed)return;this.destroyed=!0,this.connected=!1,w("destroy %s %s (error: %s)",this.type,this.id,S&&(S.message||S)),clearTimeout(this.connectTimeout),clearTimeout(this.handshakeTimeout);const C=this.swarm,H=this.conn,U=this.wire;this.swarm=null,this.conn=null,this.wire=null,C&&U&&m(C.wires,C.wires.indexOf(U)),H&&(H.on("error",()=>{}),H.destroy()),U&&U.destroy(),C&&C.removePeer(this.id)}}u.TYPE_TCP_INCOMING=r,u.TYPE_TCP_OUTGOING=d,u.TYPE_UTP_INCOMING=g,u.TYPE_UTP_OUTGOING=b,u.TYPE_WEBRTC="webrtc",u.TYPE_WEBSEED=h,u.SOURCE_MANUAL="manual",u.SOURCE_TRACKER="tracker",u.SOURCE_DHT="dht",u.SOURCE_LSD="lsd",u.SOURCE_UT_PEX="ut_pex",u.createWebRTCPeer=(x,S,C)=>{const H=new u(x.id,"webrtc");if(H.conn=x,H.swarm=S,H.throttleGroups=C,H.conn.connected)H.onConnect();else{const U=()=>{H.conn.removeListener("connect",D),H.conn.removeListener("error",W)},D=()=>{U(),H.onConnect()},W=$=>{U(),H.destroy($)};H.conn.once("connect",D),H.conn.once("error",W),H.startConnectTimeout()}return H},u.createTCPIncomingPeer=(x,S)=>u._createIncomingPeer(x,r,S),u.createUTPIncomingPeer=(x,S)=>u._createIncomingPeer(x,g,S),u.createTCPOutgoingPeer=(x,S,C)=>u._createOutgoingPeer(x,S,d,C),u.createUTPOutgoingPeer=(x,S,C)=>u._createOutgoingPeer(x,S,b,C),u._createIncomingPeer=(x,S,C)=>{const H=`${x.remoteAddress}:${x.remotePort}`,U=new u(H,S);return U.conn=x,U.addr=H,U.throttleGroups=C,U.onConnect(),U},u._createOutgoingPeer=(x,S,C,H)=>{const U=new u(x,C);return U.addr=x,U.swarm=S,U.throttleGroups=H,U},u.createWebSeedPeer=(x,S,C,H)=>{const U=new u(S,h);return U.swarm=C,U.conn=x,U.throttleGroups=H,U.onConnect(),U}},502:(N,R,y)=>{y.d(R,{Z:()=>s});var k=y(5194);function f(a){const u=a<0?1:0;return a=Math.abs(Number(a||1)),Math.floor(Math.log10(a))+1+u}function m(a){return ArrayBuffer.isView(a)?"arraybufferview":Array.isArray(a)?"array":a instanceof Number?"number":a instanceof Boolean?"boolean":a instanceof Set?"set":a instanceof Map?"map":a instanceof String?"string":a instanceof ArrayBuffer?"arraybuffer":typeof a}function c(a,u,x){const S=[];let C=null;return c._encode(S,a),C=(0,k.zo)(S),c.bytes=C.length,ArrayBuffer.isView(u)?(u.set(C,x),u):C}c.bytes=-1,c._floatConversionDetected=!1,c._encode=function(a,u){if(u!=null)switch(m(u)){case"object":c.dict(a,u);break;case"map":c.dictMap(a,u);break;case"array":c.list(a,u);break;case"set":c.listSet(a,u);break;case"string":c.string(a,u);break;case"number":case"boolean":c.number(a,u);break;case"arraybufferview":c.buffer(a,new Uint8Array(u.buffer,u.byteOffset,u.byteLength));break;case"arraybuffer":c.buffer(a,new Uint8Array(u))}};const i=new Uint8Array([101]),r=new Uint8Array([100]),d=new Uint8Array([108]);c.buffer=function(a,u){a.push((0,k.gR)(u.length+":"),u)},c.string=function(a,u){a.push((0,k.gR)((0,k.gR)(u).byteLength+":"+u))},c.number=function(a,u){const S=(u/2147483648<<0)*2147483648+(u%2147483648<<0);a.push((0,k.gR)("i"+S+"e")),S===u||c._floatConversionDetected||(c._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+u+'":','Bencoding only defines support for integers, value was converted to "'+S+'"'),console.trace())},c.dict=function(a,u){a.push(r);let x,S=0;const C=Object.keys(u).sort(),H=C.length;for(;S<H;S++)x=C[S],u[x]!=null&&(c.string(a,x),c._encode(a,u[x]));a.push(i)},c.dictMap=function(a,u){a.push(r);const x=Array.from(u.keys()).sort();for(const S of x)u.get(S)!=null&&(ArrayBuffer.isView(S)?c._encode(a,S):c.string(a,String(S)),c._encode(a,u.get(S)));a.push(i)},c.list=function(a,u){let x=0;const S=u.length;for(a.push(d);x<S;x++)u[x]!=null&&c._encode(a,u[x]);a.push(i)},c.listSet=function(a,u){a.push(d);for(const x of u)x!=null&&c._encode(a,x);a.push(i)};const g=c;function b(a,u,x){let S=0,C=1;for(let H=u;H<x;H++){const U=a[H];if(U<58&&U>=48)S=10*S+(U-48);else if(H!==u||U!==43){if(H!==u||U!==45){if(U===46)break;throw new Error("not a number: buffer["+H+"] = "+U)}C=-1}}return S*C}function h(a,u,x,S){return a==null||a.length===0?null:(typeof u!="number"&&S==null&&(S=u,u=void 0),typeof x!="number"&&S==null&&(S=x,x=void 0),h.position=0,h.encoding=S||null,h.data=ArrayBuffer.isView(a)?new Uint8Array(a.slice(u,x)):(0,k.gR)(a),h.bytes=h.data.length,h.next())}h.bytes=0,h.position=0,h.data=null,h.encoding=null,h.next=function(){switch(h.data[h.position]){case 100:return h.dictionary();case 108:return h.list();case 105:return h.integer();default:return h.buffer()}},h.find=function(a){let u=h.position;const x=h.data.length,S=h.data;for(;u<x;){if(S[u]===a)return u;u++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(a)+'" [0x'+a.toString(16)+"]")},h.dictionary=function(){h.position++;const a={};for(;h.data[h.position]!==101;)a[(0,k.vV)(h.buffer())]=h.next();return h.position++,a},h.list=function(){h.position++;const a=[];for(;h.data[h.position]!==101;)a.push(h.next());return h.position++,a},h.integer=function(){const a=h.find(101),u=b(h.data,h.position+1,a);return h.position+=a+1-h.position,u},h.buffer=function(){let a=h.find(58);const u=b(h.data,h.position,a),x=++a+u;return h.position=x,h.encoding?(0,k.vV)(h.data.slice(a,x)):h.data.slice(a,x)};function w(a){if(a==null)return 0;const u=m(a);switch(u){case"arraybufferview":return function(x){const S=x.byteLength-x.byteOffset;return f(S)+1+S}(a);case"string":return function(x){const S=(0,k.gR)(x).byteLength;return f(S)+1+S}(a);case"array":case"set":return function(x){let S=2;for(const C of x)S+=w(C);return S}(a);case"number":return 1+f(Math.floor(a))+1;case"bigint":return 1+a.toString().length+1;case"object":return function(x){let S=2;const C=Object.keys(x);for(let H=0;H<C.length;H++){const U=(0,k.gR)(C[H]).byteLength;S+=f(U)+1+U,S+=w(x[C[H]])}return S}(a);case"map":return function(x){let S=2;for(const[C,H]of x){const U=(0,k.gR)(C).byteLength;S+=f(U)+1+U,S+=w(H)}return S}(a);default:throw new TypeError(`Unsupported value of type "${u}"`)}}const s={encode:g,decode:h,byteLength:w,encodingLength:w}},8205:(N,R,y)=>{function k(m){let c=m>>3;return m%8!=0&&c++,c}y.d(R,{Z:()=>f});class f{constructor(c=0,i){const r=i==null?void 0:i.grow;this.grow=r&&isFinite(r)&&k(r)||r||0,this.buffer=typeof c=="number"?new Uint8Array(k(c)):c}get(c){const i=c>>3;return i<this.buffer.length&&!!(this.buffer[i]&128>>c%8)}set(c,i=!0){const r=c>>3;if(i){if(this.buffer.length<r+1){const d=Math.max(r+1,Math.min(2*this.buffer.length,this.grow));if(d<=this.grow){const g=new Uint8Array(d);g.set(this.buffer),this.buffer=g}}this.buffer[r]|=128>>c%8}else r<this.buffer.length&&(this.buffer[r]&=~(128>>c%8))}forEach(c,i=0,r=8*this.buffer.length){for(let d=i,g=d>>3,b=128>>d%8,h=this.buffer[g];d<r;d++)c(!!(h&b),d),b=b===1?(h=this.buffer[++g],128):b>>1}}},814:(N,R,y)=>{y.d(R,{Z:()=>mt});var k=y(502),f=y(8205),m=y(5517),c=y(1227),i=y(1798),r=y(7830),d=y(8473),g=y(5194),b=y(1463),h=y(6581);const w=c("bittorrent-protocol"),s=(0,g.gR)("BitTorrent protocol"),a=new Uint8Array([0,0,0,0]),u=new Uint8Array([0,0,0,1,0]),x=new Uint8Array([0,0,0,1,1]),S=new Uint8Array([0,0,0,1,2]),C=new Uint8Array([0,0,0,1,3]),H=[0,0,0,0,0,0,0,0],U=[0,0,0,3,9,0,0],D=new Uint8Array([0,0,0,1,14]),W=new Uint8Array([0,0,0,1,15]),$=new Uint8Array([0,0,0,0,0,0,0,0]),G=new Uint8Array([0,0,1,2]),tt=new Uint8Array([0,0,0,2]);function nt(V,v){for(let A=V.length;A--;)V[A]^=v[A];return V}class lt{constructor(v,A,q,Y){this.piece=v,this.offset=A,this.length=q,this.callback=Y}}class ct{constructor(){this.buffer=new Uint8Array}get(v){return!0}set(v){}}class gt extends d.Duplex{constructor(v=null,A=0,q=!1){super(),this._debugId=(0,g.oc)(i(4)),this._debug("new wire"),this.peerId=null,this.peerIdBuffer=null,this.type=v,this.amChoking=!0,this.amInterested=!1,this.peerChoking=!0,this.peerInterested=!1,this.peerPieces=new f.Z(0,{grow:4e5}),this.extensions={},this.peerExtensions={},this.requests=[],this.peerRequests=[],this.extendedMapping={},this.peerExtendedMapping={},this.extendedHandshake={},this.peerExtendedHandshake={},this.hasFast=!1,this.allowedFastSet=[],this.peerAllowedFastSet=[],this._ext={},this._nextExt=1,this.uploaded=0,this.downloaded=0,this.uploadSpeed=b(),this.downloadSpeed=b(),this._keepAliveInterval=null,this._timeout=null,this._timeoutMs=0,this._timeoutExpiresAt=null,this.destroyed=!1,this._finished=!1,this._parserSize=0,this._parser=null,this._buffer=[],this._bufferSize=0,this._peEnabled=q,q?(this._dh=m.createDiffieHellman("ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a36210000000000090563","hex",2),this._myPubKey=this._dh.generateKeys("hex")):this._myPubKey=null,this._peerPubKey=null,this._sharedSecret=null,this._peerCryptoProvide=[],this._cryptoHandshakeDone=!1,this._cryptoSyncPattern=null,this._waitMaxBytes=null,this._encryptionMethod=null,this._encryptGenerator=null,this._decryptGenerator=null,this._setGenerators=!1,this.once("finish",()=>this._onFinish()),this.on("finish",this._onFinish),this._debug("type:",this.type),this.type==="tcpIncoming"&&this._peEnabled?this._determineHandshakeType():this.type==="tcpOutgoing"&&this._peEnabled&&A===0?this._parsePe2():this._parseHandshake(null)}setKeepAlive(v){this._debug("setKeepAlive %s",v),clearInterval(this._keepAliveInterval),v!==!1&&(this._keepAliveInterval=setInterval(()=>{this.keepAlive()},55e3))}setTimeout(v,A){this._debug("setTimeout ms=%d unref=%s",v,A),this._timeoutMs=v,this._timeoutUnref=!!A,this._resetTimeout(!0)}destroy(){if(!this.destroyed)return this.destroyed=!0,this._debug("destroy"),this.emit("close"),this.end(),this}end(...v){return this._debug("end"),this._onUninterested(),this._onChoke(),super.end(...v)}use(v){const A=v.prototype.name;if(!A)throw new Error('Extension class requires a "name" property on the prototype');this._debug("use extension.name=%s",A);const q=this._nextExt,Y=new v(this);function Q(){}typeof Y.onHandshake!="function"&&(Y.onHandshake=Q),typeof Y.onExtendedHandshake!="function"&&(Y.onExtendedHandshake=Q),typeof Y.onMessage!="function"&&(Y.onMessage=Q),this.extendedMapping[q]=A,this._ext[A]=Y,this[A]=Y,this._nextExt+=1}keepAlive(){this._debug("keep-alive"),this._push(a)}sendPe1(){if(this._peEnabled){const v=Math.floor(513*Math.random()),A=i(v);this._push((0,g.zo)([(0,g._0)(this._myPubKey),A]))}}sendPe2(){const v=Math.floor(513*Math.random()),A=i(v);this._push((0,g.zo)([(0,g._0)(this._myPubKey),A]))}async sendPe3(v){await this.setEncrypt(this._sharedSecret,v);const A=await(0,g.vp)((0,g._0)(this._utfToHex("req1")+this._sharedSecret)),q=nt(await(0,g.vp)((0,g._0)(this._utfToHex("req2")+v)),await(0,g.vp)((0,g._0)(this._utfToHex("req3")+this._sharedSecret))),Y=new DataView(i(2).buffer).getUint16(0)%512,Q=i(Y);let st=new Uint8Array(14+Y+2);st.set($),st.set(G,8);const ut=new DataView(st.buffer);ut.setInt16(12,Y),Q.copy(st,14),ut.setInt16(14+Y,0),st=this._encryptHandshake(st),this._push((0,g.zo)([A,q,st]))}async sendPe4(v){await this.setEncrypt(this._sharedSecret,v);const A=new DataView(i(2).buffer).getUint16(0)%512,q=i(A);let Y=new Uint8Array(14+A);const Q=new DataView(Y.buffer);Y.set($),Y.set(tt,8),Q.setInt16(12,A),Y.set(q,14),Y=this._encryptHandshake(Y),this._push(Y),this._cryptoHandshakeDone=!0,this._debug("completed crypto handshake")}handshake(v,A,q){let Y,Q;if(typeof v=="string"?(v=v.toLowerCase(),Y=(0,g._0)(v)):(Y=v,v=(0,g.oc)(Y)),typeof A=="string"?Q=(0,g._0)(A):(Q=A,A=(0,g.oc)(Q)),this._infoHash=Y,Y.length!==20||Q.length!==20)throw new Error("infoHash and peerId MUST have length 20");this._debug("handshake i=%s p=%s exts=%o",v,A,q);const st=new Uint8Array(H);this.extensions={extended:!0,dht:!(!q||!q.dht),fast:!(!q||!q.fast)},st[5]|=16,this.extensions.dht&&(st[7]|=1),this.extensions.fast&&(st[7]|=4),this.extensions.fast&&this.peerExtensions.fast&&(this._debug("fast extension is enabled"),this.hasFast=!0),this._push((0,g.zo)([s,st,Y,Q])),this._handshakeSent=!0,this.peerExtensions.extended&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()}_sendExtendedHandshake(){const v=Object.assign({},this.extendedHandshake);v.m={};for(const A in this.extendedMapping){const q=this.extendedMapping[A];v.m[q]=Number(A)}this.extended(0,k.Z.encode(v)),this._extendedHandshakeSent=!0}choke(){if(!this.amChoking)if(this.amChoking=!0,this._debug("choke"),this._push(u),this.hasFast){let v=0;for(;this.peerRequests.length>v;){const A=this.peerRequests[v];this.allowedFastSet.includes(A.piece)?++v:this.reject(A.piece,A.offset,A.length)}}else for(;this.peerRequests.length;)this.peerRequests.pop()}unchoke(){this.amChoking&&(this.amChoking=!1,this._debug("unchoke"),this._push(x))}interested(){this.amInterested||(this.amInterested=!0,this._debug("interested"),this._push(S))}uninterested(){this.amInterested&&(this.amInterested=!1,this._debug("uninterested"),this._push(C))}have(v){this._debug("have %d",v),this._message(4,[v],null)}bitfield(v){this._debug("bitfield"),ArrayBuffer.isView(v)||(v=v.buffer),this._message(5,[],v)}request(v,A,q,Y){return Y||(Y=()=>{}),this._finished?Y(new Error("wire is closed")):!this.peerChoking||this.hasFast&&this.peerAllowedFastSet.includes(v)?(this._debug("request index=%d offset=%d length=%d",v,A,q),this.requests.push(new lt(v,A,q,Y)),this._timeout||this._resetTimeout(!0),void this._message(6,[v,A,q],null)):Y(new Error("peer is choking"))}piece(v,A,q){this._debug("piece index=%d offset=%d",v,A),this._message(7,[v,A],q),this.uploaded+=q.length,this.uploadSpeed(q.length),this.emit("upload",q.length)}cancel(v,A,q){this._debug("cancel index=%d offset=%d length=%d",v,A,q),this._callback(this._pull(this.requests,v,A,q),new Error("request was cancelled"),null),this._message(8,[v,A,q],null)}port(v){this._debug("port %d",v);const A=new Uint8Array(U);new DataView(A.buffer).setUint16(5,v),this._push(A)}suggest(v){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("suggest %d",v),this._message(13,[v],null)}haveAll(){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("have-all"),this._push(D)}haveNone(){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("have-none"),this._push(W)}reject(v,A,q){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("reject index=%d offset=%d length=%d",v,A,q),this._pull(this.peerRequests,v,A,q),this._message(16,[v,A,q],null)}allowedFast(v){if(!this.hasFast)throw Error("fast extension is disabled");this._debug("allowed-fast %d",v),this.allowedFastSet.includes(v)||this.allowedFastSet.push(v),this._message(17,[v],null)}extended(v,A){if(this._debug("extended ext=%s",v),typeof v=="string"&&this.peerExtendedMapping[v]&&(v=this.peerExtendedMapping[v]),typeof v!="number")throw new Error(`Unrecognized extension: ${v}`);{const q=new Uint8Array([v]),Y=ArrayBuffer.isView(A)?A:k.Z.encode(A);this._message(20,[],(0,g.zo)([q,Y]))}}async setEncrypt(v,A){let q,Y,Q,st;switch(this.type){case"tcpIncoming":q=await(0,g.vp)((0,g._0)(this._utfToHex("keyB")+v+A)),Q=await(0,g.vp)((0,g._0)(this._utfToHex("keyA")+v+A)),Y=[];for(const ut of q.values())Y.push(ut);st=[];for(const ut of Q.values())st.push(ut);this._encryptGenerator=new r(Y),this._decryptGenerator=new r(st);break;case"tcpOutgoing":q=await(0,g.vp)((0,g._0)(this._utfToHex("keyA")+v+A)),Q=await(0,g.vp)((0,g._0)(this._utfToHex("keyB")+v+A)),Y=[];for(const ut of q.values())Y.push(ut);st=[];for(const ut of Q.values())st.push(ut);this._encryptGenerator=new r(Y),this._decryptGenerator=new r(st);break;default:return!1}for(let ut=0;ut<1024;ut++)this._encryptGenerator.randomByte(),this._decryptGenerator.randomByte();return this._setGenerators=!0,!0}_read(){}_message(v,A,q){const Y=q?q.length:0,Q=new Uint8Array(5+4*A.length),st=new DataView(Q.buffer);st.setUint32(0,Q.length+Y-4),Q[4]=v;for(let ut=0;ut<A.length;ut++)st.setUint32(5+4*ut,A[ut]);this._push(Q),q&&this._push(q)}_push(v){if(!this._finished)return this._encryptionMethod===2&&this._cryptoHandshakeDone&&(v=this._encrypt(v)),this.push(v)}_onKeepAlive(){this._debug("got keep-alive"),this.emit("keep-alive")}_onPe1(v){this._peerPubKey=(0,g.oc)(v),this._sharedSecret=this._dh.computeSecret(this._peerPubKey,"hex","hex"),this.emit("pe1")}_onPe2(v){this._peerPubKey=(0,g.oc)(v),this._sharedSecret=this._dh.computeSecret(this._peerPubKey,"hex","hex"),this.emit("pe2")}async _onPe3(v){const A=await(0,g.oc)(this._utfToHex("req3")+this._sharedSecret),q=(0,g.oc)(nt(A,v));this.emit("pe3",q)}_onPe3Encrypted(v,A){if(!(0,g.Dg)(v,$))return this._debug("Error: verification constant did not match"),void this.destroy();for(const q of A.values())q!==0&&this._peerCryptoProvide.push(q);this._peerCryptoProvide.includes(2)?this._encryptionMethod=2:(this._debug("Error: RC4 encryption method not provided by peer"),this.destroy())}_onPe4(v){this._encryptionMethod=v[3],G.includes(this._encryptionMethod)||(this._debug("Error: peer selected invalid crypto method"),this.destroy()),this._cryptoHandshakeDone=!0,this._debug("crypto handshake done"),this.emit("pe4")}_onHandshake(v,A,q){const Y=(0,g.oc)(v),Q=(0,g.oc)(A);this._debug("got handshake i=%s p=%s exts=%o",Y,Q,q),this.peerId=Q,this.peerIdBuffer=A,this.peerExtensions=q,this.extensions.fast&&this.peerExtensions.fast&&(this._debug("fast extension is enabled"),this.hasFast=!0),this.emit("handshake",Y,Q,q);for(const st in this._ext)this._ext[st].onHandshake(Y,Q,q);q.extended&&this._handshakeSent&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()}_onChoke(){if(this.peerChoking=!0,this._debug("got choke"),this.emit("choke"),!this.hasFast)for(;this.requests.length;)this._callback(this.requests.pop(),new Error("peer is choking"),null)}_onUnchoke(){this.peerChoking=!1,this._debug("got unchoke"),this.emit("unchoke")}_onInterested(){this.peerInterested=!0,this._debug("got interested"),this.emit("interested")}_onUninterested(){this.peerInterested=!1,this._debug("got uninterested"),this.emit("uninterested")}_onHave(v){this.peerPieces.get(v)||(this._debug("got have %d",v),this.peerPieces.set(v,!0),this.emit("have",v))}_onBitField(v){this.peerPieces=new f.Z(v),this._debug("got bitfield"),this.emit("bitfield",this.peerPieces)}_onRequest(v,A,q){if(this.amChoking&&(!this.hasFast||!this.allowedFastSet.includes(v)))return void(this.hasFast&&this.reject(v,A,q));this._debug("got request index=%d offset=%d length=%d",v,A,q);const Y=(st,ut)=>{if(Q===this._pull(this.peerRequests,v,A,q))return st?(this._debug("error satisfying request index=%d offset=%d length=%d (%s)",v,A,q,st.message),void(this.hasFast&&this.reject(v,A,q))):void this.piece(v,A,ut)},Q=new lt(v,A,q,Y);this.peerRequests.push(Q),this.emit("request",v,A,q,Y)}_onPiece(v,A,q){this._debug("got piece index=%d offset=%d",v,A),this._callback(this._pull(this.requests,v,A,q.length),null,q),this.downloaded+=q.length,this.downloadSpeed(q.length),this.emit("download",q.length),this.emit("piece",v,A,q)}_onCancel(v,A,q){this._debug("got cancel index=%d offset=%d length=%d",v,A,q),this._pull(this.peerRequests,v,A,q),this.emit("cancel",v,A,q)}_onPort(v){this._debug("got port %d",v),this.emit("port",v)}_onSuggest(v){if(!this.hasFast)return this._debug("Error: got suggest whereas fast extension is disabled"),void this.destroy();this._debug("got suggest %d",v),this.emit("suggest",v)}_onHaveAll(){if(!this.hasFast)return this._debug("Error: got have-all whereas fast extension is disabled"),void this.destroy();this._debug("got have-all"),this.peerPieces=new ct,this.emit("have-all")}_onHaveNone(){if(!this.hasFast)return this._debug("Error: got have-none whereas fast extension is disabled"),void this.destroy();this._debug("got have-none"),this.emit("have-none")}_onReject(v,A,q){if(!this.hasFast)return this._debug("Error: got reject whereas fast extension is disabled"),void this.destroy();this._debug("got reject index=%d offset=%d length=%d",v,A,q),this._callback(this._pull(this.requests,v,A,q),new Error("request was rejected"),null),this.emit("reject",v,A,q)}_onAllowedFast(v){if(!this.hasFast)return this._debug("Error: got allowed-fast whereas fast extension is disabled"),void this.destroy();this._debug("got allowed-fast %d",v),this.peerAllowedFastSet.includes(v)||this.peerAllowedFastSet.push(v),this.peerAllowedFastSet.length>100&&this.peerAllowedFastSet.shift(),this.emit("allowed-fast",v)}_onExtended(v,A){if(v===0){let q;try{q=k.Z.decode(A)}catch(Y){this._debug("ignoring invalid extended handshake: %s",Y.message||Y)}if(!q)return;if(this.peerExtendedHandshake=q,typeof q.m=="object")for(const Y in q.m)this.peerExtendedMapping[Y]=Number(q.m[Y].toString());for(const Y in this._ext)this.peerExtendedMapping[Y]&&this._ext[Y].onExtendedHandshake(this.peerExtendedHandshake);this._debug("got extended handshake"),this.emit("extended","handshake",this.peerExtendedHandshake)}else this.extendedMapping[v]&&(v=this.extendedMapping[v],this._ext[v]&&this._ext[v].onMessage(A)),this._debug("got extended message ext=%s",v),this.emit("extended",v,A)}_onTimeout(){this._debug("request timed out"),this._callback(this.requests.shift(),new Error("request has timed out"),null),this.emit("timeout")}_write(v,A,q){if(this._encryptionMethod===2&&this._cryptoHandshakeDone&&(v=this._decrypt(v)),this._bufferSize+=v.length,this._buffer.push(v),this._buffer.length>1&&(this._buffer=[(0,g.zo)(this._buffer,this._bufferSize)]),this._cryptoSyncPattern){const Y=this._buffer[0].indexOf(this._cryptoSyncPattern);if(Y!==-1)this._buffer[0]=this._buffer[0].slice(Y+this._cryptoSyncPattern.length),this._bufferSize-=Y+this._cryptoSyncPattern.length,this._cryptoSyncPattern=null;else if(this._bufferSize+v.length>this._waitMaxBytes+this._cryptoSyncPattern.length)return this._debug("Error: could not resynchronize"),void this.destroy()}for(;this._bufferSize>=this._parserSize&&!this._cryptoSyncPattern;)if(this._parserSize===0)this._parser(new Uint8Array);else{const Y=this._buffer[0];this._bufferSize-=this._parserSize,this._buffer=this._bufferSize?[Y.slice(this._parserSize)]:[],this._parser(Y.slice(0,this._parserSize))}q(null)}_callback(v,A,q){v&&(this._resetTimeout(!this.peerChoking&&!this._finished),v.callback(A,q))}_resetTimeout(v){if(!v||!this._timeoutMs||!this.requests.length)return clearTimeout(this._timeout),this._timeout=null,void(this._timeoutExpiresAt=null);const A=Date.now()+this._timeoutMs;if(this._timeout){if(A-this._timeoutExpiresAt<.05*this._timeoutMs)return;clearTimeout(this._timeout)}this._timeoutExpiresAt=A,this._timeout=setTimeout(()=>this._onTimeout(),this._timeoutMs),this._timeoutUnref&&this._timeout.unref&&this._timeout.unref()}_parse(v,A){this._parserSize=v,this._parser=A}_parseUntil(v,A){this._cryptoSyncPattern=v,this._waitMaxBytes=A}_onMessageLength(v){const A=new DataView(v.buffer,v.byteOffset,v.byteLength).getUint32(0);A>0?this._parse(A,this._onMessage):(this._onKeepAlive(),this._parse(4,this._onMessageLength))}_onMessage(v){this._parse(4,this._onMessageLength);const A=new DataView(v.buffer,v.byteOffset,v.byteLength);switch(v[0]){case 0:return this._onChoke();case 1:return this._onUnchoke();case 2:return this._onInterested();case 3:return this._onUninterested();case 4:return this._onHave(A.getUint32(1));case 5:return this._onBitField(v.slice(1));case 6:return this._onRequest(A.getUint32(1),A.getUint32(5),A.getUint32(9));case 7:return this._onPiece(A.getUint32(1),A.getUint32(5),v.slice(9));case 8:return this._onCancel(A.getUint32(1),A.getUint32(5),A.getUint32(9));case 9:return this._onPort(A.getUint16(1));case 13:return this._onSuggest(A.getUint32(1));case 14:return this._onHaveAll();case 15:return this._onHaveNone();case 16:return this._onReject(A.getUint32(1),A.getUint32(5),A.getUint32(9));case 17:return this._onAllowedFast(A.getUint32(1));case 20:return this._onExtended(v[1],v.slice(2));default:return this._debug("got unknown message"),this.emit("unknownmessage",v)}}_determineHandshakeType(){this._parse(1,v=>{const A=v[0];A===19?this._parse(A+48,this._onHandshakeBuffer):this._parsePe1(v)})}_parsePe1(v){this._parse(95,A=>{this._onPe1((0,g.zo)([v,A])),this._parsePe3()})}_parsePe2(){this._parse(96,v=>{for(this._onPe2(v);!this._setGenerators;);this._parsePe4()})}async _parsePe3(){const v=await(0,g.vp)((0,g._0)(this._utfToHex("req1")+this._sharedSecret));this._parseUntil(v,512),this._parse(20,A=>{for(this._onPe3(A);!this._setGenerators;);this._parsePe3Encrypted()})}_parsePe3Encrypted(){this._parse(14,v=>{const A=this._decryptHandshake(v.slice(0,8)),q=this._decryptHandshake(v.slice(8,12)),Y=new DataView(this._decryptHandshake(v.slice(12,14)).buffer).getUint16(0);this._parse(Y,Q=>{Q=this._decryptHandshake(Q),this._parse(2,st=>{const ut=new DataView(this._decryptHandshake(st).buffer).getUint16(0);this._parse(ut,_t=>{_t=this._decryptHandshake(_t),this._onPe3Encrypted(A,q,Q,_t);const Tt=ut?_t[0]:null,B=ut?_t.slice(1,20):null;Tt===19&&(0,g.vV)(B)==="BitTorrent protocol"?this._onHandshakeBuffer(_t.slice(1)):this._parseHandshake()})})})})}_parsePe4(){const v=this._decryptHandshake($);this._parseUntil(v,512),this._parse(6,A=>{const q=this._decryptHandshake(A.slice(0,4)),Y=new DataView(this._decryptHandshake(A.slice(4,6)).buffer).getUint16(0);this._parse(Y,Q=>{this._decryptHandshake(Q),this._onPe4(q),this._parseHandshake(null)})})}_parseHandshake(){this._parse(1,v=>{const A=v[0];if(A!==19)return this._debug("Error: wire not speaking BitTorrent protocol (%s)",A.toString()),void this.end();this._parse(A+48,this._onHandshakeBuffer)})}_onHandshakeBuffer(v){const A=v.slice(0,19);if((0,g.vV)(A)!=="BitTorrent protocol")return this._debug("Error: wire not speaking BitTorrent protocol (%s)",(0,g.vV)(A)),void this.end();v=v.slice(19),this._onHandshake(v.slice(8,28),v.slice(28,48),{dht:!!(1&v[7]),fast:!!(4&v[7]),extended:!!(16&v[5])}),this._parse(4,this._onMessageLength)}_onFinish(){for(this._finished=!0,this.push(null);this.read(););for(clearInterval(this._keepAliveInterval),this._parse(Number.MAX_VALUE,()=>{});this.peerRequests.length;)this.peerRequests.pop();for(;this.requests.length;)this._callback(this.requests.pop(),new Error("wire was closed"),null)}_debug(...v){v[0]=`[${this._debugId}] ${v[0]}`,w(...v)}_pull(v,A,q,Y){for(let Q=0;Q<v.length;Q++){const st=v[Q];if(st.piece===A&&st.offset===q&&st.length===Y)return h(v,Q),st}return null}_encryptHandshake(v){const A=new Uint8Array(v);if(!this._encryptGenerator)return this._debug("Warning: Encrypting without any generator"),A;for(let q=0;q<v.length;q++){const Y=this._encryptGenerator.randomByte();A[q]=A[q]^Y}return A}_encrypt(v){const A=new Uint8Array(v);if(!this._encryptGenerator||this._encryptionMethod!==2)return A;for(let q=0;q<v.length;q++){const Y=this._encryptGenerator.randomByte();A[q]=A[q]^Y}return A}_decryptHandshake(v){const A=new Uint8Array(v);if(!this._decryptGenerator)return this._debug("Warning: Decrypting without any generator"),A;for(let q=0;q<v.length;q++){const Y=this._decryptGenerator.randomByte();A[q]=A[q]^Y}return A}_decrypt(v){const A=new Uint8Array(v);if(!this._decryptGenerator||this._encryptionMethod!==2)return A;for(let q=0;q<v.length;q++){const Y=this._decryptGenerator.randomByte();A[q]=A[q]^Y}return A}_utfToHex(v){return(0,g.oc)((0,g.gR)(v))}}const mt=gt},5194:(N,R,y)=>{y.d(R,{te:()=>x,oc:()=>c,vV:()=>s,Ff:()=>S,zo:()=>r,Dg:()=>d,vp:()=>W,_0:()=>i,gR:()=>u});const k="0123456789abcdef",f=[],m=[];for(let $=0;$<256;$++)f[$]=k[$>>4&15]+k[15&$],$<16&&($<10?m[48+$]=$:m[87+$]=$);const c=$=>{const G=$.length;let tt="",nt=0;for(;nt<G;)tt+=f[$[nt++]];return tt},i=$=>{const G=$.length>>1,tt=G<<1,nt=new Uint8Array(G);let lt=0,ct=0;for(;ct<tt;)nt[lt++]=m[$.charCodeAt(ct++)]<<4|m[$.charCodeAt(ct++)];return nt},r=($,G)=>{if(!G){G=0;let lt=$.length||$.byteLength||0;for(;lt--;)G+=$[lt].length}const tt=new Uint8Array(G);let nt=0;for(const lt of $)tt.set(lt,nt),nt+=lt.byteLength||lt.length;return tt},d=($,G)=>{if($.byteLength!==G.byteLength)return!1;for(let tt=$.length;tt>-1;tt-=1)if($[tt]!==G[tt])return!1;return!0};for(var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=typeof Uint8Array>"u"?[]:new Uint8Array(256),h=0;h<g.length;h++)b[g.charCodeAt(h)]=h;const w=new TextDecoder,s=($,G)=>G?new TextDecoder(G).decode($):w.decode($),a=new TextEncoder,u=$=>a.encode($),x=$=>function(G){var tt,nt=new Uint8Array(G),lt=nt.length,ct="";for(tt=0;tt<lt;tt+=3)ct+=g[nt[tt]>>2],ct+=g[(3&nt[tt])<<4|nt[tt+1]>>4],ct+=g[(15&nt[tt+1])<<2|nt[tt+2]>>6],ct+=g[63&nt[tt+2]];return lt%3==2?ct=ct.substring(0,ct.length-1)+"=":lt%3==1&&(ct=ct.substring(0,ct.length-2)+"=="),ct}($),S=$=>{let G,tt="",nt=0;const lt=$.length;for(;nt<lt;)G=$.charCodeAt(nt++),tt+=k[G>>4],tt+=k[15&G];return tt},C=typeof window<"u"?window:self,H=C.crypto||C.msCrypto||{},U=H.subtle||H.webkitSubtle,D={hex:c,base64:x},W=async($,G,tt="sha-1")=>{if(!U)throw new Error("no web crypto support");typeof $=="string"&&($=u($));const nt=new Uint8Array(await U.digest(tt,$));return G?D[G](nt):nt}},8768:(N,R,y)=>{y.r(R),y.d(R,{addListener:()=>h,argv:()=>i,binding:()=>$,browser:()=>m,chdir:()=>G,cwd:()=>D,emit:()=>x,env:()=>c,listeners:()=>U,nextTick:()=>H,off:()=>s,on:()=>b,once:()=>w,prependListener:()=>S,prependOnceListener:()=>C,removeAllListeners:()=>u,removeListener:()=>a,title:()=>f,umask:()=>W,version:()=>r,versions:()=>d});var k=y(4375);const f="browser",m=!0,c={},i=[],r="",d={};function g(){}const b=g,h=g,w=g,s=g,a=g,u=g,x=g,S=g,C=g,H=(tt,...nt)=>k(()=>tt(...nt)),U=tt=>[],D=()=>"/",W=()=>0,$=tt=>{throw new Error("process.binding is not supported")},G=tt=>{throw new Error("process.chdir is not supported")}}},qe={};function it(N){var R=qe[N];if(R!==void 0)return R.exports;var y=qe[N]={exports:{}};return cr[N](y,y.exports,it),y.exports}te=Object.getPrototypeOf?N=>Object.getPrototypeOf(N):N=>N.__proto__,it.t=function(N,R){if(1&R&&(N=this(N)),8&R||typeof N=="object"&&N&&(4&R&&N.__esModule||16&R&&typeof N.then=="function"))return N;var y=Object.create(null);it.r(y);var k={};Ce=Ce||[null,te({}),te([]),te(te)];for(var f=2&R&&N;typeof f=="object"&&!~Ce.indexOf(f);f=te(f))Object.getOwnPropertyNames(f).forEach(m=>k[m]=()=>N[m]);return k.default=()=>N,it.d(y,k),y},it.d=(N,R)=>{for(var y in R)it.o(R,y)&&!it.o(N,y)&&Object.defineProperty(N,y,{enumerable:!0,get:R[y]})},it.o=(N,R)=>Object.prototype.hasOwnProperty.call(N,R),it.r=N=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(N,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(N,"__esModule",{value:!0})};var We={};(()=>{var Me,Ne,je;it.d(We,{Z:()=>Qt});var N=it(7187),R=it(6470),y=it(7485),k=it(502),f=it(2090),m=it(3786),c=it(970),i=it(1351),r=it(8225),d=it(4595),g=it(4375),b=it(5194),h=(it(3811),it(2911));const w=[["udp://tracker.leechers-paradise.org:6969"],["udp://tracker.coppersurfer.tk:6969"],["udp://tracker.opentrackr.org:1337"],["udp://explodie.org:6969"],["udp://tracker.empire-js.us:1337"],["wss://tracker.btorrent.xyz"],["wss://tracker.openwebtorrent.com"]],s=Symbol("itemPath");function a(M,t,e){var o;if(o=M,typeof FileList<"u"&&o instanceof FileList&&(M=Array.from(M)),Array.isArray(M)||(M=[M]),M.length===0)throw new Error("invalid input type");M.forEach(O=>{if(O==null)throw new Error(`invalid input type: ${O}`)}),(M=M.map(O=>S(O)&&typeof O.path=="string"&&typeof h=="function"?O.path:O)).length!==1||typeof M[0]=="string"||M[0].name||(M[0].name=t.name);let _=null;M.forEach((O,K)=>{if(typeof O=="string")return;let Z=O.fullPath||O.name;Z||(Z=`Unknown File ${K+1}`,O.unknownName=!0),O[s]=Z.split("/"),O[s][0]||O[s].shift(),O[s].length<2?_=null:K===0&&M.length>1?_=O[s][0]:O[s][0]!==_&&(_=null)}),(t.filterJunkFiles===void 0||t.filterJunkFiles)&&(M=M.filter(O=>typeof O=="string"||!function(K){const Z=K[K.length-1];return Z[0]==="."&&i.is(Z)}(O[s]))),_&&M.forEach(O=>{const K=(ArrayBuffer.isView(O)||C(O))&&!O[s];typeof O=="string"||K||O[s].shift()}),!t.name&&_&&(t.name=_),t.name||M.some(O=>typeof O=="string"?(t.name=R.basename(O),!0):!O.unknownName&&(t.name=O[s][O[s].length-1],!0)),t.name||(t.name=`Unnamed Torrent ${Date.now()}`);const P=M.reduce((O,K)=>O+ +(typeof K=="string"),0);let I=M.length===1;if(M.length===1&&typeof M[0]=="string"){if(typeof h!="function")throw new Error("filesystem paths do not work in the browser");c(M[0],(O,K)=>{if(O)return e(O);I=K,j()})}else g(j);function j(){d(M.map(O=>K=>{const Z={};if(S(O))Z.getStream=O.stream(),Z.length=O.size;else if(ArrayBuffer.isView(O))Z.getStream=[O],Z.length=O.length;else{if(!C(O)){if(typeof O=="string"){if(typeof h!="function")throw new Error("filesystem paths do not work in the browser");return void h(O,P>1||I,K)}throw new Error("invalid input type")}Z.getStream=async function*(et,ot){for await(const ft of et)ot.length+=ft.length,yield ft}(O,Z),Z.length=0}Z.path=O[s],K(null,Z)}),(O,K)=>{if(O)return e(O);K=K.flat(),e(null,K,I)})}}const u=5;function x(M,t){return M+t.length}function S(M){return typeof Blob<"u"&&M instanceof Blob}function C(M){return typeof M=="object"&&M!=null&&typeof M.pipe=="function"}const H=function(M,t,e){typeof t=="function"&&([t,e]=[e,t]),a(M,t=t?Object.assign({},t):{},(o,_,P)=>{if(o)return e(o);t.singleFileTorrent=P,function(I,j,O){let K=j.announceList;K||(typeof j.announce=="string"?K=[[j.announce]]:Array.isArray(j.announce)&&(K=j.announce.map(ft=>[ft]))),K||(K=[]),globalThis.WEBTORRENT_ANNOUNCE&&(typeof globalThis.WEBTORRENT_ANNOUNCE=="string"?K.push([[globalThis.WEBTORRENT_ANNOUNCE]]):Array.isArray(globalThis.WEBTORRENT_ANNOUNCE)&&(K=K.concat(globalThis.WEBTORRENT_ANNOUNCE.map(ft=>[ft])))),j.announce===void 0&&j.announceList===void 0&&(K=K.concat(w)),typeof j.urlList=="string"&&(j.urlList=[j.urlList]);const Z={info:{name:j.name},"creation date":Math.ceil((Number(j.creationDate)||Date.now())/1e3),encoding:"UTF-8"};K.length!==0&&(Z.announce=K[0][0],Z["announce-list"]=K),j.comment!==void 0&&(Z.comment=j.comment),j.createdBy!==void 0&&(Z["created by"]=j.createdBy),j.private!==void 0&&(Z.info.private=Number(j.private)),j.info!==void 0&&Object.assign(Z.info,j.info),j.sslCert!==void 0&&(Z.info["ssl-cert"]=j.sslCert),j.urlList!==void 0&&(Z["url-list"]=j.urlList);const et=I.reduce(x,0),ot=j.pieceLength||m(et);Z.info["piece length"]=ot,async function(ft,St,Ot,jt,Ut){const Kt=[];let oe=0,ae=0;const Te=ft.map(Jt=>Jt.getStream),Ue=jt.onProgress;let fe=0,De=0,He=!1;const ar=f(r(Te),St,{zeroPadding:!1});try{for await(const Jt of ar)await new Promise(Fe=>{oe+=Jt.length;const hr=De;++De,++fe<u&&Fe(),(0,b.vp)(Jt,"hex").then(lr=>{Kt[hr]=lr,--fe,ae+=Jt.length,Ue&&Ue(ae,Ot),Fe(),He&&fe===0&&Ut(null,(0,b._0)(Kt.join("")),oe)})});if(fe===0)return Ut(null,(0,b._0)(Kt.join("")),oe);He=!0}catch(Jt){Ut(Jt)}}(I,ot,et,j,(ft,St,Ot)=>{if(ft)return O(ft);Z.info.pieces=St,I.forEach(jt=>{delete jt.getStream}),j.singleFileTorrent?Z.info.length=Ot:Z.info.files=I,O(null,k.Z.encode(Z))})}(_,t,e)})};var U=it(1227),D=it(3552),W=it(5843),$=it(1982);const G=self.fetch||(()=>{throw new Error("global fetch is not available!")});var tt=it(5017);function nt(M){return M.reduce((t,e,o,_)=>{const P=e.split("-").map(I=>parseInt(I));return t.concat(((I,j=I)=>Array.from({length:j-I+1},(O,K)=>K+I))(...P))},[])}const lt=function(M){const t={},e=M.split("magnet:?")[1];let o;return(e&&e.length>=0?e.split("&"):[]).forEach(_=>{const P=_.split("=");if(P.length!==2)return;const I=P[0];let j=P[1];I==="dn"&&(j=decodeURIComponent(j).replace(/\+/g," ")),I!=="tr"&&I!=="xs"&&I!=="as"&&I!=="ws"||(j=decodeURIComponent(j)),I==="kt"&&(j=decodeURIComponent(j).split("+")),I==="ix"&&(j=Number(j)),I==="so"&&(j=nt(decodeURIComponent(j).split(","))),t[I]?(Array.isArray(t[I])||(t[I]=[t[I]]),t[I].push(j)):t[I]=j}),t.xt&&(Array.isArray(t.xt)?t.xt:[t.xt]).forEach(_=>{if(o=_.match(/^urn:btih:(.{40})/))t.infoHash=o[1].toLowerCase();else if(o=_.match(/^urn:btih:(.{32})/)){const P=tt.decode(o[1]);t.infoHash=(0,b.Ff)(P)}else(o=_.match(/^urn:btmh:1220(.{64})/))&&(t.infoHashV2=o[1].toLowerCase())}),t.xs&&(Array.isArray(t.xs)?t.xs:[t.xs]).forEach(_=>{(o=_.match(/^urn:btpk:(.{64})/))&&(t.publicKey=o[1].toLowerCase())}),t.infoHash&&(t.infoHashBuffer=(0,b._0)(t.infoHash)),t.infoHashV2&&(t.infoHashV2Buffer=(0,b._0)(t.infoHashV2)),t.publicKey&&(t.publicKeyBuffer=(0,b._0)(t.publicKey)),t.dn&&(t.name=t.dn),t.kt&&(t.keywords=t.kt),t.announce=[],(typeof t.tr=="string"||Array.isArray(t.tr))&&(t.announce=t.announce.concat(t.tr)),t.urlList=[],(typeof t.as=="string"||Array.isArray(t.as))&&(t.urlList=t.urlList.concat(t.as)),(typeof t.ws=="string"||Array.isArray(t.ws))&&(t.urlList=t.urlList.concat(t.ws)),t.peerAddresses=[],(typeof t["x.pe"]=="string"||Array.isArray(t["x.pe"]))&&(t.peerAddresses=t.peerAddresses.concat(t["x.pe"])),t.announce=Array.from(new Set(t.announce)),t.urlList=Array.from(new Set(t.urlList)),t.peerAddresses=Array.from(new Set(t.peerAddresses)),t};async function ct(M){if(typeof M=="string"&&/^(stream-)?magnet:/.test(M)){const t=lt(M);if(!t.infoHash)throw new Error("Invalid torrent identifier");return t}if(typeof M=="string"&&(/^[a-f0-9]{40}$/i.test(M)||/^[a-z2-7]{32}$/i.test(M)))return lt(`magnet:?xt=urn:btih:${M}`);if(ArrayBuffer.isView(M)&&M.length===20)return lt(`magnet:?xt=urn:btih:${(0,b.oc)(M)}`);if(ArrayBuffer.isView(M))return await async function(t){ArrayBuffer.isView(t)&&(t=k.Z.decode(t)),V(t.info,"info"),V(t.info["name.utf-8"]||t.info.name,"info.name"),V(t.info["piece length"],"info['piece length']"),V(t.info.pieces,"info.pieces"),t.info.files?t.info.files.forEach(P=>{V(typeof P.length=="number","info.files[0].length"),V(P["path.utf-8"]||P.path,"info.files[0].path")}):V(typeof t.info.length=="number","info.length");const e={info:t.info,infoBuffer:k.Z.encode(t.info),name:(0,b.vV)(t.info["name.utf-8"]||t.info.name),announce:[]};e.infoHashBuffer=await(0,b.vp)(e.infoBuffer),e.infoHash=(0,b.oc)(e.infoHashBuffer),t.info.private!==void 0&&(e.private=!!t.info.private),t["creation date"]&&(e.created=new Date(1e3*t["creation date"])),t["created by"]&&(e.createdBy=(0,b.vV)(t["created by"])),ArrayBuffer.isView(t.comment)&&(e.comment=(0,b.vV)(t.comment)),Array.isArray(t["announce-list"])&&t["announce-list"].length>0?t["announce-list"].forEach(P=>{P.forEach(I=>{e.announce.push((0,b.vV)(I))})}):t.announce&&e.announce.push((0,b.vV)(t.announce)),ArrayBuffer.isView(t["url-list"])&&(t["url-list"]=t["url-list"].length>0?[t["url-list"]]:[]),e.urlList=(t["url-list"]||[]).map(P=>(0,b.vV)(P)),e.announce=Array.from(new Set(e.announce)),e.urlList=Array.from(new Set(e.urlList));const o=t.info.files||[t.info];e.files=o.map((P,I)=>{const j=[].concat(e.name,P["path.utf-8"]||P.path||[]).map(O=>ArrayBuffer.isView(O)?(0,b.vV)(O):O);return{path:R.join.apply(null,[R.sep].concat(j)).slice(1),name:j[j.length-1],length:P.length,offset:o.slice(0,I).reduce(mt,0)}}),e.length=o.reduce(mt,0);const _=e.files[e.files.length-1];return e.pieceLength=t.info["piece length"],e.lastPieceLength=(_.offset+_.length)%e.pieceLength||e.pieceLength,e.pieces=function(P){const I=[];for(let j=0;j<P.length;j+=20)I.push((0,b.oc)(P.slice(j,j+20)));return I}(t.info.pieces),e}(M);if(M&&M.infoHash)return M.infoHash=M.infoHash.toLowerCase(),M.announce||(M.announce=[]),typeof M.announce=="string"&&(M.announce=[M.announce]),M.urlList||(M.urlList=[]),M;throw new Error("Invalid torrent identifier")}async function gt(M,t,e){if(typeof t=="function")return gt(M,{},t);if(typeof e!="function")throw new Error("second argument must be a Function");let o;try{o=await ct(M)}catch{}if(o&&o.infoHash)g(()=>{e(null,o)});else if(_=M,typeof Blob<"u"&&_ instanceof Blob)try{P(new Uint8Array(await M.arrayBuffer()))}catch(I){return e(new Error(`Error converting Blob: ${I.message}`))}else if(/^https?:/.test(M))try{const I=await G(M,{headers:{"user-agent":"WebTorrent (https://webtorrent.io)"},signal:AbortSignal.timeout(3e4),...t});P(new Uint8Array(await I.arrayBuffer()))}catch(I){return e(new Error(`Error downloading torrent: ${I.message}`))}else typeof $.readFile=="function"&&typeof M=="string"?$.readFile(M,(I,j)=>{if(I)return e(new Error("Invalid torrent identifier"));P(j)}):g(()=>{e(new Error("Invalid torrent identifier"))});var _;async function P(I){try{o=await ct(I)}catch(j){return e(j)}o&&o.infoHash?e(null,o):e(new Error("Invalid torrent identifier"))}}function mt(M,t){return M+t.length}function V(M,t){if(!M)throw new Error(`Torrent is missing required field: ${t}`)}it(8764).Buffer.alloc(0);const v=ct,A=function(M){M=Object.assign({},M);let t=new Set;M.xt&&typeof M.xt=="string"&&t.add(M.xt),M.xt&&Array.isArray(M.xt)&&(t=new Set(M.xt)),M.infoHashBuffer&&t.add(`urn:btih:${(0,b.oc)(M.infoHashBuffer)}`),M.infoHash&&t.add(`urn:btih:${M.infoHash}`),M.infoHashV2Buffer&&t.add(M.xt=`urn:btmh:1220${(0,b.oc)(M.infoHashV2Buffer)}`),M.infoHashV2&&t.add(`urn:btmh:1220${M.infoHashV2}`);const e=Array.from(t);e.length===1&&(M.xt=e[0]),e.length>1&&(M.xt=e),M.publicKeyBuffer&&(M.xs=`urn:btpk:${(0,b.oc)(M.publicKeyBuffer)}`),M.publicKey&&(M.xs=`urn:btpk:${M.publicKey}`),M.name&&(M.dn=M.name),M.keywords&&(M.kt=M.keywords),M.announce&&(M.tr=M.announce),M.urlList&&(M.ws=M.urlList,delete M.as),M.peerAddresses&&(M["x.pe"]=M.peerAddresses);let o="magnet:?";return Object.keys(M).filter(_=>_.length===2||_==="x.pe").forEach((_,P)=>{const I=Array.isArray(M[_])?M[_]:[M[_]];var j;I.forEach((O,K)=>{(P>0||K>0)&&(_!=="kt"&&_!=="so"||K===0)&&(o+="&"),_==="dn"&&(O=encodeURIComponent(O).replace(/%20/g,"+")),_!=="tr"&&_!=="as"&&_!=="ws"||(O=encodeURIComponent(O)),_!=="xs"||O.startsWith("urn:btpk:")||(O=encodeURIComponent(O)),_==="kt"&&(O=encodeURIComponent(O)),_!=="so"&&(o+=_==="kt"&&K>0?`+${O}`:`${_}=${O}`)}),_==="so"&&(o+=`${_}=${j=I,j.reduce((O,K,Z,et)=>(Z!==0&&K===et[Z-1]+1||O.push([]),O[O.length-1].push(K),O),[]).map(O=>O.length>1?`${O[0]}-${O[O.length-1]}`:`${O[0]}`)}`)}),o};var q=it(8853),Y=it(1798),Q=it(1463),st=it(558),ut=it(8302),_t=it(2203),Tt=it(1494),B=it(5381);const T=/^\[?([^\]]+)]?:(\d+)$/;let J=new Map;function ht(M){if(J.size===1e5&&J.clear(),!J.has(M)){const t=T.exec(M);if(!t)throw new Error(`invalid addr: ${M}`);J.set(M,[t[1],Number(t[2])])}return J.get(M)}var vt=it(8205),Ct=it(9421);async function*dt(M,t={}){if(M!=null&&M[Symbol.asyncIterator])return void(yield*M[Symbol.asyncIterator](t.offset));if(!(M!=null&&M.get))throw new Error("First argument must be an abstract-chunk-store compliant store");const e=t.chunkLength||M.chunkLength;if(!e)throw new Error("missing required `chunkLength` property");let o=t.length||M.length;if(!Number.isFinite(o))throw new Error("missing required `length` property");const _=t.offset||0,P=(O,K,Z)=>new Promise((et,ot)=>{M.get(O,{offset:Z,length:K},(ft,St)=>{ft&&ot(ft),et(St)})});let I=Math.floor(_/e);const j=_%e;if(_){const O=Math.min(o,e-j);o-=O,yield P(I++,O,j)}for(let O=o;O>0;++I,O-=e)yield P(I,Math.min(O,e))}async function At(M,t,e={}){if(!(M!=null&&M.put))throw new Error("First argument must be an abstract-chunk-store compliant store");const o=e.chunkLength||M.chunkLength;if(!o)throw new Error("missing required `chunkLength` property");const _=e.storeMaxOutstandingPuts||16;let P=0,I=0,j=()=>{},O=!1;for await(const K of f(t,o,{zeroPadding:e.zeroPadding||!1}))await new Promise(Z=>{P++<=_&&Z(),M.put(I++,K,et=>{if(et)throw et;--P,Z(),O&&P===0&&j()})});P!==0&&(O=new Promise(K=>{j=K}),await O)}var Et=it(9648),Mt=it(1018),Bt=it(778),zt=it(8411),n=it.t(zt,2),l=it(8764).Buffer;const p={DEFAULT_ANNOUNCE_PEERS:50,MAX_ANNOUNCE_PEERS:82,binaryToHex:M=>(typeof M!="string"&&(M=String(M)),l.from(M,"binary").toString("hex")),hexToBinary:M=>(typeof M!="string"&&(M=String(M)),l.from(M,"hex").toString("binary")),parseUrl:M=>{const t=new URL(M.replace(/^udp:/,"http:"));return M.match(/^udp:/)&&Object.defineProperties(t,{href:{value:t.href.replace(/^http/,"udp")},protocol:{value:t.protocol.replace(/^http/,"udp")},origin:{value:t.origin.replace(/^http/,"udp")}}),t},...n};var L=it(1857),F=it(159),z=it(6313),X=it(522),pt=it(9354);const wt=class extends N{constructor(M,t){super(),this.client=M,this.announceUrl=t,this.interval=null,this.destroyed=!1}setInterval(M){M==null&&(M=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),M&&(this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},M),this.interval.unref&&this.interval.unref())}},kt=U("bittorrent-tracker:websocket-tracker"),yt={};class Rt extends wt{constructor(t,e){super(t,e),kt("new websocket tracker %s",e),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}announce(t){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected)return void this.socket.once("connect",()=>{this.announce(t)});const e=Object.assign({},t,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(e.trackerid=this._trackerId),t.event==="stopped"||t.event==="completed")this._send(e);else{const o=Math.min(t.numwant,5);this._generateOffers(o,_=>{e.numwant=o,e.offers=_,this._send(e)})}}scrape(t){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected)return void this.socket.once("connect",()=>{this.scrape(t)});const e={action:"scrape",info_hash:Array.isArray(t.infoHash)&&t.infoHash.length>0?t.infoHash.map(o=>o.toString("binary")):t.infoHash&&t.infoHash.toString("binary")||this.client._infoHashBinary};this._send(e)}destroy(t=ee){if(this.destroyed)return t(null);this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer);for(const P in this.peers){const I=this.peers[P];clearTimeout(I.trackerTimeout),I.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,yt[this.announceUrl]&&(yt[this.announceUrl].consumers-=1),yt[this.announceUrl].consumers>0)return t();let e,o=yt[this.announceUrl];if(delete yt[this.announceUrl],o.on("error",ee),o.once("close",t),!this.expectingResponse)return _();function _(){e&&(clearTimeout(e),e=null),o.removeListener("data",_),o.destroy(),o=null}e=setTimeout(_,p.DESTROY_TIMEOUT),o.once("data",_)}_openSocket(){if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=()=>{this._onSocketConnect()},this._onSocketErrorBound=t=>{this._onSocketError(t)},this._onSocketDataBound=t=>{this._onSocketData(t)},this._onSocketCloseBound=()=>{this._onSocketClose()},this.socket=yt[this.announceUrl],this.socket)yt[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{const t=new URL(this.announceUrl);let e;this.client._proxyOpts&&(e=t.protocol==="wss:"?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent,!e&&this.client._proxyOpts.socksProxy&&(e=new pt.Agent(z(this.client._proxyOpts.socksProxy),t.protocol==="wss:"))),this.socket=yt[this.announceUrl]=new X({url:this.announceUrl,agent:e}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}_onSocketConnect(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}_onSocketData(t){if(!this.destroyed){this.expectingResponse=!1;try{t=JSON.parse(t)}catch{return void this.client.emit("warning",new Error("Invalid tracker response"))}t.action==="announce"?this._onAnnounceResponse(t):t.action==="scrape"?this._onScrapeResponse(t):this._onSocketError(new Error(`invalid action in WS response: ${t.action}`))}}_onAnnounceResponse(t){if(t.info_hash!==this.client._infoHashBinary)return void kt("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,p.binaryToHex(t.info_hash),this.client.infoHash);if(t.peer_id&&t.peer_id===this.client._peerIdBinary)return;kt("received %s from %s for %s",JSON.stringify(t),this.announceUrl,this.client.infoHash);const e=t["failure reason"];if(e)return this.client.emit("warning",new Error(e));const o=t["warning message"];o&&this.client.emit("warning",new Error(o));const _=t.interval||t["min interval"];_&&this.setInterval(1e3*_);const P=t["tracker id"];if(P&&(this._trackerId=P),t.complete!=null){const j=Object.assign({},t,{announce:this.announceUrl,infoHash:p.binaryToHex(t.info_hash)});this.client.emit("update",j)}let I;if(t.offer&&t.peer_id&&(kt("creating peer (from remote offer)"),I=this._createPeer(),I.id=p.binaryToHex(t.peer_id),I.once("signal",j=>{const O={action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:t.peer_id,answer:j,offer_id:t.offer_id};this._trackerId&&(O.trackerid=this._trackerId),this._send(O)}),this.client.emit("peer",I),I.signal(t.offer)),t.answer&&t.peer_id){const j=p.binaryToHex(t.offer_id);I=this.peers[j],I?(I.id=p.binaryToHex(t.peer_id),this.client.emit("peer",I),I.signal(t.answer),clearTimeout(I.trackerTimeout),I.trackerTimeout=null,delete this.peers[j]):kt(`got unexpected answer: ${JSON.stringify(t.answer)}`)}}_onScrapeResponse(t){t=t.files||{};const e=Object.keys(t);e.length!==0?e.forEach(o=>{const _=Object.assign(t[o],{announce:this.announceUrl,infoHash:p.binaryToHex(o)});this.client.emit("scrape",_)}):this.client.emit("warning",new Error("invalid scrape response"))}_onSocketClose(){this.destroyed||(this.destroy(),this._startReconnectTimer())}_onSocketError(t){this.destroyed||(this.destroy(),this.client.emit("warning",t),this._startReconnectTimer())}_startReconnectTimer(){const t=Math.floor(3e5*Math.random())+Math.min(1e4*Math.pow(2,this.retries),36e5);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>{this.retries++,this._openSocket()},t),this.reconnectTimer.unref&&this.reconnectTimer.unref(),kt("reconnecting socket in %s ms",t)}_send(t){if(this.destroyed)return;this.expectingResponse=!0;const e=JSON.stringify(t);kt("send %s",e),this.socket.send(e)}_generateOffers(t,e){const o=this,_=[];kt("generating %s offers",t);for(let j=0;j<t;++j)P();function P(){const j=Y(20).toString("hex");kt("creating peer (from _generateOffers)");const O=o.peers[j]=o._createPeer({initiator:!0});O.once("signal",K=>{_.push({offer:K,offer_id:p.hexToBinary(j)}),I()}),O.trackerTimeout=setTimeout(()=>{kt("tracker timeout: destroying peer"),O.trackerTimeout=null,delete o.peers[j],O.destroy()},5e4),O.trackerTimeout.unref&&O.trackerTimeout.unref()}function I(){_.length===t&&(kt("generated %s offers",t),e(_))}I()}_createPeer(t){const e=this;t=Object.assign({trickle:!1,config:e.client._rtcConfig,wrtc:e.client._wrtc},t);const o=new q(t);return o.once("error",_),o.once("connect",function P(){o.removeListener("error",_),o.removeListener("connect",P)}),o;function _(P){e.client.emit("warning",new Error(`Connection error: ${P.message}`)),o.destroy()}}}function ee(){}Rt.prototype.DEFAULT_ANNOUNCE_INTERVAL=3e4,Rt._socketPool=yt;const pe=Rt;var re=it(8768),Ft=it(8764).Buffer;const qt=U("bittorrent-tracker:client");class Xt extends N{constructor(t={}){if(super(),!t.peerId)throw new Error("Option `peerId` is required");if(!t.infoHash)throw new Error("Option `infoHash` is required");if(!t.announce)throw new Error("Option `announce` is required");if(!re.browser&&!t.port)throw new Error("Option `port` is required");this.peerId=typeof t.peerId=="string"?t.peerId:t.peerId.toString("hex"),this._peerIdBuffer=Ft.from(this.peerId,"hex"),this._peerIdBinary=this._peerIdBuffer.toString("binary"),this.infoHash=typeof t.infoHash=="string"?t.infoHash.toLowerCase():t.infoHash.toString("hex"),this._infoHashBuffer=Ft.from(this.infoHash,"hex"),this._infoHashBinary=this._infoHashBuffer.toString("binary"),qt("new client %s",this.infoHash),this.destroyed=!1,this._port=t.port,this._getAnnounceOpts=t.getAnnounceOpts,this._rtcConfig=t.rtcConfig,this._userAgent=t.userAgent,this._proxyOpts=t.proxyOpts,this._wrtc=typeof t.wrtc=="function"?t.wrtc():t.wrtc;let e=typeof t.announce=="string"?[t.announce]:t.announce==null?[]:t.announce;e=e.map(P=>((P=P.toString())[P.length-1]==="/"&&(P=P.substring(0,P.length-1)),P)),e=Array.from(new Set(e));const o=this._wrtc!==!1&&(!!this._wrtc||q.WEBRTC_SUPPORT),_=P=>{g(()=>{this.emit("warning",P)})};this._trackers=e.map(P=>{let I;try{I=p.parseUrl(P)}catch{return _(new Error(`Invalid tracker URL: ${P}`)),null}const j=I.port;if(j<0||j>65535)return _(new Error(`Invalid tracker port: ${P}`)),null;const O=I.protocol;return O!=="http:"&&O!=="https:"||typeof L!="function"?O==="udp:"&&typeof F=="function"?new F(this,P):O!=="ws:"&&O!=="wss:"||!o||O==="ws:"&&typeof window<"u"&&window.location.protocol==="https:"?(_(new Error(`Unsupported tracker protocol: ${P}`)),null):new pe(this,P):new L(this,P)}).filter(Boolean)}start(t){(t=this._defaultAnnounceOpts(t)).event="started",qt("send `start` %o",t),this._announce(t),this._trackers.forEach(e=>{e.setInterval()})}stop(t){(t=this._defaultAnnounceOpts(t)).event="stopped",qt("send `stop` %o",t),this._announce(t)}complete(t){t||(t={}),(t=this._defaultAnnounceOpts(t)).event="completed",qt("send `complete` %o",t),this._announce(t)}update(t){(t=this._defaultAnnounceOpts(t)).event&&delete t.event,qt("send `update` %o",t),this._announce(t)}_announce(t){this._trackers.forEach(e=>{e.announce(t)})}scrape(t){qt("send `scrape`"),t||(t={}),this._trackers.forEach(e=>{e.scrape(t)})}setInterval(t){qt("setInterval %d",t),this._trackers.forEach(e=>{e.setInterval(t)})}destroy(t){if(this.destroyed)return;this.destroyed=!0,qt("destroy");const e=this._trackers.map(o=>_=>{o.destroy(_)});d(e,t),this._trackers=[],this._getAnnounceOpts=null}_defaultAnnounceOpts(t={}){return t.numwant==null&&(t.numwant=p.DEFAULT_ANNOUNCE_PEERS),t.uploaded==null&&(t.uploaded=0),t.downloaded==null&&(t.downloaded=0),this._getAnnounceOpts&&(t=Object.assign({},t,this._getAnnounceOpts())),t}}Xt.scrape=(M,t)=>{if(t=Bt(t),!M.infoHash)throw new Error("Option `infoHash` is required");if(!M.announce)throw new Error("Option `announce` is required");const e=Object.assign({},M,{infoHash:Array.isArray(M.infoHash)?M.infoHash[0]:M.infoHash,peerId:Ft.from("01234567890123456789"),port:6881}),o=new Xt(e);o.once("error",t),o.once("warning",t);let _=Array.isArray(M.infoHash)?M.infoHash.length:1;const P={};return o.on("scrape",I=>{if(_-=1,P[I.infoHash]=I,_===0){o.destroy();const j=Object.keys(P);j.length===1?t(null,P[j[0]]):t(null,P)}}),M.infoHash=Array.isArray(M.infoHash)?M.infoHash.map(I=>Ft.from(I,"hex")):Ft.from(M.infoHash,"hex"),o.scrape({infoHash:M.infoHash}),o};const ge=Xt;it(859);var ne=it(2067),he=it(8768);const Yt=U("torrent-discovery");class le extends N.EventEmitter{constructor(t){if(super(),!t.peerId)throw new Error("Option `peerId` is required");if(!t.infoHash)throw new Error("Option `infoHash` is required");if(!he.browser&&!t.port)throw new Error("Option `port` is required");this.peerId=typeof t.peerId=="string"?t.peerId:t.peerId.toString("hex"),this.infoHash=typeof t.infoHash=="string"?t.infoHash.toLowerCase():t.infoHash.toString("hex"),this._port=t.port,this._userAgent=t.userAgent,this.destroyed=!1,this._announce=t.announce||[],this._intervalMs=t.intervalMs||9e5,this._trackerOpts=null,this._dhtAnnouncing=!1,this._dhtTimeout=!1,this._internalDHT=!1,this._onWarning=o=>{this.emit("warning",o)},this._onError=o=>{this.emit("error",o)},this._onDHTPeer=(o,_)=>{_.toString("hex")===this.infoHash&&this.emit("peer",`${o.host}:${o.port}`,"dht")},this._onTrackerPeer=o=>{this.emit("peer",o,"tracker")},this._onTrackerAnnounce=()=>{this.emit("trackerAnnounce")},this._onLSDPeer=(o,_)=>{this.emit("peer",o,"lsd")};const e=(o,_)=>{const P=new Mt.Client(_);return P.on("warning",this._onWarning),P.on("error",this._onError),P.listen(o),this._internalDHT=!0,P};t.tracker===!1?this.tracker=null:t.tracker&&typeof t.tracker=="object"?(this._trackerOpts=Object.assign({},t.tracker),this.tracker=this._createTracker()):this.tracker=this._createTracker(),t.dht===!1||typeof Mt.Client!="function"?this.dht=null:t.dht&&typeof t.dht.addNode=="function"?this.dht=t.dht:t.dht&&typeof t.dht=="object"?this.dht=e(t.dhtPort,t.dht):this.dht=e(t.dhtPort),this.dht&&(this.dht.on("peer",this._onDHTPeer),this._dhtAnnounce()),t.lsd===!1||typeof ne!="function"?this.lsd=null:this.lsd=this._createLSD()}updatePort(t){t!==this._port&&(this._port=t,this.dht&&this._dhtAnnounce(),this.tracker&&(this.tracker.stop(),this.tracker.destroy(()=>{this.tracker=this._createTracker()})))}complete(t){this.tracker&&this.tracker.complete(t)}destroy(t){if(this.destroyed)return;this.destroyed=!0,clearTimeout(this._dhtTimeout);const e=[];this.tracker&&(this.tracker.stop(),this.tracker.removeListener("warning",this._onWarning),this.tracker.removeListener("error",this._onError),this.tracker.removeListener("peer",this._onTrackerPeer),this.tracker.removeListener("update",this._onTrackerAnnounce),e.push(o=>{this.tracker.destroy(o)})),this.dht&&this.dht.removeListener("peer",this._onDHTPeer),this._internalDHT&&(this.dht.removeListener("warning",this._onWarning),this.dht.removeListener("error",this._onError),e.push(o=>{this.dht.destroy(o)})),this.lsd&&(this.lsd.removeListener("warning",this._onWarning),this.lsd.removeListener("error",this._onError),this.lsd.removeListener("peer",this._onLSDPeer),e.push(o=>{this.lsd.destroy(o)})),d(e,t),this.dht=null,this.tracker=null,this.lsd=null,this._announce=null}_createTracker(){const t=Object.assign({},this._trackerOpts,{infoHash:this.infoHash,announce:this._announce,peerId:this.peerId,port:this._port,userAgent:this._userAgent}),e=new ge(t);return e.on("warning",this._onWarning),e.on("error",this._onError),e.on("peer",this._onTrackerPeer),e.on("update",this._onTrackerAnnounce),e.setInterval(this._intervalMs),e.start(),e}_dhtAnnounce(){this._dhtAnnouncing||(Yt("dht announce"),this._dhtAnnouncing=!0,clearTimeout(this._dhtTimeout),this.dht.announce(this.infoHash,this._port,t=>{this._dhtAnnouncing=!1,Yt("dht announce complete"),t&&this.emit("warning",t),this.emit("dhtAnnounce"),this.destroyed||(this._dhtTimeout=setTimeout(()=>{this._dhtAnnounce()},this._intervalMs+Math.floor(Math.random()*this._intervalMs/5)),this._dhtTimeout.unref&&this._dhtTimeout.unref())}))}_createLSD(){const t=Object.assign({},{infoHash:this.infoHash,peerId:this.peerId,port:this._port}),e=new ne(t);return e.on("warning",this._onWarning),e.on("error",this._onError),e.on("peer",this._onLSDPeer),e.start(),e}}const ce=le;typeof navigator<"u"&&((Me=navigator.storage)!=null&&Me.getDirectory)&&navigator.storage.getDirectory().then(M=>{M.removeEntry("chunks",{recursive:!0})});const Zt=()=>{};class at{constructor(t,e={}){var o;if(this.chunkLength=Number(t),!this.chunkLength)throw new Error("First argument must be a chunk length");if(typeof navigator>"u"||!((o=navigator.storage)!=null&&o.getDirectory))throw new Error("FSA API is not supported");if(this.closed=!1,this.name=e.name||crypto.randomUUID(),this.chunks=[],this.rootDirPromise=e.rootDir||navigator.storage.getDirectory(),this.storageDirPromise=(async()=>(await this.rootDirPromise).getDirectoryHandle(this.name,{create:!0}))(),this.chunksDirPromise=this.storageDirPromise,e.files&&e.rootDir){if(this.chunkMap=[],this.directoryMap={},this.chunksDirPromise=this._getChunksDirHandle(),this.files=e.files.map((_,P,I)=>{if(_.path==null)throw new Error("File is missing `path` property");if(_.length==null)throw new Error("File is missing `length` property");if(_.offset==null)if(P===0)_.offset=0;else{const et=I[P-1];_.offset=et.offset+et.length}_.handle==null&&(_.handle=this._createFileHandle({path:_.path})),_.blob=this._createBlobReference(_.handle);const j=_.offset,O=_.offset+_.length,K=Math.floor(j/this.chunkLength),Z=Math.floor((O-1)/this.chunkLength);for(let et=K;et<=Z;++et){const ot=et*this.chunkLength,ft=j<ot?0:j-ot,St=O>ot+this.chunkLength?this.chunkLength:O-ot,Ot=j>ot?0:ot-j;this.chunkMap[et]||(this.chunkMap[et]=[]),this.chunkMap[et].push({from:ft,to:St,offset:Ot,file:_})}return _}),window.addEventListener("pagehide",()=>this.cleanup()),this.length=this.files.reduce((_,P)=>_+P.length,0),e.length!=null&&e.length!==this.length)throw new Error("total `files` length is not equal to explicit `length` option")}else this.length=Number(e.length)||1/0;this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}async _getChunkHandle(t){let e=this.chunks[t];if(!e){const o=await this.chunksDirPromise;this.chunks[t]=e=await o.getFileHandle(t,{create:!0})}return e}async _createFileHandle(t){const e=t.path.slice(t.path.lastIndexOf("/")+1);return(await this._getDirectoryHandle(t)).getFileHandle(e,{create:!0})}async _createBlobReference(t){return(await t).getFile()}async _getDirectoryHandle(t){const e=t.path.lastIndexOf("/");if(e===-1||e===0)return this.storageDirPromise;const o=t.path=t.path.slice(0,e);return this.directoryMap[o]||(this.directoryMap[o]=(async()=>(await this._getDirectoryHandle(t)).getDirectoryHandle(o.slice(o.lastIndexOf("/")+1),{create:!0}))()),this.directoryMap[o]}async _getChunksDirHandle(){return(await(await navigator.storage.getDirectory()).getDirectoryHandle("chunks",{create:!0})).getDirectoryHandle(this.name,{create:!0})}async put(t,e,o=Zt){try{return await this._put(t,e),o(null),null}catch(_){return queueMicrotask(()=>o(_)),_}}async _put(t,e){if(this.closed)throw new Error("Storage is closed");const o=t===this.lastChunkIndex;if(o&&e.length!==this.lastChunkLength)throw new Error(`Last chunk length must be ${this.lastChunkLength}`);if(!o&&e.length!==this.chunkLength)throw new Error(`Chunk length must be ${this.chunkLength}`);const _=(async()=>{const j=await this._getChunkHandle(t),O=await j.createWritable({keepExistingData:!1});await O.write(e),await O.close()})();if(!this.files)return _;const P=this.chunkMap[t];if(!P)throw new Error("No files matching the request range");const I=P.map(async({file:j,offset:O,from:K,to:Z})=>{j.stream||(j.stream=await(await j.handle).createWritable({keepExistingData:!0})),await j.stream.write({type:"write",position:O,data:e.slice(K,Z)})});I.push(_),await Promise.all(I)}async get(t,e,o=Zt){e==null&&(e={});try{const _=await this._get(t,e);return o(null,_),_}catch(_){return o(_),_}}async _get(t,e){if(typeof e=="function")return this.get(t,void 0,e);if(this.closed)throw new Error("Storage is closed");const o=t===this.lastChunkIndex?this.lastChunkLength:this.chunkLength,_=e.offset||0,P=e.length?_+e.length:o,I=e.length||o-_;if(_<0||_<0||P>o)throw new Error("Invalid offset and/or length");if(_===P)return new Uint8Array(0);if(!this.files||this.chunks[t]){let ot=await(await this._getChunkHandle(t)).getFile();_===0&&I===o||(ot=ot.slice(_,I+_));const ft=await ot.arrayBuffer();if(ft.byteLength===0)throw new Error(`Index ${t} does not exist`);return new Uint8Array(ft)}let j=this.chunkMap[t];if(!j)throw new Error("No files matching the request range");if(e&&(j=j.filter(({from:et,to:ot})=>ot>_&&et<P),j.length===0))throw new Error("No files matching the request range");const O=j.map(async({from:et,to:ot,offset:ft,file:St})=>(e&&(ot>P&&(ot=P),et<_&&(ft+=_-et,et=_)),(await St.blob).slice(ft,ft+ot-et))),K=await Promise.all(O),Z=K.length===1?await K[0].arrayBuffer():await new Blob(K).arrayBuffer();if(Z.byteLength===0)throw new Error(`Index ${t} does not exist`);return new Uint8Array(Z)}async close(t=Zt){if(this.closed)return((e=Zt,o)=>queueMicrotask(()=>e(new Error(o))))(t,"Storage is closed");this.closed=!0,this.chunkMap=null,this.directoryMap=null,this.files&&await this.cleanup(),queueMicrotask(()=>t(null))}async cleanup(){const t=[];for(const o of this.files)o.stream&&(t.push(o.stream.close()),o.stream=null);const e=(async()=>{const o=await this.chunksDirPromise;this.chunks=[];for await(const _ of o.keys())await o.removeEntry(_,{recursive:!0});this.chunksDirPromise=await this._getChunksDirHandle()})();await Promise.all(t);for(const o of this.files)o.blob=this._createBlobReference(o.handle);await e}async destroy(t=Zt){this.close(async e=>{if(e)t(e);else{try{await(await this.rootDirPromise).removeEntry(this.name,{recursive:!0})}catch(o){return void t(o)}t(null)}})}}var E=it(4137),rt=it(1191);const bt=(typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof window<"u"&&window||typeof globalThis<"u"&&globalThis).chrome?1/0:2130706432,xt=typeof navigator<"u"&&((Ne=navigator.storage)==null?void 0:Ne.getDirectory)&&((je=FileSystemFileHandle==null?void 0:FileSystemFileHandle.prototype)==null?void 0:je.createWritable),Lt=()=>{};class Pt{constructor(t,e={}){if(this.chunkLength=Number(t),!this.chunkLength)throw new Error("First argument must be a chunk length");this.length=Number(e.length)||1/0,this.limit=e.limit||bt,this.fallbackStore=null,this.dataStore=null,this.chunkCount=0,this.stores=[],this._init(e),this.dataStore&&(e.max>0&&(this.dataStore=new Ct(this.dataStore,{max:e.max})),this.stores.push(this.dataStore)),this.stores.push(this.fallbackStore)}_init(t){if(t.onlyMem||this.limit<this.chunkLength)return void(this.fallbackStore=new rt(this.chunkLength,t));const e=xt?at:E;if(this.limit>=this.length)return void(this.fallbackStore=new e(this.chunkLength,t));this.chunkCount=Math.floor(Math.min(this.length,this.limit)/this.chunkLength);const o=this.chunkCount*this.chunkLength,_=this.length-o;this.dataStore=new e(this.chunkLength,{...t,length:o}),this.fallbackStore=new rt(this.chunkLength,{...t,length:_})}get(t,e,o){t>=this.chunkCount?this.fallbackStore.get(t-this.chunkCount,e,o):this.dataStore.get(t,e,o)}put(t,e,o){t>=this.chunkCount?this.fallbackStore.put(t-this.chunkCount,e,o):this.dataStore.put(t,e,o)}close(t=Lt){Promise.all(this.stores.map(e=>new Promise(o=>e.close(o)))).then(e=>{const o=e.find(_=>_);t(o)})}destroy(t=Lt){Promise.all(this.stores.map(e=>new Promise(o=>e.destroy(o)))).then(e=>{const o=e.find(_=>_);t(o)})}}var Nt=it(3700),$t=it(9417),It=it(9967),Dt=it(8687),me=it(5960);const ie=U("ut_metadata"),se=16384,$e=M=>{class t extends N.EventEmitter{constructor(o){super(),this._wire=o,this._fetching=!1,this._metadataComplete=!1,this._metadataSize=null,this._remainingRejects=null,this._bitfield=new vt.Z(0,{grow:1e3}),ArrayBuffer.isView(M)&&this.setMetadata(M)}onHandshake(o,_,P){this._infoHash=o}onExtendedHandshake(o){return o.m&&o.m.ut_metadata?o.metadata_size?typeof o.metadata_size!="number"||1e7<o.metadata_size||o.metadata_size<=0?this.emit("warning",new Error("Peer gave invalid metadata size")):(this._metadataSize=o.metadata_size,this._numPieces=Math.ceil(this._metadataSize/se),this._remainingRejects=2*this._numPieces,void this._requestPieces()):this.emit("warning",new Error("Peer does not have metadata")):this.emit("warning",new Error("Peer does not support ut_metadata"))}onMessage(o){let _,P;try{const I=(0,b.vV)(o),j=I.indexOf("ee")+2;_=k.Z.decode(I.substring(0,j)),P=o.slice(j)}catch{return}switch(_.msg_type){case 0:this._onRequest(_.piece);break;case 1:this._onData(_.piece,P,_.total_size);break;case 2:this._onReject(_.piece)}}fetch(){this._metadataComplete||(this._fetching=!0,this._metadataSize&&this._requestPieces())}cancel(){this._fetching=!1}async setMetadata(o){if(this._metadataComplete)return!0;ie("set metadata");try{const _=k.Z.decode(o).info;_&&(o=k.Z.encode(_))}catch{}return(!this._infoHash||this._infoHash===await(0,b.vp)(o,"hex"))&&(this.cancel(),this.metadata=o,this._metadataComplete=!0,this._metadataSize=this.metadata.length,this._wire.extendedHandshake.metadata_size=this._metadataSize,this.emit("metadata",k.Z.encode({info:k.Z.decode(this.metadata)})),!0)}_send(o,_){let P=k.Z.encode(o);ArrayBuffer.isView(_)&&(P=(0,b.zo)([P,_])),this._wire.extended("ut_metadata",P)}_request(o){this._send({msg_type:0,piece:o})}_data(o,_,P){const I={msg_type:1,piece:o};typeof P=="number"&&(I.total_size=P),this._send(I,_)}_reject(o){this._send({msg_type:2,piece:o})}_onRequest(o){if(!this._metadataComplete)return void this._reject(o);const _=o*se;let P=_+se;P>this._metadataSize&&(P=this._metadataSize);const I=this.metadata.slice(_,P);this._data(o,I,this._metadataSize)}_onData(o,_,P){_.length>se||!this._fetching||(this.metadata.set(_,o*se),this._bitfield.set(o),this._checkDone())}_onReject(o){this._remainingRejects>0&&this._fetching?(this._request(o),this._remainingRejects-=1):this.emit("warning",new Error('Peer sent "reject" too much'))}_requestPieces(){if(this._fetching){this.metadata=new Uint8Array(this._metadataSize);for(let o=0;o<this._numPieces;o++)this._request(o)}}async _checkDone(){let o=!0;for(let _=0;_<this._numPieces;_++)if(!this._bitfield.get(_)){o=!1;break}o&&(await this.setMetadata(this.metadata)||this._failedMetadata())}_failedMetadata(){this._bitfield=new vt.Z(0,{grow:1e3}),this._remainingRejects-=this._numPieces,this._remainingRejects>0?this._requestPieces():this.emit("warning",new Error("Peer sent invalid metadata"))}}return t.prototype.name="ut_metadata",t};var _e=it(8838),ue=it(1237),ze=it(2109);const Ge=U("webtorrent:file-iterator");class Ve extends N{constructor(t,{start:e,end:o}){super(),this._torrent=t._torrent,this._pieceLength=t._torrent.pieceLength,this._startPiece=(e+t.offset)/this._pieceLength|0,this._endPiece=(o+t.offset)/this._pieceLength|0,this._piece=this._startPiece,this._offset=e+t.offset-this._startPiece*this._pieceLength,this._missing=o-e+1,this._criticalLength=Math.min(1048576/this._pieceLength|0,2),this._torrent.select(this._startPiece,this._endPiece,!0,()=>{this.emit("_notify")}),this.destroyed=!1}[Symbol.asyncIterator](){return this}next(){return new Promise((t,e)=>{if(this._missing===0||this.destroyed)return t({done:!0}),this.destroy();const o=(P,I)=>{if(!this._torrent.bitfield.get(P)){this._torrent.critical(P,P+this._criticalLength);const j=()=>{this._torrent.bitfield.get(P)&&(this.removeListener("_notify",j),o(P,I))};return this.on("_notify",j)}if(this._torrent.destroyed)return e(new Error("Torrent removed"));this._torrent.store.get(P,I,(j,O)=>this.destroyed?t({done:!0}):(Ge("read %s and yielding (length %s) (err %s)",P,O==null?void 0:O.length,j==null?void 0:j.message),j?e(j):void t({value:O,done:!1})))},_=Math.min(this._missing,this._pieceLength-this._offset);o(this._piece++,{length:_,offset:this._offset}),this._missing-=_,this._offset=0})}async return(){this.destroy();const{value:t}=await this.next();return{done:!0,value:t}}async throw(t){throw t}destroy(t=()=>{},e){this.destroyed||(this.destroyed=!0,this._torrent.destroyed||this._torrent.deselect(this._startPiece,this._endPiece,!0),this.emit("return"),t(e))}}class Ae extends N{constructor(t,e){super(),this._torrent=t,this._destroyed=!1,this._fileStreams=new Set,this._iterators=new Set,this.name=e.name,this.path=e.path,this.length=e.length,this.size=e.length,this.type=ze.getType(this.name)||"application/octet-stream",this.offset=e.offset,this.done=!1;const o=e.offset,_=o+e.length-1;this._startPiece=o/this._torrent.pieceLength|0,this._endPiece=_/this._torrent.pieceLength|0,this.length===0&&(this.done=!0,this.emit("done")),this._client=t.client}get downloaded(){if(this._destroyed||!this._torrent.bitfield)return 0;const{pieces:t,bitfield:e,pieceLength:o,lastPieceLength:_}=this._torrent,{_startPiece:P,_endPiece:I}=this,j=K=>{const Z=K===t.length-1?_:o;return e.get(K)?Z:Z-t[K].missing};let O=0;for(let K=P;K<=I;K+=1){const Z=j(K);if(O+=Z,K===P){const et=this.offset%o;O-=Math.min(et,Z)}if(K===I){const et=(I===t.length-1?_:o)-(this.offset+this.length)%o;O-=Math.min(et,Z)}}return O}get progress(){return this.length?this.downloaded/this.length:0}select(t){this.length!==0&&this._torrent.select(this._startPiece,this._endPiece,t)}deselect(){this.length!==0&&this._torrent.deselect(this._startPiece,this._endPiece,!1)}[Symbol.asyncIterator](t={}){if(this.length===0)return async function*(){}();const{start:e=0}=t??{},o=t!=null&&t.end&&t.end<this.length?t.end:this.length-1;if(this.done)return dt(this._torrent.store,{offset:e+this.offset,length:o-e+1});const _=new Ve(this,{start:e,end:o});return this._iterators.add(_),_.once("return",()=>{this._iterators.delete(_)}),_}createReadStream(t){const e=this[Symbol.asyncIterator](t),o=ue.Readable.from(e);return this._fileStreams.add(o),o.once("close",()=>{this._fileStreams.delete(o)}),o}async arrayBuffer(t){const e=new Uint8Array(this.length);let o=0;for await(const _ of this[Symbol.asyncIterator](t))e.set(_,o),o+=_.length;return e.buffer}async blob(t){return new Blob([await this.arrayBuffer(t)],{type:this.type})}stream(t){let e;return new ReadableStream({start(){e=this[Symbol.asyncIterator](t)},async pull({close:o,enqueue:_}){const{value:P,done:I}=await e.next();I?o():_(P)},cancel(){e.return()}})}get streamURL(){if(!this._client._server)throw new Error("No server created");return`${this._client._server.pathname}/${this._torrent.infoHash}/${encodeURI(this.path)}`}streamTo(t){return t.src=this.streamURL,t}includes(t){return this._startPiece<=t&&this._endPiece>=t}_destroy(){this._destroyed=!0,this._torrent=null;for(const t of this._fileStreams)t.destroy();this._fileStreams.clear();for(const t of this._iterators)t.destroy();this._iterators.clear()}}var Wt=it(3287);class Ke{constructor(t){this._torrent=t,this._numPieces=t.pieces.length,this._pieces=new Array(this._numPieces),this._onWire=e=>{this.recalculate(),this._initWire(e)},this._onWireHave=e=>{this._pieces[e]+=1},this._onWireBitfield=()=>{this.recalculate()},this._torrent.wires.forEach(e=>{this._initWire(e)}),this._torrent.on("wire",this._onWire),this.recalculate()}getRarestPiece(t){let e=[],o=1/0;for(let _=0;_<this._numPieces;++_){if(t&&!t(_))continue;const P=this._pieces[_];P===o?e.push(_):P<o&&(e=[_],o=P)}return e.length?e[Math.random()*e.length|0]:-1}destroy(){this._torrent.removeListener("wire",this._onWire),this._torrent.wires.forEach(t=>{this._cleanupWireEvents(t)}),this._torrent=null,this._pieces=null,this._onWire=null,this._onWireHave=null,this._onWireBitfield=null}_initWire(t){t._onClose=()=>{this._cleanupWireEvents(t);for(let e=0;e<this._numPieces;++e)this._pieces[e]-=t.peerPieces.get(e)},t.on("have",this._onWireHave),t.on("bitfield",this._onWireBitfield),t.once("close",t._onClose)}recalculate(){this._pieces.fill(0);for(const t of this._torrent.wires)for(let e=0;e<this._numPieces;++e)this._pieces[e]+=t.peerPieces.get(e)}_cleanupWireEvents(t){t.removeListener("have",this._onWireHave),t.removeListener("bitfield",this._onWireBitfield),t._onClose&&t.removeListener("close",t._onClose),t._onClose=null}}var Ye=it(6475),Ze=it(814);const ye="2.0.16",Gt=U("webtorrent:webconn"),Je=ye;class Xe extends Ze.Z{constructor(t,e){super(),this.url=t,this.connId=t,this._torrent=e,this._init(t)}_init(t){this.setKeepAlive(!0),this.use($t()),this.once("handshake",async(e,o)=>{const _=await(0,b.vp)(t,"hex");if(this.destroyed)return;this.handshake(e,_);const P=this._torrent.pieces.length,I=new vt.Z(P);for(let j=0;j<=P;j++)I.set(j,!0);this.bitfield(I)}),this.once("interested",()=>{Gt("interested"),this.unchoke()}),this.on("uninterested",()=>{Gt("uninterested")}),this.on("choke",()=>{Gt("choke")}),this.on("unchoke",()=>{Gt("unchoke")}),this.on("bitfield",()=>{Gt("bitfield")}),this.lt_donthave.on("donthave",()=>{Gt("donthave")}),this.on("request",(e,o,_,P)=>{Gt("request pieceIndex=%d offset=%d length=%d",e,o,_),this.httpRequest(e,o,_,(I,j)=>{if(I){this.lt_donthave.donthave(e);const O=setTimeout(()=>{this.destroyed||this.have(e)},1e4);O.unref&&O.unref()}P(I,j)})})}async httpRequest(t,e,o,_){_=Bt(_);const P=t*this._torrent.pieceLength+e,I=P+o-1,j=this._torrent.files;let O;if(j.length<=1)O=[{url:this.url,start:P,end:I}];else{const Z=j.filter(et=>et.offset<=I&&et.offset+et.length>P);if(Z.length<1)return _(new Error("Could not find file corresponding to web seed range request"));O=Z.map(et=>{const ot=et.offset+et.length-1;return{url:this.url+(this.url[this.url.length-1]==="/"?"":"/")+et.path.replace(this._torrent.path,""),fileOffsetInRange:Math.max(et.offset-P,0),start:Math.max(P-et.offset,0),end:Math.min(ot,I-et.offset)}})}const K=await Promise.all(O.map(async({start:Z,end:et,url:ot})=>{let ft,St;Gt("Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d",ot,t,e,o,Z,et);try{ft=await G(ot,{cache:"no-store",method:"GET",headers:{"Cache-Control":"no-store","user-agent":`WebTorrent/${Je} (https://webtorrent.io)`,range:`bytes=${Z}-${et}`},signal:AbortSignal.timeout(6e4)})}catch(Ot){return _(Ot)}if(!ft.ok)return _(new Error(`Unexpected HTTP status code ${ft.status}`));try{St=new Uint8Array(await ft.arrayBuffer())}catch(Ot){return _(Ot)}return Gt("Got data of length %d",St.length),St}));_(null,(0,b.zo)(K))}destroy(){super.destroy(),this._torrent=null}}var Qe=it(8768);const tr=U("webtorrent:torrent"),be=5e3,we=3*Dt.BLOCK_LENGTH,Re=Qe.browser?Et().length:2,ve=[1e3,5e3,15e3],Pe=`WebTorrent/${ye} (https://webtorrent.io)`;let ke;try{ke=R.join(_t.statSync("/tmp")&&"/tmp","webtorrent")}catch{ke=R.join(typeof B.tmpdir=="function"?B.tmpdir():"/","webtorrent")}class Ie extends N{constructor(t,e,o){super(),this._debugId="unknown infohash",this.client=e,this.announce=o.announce,this.urlList=o.urlList,this.path=o.path||ke,this.addUID=o.addUID||!1,this.rootDir=o.rootDir||null,this.skipVerify=!!o.skipVerify,this._store=o.store||Pt,this._preloadedStore=o.preloadedStore||null,this._storeCacheSlots=o.storeCacheSlots!==void 0?o.storeCacheSlots:20,this._destroyStoreOnDestroy=o.destroyStoreOnDestroy||!1,this.store=null,this.storeOpts=o.storeOpts,this._getAnnounceOpts=o.getAnnounceOpts,typeof o.private=="boolean"&&(this.private=o.private),this.strategy=o.strategy||"sequential",this.maxWebConns=o.maxWebConns||4,this._rechokeNumSlots=o.uploads===!1||o.uploads===0?0:+o.uploads||10,this._rechokeOptimisticWire=null,this._rechokeOptimisticTime=0,this._rechokeIntervalId=null,this._noPeersIntervalId=null,this._noPeersIntervalTime=o.noPeersIntervalTime?1e3*o.noPeersIntervalTime:3e4,this.ready=!1,this.destroyed=!1,this.paused=o.paused||!1,this.done=!1,this.metadata=null,this.files=[],this.pieces=[],this._amInterested=!1,this._selections=[],this._critical=[],this.wires=[],this._queue=[],this._peers={},this._peersLength=0,this.received=0,this.uploaded=0,this._downloadSpeed=Q(),this._uploadSpeed=Q(),this._servers=[],this._xsRequests=[],this._fileModtimes=o.fileModtimes,t!==null&&this._onTorrentId(t),this._debug("new torrent")}get timeRemaining(){return this.done?0:this.downloadSpeed===0?1/0:(this.length-this.downloaded)/this.downloadSpeed*1e3}get downloaded(){if(!this.bitfield)return 0;let t=0;for(let e=0,o=this.pieces.length;e<o;++e)if(this.bitfield.get(e))t+=e===o-1?this.lastPieceLength:this.pieceLength;else{const _=this.pieces[e];t+=_.length-_.missing}return t}get downloadSpeed(){return this._downloadSpeed()}get uploadSpeed(){return this._uploadSpeed()}get progress(){return this.length?this.downloaded/this.length:0}get ratio(){return this.uploaded/(this.received||this.length)}get numPeers(){return this.wires.length}get torrentFileBlob(){return this.torrentFile?new Blob([this.torrentFile],{type:"application/x-bittorrent"}):null}get _numQueued(){return this._queue.length+(this._peersLength-this._numConns)}get _numConns(){let t=0;for(const e in this._peers)this._peers[e].connected&&(t+=1);return t}async _onTorrentId(t){if(this.destroyed)return;let e;try{e=await v(t)}catch{}e?(this.infoHash=e.infoHash,this._debugId=(0,b.oc)(e.infoHash).substring(0,7),g(()=>{this.destroyed||this._onParsedTorrent(e)})):gt(t,(o,_)=>{if(!this.destroyed)return o?this._destroy(o):void this._onParsedTorrent(_)})}_onParsedTorrent(t){if(!this.destroyed){if(this._processParsedTorrent(t),!this.infoHash)return this._destroy(new Error("Malformed torrent data: No info hash"));this._rechokeIntervalId=setInterval(()=>{this._rechoke()},1e4),this._rechokeIntervalId.unref&&this._rechokeIntervalId.unref(),this.emit("_infoHash",this.infoHash),this.destroyed||(this.emit("infoHash",this.infoHash),this.destroyed||(this.client.listening?this._onListening():this.client.once("listening",()=>{this._onListening()})))}}_processParsedTorrent(t){this._debugId=(0,b.oc)(t.infoHash).substring(0,7),this.private!==void 0&&(t.private=this.private),this.announce&&(t.announce=t.announce.concat(this.announce)),this.client.tracker&&globalThis.WEBTORRENT_ANNOUNCE&&!t.private&&(t.announce=t.announce.concat(globalThis.WEBTORRENT_ANNOUNCE)),this.urlList&&(t.urlList=t.urlList.concat(this.urlList)),t.announce=Array.from(new Set(t.announce)),t.urlList=Array.from(new Set(t.urlList)),Object.assign(this,t),this.magnetURI=A(t),this.torrentFile=function(e){const o={info:e.info};return o["announce-list"]=(e.announce||[]).map(_=>(o.announce||(o.announce=_),[_=(0,b.gR)(_)])),o["url-list"]=e.urlList||[],e.private!==void 0&&(o.private=Number(e.private)),e.created&&(o["creation date"]=e.created.getTime()/1e3|0),e.createdBy&&(o["created by"]=e.createdBy),e.comment&&(o.comment=e.comment),k.Z.encode(o)}(t)}_onListening(){this.destroyed||(this.info?this._onMetadata(this):(this.xs&&this._getMetadataFromServer(),this._startDiscovery()))}_startDiscovery(){if(this.discovery||this.destroyed)return;let t=this.client.tracker;t&&(t=Object.assign({},this.client.tracker,{getAnnounceOpts:()=>{if(this.destroyed)return;const e={uploaded:this.uploaded,downloaded:this.downloaded,left:Math.max(this.length-this.downloaded,0)};return this.client.tracker.getAnnounceOpts&&Object.assign(e,this.client.tracker.getAnnounceOpts()),this._getAnnounceOpts&&Object.assign(e,this._getAnnounceOpts()),e}})),this.peerAddresses&&this.peerAddresses.forEach(e=>this.addPeer(e,Wt.default.SOURCE_MANUAL)),this.discovery=new ce({infoHash:this.infoHash,announce:this.announce,peerId:this.client.peerId,dht:!this.private&&this.client.dht,tracker:t,port:this.client.torrentPort,userAgent:Pe,lsd:this.client.lsd}),this.discovery.on("error",e=>{this._destroy(e)}),this.discovery.on("peer",(e,o)=>{this._debug("peer %s discovered via %s",e,o),typeof e=="string"&&this.done||this.addPeer(e,o)}),this.discovery.on("trackerAnnounce",()=>{this.emit("trackerAnnounce")}),this.discovery.on("dhtAnnounce",()=>{this.emit("dhtAnnounce")}),this.discovery.on("warning",e=>{this.emit("warning",e)}),this._noPeersIntervalId=setInterval(()=>{if(this.destroyed)return;const e={[Wt.default.SOURCE_TRACKER]:{enabled:!!this.client.tracker,numPeers:0},[Wt.default.SOURCE_DHT]:{enabled:!!this.client.dht,numPeers:0},[Wt.default.SOURCE_LSD]:{enabled:!!this.client.lsd,numPeers:0},[Wt.default.SOURCE_UT_PEX]:{enabled:this.client.utPex&&typeof _e=="function",numPeers:0}};for(const o of Object.values(this._peers)){const _=e[o.source];_!==void 0&&_.numPeers++}for(const o of Object.keys(e)){const _=e[o];_.enabled&&_.numPeers===0&&this.emit("noPeers",o)}},this._noPeersIntervalTime),this._noPeersIntervalId.unref&&this._noPeersIntervalId.unref()}_getMetadataFromServer(){const t=this,e=Array.isArray(this.xs)?this.xs:[this.xs];t._xsRequestsController=new AbortController;const o=t._xsRequestsController.signal,_=e.map(P=>I=>{(async function(j,O){if(j.indexOf("http://")!==0&&j.indexOf("https://")!==0)return t.emit("warning",new Error(`skipping non-http xs param: ${j}`)),O(null);const K={method:"GET",headers:{"user-agent":Pe},signal:o};let Z,et,ot;try{Z=await G(j,K)}catch{return t.emit("warning",new Error(`http error from xs param: ${j}`)),O(null)}if(t.destroyed||t.metadata)return O(null);if(Z.status!==200)return t.emit("warning",new Error(`non-200 status code ${Z.status} from xs param: ${j}`)),O(null);try{et=new Uint8Array(await Z.arrayBuffer())}catch(ft){return t.emit("warning",ft),O(null)}try{ot=await v(et)}catch{}if(!ot)return t.emit("warning",new Error(`got invalid torrent file from xs param: ${j}`)),O(null);if(ot.infoHash!==t.infoHash)return t.emit("warning",new Error(`got torrent file with incorrect info hash from xs param: ${j}`)),O(null);t._onMetadata(ot),O(null)})(P,I)});d(_)}async _onMetadata(t){var _;if(this.metadata||this.destroyed)return;let e;if(this._debug("got metadata"),(_=this._xsRequestsController)==null||_.abort(),this._xsRequestsController=null,t&&t.infoHash)e=t;else try{e=await v(t)}catch(P){return this._destroy(P)}this._processParsedTorrent(e),this.metadata=this.torrentFile,this.client.enableWebSeeds&&this.urlList.forEach(P=>{this.addWebSeed(P)}),this._rarityMap=new Ke(this),this.files=this.files.map(P=>new Ae(this,P));let o=this._preloadedStore;if(o||(o=new this._store(this.pieceLength,{...this.storeOpts,torrent:this,path:this.path,files:this.files,length:this.length,name:this.name+" - "+this.infoHash.slice(0,8),addUID:this.addUID,rootDir:this.rootDir,max:this._storeCacheSlots})),this._storeCacheSlots>0&&!(o instanceof rt||o instanceof Pt)&&(o=new Ct(o,{max:this._storeCacheSlots})),this.store=new Nt(o),this.so?this.files.forEach((P,I)=>{this.so.includes(I)?this.files[I].select():this.files[I].deselect()}):this.pieces.length!==0&&this.select(0,this.pieces.length-1,!1),this._hashes=this.pieces,this.pieces=this.pieces.map((P,I)=>{const j=I===this.pieces.length-1?this.lastPieceLength:this.pieceLength;return new Dt(j)}),this._reservations=this.pieces.map(()=>[]),this.bitfield=new vt.Z(this.pieces.length),this.emit("metadata"),!this.destroyed)if(this.skipVerify)this._markAllVerified(),this._onStore();else{const P=I=>{if(I)return this._destroy(I);this._debug("done verifying"),this._onStore()};this._debug("verifying existing torrent data"),this._fileModtimes&&this._store===Pt?this.getFileModtimes((I,j)=>{if(I)return this._destroy(I);this.files.map((O,K)=>j[K]===this._fileModtimes[K]).every(O=>O)?(this._markAllVerified(),this._onStore()):this._verifyPieces(P)}):this._verifyPieces(P)}}getFileModtimes(t){const e=[];It(this.files.map((o,_)=>P=>{const I=this.addUID?R.join(this.name+" - "+this.infoHash.slice(0,8)):R.join(this.path,o.path);_t.stat(I,(j,O)=>{if(j&&j.code!=="ENOENT")return P(j);e[_]=O&&O.mtime.getTime(),P(null)})}),Re,o=>{this._debug("done getting file modtimes"),t(o,e)})}_verifyPieces(t){It(this.pieces.map((e,o)=>_=>{if(this.destroyed)return _(new Error("torrent is destroyed"));const P={};o===this.pieces.length-1&&(P.length=this.lastPieceLength),this.store.get(o,P,async(I,j)=>{if(this.destroyed)return _(new Error("torrent is destroyed"));if(I)return g(()=>_(null));const O=await(0,b.vp)(j,"hex");if(this.destroyed)return _(new Error("torrent is destroyed"));O===this._hashes[o]?(this._debug("piece verified %s",o),this._markVerified(o)):(this._markUnverified(o),this._debug("piece invalid %s",o)),_(null)})}),Re,t)}rescanFiles(t){if(this.destroyed)throw new Error("torrent is destroyed");t||(t=Ee),this._verifyPieces(e=>{if(e)return this._destroy(e),t(e);this._checkDone(),t(null)})}_markAllVerified(){for(let t=0;t<this.pieces.length;t++)this._markVerified(t)}_markVerified(t){this.pieces[t]=null,this._reservations[t]=null,this.bitfield.set(t,!0)}_markUnverified(t){const e=t===this.pieces.length-1?this.lastPieceLength:this.pieceLength;this.pieces[t]=new Dt(e),this.bitfield.set(t,!1),this.select(t,t,1),this.files.forEach(o=>{o.done&&o.includes(t)&&(o.done=!1)})}_hasAllPieces(){for(let t=0;t<this.pieces.length;t++)if(!this.bitfield.get(t))return!1;return!0}_hasNoPieces(){return!this._hasMorePieces(0)}_hasMorePieces(t){let e=0;for(let o=0;o<this.pieces.length;o++)if(this.bitfield.get(o)&&(e+=1,e>t))return!0;return!1}_onStore(){this.destroyed||(this._debug("on store"),this._startDiscovery(),this.ready=!0,this.emit("ready"),this._checkDone(),this._updateSelections(),this.wires.forEach(t=>{t.ut_metadata&&t.ut_metadata.setMetadata(this.metadata),this._onWireWithMetadata(t)}))}destroy(t,e){if(typeof t=="function")return this.destroy(null,t);this._destroy(null,t,e)}_destroy(t,e,o){var P;if(typeof e=="function")return this._destroy(t,null,e);if(this.destroyed)return;this.destroyed=!0,this._debug("destroy"),this.client._remove(this),clearInterval(this._rechokeIntervalId),clearInterval(this._noPeersIntervalId),(P=this._xsRequestsController)==null||P.abort(),this._rarityMap&&this._rarityMap.destroy();for(const I in this._peers)this.removePeer(I);this.files.forEach(I=>{I instanceof Ae&&I._destroy()});const _=this._servers.map(I=>j=>{I.destroy(j)});if(this.discovery&&_.push(I=>{this.discovery.destroy(I)}),this.store){let I=this._destroyStoreOnDestroy;e&&e.destroyStore!==void 0&&(I=e.destroyStore),_.push(j=>{I?this.store.destroy(j):this.store.close(j)})}d(_,o),t&&(this.listenerCount("error")===0?this.client.emit("error",t):this.emit("error",t)),this.emit("close"),this.client=null,this.files=[],this.discovery=null,this.store=null,this._rarityMap=null,this._peers=null,this._servers=null,this._xsRequests=null}addPeer(t,e){if(this.destroyed)throw new Error("torrent is destroyed");if(!this.infoHash)throw new Error("addPeer() must not be called before the `infoHash` event");let o;if(this.client.blocked){if(typeof t=="string"){let I;try{I=ht(t)}catch{return this._debug("ignoring peer: invalid %s",t),this.emit("invalidPeer",t),!1}o=I[0]}else typeof t.remoteAddress=="string"&&(o=t.remoteAddress);if(o&&this.client.blocked.contains(o))return this._debug("ignoring peer: blocked %s",t),typeof t!="string"&&t.destroy(),this.emit("blockedPeer",t),!1}const _=this.client.utp&&this._isIPv4(o)?"utp":"tcp",P=!!this._addPeer(t,_,e);return P?this.emit("peer",t):this.emit("invalidPeer",t),P}_addPeer(t,e,o){if(this.destroyed)return typeof t!="string"&&t.destroy(),null;if(typeof t=="string"&&!this._validAddr(t))return this._debug("ignoring peer: invalid %s",t),null;const _=t&&t.id||t;if(this._peers[_])return this._debug("ignoring peer: duplicate (%s)",_),typeof t!="string"&&t.destroy(),null;if(this.paused)return this._debug("ignoring peer: torrent is paused"),typeof t!="string"&&t.destroy(),null;let P;return this._debug("add peer %s",_),P=typeof t=="string"?e==="utp"?Wt.default.createUTPOutgoingPeer(t,this,this.client.throttleGroups):Wt.default.createTCPOutgoingPeer(t,this,this.client.throttleGroups):Wt.default.createWebRTCPeer(t,this,this.client.throttleGroups),this._registerPeer(P),typeof t=="string"&&(this._queue.push(P),this._drain()),P}addWebSeed(t){if(this.destroyed)throw new Error("torrent is destroyed");let e,o;if(typeof t=="string"){if(e=t,!/^https?:\/\/.+/.test(e))return this.emit("warning",new Error(`ignoring invalid web seed: ${e}`)),void this.emit("invalidPeer",e);if(this._peers[e])return this.emit("warning",new Error(`ignoring duplicate web seed: ${e}`)),void this.emit("invalidPeer",e);o=new Xe(e,this)}else{if(!t||typeof t.connId!="string")return void this.emit("warning",new Error("addWebSeed must be passed a string or connection object with id property"));if(o=t,e=o.connId,this._peers[e])return this.emit("warning",new Error(`ignoring duplicate web seed: ${e}`)),void this.emit("invalidPeer",e)}this._debug("add web seed %s",e);const _=Wt.default.createWebSeedPeer(o,e,this,this.client.throttleGroups);this._registerPeer(_),this.emit("peer",e)}_addIncomingPeer(t){return this.destroyed?t.destroy(new Error("torrent is destroyed")):this.paused?t.destroy(new Error("torrent is paused")):(this._debug("add incoming peer %s",t.id),void this._registerPeer(t))}_registerPeer(t){t.on("download",e=>{this.destroyed||(this.received+=e,this._downloadSpeed(e),this.client._downloadSpeed(e),this.emit("download",e),this.destroyed||this.client.emit("download",e))}),t.on("upload",e=>{this.destroyed||(this.uploaded+=e,this._uploadSpeed(e),this.client._uploadSpeed(e),this.emit("upload",e),this.destroyed||this.client.emit("upload",e))}),this._peers[t.id]=t,this._peersLength+=1}removePeer(t){var o;const e=(t==null?void 0:t.id)||t;t&&!t.id&&(t=(o=this._peers)==null?void 0:o[e]),t&&(t.destroy(),this.destroyed||(this._debug("removePeer %s",e),delete this._peers[e],this._peersLength-=1,this._drain()))}select(t,e,o,_){if(this.destroyed)throw new Error("torrent is destroyed");if(t<0||e<t||this.pieces.length<=e)throw new Error(`invalid selection ${t} : ${e}`);o=Number(o)||0,this._debug("select %s-%s (priority %s)",t,e,o),this._selections.push({from:t,to:e,offset:0,priority:o,notify:_||Ee}),this._selections.sort((P,I)=>I.priority-P.priority),this._updateSelections()}deselect(t,e,o){if(this.destroyed)throw new Error("torrent is destroyed");o=Number(o)||0,this._debug("deselect %s-%s (priority %s)",t,e,o);for(let _=0;_<this._selections.length;++_){const P=this._selections[_];if(P.from===t&&P.to===e&&P.priority===o){this._selections.splice(_,1);break}}this._updateSelections()}critical(t,e){if(this.destroyed)throw new Error("torrent is destroyed");this._debug("critical %s-%s",t,e);for(let o=t;o<=e;++o)this._critical[o]=!0;this._updateSelections()}_onWire(t,e){if(this._debug("got wire %s (%s)",t._debugId,e||"Unknown"),this.wires.push(t),e){const o=ht(e);t.remoteAddress=o[0],t.remotePort=o[1]}this.client.dht&&this.client.dht.listening&&t.on("port",o=>{if(!this.destroyed&&!this.client.dht.destroyed){if(!t.remoteAddress)return this._debug("ignoring PORT from peer with no address");if(o===0||o>65536)return this._debug("ignoring invalid PORT from peer");this._debug("port: %s (from %s)",o,e),this.client.dht.addNode({host:t.remoteAddress,port:o})}}),t.on("timeout",()=>{this._debug("wire timeout (%s)",e),t.destroy()}),t.type!=="webSeed"&&t.setTimeout(3e4,!0),t.setKeepAlive(!0),t.use($e(this.metadata)),t.ut_metadata.on("warning",o=>{this._debug("ut_metadata warning: %s",o.message)}),this.metadata||(t.ut_metadata.on("metadata",o=>{this._debug("got metadata via ut_metadata"),this._onMetadata(o)}),t.ut_metadata.fetch()),this.client.utPex&&typeof _e=="function"&&!this.private&&(t.use(_e()),t.ut_pex.on("peer",o=>{this.done||(this._debug("ut_pex: got peer: %s (from %s)",o,e),this.addPeer(o,Wt.default.SOURCE_UT_PEX))}),t.ut_pex.on("dropped",o=>{const _=this._peers[o];_&&!_.connected&&(this._debug("ut_pex: dropped peer: %s (from %s)",o,e),this.removePeer(o))}),t.once("close",()=>{t.ut_pex.reset()})),t.use($t()),this.emit("wire",t,e),this.ready&&g(()=>{this._onWireWithMetadata(t)})}_onWireWithMetadata(t){let e=null;const o=()=>{this.destroyed||t.destroyed||(this._numQueued>2*(this._numConns-this.numPeers)&&t.amInterested?t.destroy():(e=setTimeout(o,be),e.unref&&e.unref()))};let _;const P=()=>{if(t.peerPieces.buffer.length===this.bitfield.buffer.length){for(_=0;_<this.pieces.length;++_)if(!t.peerPieces.get(_))return;t.isSeeder=!0,t.choke()}};t.on("bitfield",()=>{P(),this._update(),this._updateWireInterest(t)}),t.on("have",()=>{P(),this._update(),this._updateWireInterest(t)}),t.lt_donthave.on("donthave",()=>{P(),this._update(),this._updateWireInterest(t)}),t.on("have-all",()=>{t.isSeeder=!0,t.choke(),this._update(),this._updateWireInterest(t)}),t.on("have-none",()=>{t.isSeeder=!1,this._update(),this._updateWireInterest(t)}),t.on("allowed-fast",I=>{this._update()}),t.once("interested",()=>{t.unchoke()}),t.once("close",()=>{clearTimeout(e)}),t.on("choke",()=>{clearTimeout(e),e=setTimeout(o,be),e.unref&&e.unref()}),t.on("unchoke",()=>{clearTimeout(e),this._update()}),t.on("request",(I,j,O,K)=>{if(O>131072)return t.destroy();this.pieces[I]||this.store.get(I,{offset:j,length:O},K)}),t.hasFast&&this._hasAllPieces()?t.haveAll():t.hasFast&&this._hasNoPieces()?t.haveNone():t.bitfield(this.bitfield),this._updateWireInterest(t),t.peerExtensions.dht&&this.client.dht&&this.client.dht.listening&&t.port(this.client.dht.address().port),t.type!=="webSeed"&&(e=setTimeout(o,be),e.unref&&e.unref()),t.isSeeder=!1,P()}_updateSelections(){this.ready&&!this.destroyed&&(g(()=>{this._gcSelections()}),this._updateInterest(),this._update())}_gcSelections(){for(let t=0;t<this._selections.length;++t){const e=this._selections[t],o=e.offset;for(;this.bitfield.get(e.from+e.offset)&&e.from+e.offset<e.to;)e.offset+=1;o!==e.offset&&e.notify(),e.to===e.from+e.offset&&this.bitfield.get(e.from+e.offset)&&(this._selections.splice(t,1),t-=1,e.notify(),this._updateInterest())}this._selections.length||this.emit("idle")}_updateInterest(){const t=this._amInterested;this._amInterested=!!this._selections.length,this.wires.forEach(e=>this._updateWireInterest(e)),t!==this._amInterested&&(this._amInterested?this.emit("interested"):this.emit("uninterested"))}_updateWireInterest(t){let e=!1;for(let o=0;o<this.pieces.length;++o)if(this.pieces[o]&&t.peerPieces.get(o)){e=!0;break}e?t.interested():t.uninterested()}_update(){if(this.destroyed)return;const t=me(this.wires);let e;for(;e=t();)this._updateWireWrapper(e)}_updateWireWrapper(t){const e=this;typeof window<"u"&&typeof window.requestIdleCallback=="function"?window.requestIdleCallback(()=>{e._updateWire(t)},{timeout:250}):e._updateWire(t)}_updateWire(t){if(t.destroyed)return!1;const e=this,o=xe(t,.5);if(t.requests.length>=o)return;const _=xe(t,1);if(t.peerChoking)t.hasFast&&t.peerAllowedFastSet.length>0&&!this._hasMorePieces(t.peerAllowedFastSet.length-1)&&function(){if(t.requests.length>=_)return!1;for(const O of t.peerAllowedFastSet){if(t.peerPieces.get(O)&&!e.bitfield.get(O))for(;e._request(t,O,!1)&&t.requests.length<_;);if(!(t.requests.length<_))return!0}}();else{if(!t.downloaded)return function(){if(t.requests.length)return;let O=e._selections.length;for(;O--;){const K=e._selections[O];let Z;if(e.strategy==="rarest"){const et=K.from+K.offset,ot=K.to,ft=ot-et+1,St={};let Ot=0;const jt=P(et,ot,St);for(;Ot<ft&&(Z=e._rarityMap.getRarestPiece(jt),!(Z<0));){if(e._request(t,Z,!1))return;St[Z]=!0,Ot+=1}}else for(Z=K.to;Z>=K.from+K.offset;--Z)if(t.peerPieces.get(Z)&&e._request(t,Z,!1))return}}();j(!1)||j(!0)}function P(O,K,Z,et){return ot=>ot>=O&&ot<=K&&!(ot in Z)&&t.peerPieces.get(ot)&&(!et||et(ot))}function I(O){let K=O;for(let et=O;et<e._selections.length&&e._selections[et].priority;et++)K=et;const Z=e._selections[O];e._selections[O]=e._selections[K],e._selections[K]=Z}function j(O){if(t.requests.length>=_)return!0;const K=function(){const Z=t.downloadSpeed()||1;if(Z>we)return()=>!0;const et=Math.max(1,t.requests.length)*Dt.BLOCK_LENGTH/Z;let ot=10,ft=0;return St=>{if(!ot||e.bitfield.get(St))return!0;let Ot=e.pieces[St].missing;for(;ft<e.wires.length;ft++){const jt=e.wires[ft],Ut=jt.downloadSpeed();if(!(Ut<we)&&!(Ut<=Z)&&jt.peerPieces.get(St)&&!((Ot-=Ut*et)>0))return ot--,!1}return!0}}();for(let Z=0;Z<e._selections.length;Z++){const et=e._selections[Z];let ot;if(e.strategy==="rarest"){const ft=et.from+et.offset,St=et.to,Ot=St-ft+1,jt={};let Ut=0;const Kt=P(ft,St,jt,K);for(;Ut<Ot&&(ot=e._rarityMap.getRarestPiece(Kt),!(ot<0));){for(;e._request(t,ot,e._critical[ot]||O)&&t.requests.length<_;);if(!(t.requests.length<_))return et.priority&&I(Z),!0;jt[ot]=!0,Ut++}}else for(ot=et.from+et.offset;ot<=et.to;ot++)if(t.peerPieces.get(ot)&&K(ot)){for(;e._request(t,ot,e._critical[ot]||O)&&t.requests.length<_;);if(!(t.requests.length<_))return et.priority&&I(Z),!0}}return!1}}_rechoke(){if(!this.ready)return;const t=this.wires.map(_=>({wire:_,random:Math.random()})).sort((_,P)=>{const I=_.wire,j=P.wire;return I.downloadSpeed()!==j.downloadSpeed()?I.downloadSpeed()-j.downloadSpeed():I.uploadSpeed()!==j.uploadSpeed()?I.uploadSpeed()-j.uploadSpeed():I.amChoking!==j.amChoking?I.amChoking?-1:1:_.random-P.random}).map(_=>_.wire);this._rechokeOptimisticTime<=0?this._rechokeOptimisticWire=null:this._rechokeOptimisticTime-=1;let e=0;for(;t.length>0&&e<this._rechokeNumSlots-1;){const _=t.pop();_.isSeeder||_===this._rechokeOptimisticWire||(_.unchoke(),_.peerInterested&&e++)}if(this._rechokeOptimisticWire===null&&this._rechokeNumSlots>0){const _=t.filter(P=>P.peerInterested);if(_.length>0){const P=_[o=_.length,Math.random()*o|0];P.unchoke(),this._rechokeOptimisticWire=P,this._rechokeOptimisticTime=2}}var o;t.filter(_=>_!==this._rechokeOptimisticWire).forEach(_=>_.choke())}_hotswap(t,e){const o=t.downloadSpeed();if(o<Dt.BLOCK_LENGTH||!this._reservations[e])return!1;const _=this._reservations[e];if(!_)return!1;let P,I,j=1/0;for(I=0;I<_.length;I++){const O=_[I];if(!O||O===t)continue;const K=O.downloadSpeed();K>=we||2*K>o||K>j||(P=O,j=K)}if(!P)return!1;for(I=0;I<_.length;I++)_[I]===P&&(_[I]=null);for(I=0;I<P.requests.length;I++){const O=P.requests[I];O.piece===e&&this.pieces[e].cancel(O.offset/Dt.BLOCK_LENGTH|0)}return this.emit("hotswap",P,t,e),!0}_request(t,e,o){const _=this,P=t.requests.length,I=t.type==="webSeed";if(_.bitfield.get(e))return!1;const j=I?Math.min(function(Ot,jt,Ut){return 1+Math.ceil(jt*Ot.downloadSpeed()/Ut)}(t,1,_.pieceLength),_.maxWebConns):xe(t,1);if(P>=j)return!1;const O=_.pieces[e];let K=I?O.reserveRemaining():O.reserve();if(K===-1&&o&&_._hotswap(t,e)&&(K=I?O.reserveRemaining():O.reserve()),K===-1)return!1;let Z=_._reservations[e];Z||(Z=_._reservations[e]=[]);let et=Z.indexOf(null);et===-1&&(et=Z.length),Z[et]=t;const ot=O.chunkOffset(K),ft=I?O.chunkLengthRemaining(K):O.chunkLength(K);function St(){g(()=>{_._update()})}return t.request(e,ot,ft,async function Ot(jt,Ut){if(_.destroyed)return;if(!_.ready)return _.once("ready",()=>{Ot(jt,Ut)});if(Z[et]===t&&(Z[et]=null),O!==_.pieces[e])return St();if(jt)return _._debug("error getting piece %s (offset: %s length: %s) from %s: %s",e,ot,ft,`${t.remoteAddress}:${t.remotePort}`,jt.message),I?O.cancelRemaining(K):O.cancel(K),void St();if(_._debug("got piece %s (offset: %s length: %s) from %s",e,ot,ft,`${t.remoteAddress}:${t.remotePort}`),!O.set(K,Ut,t))return St();const Kt=O.flush(),oe=await(0,b.vp)(Kt,"hex");_.destroyed||(oe===_._hashes[e]?(_._debug("piece verified %s",e),_.store.put(e,Kt,ae=>{ae?_._destroy(ae):(_.pieces[e]=null,_._markVerified(e),_.wires.forEach(Te=>{Te.have(e)}),_._checkDone()&&!_.destroyed&&_.discovery.complete(),St())})):(_.pieces[e]=new Dt(O.length),_.emit("warning",new Error(`Piece ${e} failed verification`)),St()))}),!0}_checkDone(){if(this.destroyed)return;this.files.forEach(e=>{if(!e.done){for(let o=e._startPiece;o<=e._endPiece;++o)if(!this.bitfield.get(o))return;e.done=!0,e.emit("done"),this._debug(`file done: ${e.name}`)}});let t=!0;for(const e of this._selections){for(let o=e.from;o<=e.to;o++)if(!this.bitfield.get(o)){t=!1;break}if(!t)break}return!this.done&&t?(this.done=!0,this._debug(`torrent done: ${this.infoHash}`),this.emit("done")):this.done=!1,this._gcSelections(),t}async load(t,e){if(this.destroyed)throw new Error("torrent is destroyed");if(!this.ready)return this.once("ready",()=>{this.load(t,e)});Array.isArray(t)||(t=[t]),e||(e=Ee);try{await At(this.store,r(t),{chunkLength:this.pieceLength}),this._markAllVerified(),this._checkDone(),e(null)}catch(o){return e(o),o}}pause(){this.destroyed||(this._debug("pause"),this.paused=!0)}resume(){this.destroyed||(this._debug("resume"),this.paused=!1,this._drain())}_debug(){const t=[].slice.call(arguments);t[0]=`[${this.client?this.client._debugId:"No Client"}] [${this._debugId}] ${t[0]}`,tr(...t)}_drain(){if(this._debug("_drain numConns %s maxConns %s",this._numConns,this.client.maxConns),typeof Tt.connect!="function"||this.destroyed||this.paused||this._numConns>=this.client.maxConns)return;this._debug("drain (%s queued, %s/%s peers)",this._numQueued,this.numPeers,this.client.maxConns);const t=this._queue.shift();if(!t)return;this._debug("%s connect attempt to %s",t.type,t.addr);const e=ht(t.addr),o={host:e[0],port:e[1]};this.client.utp&&t.type===Wt.default.TYPE_UTP_OUTGOING?t.conn=Ye.connect(o.port,o.host):t.conn=Tt.connect(o);const _=t.conn;_.once("connect",()=>{this.destroyed||t.onConnect()}),_.once("error",P=>{t.destroy(P)}),t.startConnectTimeout(),_.on("close",()=>{if(this.destroyed)return;if(t.retries>=ve.length){if(this.client.utp){const j=this._addPeer(t.addr,"tcp",t.source);j&&(j.retries=0)}else this._debug("conn %s closed: will not re-add (max %s attempts)",t.addr,ve.length);return}const P=ve[t.retries];this._debug("conn %s closed: will re-add to queue in %sms (attempt %s)",t.addr,P,t.retries+1);const I=setTimeout(()=>{if(this.destroyed)return;const j=ht(t.addr)[0],O=this.client.utp&&this._isIPv4(j)?"utp":"tcp",K=this._addPeer(t.addr,O,t.source);K&&(K.retries=t.retries+1)},P);I.unref&&I.unref()})}_validAddr(t){let e;try{e=ht(t)}catch{return!1}const o=e[0],_=e[1];return _>0&&_<65535&&!(o==="127.0.0.1"&&_===this.client.torrentPort)}_isIPv4(t){return/^((?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])[.]){3}(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])$/.test(t)}}function xe(M,t){let e=2+Math.ceil(t*M.downloadSpeed()/Dt.BLOCK_LENGTH);if(M.peerExtendedHandshake){const o=M.peerExtendedHandshake.reqq;typeof o=="number"&&o>0&&(e=Math.min(e,o))}return e}function Ee(){}var er=it(3423),Vt=it(5573),Le=it(4286),rr=it(4622);class Ht{constructor(t,e={}){this.client=t,e.origin||(e.origin="*"),this.opts=e,this.pendingReady=new Set}static serveIndexPage(t,e,o){const _=e.map(P=>`<li>
        <a href="${Vt(o)}/${P.infoHash}">
          ${Vt(P.name)}
        </a>
        (${Vt(P.length)} bytes)
      </li>`).join("<br>");return t.status=200,t.headers["Content-Type"]="text/html",t.body=de("WebTorrent",`<h1>WebTorrent</h1>
         <ol>${_}</ol>`),t}isOriginAllowed(t){return this.opts.origin!==!1&&(this.opts.origin==="*"||t.headers.origin===this.opts.origin)}static serveMethodNotAllowed(t){return t.status=405,t.headers["Content-Type"]="text/html",t.body=de("405 - Method Not Allowed","<h1>405 - Method Not Allowed</h1>"),t}static serve404Page(t){return t.status=404,t.headers["Content-Type"]="text/html",t.body=de("404 - Not Found","<h1>404 - Not Found</h1>"),t}static serveTorrentPage(t,e,o){const _=t.files.map(P=>`<li>
      <a href="${Vt(o)}/${t.infoHash}/${Vt(P.path)}">
        ${Vt(P.path)}
      </a>
      (${Vt(P.length)} bytes)
    </li>`).join("<br>");return e.status=200,e.headers["Content-Type"]="text/html",e.body=de(`${Vt(t.name)} - WebTorrent`,`<h1>${Vt(t.name)}</h1>
        <ol>${_}</ol>`),e}static serveOptionsRequest(t,e){return e.status=204,e.headers["Access-Control-Max-Age"]="600",e.headers["Access-Control-Allow-Methods"]="GET,HEAD",t.headers["access-control-request-headers"]&&(e.headers["Access-Control-Allow-Headers"]=t.headers["access-control-request-headers"]),e}static serveFile(t,e,o){o.status=200,o.headers.Expires="0",o.headers["Cache-Control"]="no-cache, no-store, must-revalidate, max-age=0",o.headers["Accept-Ranges"]="bytes",o.headers["Content-Type"]=t.type,o.headers["transferMode.dlna.org"]="Streaming",o.headers["contentFeatures.dlna.org"]="DLNA.ORG_OP=01;DLNA.ORG_CI=0;DLNA.ORG_FLAGS=01700000000000000000000000000000",e.destination==="document"?(o.headers["Content-Type"]="application/octet-stream",o.headers["Content-Disposition"]=`attachment; filename*=UTF-8''${Oe(t.name)}`,o.body="DOWNLOAD"):o.headers["Content-Disposition"]=`inline; filename*=UTF-8''${Oe(t.name)}`;let _=rr(t.length,e.headers.range||"");if(Array.isArray(_)?(o.status=206,_=_[0],o.headers["Content-Range"]=`bytes ${_.start}-${_.end}/${t.length}`,o.headers["Content-Length"]=_.end-_.start+1):(o.statusCode=200,_=null,o.headers["Content-Length"]=t.length),e.method==="GET"){const P=t[Symbol.asyncIterator](_);let I=null;t.emit("iterator",{iterator:P,req:e,file:t},K=>{I=K});const j=ue.Readable.from(I||P);let O=null;t.emit("stream",{stream:j,req:e,file:t},K=>{O=Le(j,K)}),o.body=O||j}else o.body=!1;return o}async onRequest(t,e){let o=new URL(t.url,"http://example.com").pathname;o=o.slice(o.indexOf(this.pathname)+this.pathname.length+1);const _={headers:{"X-Content-Type-Options":"nosniff","Content-Security-Policy":"base-uri 'none'; frame-ancestors 'none'; form-action 'none';"}};if(this.isOriginAllowed(t)&&(_.headers["Access-Control-Allow-Origin"]=this.opts.origin==="*"?"*":t.headers.origin),o==="favicon.ico")return e(Ht.serve404Page(_));if(t.method==="OPTIONS")return this.isOriginAllowed(t)?e(Ht.serveOptionsRequest(t,_)):e(Ht.serveMethodNotAllowed(_));const P=async()=>{this.pendingReady.delete(P);const j=await I();e(j)},I=async()=>{if(o==="")return Ht.serveIndexPage(_,this.client.torrents,this.pathname);let[j,...O]=o.split("/");O=decodeURI(O.join("/"));const K=await this.client.get(j);if(!j||!K)return Ht.serve404Page(_);if(!O)return Ht.serveTorrentPage(K,_,this.pathname);const Z=K.files.find(et=>et.path.replace(/\\/g,"/")===O);return Z?Ht.serveFile(Z,t,_):Ht.serve404Page(_)};if(t.method==="GET"||t.method==="HEAD"){if(this.client.ready){const j=await I();return e(j)}return this.pendingReady.add(P),void this.client.once("ready",P)}return Ht.serveMethodNotAllowed(_)}close(t=()=>{}){this.closed=!0,this.pendingReady.forEach(e=>{this.client.removeListener("ready",e)}),this.pendingReady.clear(),g(t)}destroy(t=()=>{}){this.closed?g(t):this.close(t),this.client=null}}class nr extends Ht{constructor(t,e){super(t,e),this.server=er.createServer(),this._listen=this.server.listen,this.server.listen=this.listen.bind(this),this._close=this.server.close,this.server.close=this.close.bind(this),this.sockets=new Set,this.closed=!1,this.pathname=(e==null?void 0:e.pathname)||"/webtorrent"}wrapRequest(t,e){return this.opts.hostname&&t.headers.host!==`${this.opts.hostname}:${this.server.address().port}`?t.destroy():new URL(t.url,"http://example.com").pathname.startsWith(this.pathname)?void this.onRequest(t,({status:o,headers:_,body:P})=>{e.writeHead(o,_),P instanceof ue.Readable?Le(P,e):e.end(P)}):t.destroy()}onConnection(t){t.setTimeout(36e6),this.sockets.add(t),t.once("close",()=>{this.sockets.delete(t)})}address(){return this.server.address()}listen(...t){return this.closed=!1,this.server.on("connection",this.onConnection.bind(this)),this.server.on("request",this.wrapRequest.bind(this)),this._listen.apply(this.server,t)}close(t=()=>{}){this.server.removeAllListeners("connection"),this.server.removeAllListeners("request"),super.close(),this._close.call(this.server,t)}destroy(t){this.sockets.forEach(e=>{e.destroy()}),super.destroy(t)}}class ir extends Ht{constructor(t,e){super(t,e),this.registration=e.controller,this.workerKeepAliveInterval=null,this.workerPortCount=0;const o=new URL(e.controller.scope);this.pathname=o.pathname+"webtorrent",this._address={port:o.port,family:"IPv4",address:o.hostname},this.boundHandler=this.wrapRequest.bind(this),navigator.serviceWorker.addEventListener("message",this.boundHandler),fetch(`${this.pathname}/cancel/`).then(_=>{_.body.cancel()})}wrapRequest(t){const e=t.data;if(!(e!=null&&e.type)==="webtorrent"||!e.url)return null;const[o]=t.ports;this.onRequest(e,({status:_,headers:P,body:I})=>{const j=I instanceof ue.Readable&&I[Symbol.asyncIterator](),O=()=>{o.onmessage=null,I!=null&&I.destroy&&I.destroy(),this.workerPortCount--,this.workerPortCount||(clearInterval(this.workerKeepAliveInterval),this.workerKeepAliveInterval=null)};o.onmessage=async K=>{if(K.data){let Z;try{Z=(await j.next()).value}catch{}o.postMessage(Z),Z||O(),this.workerKeepAliveInterval||(this.workerKeepAliveInterval=setInterval(()=>fetch(`${this.pathname}/keepalive/`),2e4))}else O()},this.workerPortCount++,o.postMessage({status:_,headers:P,body:j?"STREAM":I})})}listen(t,e){e()}address(){return this._address}close(t){navigator.serviceWorker.removeEventListener("message",this.boundHandler),super.close(t)}destroy(t){super.destroy(t)}}function de(M,t){return`
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="utf-8">
        <title>${M}</title>
      </head>
      <body>
        ${t}
      </body>
    </html>
  `}function Oe(M){return encodeURIComponent(M).replace(/['()]/g,escape).replace(/\*/g,"%2A").replace(/%(?:7C|60|5E)/g,unescape)}const Se=ye,sr=U("webtorrent"),Be=Se.replace(/\d*./g,M=>("0"+M%100).slice(-2)).slice(0,4),or=`-WW${Be}-`;class Qt extends N{constructor(t={}){super(),typeof t.peerId=="string"?this.peerId=t.peerId:ArrayBuffer.isView(t.peerId)?this.peerId=(0,b.oc)(t.peerId):this.peerId=(0,b.oc)((0,b.gR)(or+(0,b.te)(Y(9)))),this.peerIdBuffer=(0,b._0)(this.peerId),typeof t.nodeId=="string"?this.nodeId=t.nodeId:ArrayBuffer.isView(t.nodeId)?this.nodeId=(0,b.oc)(t.nodeId):this.nodeId=(0,b.oc)(Y(20)),this.nodeIdBuffer=(0,b._0)(this.nodeId),this._debugId=(0,b.oc)(this.peerId).substring(0,7),this.destroyed=!1,this.listening=!1,this.torrentPort=t.torrentPort||0,this.dhtPort=t.dhtPort||0,this.tracker=t.tracker!==void 0?t.tracker:{},this.lsd=t.lsd!==!1,this.utPex=t.utPex!==!1,this.torrents=[],this.maxConns=Number(t.maxConns)||55,this.utp=Qt.UTP_SUPPORT&&t.utp!==!1,this._downloadLimit=Math.max(typeof t.downloadLimit=="number"?t.downloadLimit:-1,-1),this._uploadLimit=Math.max(typeof t.uploadLimit=="number"?t.uploadLimit:-1,-1),t.secure===!0&&Promise.resolve().then(it.bind(it,3287)).then(({enableSecure:o})=>o()),this._debug("new webtorrent (peerId %s, nodeId %s, port %s)",this.peerId,this.nodeId,this.torrentPort),this.throttleGroups={down:new st.ThrottleGroup({rate:Math.max(this._downloadLimit,0),enabled:this._downloadLimit>=0}),up:new st.ThrottleGroup({rate:Math.max(this._uploadLimit,0),enabled:this._uploadLimit>=0})},this.tracker&&(typeof this.tracker!="object"&&(this.tracker={}),globalThis.WRTC&&!this.tracker.wrtc&&(this.tracker.wrtc=globalThis.WRTC)),typeof ut=="function"?this._connPool=new ut(this):g(()=>{this._onListening()}),this._downloadSpeed=Q(),this._uploadSpeed=Q(),t.dht!==!1&&typeof D.Client=="function"?(this.dht=new D.Client(Object.assign({},{nodeId:this.nodeId},t.dht)),this.dht.once("error",o=>{this._destroy(o)}),this.dht.once("listening",()=>{const o=this.dht.address();o&&(this.dhtPort=o.port)}),this.dht.setMaxListeners(0),this.dht.listen(this.dhtPort)):this.dht=!1,this.enableWebSeeds=t.webSeeds!==!1;const e=()=>{this.destroyed||(this.ready=!0,this.emit("ready"))};typeof W=="function"&&t.blocklist!=null?W(t.blocklist,{headers:{"user-agent":`WebTorrent/${Se} (https://webtorrent.io)`}},(o,_)=>{if(o)return console.error(`Failed to load blocklist: ${o.message}`);this.blocked=_,e()}):g(e)}createServer(t,e){if(this.destroyed)throw new Error("torrent is destroyed");if(this._server)throw new Error("server already created");if(typeof window<"u"&&e!=="node"||e==="browser"){if(!((t==null?void 0:t.controller)instanceof ServiceWorkerRegistration))throw new Error("Invalid worker registration");if(t.controller.active.state!=="activated")throw new Error("Worker isn't activated");return this._server=new ir(this,t),this._server}return this._server=new nr(this,t),this._server}get downloadSpeed(){return this._downloadSpeed()}get uploadSpeed(){return this._uploadSpeed()}get progress(){const t=this.torrents.filter(e=>e.progress!==1);return t.reduce((e,o)=>e+o.downloaded,0)/(t.reduce((e,o)=>e+(o.length||0),0)||1)}get ratio(){return this.torrents.reduce((t,e)=>t+e.uploaded,0)/(this.torrents.reduce((t,e)=>t+e.received,0)||1)}async get(t){if(t instanceof Ie){if(this.torrents.includes(t))return t}else{const e=this.torrents;let o;try{o=await v(t)}catch{}if(!o)return null;if(!o.infoHash)throw new Error("Invalid torrent identifier");for(const _ of e)if(_.infoHash===o.infoHash)return _}return null}add(t,e={},o=()=>{}){if(this.destroyed)throw new Error("client is destroyed");typeof e=="function"&&([e,o]=[{},e]);const _=()=>{if(!this.destroyed){for(const j of this.torrents)if(j.infoHash===I.infoHash&&j!==I)return I._destroy(new Error(`Cannot add duplicate torrent ${I.infoHash}`)),void o(j)}},P=()=>{this.destroyed||(o(I),this.emit("torrent",I))};this._debug("add"),e=e?Object.assign({},e):{};const I=new Ie(t,this,e);return this.torrents.push(I),I.once("_infoHash",_),I.once("ready",P),I.once("close",function j(){I.removeListener("_infoHash",_),I.removeListener("ready",P),I.removeListener("close",j)}),I}seed(t,e,o){if(this.destroyed)throw new Error("client is destroyed");typeof e=="function"&&([e,o]=[{},e]),this._debug("seed"),(e=e?Object.assign({},e):{}).skipVerify=!0;const _=typeof t=="string";_&&(e.path=R.dirname(t)),e.createdBy||(e.createdBy=`WebTorrent/${Be}`);const P=K=>{this._debug("on seed"),typeof o=="function"&&o(K),K.emit("seed"),this.emit("seed",K)},I=this.add(null,e,K=>{const Z=[et=>{if(_||e.preloadedStore)return et();K.load(j,et)}];this.dht&&Z.push(et=>{K.once("dhtAnnounce",et)}),d(Z,et=>{if(!this.destroyed)return et?K._destroy(et):void P(K)})});let j;var O;return O=t,typeof FileList<"u"&&O instanceof FileList?t=Array.from(t):Array.isArray(t)||(t=[t]),d(t.map(K=>Z=>{!e.preloadedStore&&function(et){return typeof et=="object"&&et!=null&&typeof et.pipe=="function"}(K)?y(K,(et,ot)=>{if(et)return Z(et);ot.name=K.name,Z(null,ot)}):Z(null,K)}),(K,Z)=>{if(!this.destroyed)return K?I._destroy(K):void function(et,ot,ft){typeof ot=="function"&&([ot,ft]=[ft,ot]),a(et,ot=ot?Object.assign({},ot):{},ft)}(Z,e,(et,ot)=>{if(!this.destroyed){if(et)return I._destroy(et);j=ot.map(ft=>ft.getStream),H(Z,e,async(ft,St)=>{if(this.destroyed)return;if(ft)return I._destroy(ft);const Ot=await this.get(St);Ot?(console.warn("A torrent with the same id is already being seeded"),I._destroy(),typeof o=="function"&&o(Ot)):I._onTorrentId(St)})}})}),I}async remove(t,e,o){if(typeof e=="function")return this.remove(t,null,e);this._debug("remove");const _=await this.get(t);if(!_)throw new Error(`No torrent with id ${t}`);this._remove(_,e,o)}_remove(t,e,o){if(t){if(typeof e=="function")return this._remove(t,null,e);this.torrents.splice(this.torrents.indexOf(t),1),t.destroy(e,o),this.dht&&this.dht._tables.remove(t.infoHash)}}address(){return this.listening?this._connPool?this._connPool.tcpServer.address():{address:"0.0.0.0",family:"IPv4",port:0}:null}throttleDownload(t){return t=Number(t),!(isNaN(t)||!isFinite(t)||t<-1)&&(this._downloadLimit=t,this._downloadLimit<0?this.throttleGroups.down.setEnabled(!1):(this.throttleGroups.down.setEnabled(!0),void this.throttleGroups.down.setRate(this._downloadLimit)))}throttleUpload(t){return t=Number(t),!(isNaN(t)||!isFinite(t)||t<-1)&&(this._uploadLimit=t,this._uploadLimit<0?this.throttleGroups.up.setEnabled(!1):(this.throttleGroups.up.setEnabled(!0),void this.throttleGroups.up.setRate(this._uploadLimit)))}destroy(t){if(this.destroyed)throw new Error("client already destroyed");this._destroy(null,t)}_destroy(t,e){this._debug("client destroy"),this.destroyed=!0;const o=this.torrents.map(_=>P=>{_.destroy(P)});this._connPool&&o.push(_=>{this._connPool.destroy(_)}),this.dht&&o.push(_=>{this.dht.destroy(_)}),this._server&&o.push(_=>{this._server.destroy(_)}),d(o,e),t&&this.emit("error",t),this.torrents=[],this._connPool=null,this.dht=null,this.throttleGroups.down.destroy(),this.throttleGroups.up.destroy()}_onListening(){if(this._debug("listening"),this.listening=!0,this._connPool){const t=this._connPool.tcpServer.address();t&&(this.torrentPort=t.port)}this.emit("listening")}_debug(){const t=[].slice.call(arguments);t[0]=`[${this._debugId}] ${t[0]}`,sr(...t)}async _getByHash(t){for(const e of this.torrents)if(e.infoHashHash||(e.infoHashHash=await(0,b.vp)((0,b._0)("72657132"+e.infoHash),"hex")),t===e.infoHashHash)return e;return null}}Qt.WEBRTC_SUPPORT=q.WEBRTC_SUPPORT,Qt.UTP_SUPPORT=ut.UTP_SUPPORT,Qt.VERSION=Se})();var ur=We.Z;export{ur as default};
