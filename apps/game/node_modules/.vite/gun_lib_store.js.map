{
  "version": 3,
  "sources": ["../../../../node_modules/.pnpm/gun@0.2020.1235/node_modules/gun/lib/store.js", "dep:gun_lib_store"],
  "sourcesContent": ["var Gun = (typeof window !== \"undefined\")? window.Gun : require('../gun');\n\nGun.on('create', function(root){\n    if(Gun.TESTING){ root.opt.file = 'radatatest' }\n    this.to.next(root);\n    var opt = root.opt, empty = {}, u;\n    if(false === opt.rad || false === opt.radisk){ return }\n    if((u+'' != typeof process) && 'false' === ''+(process.env||'').RAD){ return }\n    var Radisk = (Gun.window && Gun.window.Radisk) || require('./radisk');\n    var Radix = Radisk.Radix;\n    var dare = Radisk(opt), esc = String.fromCharCode(27);\n    var ST = 0;\n \n    root.on('put', function(msg){\n        this.to.next(msg);\n        if((msg._||'').rad){ return } // don't save what just came from a read.\n        var id = msg['#'], put = msg.put, soul = put['#'], key = put['.'], val = put[':'], state = put['>'], tmp;\n        var DBG = (msg._||'').DBG; DBG && (DBG.sp = DBG.sp || +new Date);\n        //var lot = (msg._||'').lot||''; count[id] = (count[id] || 0) + 1; \n        var S = (msg._||'').RPS || ((msg._||'').RPS = +new Date);\n        //console.log(\"PUT ------->>>\", soul,key, val, state);\n        //dare(soul+esc+key, {':': val, '>': state}, dare.one[id] || function(err, ok){\n        dare(soul+esc+key, {':': val, '>': state}, function(err, ok){\n            //console.log(\"<<<------- PAT\", soul,key, val, state, 'in', +new Date - S);\n            DBG && (DBG.spd = DBG.spd || +new Date);\n            console.STAT && console.STAT(S, +new Date - S, 'put');\n            //if(!err && count[id] !== lot.s){ console.log(err = \"Disk count not same as ram count.\"); console.STAT && console.STAT(+new Date, lot.s - count[id], 'put ack != count') } delete count[id];\n            if(err){ root.on('in', {'@': id, err: err, DBG: DBG}); return }\n            root.on('in', {'@': id, ok: ok, DBG: DBG});\n        //}, id, DBG && (DBG.r = DBG.r || {}));\n        }, false && id, DBG && (DBG.r = DBG.r || {}));\n        DBG && (DBG.sps = DBG.sps || +new Date);\n    });\n    var count = {}, obj_empty = Object.empty;\n \n    root.on('get', function(msg){\n        this.to.next(msg);\n        var ctx = msg._||'', DBG = ctx.DBG = msg.DBG; DBG && (DBG.sg = +new Date);\n        var id = msg['#'], get = msg.get, soul = msg.get['#'], has = msg.get['.']||'', o = {}, graph, lex, key, tmp, force;\n        if('string' == typeof soul){\n            key = soul;\n        } else \n        if(soul){\n            if(u !== (tmp = soul['*'])){ o.limit = force = 1 }\n            if(u !== soul['>']){ o.start = soul['>'] }\n            if(u !== soul['<']){ o.end = soul['<'] }\n            key = force? (''+tmp) : tmp || soul['='];\n            force = null;\n        }\n        if(key && !o.limit){ // a soul.has must be on a soul, and not during soul*\n            if('string' == typeof has){\n                key = key+esc+(o.atom = has);\n            } else \n            if(has){\n                if(u !== has['>']){ o.start = has['>']; o.limit = 1 }\n                if(u !== has['<']){ o.end = has['<']; o.limit = 1 }\n                if(u !== (tmp = has['*'])){ o.limit = force = 1 }\n                if(key){ key = key+esc + (force? (''+(tmp||'')) : tmp || (o.atom = has['='] || '')) }\n            }\n        }\n        if((tmp = get['%']) || o.limit){\n            o.limit = (tmp <= (o.pack || (1000 * 100)))? tmp : 1;\n        }\n        if(has['-'] || (soul||{})['-'] || get['-']){ o.reverse = true }\n        if((tmp = (root.next||'')[soul]) && tmp.put){\n            if(o.atom){\n                tmp = (tmp.next||'')[o.atom] ;\n                if(tmp && tmp.rad){ return }\n            } else\n            if(tmp && tmp.rad){ return }\n        }\n        var now = Gun.state();\n        var S = (+new Date), C = 0, SPT = 0; // STATS!\n        DBG && (DBG.sgm = S);\n        //var GID = String.random(3); console.log(\"GET ------->>>\", GID, key, o, '?', get);\n        dare(key||'', function(err, data, info){\n            //console.log(\"<<<------- GOT\", GID, +new Date - S, err, data);\n            DBG && (DBG.sgr = +new Date);\n            DBG && (DBG.sgi = info);\n            try{opt.store.stats.get.time[statg % 50] = (+new Date) - S; ++statg;\n                opt.store.stats.get.count++;\n                if(err){ opt.store.stats.get.err = err }\n            }catch(e){} // STATS!\n            //if(u === data && info.chunks > 1){ return } // if we already sent a chunk, ignore ending empty responses. // this causes tests to fail.\n            console.STAT && console.STAT(S, +new Date - S, 'got', JSON.stringify(key)); S = +new Date;\n            info = info || '';\n            var va, ve;\n            if(info.unit && data && u !== (va = data[':']) && u !== (ve = data['>'])){ // new format\n                var tmp = key.split(esc), so = tmp[0], ha = tmp[1];\n                (graph = graph || {})[so] = Gun.state.ify(graph[so], ha, ve, va, so);\n                root.$.get(so).get(ha)._.rad = now;\n                // REMEMBER TO ADD _rad TO NODE/SOUL QUERY!\n            } else\n            if(data){ // old code path\n                if(typeof data !== 'string'){\n                    if(o.atom){\n                        data = u;\n                    } else {\n                        Radix.map(data, each, o); // IS A RADIX TREE, NOT FUNCTION!\n                    }\n                }\n                if(!graph && data){ each(data, '') }\n                // TODO: !has what about soul lookups?\n                if(!o.atom && !has & 'string' == typeof soul && !o.limit && !o.more){\n                    root.$.get(soul)._.rad = now;\n                }\n            }\n            DBG && (DBG.sgp = +new Date);\n            // TODO: PERF NOTES! This is like 0.2s, but for each ack, or all? Can you cache these preps?\n            // TODO: PERF NOTES! This is like 0.2s, but for each ack, or all? Can you cache these preps?\n            // TODO: PERF NOTES! This is like 0.2s, but for each ack, or all? Can you cache these preps?\n            // TODO: PERF NOTES! This is like 0.2s, but for each ack, or all? Can you cache these preps?\n            // TODO: PERF NOTES! This is like 0.2s, but for each ack, or all? Can you cache these preps?\n            // Or benchmark by reusing first start date.\n            if(console.STAT && (ST = +new Date - S) > 9){ console.STAT(S, ST, 'got prep time'); console.STAT(S, C, 'got prep #') } SPT += ST; C = 0; S = +new Date;\n            var faith = function(){}; faith.faith = true; faith.rad = get; // HNPERF: We're testing performance improvement by skipping going through security again, but this should be audited.\n            root.on('in', {'@': id, put: graph, '%': info.more? 1 : u, err: err? err : u, _: faith, DBG: DBG});\n            console.STAT && (ST = +new Date - S) > 9 && console.STAT(S, ST, 'got emit', Object.keys(graph||{}).length);\n            graph = u; // each is outside our scope, we have to reset graph to nothing!\n        }, o, DBG && (DBG.r = DBG.r || {}));\n        DBG && (DBG.sgd = +new Date);\n        console.STAT && (ST = +new Date - S) > 9 && console.STAT(S, ST, 'get call'); // TODO: Perf: this was half a second??????\n        function each(val, has, a,b){ // TODO: THIS CODE NEEDS TO BE FASTER!!!!\n            C++;\n            if(!val){ return }\n            has = (key+has).split(esc);\n            var soul = has.slice(0,1)[0];\n            has = has.slice(-1)[0];\n            if(o.limit && o.limit <= o.count){ return true }\n            var va, ve, so = soul, ha = has;\n            //if(u !== (va = val[':']) && u !== (ve = val['>'])){ // THIS HANDLES NEW CODE!\n            if('string' != typeof val){ // THIS HANDLES NEW CODE!\n                va = val[':']; ve = val['>'];\n                (graph = graph || {})[so] = Gun.state.ify(graph[so], ha, ve, va, so);\n                //root.$.get(so).get(ha)._.rad = now;\n                o.count = (o.count || 0) + ((va||'').length || 9);\n                return;\n            }\n            o.count = (o.count || 0) + val.length;\n            var tmp = val.lastIndexOf('>');\n            var state = Radisk.decode(val.slice(tmp+1), null, esc);\n            val = Radisk.decode(val.slice(0,tmp), null, esc);\n            (graph = graph || {})[soul] = Gun.state.ify(graph[soul], has, state, val, soul);\n        }\n    });\n    var val_is = Gun.valid;\n    (opt.store||{}).stats = {get:{time:{}, count:0}, put: {time:{}, count:0}}; // STATS!\n    var statg = 0, statp = 0; // STATS!\n});", "export default require(\"../../node_modules/.pnpm/gun@0.2020.1235/node_modules/gun/lib/store.js\");"],
  "mappings": "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",
  "names": []
}
